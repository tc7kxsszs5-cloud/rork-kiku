# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Bun test** –¥–ª—è unit —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
backend/trpc/routes/sync/
  ‚îú‚îÄ‚îÄ merge-logic.test.ts          # –¢–µ—Å—Ç—ã merge –ª–æ–≥–∏–∫–∏ –¥–ª—è —á–∞—Ç–æ–≤ –∏ –∞–ª–µ—Ä—Ç–æ–≤
  ‚îî‚îÄ‚îÄ settings-merge.test.ts       # –¢–µ—Å—Ç—ã merge –ª–æ–≥–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

constants/
  ‚îî‚îÄ‚îÄ risk-analysis.test.ts        # –¢–µ—Å—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤

utils/
  ‚îî‚îÄ‚îÄ pushNotificationHandler.test.ts  # –¢–µ—Å—Ç—ã –ª–æ–≥–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–∑ push
```

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞):

1. **Merge –ª–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
   - `mergeChats` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - `mergeMessages` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - `mergeAlerts` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤
   - `mergeSettings` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - `getDeltaChats` - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

2. **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤**
   - `evaluateMessageRisk` - –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - `evaluateImageRisk` - –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

3. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**
   - `getRouteFromPushNotification` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –∏–∑ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### ‚ùå –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞):

- –ü—Ä–æ—Å—Ç–æ–π CRUD
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ü—Ä–æ—Å—Ç—ã–µ –º–∞–ø–ø–∏–Ω–≥–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
bun test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ watch —Ä–µ–∂–∏–º–µ
bun test --watch

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
bun test backend/trpc/routes/sync/merge-logic.test.ts

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
bun test --coverage
```

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏
2. **–ò–∑–æ–ª—è—Ü–∏—è** - —Ç–µ—Å—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–∫–æ–≤ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π
4. **–õ–æ–≥–∏–∫–∞, –∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - —Ç–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –Ω–µ –¥–µ—Ç–∞–ª–∏ –∫–æ–¥–∞

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `*.test.ts` —Ä—è–¥–æ–º —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ù–∞–ø–∏—à–∏—Ç–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

## –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–∞

```typescript
import { describe, it, expect } from 'bun:test';

describe('functionName', () => {
  it('–¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å X –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ Y', () => {
    const input = { ... };
    const result = functionName(input);
    
    expect(result).toBe(expected);
  });
});
```

## –°—Ç–∞—Ç—É—Å –ø–æ–∫—Ä—ã—Ç–∏—è

- ‚úÖ Merge –ª–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ - –ø–æ–∫—Ä—ã—Ç–æ (15 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ - –ø–æ–∫—Ä—ã—Ç–æ (13 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏–∑ push - –ø–æ–∫—Ä—ã—Ç–æ (8 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ Merge –Ω–∞—Å—Ç—Ä–æ–µ–∫ - –ø–æ–∫—Ä—ã—Ç–æ (6 —Ç–µ—Å—Ç–æ–≤)
- ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ/E2E —Ç–µ—Å—Ç—ã - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)

**–í—Å–µ–≥–æ: 42 —Ç–µ—Å—Ç–∞, –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ ‚úÖ**

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
$ bun test

‚úÖ 42 pass
‚ùå 0 fail
‚è±Ô∏è  ~350ms
```

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –±—ã—Å—Ç—Ä—ã–µ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ.

