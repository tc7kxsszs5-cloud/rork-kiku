# Что происходит при запуске приложения KIKU

Простыми словами — что за что отвечает и в каком порядке всё работает.

---

## Две части приложения

У KIKU две части:

1. **Нативная оболочка (iOS)** — то, что собирает Xcode: экран, кнопки системы, симулятор. Она **не содержит** ваш интерфейс (чаты, настройки и т.д.).

2. **Код приложения (JavaScript/React)** — то, что вы правите в Cursor: экраны, логика, UI. Он **не встроен** в приложение в режиме разработки — он отдаётся по сети.

В режиме разработки (Debug) приложение **каждый раз загружает** этот код с сервера (Metro). Поэтому без Metro приложение «открывается», но экран пустой или с ошибкой.

---

## Кто такой Metro

**Metro** — это сервер на вашем компьютере. Он:

- читает ваш код (папки `app/`, `components/` и т.д.);
- собирает из него один «бандл» (JavaScript);
- отдаёт его приложению в симуляторе по адресу типа `http://localhost:8081`.

Пока Metro **не запущен**, приложению неоткуда взять код — поэтому «процесс запуска не происходит» или виден красный экран.

---

## Что происходит по шагам

### Если запускаете через Xcode

1. Вы нажимаете **Run** в Xcode.
2. Xcode собирает нативную часть и ставит приложение в симулятор.
3. Симулятор открывается, приложение стартует.
4. Приложение пытается подключиться к Metro (например, к `localhost:8081`).
5. **Если Metro не запущен** — приложение висит на загрузке или показывает ошибку. **Если Metro запущен** — подключается, загружает JS и показывает интерфейс.

Итого: **сначала** в терминале запускаете Metro (`bun run start`), **потом** в Xcode нажимаете Run.

### Если запускаете из терминала

Команда `bun run ios:sim` (или `bun run ios`):

1. Запускает Metro.
2. Открывает симулятор.
3. Запускает/собирает приложение и подключает его к Metro.

Всё делается одной командой, порядок уже правильный.

---

## Кратко

| Вопрос | Ответ |
|--------|--------|
| Почему симулятор открылся, а приложение «не запускается»? | Приложение ждёт Metro. Запустите в другом терминале `bun run start`, затем снова Run в Xcode. |
| Что такое Metro? | Сервер на вашем компе, который отдаёт приложению ваш JS-код. |
| Как запустить «всё сразу»? | В терминале: `bun run ios:sim` — Metro и симулятор запустятся вместе. |
| Где править код? | В Cursor (папки `app/`, `components/` и т.д.). После сохранения Metro отдаёт обновлённый код — в симуляторе можно обновить экран (или он обновится сам). |

---

## «Одно и то же давно устанавливает» — что это и когда ждать

Часто кажется, что **одно и то же** ставится снова и очень долго. На самом деле установки делятся на две группы.

### Что делается **один раз** (или редко)

| Действие | Когда нужно | Сколько раз |
|----------|-------------|-------------|
| `bun install` | После клонирования проекта или когда в `package.json` добавили зависимости | Один раз (потом только при изменении зависимостей). |
| `sudo gem install cocoapods` или `gem install cocoapods` | Если ещё нет CocoaPods | Один раз на компьютер. |
| `cd ios && pod install` | После первого запуска iOS или после изменения нативных зависимостей | Один раз, потом только если меняли `Podfile` или добавляли нативные модули. |

**Первый раз** `pod install` может идти **несколько минут** (5–15 и больше) — качаются и собираются все iOS-библиотеки. Это нормально. Когда в конце появится строка вроде «Pod installation complete» — **всё, больше этот шаг при каждом запуске не нужен.**

Если вы **не меняли** зависимости и не делали `pod install` заново — при следующих запусках (`bun run ios`, `bun run start`) поды заново **не ставятся**. То, что «одно и то же устанавливается», может быть другим шагом (см. ниже).

### Что происходит **при каждом** запуске приложения

| Действие | Что вы видите |
|----------|----------------|
| `bun run start` или `bun run ios:sim` | Запускается **Metro** (сервер). Он не «ставит» пакеты заново — он просто стартует и ждёт подключения приложения. |
| `bun run ios` (expo run:ios) | Expo может **проверить**, что поды установлены, и при первом запуске или после изменений — вызвать `pod install`. Если поды уже стоят, это быстро. |
| Сборка в Xcode (Run) | Xcode **собирает** приложение (компилирует код). Это не установка зависимостей — это компиляция. При следующих запусках обычно быстрее (инкрементальная сборка). |

Итого: **долго «устанавливается»** обычно только при **первом** `bun install` и **первом** `pod install`. Дальше при обычном запуске (`bun run start`, затем Run в Xcode или `bun run ios:sim`) никакая полная установка заново не идёт — только старт Metro и сборка.

### Как понять, что «установка» закончилась

- **`pod install`** — в конце в терминале будет что-то вроде:  
  `Pod installation complete. There are X dependencies...`  
  После этого можно закрыть этот процесс и дальше просто запускать приложение.
- **`bun run start`** — когда в терминале появится что-то вроде:  
  `Metro waiting on...` или QR-код и «Press i for iOS» — Metro уже работает, можно нажимать Run в Xcode или `i` для симулятора.
- **Xcode (Run)** — когда внизу в Xcode появится «Build Succeeded» и в симуляторе откроется приложение — сборка закончилась.

Если один и тот же шаг (например, `pod install`) вы запускаете или видите **каждый раз** при `bun run ios` — возможно, поды так и не установились один раз успешно (например, падала установка CocoaPods). Тогда стоит один раз вручную сделать `cd ios && pod install`, дождаться «Pod installation complete», и дальше не трогать — при следующих `bun run ios` повторная полная установка не нужна.

---

Если что-то из этого всё равно непонятно — напишите, что именно видите на экране (например: «открылся симулятор и белый экран» или «красная ошибка с текстом ...») и что делали перед этим (только Xcode или только терминал).
