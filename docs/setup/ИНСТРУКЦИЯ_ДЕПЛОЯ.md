# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ Vercel –∏ Supabase

## üìã –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)

### 1.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Supabase

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –ù–∞–∂–º–∏—Ç–µ "Start your project"
3. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ GitHub (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç)
4. –ù–∞–∂–º–∏—Ç–µ "New Project"
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Name:** `kiku-production` (–∏–ª–∏ –ª—é–±–æ–µ –∏–º—è)
   - **Database Password:** –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ!)
   - **Region:** –≤—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω
   - **Pricing Plan:** Free (–¥–ª—è —Å—Ç–∞—Ä—Ç–∞)

6. –ù–∞–∂–º–∏—Ç–µ "Create new project"
7. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç

### 1.2. –ü–æ–ª—É—á–µ–Ω–∏–µ Connection String

1. –í –ø—Ä–æ–µ–∫—Ç–µ Supabase –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Database**
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **Connection string**
3. –í—ã–±–µ—Ä–∏—Ç–µ **URI** (–Ω–µ Pooling)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ connection string (–≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫):
   ```
   postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres
   ```
5. –ó–∞–º–µ–Ω–∏—Ç–µ `[YOUR-PASSWORD]` –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å –∏–∑ —à–∞–≥–∞ 1.1
6. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç URL** - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è Vercel

### 1.3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã)

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–π—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ SQL Editor –≤ Supabase:

```sql
-- –ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE,
  name TEXT,
  role TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
CREATE TABLE IF NOT EXISTS sync_data (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  device_id TEXT,
  data JSONB,
  updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## üìã –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Vercel (Backend API)

### 2.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vercel CLI

```bash
npm install -g vercel
```

### 2.2. –õ–æ–≥–∏–Ω –≤ Vercel

```bash
vercel login
```

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### 2.3. –î–µ–ø–ª–æ–π backend

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é backend
cd backend

# –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π (development)
vercel

# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
# - Set up and deploy? Y
# - Which scope? (–≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç)
# - Link to existing project? N
# - Project name? kiku-backend (–∏–ª–∏ –ª—é–±–æ–µ –∏–º—è)
# - Directory? ./
# - Override settings? N
```

### 2.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Environment Variables

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [vercel.com/dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç `kiku-backend`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Environment Variables**
4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

   ```
   DATABASE_URL = postgresql://postgres:password@db.xxxxx.supabase.co:5432/postgres
   NODE_ENV = production
   ```

   (–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection string –∏–∑ Supabase)

5. –ù–∞–∂–º–∏—Ç–µ "Save"

### 2.5. Production –¥–µ–ø–ª–æ–π

```bash
# –î–µ–ø–ª–æ–π –≤ production
vercel --prod
```

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ URL —Ç–∏–ø–∞: `https://kiku-backend.vercel.app`

---

## üìã –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend

### 3.1. –û–±–Ω–æ–≤–∏—Ç—å API URL –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–û—Ç–∫—Ä–æ–π—Ç–µ `lib/trpc.ts` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ:

```typescript
// –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Vercel URL
const PROJECT_BASE_URL = 'https://kiku-backend.vercel.app';
```

### 3.2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ EAS Build
eas build --platform all

# –ò–ª–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
bun run start:simple
```

---

## üìã –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 4.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Backend API

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://your-backend.vercel.app/
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è:
```json
{
  "status": "ok",
  "message": "API is running"
}
```

### 4.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å tRPC endpoint

–û—Ç–∫—Ä–æ–π—Ç–µ:
```
https://your-backend.vercel.app/api/trpc/example.hi
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç–≤–µ—Ç –æ—Ç tRPC.

### 4.3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–í Supabase Dashboard:
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **Table Editor**
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –≤–∞—à–∏ —Ç–∞–±–ª–∏—Ü—ã (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏)

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–í `backend/hono.ts` —É–∂–µ –µ—Å—Ç—å:
```typescript
app.use("*", cors());
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å origins, –æ–±–Ω–æ–≤–∏—Ç–µ:
```typescript
app.use("*", cors({
  origin: ['https://your-app-domain.com'],
  credentials: true,
}));
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Rate Limiting

–í `backend/trpc/middleware/rateLimit.ts` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–º–∏—Ç—ã.

---

## üö® Troubleshooting

### –û—à–∏–±–∫–∞: "Cannot find module"

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
cd backend
bun install
```

### –û—à–∏–±–∫–∞: "Database connection failed"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` –≤ Vercel Environment Variables
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Supabase –ø—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–µ–Ω

### –û—à–∏–±–∫–∞: "CORS error"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ `backend/hono.ts`
2. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ `ALLOWED_ORIGINS`

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Vercel Dashboard

- **Deployments** - –∏—Å—Ç–æ—Ä–∏—è –¥–µ–ø–ª–æ–µ–≤
- **Functions** - –ª–æ–≥–∏ serverless functions
- **Analytics** - –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Supabase Dashboard

- **Database** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Logs** - –ª–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **API** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –≤ Supabase
- [ ] –ü–æ–ª—É—á–µ–Ω connection string
- [ ] –°–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Vercel CLI
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω –¥–µ–ø–ª–æ–π –Ω–∞ Vercel
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã environment variables
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω API URL –≤ frontend
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ API
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π** —á–µ—Ä–µ–∑ GitHub Actions (—É–∂–µ –µ—Å—Ç—å –≤ `.github/workflows/deploy-backend.yml`)
2. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Sentry, LogRocket)
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. **–î–æ–±–∞–≤–∏—Ç—å Redis** –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

**–ì–æ—Ç–æ–≤–æ! –í–∞—à backend —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Vercel, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Supabase! üöÄ**
