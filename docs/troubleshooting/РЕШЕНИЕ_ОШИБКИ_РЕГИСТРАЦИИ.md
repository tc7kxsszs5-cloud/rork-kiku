# Решение ошибки регистрации родителя

## Проблема

Ошибка: "Ошибка при создании аккаунта родителя"

## Причины

Скорее всего одна из следующих:

1. **Таблица `parents` не существует в Supabase** (наиболее вероятно)
2. **Код не развернут на Vercel** с последними изменениями
3. **Проблема с переменными окружения** в Vercel

## Решение

### Шаг 1: Применить SQL схему в Supabase

1. Откройте Supabase Dashboard: https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в **SQL Editor**
4. Откройте файл `SQL_РОДИТЕЛЬ_РЕБЕНОК_ДЛЯ_SUPABASE.sql`
5. Скопируйте весь SQL код
6. Вставьте в SQL Editor и нажмите **Run**
7. Проверьте, что таблицы созданы (Table Editor → должна быть таблица `parents`)

### Шаг 2: Развернуть обновленный backend на Vercel

```bash
cd backend
bunx vercel --prod
```

Или если нужно принудительно обновить:

```bash
cd backend
bunx vercel --prod --force
```

### Шаг 3: Проверить переменные окружения в Vercel

Убедитесь, что в Vercel установлены:
- `SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY` (или `SUPABASE_ANON_KEY`)

### Шаг 4: Проверить подключение и таблицы

```bash
cd backend
bun test-db-check.ts
```

Должно показать:
- ✅ Подключение успешно
- ✅ Таблица `parents` существует

### Шаг 5: Повторить тест регистрации

```bash
cd backend
bun test-registration.ts
```

Теперь должно работать!

## Проверка в Supabase

После применения SQL схемы проверьте:

```sql
-- Проверка существования таблицы
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name = 'parents';

-- Проверка структуры таблицы
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'parents';
```

## Если проблема сохраняется

1. Проверьте логи Vercel: https://vercel.com/dashboard → ваш проект → Deployments → Functions → Logs
2. Проверьте детали ошибки в ответе (должны быть `errorCode`, `errorDetails`, `errorHint`)
3. Убедитесь, что используется `SUPABASE_SERVICE_ROLE_KEY` (не `ANON_KEY`) для backend операций
