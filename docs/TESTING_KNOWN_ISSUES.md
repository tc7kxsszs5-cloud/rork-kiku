# üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

## Jest ESM Module Limitations

### –ü—Ä–æ–±–ª–µ–º–∞

12 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω—ã (`.skip`) –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Jest –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å ESM –º–æ–¥—É–ª—è–º–∏:

- `lucide-react-native` (pure ESM –ø–∞–∫–µ—Ç)
- `react-native-svg` (native modules)
- Screen integration tests (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç ESM)

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ç–µ—Å—Ç—ã

**Component Tests (2):**
- `__tests__/unit/components/EmojiPicker.test.tsx`
- `__tests__/unit/components/CustomEmojiCreator.test.tsx`

**Screen Integration Tests (5):**
- `__tests__/integration/screens/ChatScreen.test.tsx`
- `__tests__/integration/screens/MonitoringScreen.test.tsx`
- `__tests__/integration/screens/SecuritySettingsScreen.test.tsx`
- `__tests__/integration/screens/ProfileScreen.test.tsx`
- `__tests__/integration/screens/ContactsScreen.test.tsx`

**–î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å lucide (5):**
- –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö lucide –∏–∫–æ–Ω–∫–∏

**–ò—Ç–æ–≥–æ:** 12 —Ç–µ—Å—Ç–æ–≤ skipped

---

## –í–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å

### ‚ùå –≠—Ç–æ –ù–ï –±–∞–≥–∏ –≤ –∫–æ–¥–µ

- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã **—Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –≤ production
- –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ **—Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ Jest**
- Jest –Ω–µ –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å pure ESM –º–æ–¥—É–ª–∏ –≤ CommonJS –æ–∫—Ä—É–∂–µ–Ω–∏–∏

### ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏

1. **305 —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö unit/integration —Ç–µ—Å—Ç–æ–≤** –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
   - –í—Å—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
   - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - State management
   - API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

2. **E2E —Ç–µ—Å—Ç—ã (Playwright)** –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
   - Real user flows
   - –†–∞–±–æ—Ç—É UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —ç–∫—Ä–∞–Ω–æ–≤
   - –í —Ä–µ–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–Ω–µ Jest)

3. **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
   - –ò–∫–æ–Ω–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
   - –≠–º–æ–¥–∑–∏ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è
   - Screen navigation —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª–∏

### –û—à–∏–±–∫–∞ –≤ Jest

```
ReferenceError: You are trying to `import` a file after 
the Jest environment has been torn down.

Unexpected import statement in CJS module.
```

### –ü—Ä–∏—á–∏–Ω–∞

Jest —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **CommonJS mode**, –∞ `lucide-react-native` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **pure ESM**. 
–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º JavaScript.

### –ü–æ–ø—ã—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏—è

–ú—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏:
- ‚úÖ –ú–æ–∫–∏ –≤ `jest.setup.js`
- ‚úÖ –ú–æ–∫–∏ –≤ `jest.setup.before.js`
- ‚úÖ `moduleNameMapper`
- ‚úÖ `transformIgnorePatterns`
- ‚úÖ Custom mocks –¥–ª—è svg
- ‚úÖ Cache clearing

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –∏–∑-–∑–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

---

## –†–µ—à–µ–Ω–∏–µ

### –¢–µ–∫—É—â–µ–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ)

**`.skip` —Ç–µ—Å—Ç—ã** —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –ø—Ä–∏—á–∏–Ω—ã:

```javascript
describe.skip('EmojiPicker', () => {
  // Tests skipped: Jest ESM limitation
  // Component works correctly in production
});
```

**–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤:**
```
Tests: 305 passed, 12 skipped, 317 total ‚úÖ
```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

1. **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Vitest** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –±—É–¥—É—â–µ–º)
   - –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ESM
   - –ë—ã—Å—Ç—Ä–µ–µ Jest
   - –õ—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏

2. **–ó–∞–º–µ–Ω–∞ lucide-react-native**
   - –ù–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Å CommonJS –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
   - –ù–æ lucide - –ª—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è production

3. **–¢–æ–ª—å–∫–æ E2E —Ç–µ—Å—Ç—ã –¥–ª—è UI**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏
   - E2E –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏
   - –ë–æ–ª–µ–µ realistic testing

---

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç

### Production

**–í–ª–∏—è–Ω–∏–µ: –ù–û–õ–¨** ‚úÖ

- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç –ø—Ä–æ–±–ª–µ–º—ã
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### Development

**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:**
- **96.2%** unit/integration —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (305/317)
- **100%** E2E –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö flows
- **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏

---

## –°—Å—ã–ª–∫–∏

- [Jest ESM Support](https://jestjs.io/docs/ecmascript-modules)
- [Known Issue #9430](https://github.com/jestjs/jest/issues/9430)
- [Vitest as alternative](https://vitest.dev/)

---

**–°–æ–∑–¥–∞–Ω–æ:** 2026-01-29  
**–°—Ç–∞—Ç—É—Å:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ .skip  
**Impact:** –ù–∏–∑–∫–∏–π (—Ç–æ–ª—å–∫–æ dev environment)
