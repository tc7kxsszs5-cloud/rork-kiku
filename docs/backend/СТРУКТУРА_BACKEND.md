# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Backend

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Backend?

**Backend** - —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è KIKU, –∫–æ—Ç–æ—Ä–∞—è:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (PostgreSQL/Supabase)
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `backend/`

```
backend/
‚îú‚îÄ‚îÄ index.ts                    # üö™ –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ package.json                # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ vercel.json                 # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Vercel
‚îú‚îÄ‚îÄ Dockerfile                  # üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tsconfig.json               # üìù TypeScript –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ trpc/                       # üîå tRPC (API —Ä–æ—É—Ç–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ app-router.ts          # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –≤—Å–µ—Ö API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ create-context.ts      # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware/            # üõ°Ô∏è –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rateLimit.ts      # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ routes/                # üõ£Ô∏è API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ auth/              # üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ register-parent.ts    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ register-child.ts     # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–±–µ–Ω–∫–∞
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ validate-code.ts      # –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–¥–∞
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ sync/               # üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ chats.ts       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–∞—Ç–æ–≤
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ alerts.ts      # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ settings.ts    # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ notifications/     # üì± Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ register-device.ts    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ send-push.ts          # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ get-sync-status.ts    # –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ log-device-test.ts    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ test/               # üß™ –¢–µ—Å—Ç–æ–≤—ã–µ endpoints
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ db-check.ts    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ example/            # üìö –ü—Ä–∏–º–µ—Ä—ã
‚îÇ           ‚îî‚îÄ‚îÄ hi/route.ts    # –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ endpoint
‚îÇ
‚îú‚îÄ‚îÄ utils/                      # üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts            # –†–∞–±–æ—Ç–∞ —Å Supabase
‚îÇ   ‚îú‚îÄ‚îÄ security.ts            # –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ validationSchemas.ts   # –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (Zod)
‚îÇ   ‚îî‚îÄ‚îÄ syncHelpers.ts         # –ü–æ–º–æ—â–Ω–∏–∫–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ schema.sql                  # üìä SQL —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ schema-parent-child.sql    # –°—Ö–µ–º–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å-—Ä–µ–±–µ–Ω–æ–∫
‚îú‚îÄ‚îÄ security-policies.sql      # –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ë–î
‚îÇ
‚îî‚îÄ‚îÄ –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è:
    ‚îú‚îÄ‚îÄ deploy.sh              # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
    ‚îú‚îÄ‚îÄ auto-deploy.sh         # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
    ‚îî‚îÄ‚îÄ setup-env.sh           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **index.ts** - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- –°–æ–∑–¥–∞–µ—Ç Hono –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç CORS (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç tRPC —Ä–æ—É—Ç–µ—Ä
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç handler –¥–ª—è Vercel

### 2. **trpc/app-router.ts** - API —Ä–æ—É—Ç–µ—Ä
–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ API endpoints:
- `auth.*` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `sync.*` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `notifications.*` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `test.*` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. **routes/** - API endpoints
–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É tRPC:
```typescript
// –ü—Ä–∏–º–µ—Ä: routes/auth/register-parent.ts
export const registerParentProcedure = createTRPCProcedure()
  .input(z.object({ ... }))
  .mutation(async ({ input, ctx }) => {
    // –õ–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  });
```

### 4. **utils/** - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `supabase.ts` - –∫–ª–∏–µ–Ω—Ç Supabase –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- `security.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–æ–∫–µ–Ω—ã)
- `validationSchemas.ts` - —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `syncHelpers.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ó–∞–ø—Ä–æ—Å –æ—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```
Mobile App ‚Üí tRPC Client ‚Üí Backend (index.ts) ‚Üí tRPC Router ‚Üí Route Handler ‚Üí Database
                                                                              ‚Üì
Mobile App ‚Üê tRPC Response ‚Üê Backend ‚Üê tRPC Router ‚Üê Route Handler ‚Üê Database
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```typescript
// –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
const result = await trpc.auth.registerParent.mutate({
  email: "parent@example.com",
  password: "secure123"
});

// Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ routes/auth/register-parent.ts
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **CORS** - –∑–∞—â–∏—Ç–∞ –æ—Ç –º–µ–∂—Å–∞–π—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **Validation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Zod)
- **Secure Storage** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- **SQL Injection Protection** - —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

Backend —Ä–∞–±–æ—Ç–∞–µ—Ç —Å:
- **Supabase** (PostgreSQL) - –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
- **Redis** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ö–µ–º—ã –ë–î:
- `schema.sql` - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞
- `schema-parent-child.sql` - —Å–≤—è–∑–∏ —Ä–æ–¥–∏—Ç–µ–ª—å-—Ä–µ–±–µ–Ω–æ–∫
- `security-policies.sql` - –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üì° API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
- `auth.registerParent` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
- `auth.registerChild` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–±–µ–Ω–∫–∞
- `auth.validateParentCode` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Ä–æ–¥–∏—Ç–µ–ª—è

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- `sync.chats.*` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–∞—Ç–æ–≤
- `sync.alerts.*` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤
- `sync.settings.*` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
- `notifications.registerDevice` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `notifications.sendPushToDevice` - –æ—Ç–ø—Ä–∞–≤–∫–∞ push
- `notifications.getSyncStatus` - —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `test-db-check.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- `test-registration.ts` - —Ç–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `test-sync.ts` - —Ç–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `test-alerts.ts` - —Ç–µ—Å—Ç –∞–ª–µ—Ä—Ç–æ–≤

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
cd backend
bun run test-db-check.ts
```

---

## üöÄ –î–µ–ø–ª–æ–π

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
cd backend
bun install
bun run dev
# –°–µ—Ä–≤–µ—Ä –Ω–∞ http://localhost:3000
```

### –ù–∞ Vercel:
```bash
cd backend
vercel --prod
```

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:
```bash
./scripts/deploy.sh backend
```

---

## üìö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Hono** - –±—ã—Å—Ç—Ä—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **tRPC** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π API
- **Supabase** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- **Zod** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Bun** - JavaScript runtime

---

## üîó –°–≤—è–∑—å —Å Mobile App

Mobile app –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ backend —á–µ—Ä–µ–∑:
```typescript
// –í mobile app
const trpc = createTRPCClient<AppRouter>({
  url: 'https://your-backend.vercel.app/api/trpc',
});
```

–í—Å–µ —Ç–∏–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è tRPC!

---

**Backend - —ç—Ç–æ "–º–æ–∑–≥" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –∏ –¥–∞–Ω–Ω—ã–µ! üß†**
