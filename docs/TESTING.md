# üß™ –ì–∞–π–¥ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Ç–µ—Å—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ KIKU.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
- [–†–∞–±–æ—Ç–∞ —Å Jest](#—Ä–∞–±–æ—Ç–∞-—Å-jest)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–æ–≤)
- [–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤](#–Ω–∞–ø–∏—Å–∞–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤)
- [–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∏–∑–≤–µ—Å—Ç–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bun install

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
bun run test

# –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤
bun run test:unit
```

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
bun run test

# Unit —Ç–µ—Å—Ç—ã (19 —Ç–µ—Å—Ç–æ–≤)
bun run test:unit

# Integration —Ç–µ—Å—Ç—ã
bun run test:integration

# E2E —Ç–µ—Å—Ç—ã
bun run test:e2e

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
bun run test:coverage

# –¢–µ—Å—Ç—ã –≤ watch —Ä–µ–∂–∏–º–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
bun run test:watch
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Bun (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤)

```bash
# Unit —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ Bun (–±—ã—Å—Ç—Ä–µ–µ)
bun run test:bun

# –í—Å–µ —Ç–µ—Å—Ç—ã (Bun + Jest)
bun run test:all
```

#### –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ Jest

```bash
# –ß–µ—Ä–µ–∑ bunx
bunx jest

# –° —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø—É—Ç–∏
bunx jest --testPathPattern=unit

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ñ–∞–π–ª–æ–º
bunx jest __tests__/unit/utils/aiService.test.ts
```

## üîß –†–∞–±–æ—Ç–∞ —Å Jest

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `jest.config.js`:

```javascript
module.exports = {
  preset: 'jest-expo',
  testEnvironment: 'node',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/$1',
  },
  // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ESM –º–æ–¥—É–ª–µ–π
  extensionsToTreatAsEsm: ['.ts', '.tsx'],
  globals: {
    'ts-jest': {
      useESM: true,
    },
  },
};
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **maxWorkers:** 50% CPU (–≤ CI: 2)
- **testTimeout:** 10000ms
- **cache:** –í–∫–ª—é—á–µ–Ω –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

### –ú–æ–∫–∏ –∏ setup

–§–∞–π–ª `jest.setup.js` —Å–æ–¥–µ—Ä–∂–∏—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```javascript
// –ü—Ä–∏–º–µ—Ä –º–æ–∫–∞ –¥–ª—è expo-constants
jest.mock('expo-constants', () => ({
  default: {
    expoConfig: {
      extra: {
        openaiApiKey: undefined,
        aiProvider: 'local',
      },
    },
  },
}));
```

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
__tests__/
‚îú‚îÄ‚îÄ unit/                    # Unit —Ç–µ—Å—Ç—ã (19 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ components/         # –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OnlineStatus.test.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Typography.test.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ contexts/          # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.test.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserContext.test.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ThemeContext.test.tsx
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç
‚îÇ       ‚îú‚îÄ‚îÄ aiService.test.ts
‚îÇ       ‚îú‚îÄ‚îÄ syncService.test.ts
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ integration/            # Integration —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ e2e/                   # E2E —Ç–µ—Å—Ç—ã
    ‚îî‚îÄ‚îÄ app-flow.test.tsx
```

### –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

1. **Unit —Ç–µ—Å—Ç—ã** (`__tests__/unit/`)
   - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - –ë—ã—Å—Ç—Ä—ã–µ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
   - 19 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç ‚úÖ

2. **Integration —Ç–µ—Å—Ç—ã** (`__tests__/integration/`)
   - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

3. **E2E —Ç–µ—Å—Ç—ã** (`__tests__/e2e/`)
   - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - –¢—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

## ‚úçÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä unit —Ç–µ—Å—Ç–∞

```typescript
import { getAIConfig } from '@/utils/aiService';

describe('aiService', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('getAIConfig', () => {
    it('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', () => {
      const config = getAIConfig();
      
      expect(config).toBeDefined();
      expect(config.provider).toBe('local');
    });
  });
});
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```typescript
import { render } from '@testing-library/react-native';
import { OnlineStatus } from '@/components/OnlineStatus';

describe('OnlineStatus', () => {
  it('–¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω', () => {
    const { getByText } = render(<OnlineStatus isOnline={true} />);
    
    expect(getByText('–û–Ω–ª–∞–π–Ω')).toBeTruthy();
  });
});
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```typescript
import { renderHook, act } from '@testing-library/react-hooks';
import { useAuth } from '@/contexts/AuthContext';

describe('AuthContext', () => {
  it('–¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏', () => {
    const { result } = renderHook(() => useAuth());
    
    expect(result.current.login).toBeDefined();
    expect(result.current.logout).toBeDefined();
  });
});
```

### Best practices

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤**
   ```typescript
   // ‚úÖ –•–æ—Ä–æ—à–æ
   it('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º email', () => {
   
   // ‚ùå –ü–ª–æ—Ö–æ
   it('test email', () => {
   ```

2. **–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
   ```typescript
   describe('aiService', () => {
     describe('getAIConfig', () => {
       // —Ç–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
     });
     describe('analyzeMessage', () => {
       // —Ç–µ—Å—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
     });
   });
   ```

3. **–û—á–∏—â–∞–π—Ç–µ –º–æ–∫–∏ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏**
   ```typescript
   beforeEach(() => {
     jest.clearAllMocks();
   });
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
   ```typescript
   jest.mock('expo-constants', () => ({
     default: { expoConfig: { extra: {} } },
   }));
   ```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Jest ESM –ø—Ä–æ–±–ª–µ–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
TypeError: Attempted to assign to readonly property.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É `jest-expo` preset –∏ Node.js 20+ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å ESM –º–æ–¥—É–ª—è–º–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—á —á–µ—Ä–µ–∑ `postinstall` —Å–∫—Ä–∏–ø—Ç
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Bun –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ESM –≤ `jest.config.js`

**–û–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Bun –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤
bun run test:bun
```

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å react-native –º–æ–¥—É–ª—è–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π React Native.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –¥–ª—è –Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

```typescript
jest.mock('react-native', () => {
  const RN = jest.requireActual('react-native');
  return {
    ...RN,
    NativeModules: {
      // –º–æ–∫–∏ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
    },
  };
});
```

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–µ–º Jest

**–ü—Ä–æ–±–ª–µ–º–∞:** –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫—ç—à –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
bunx jest --clearCache

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑ –∫—ç—à–∞
bunx jest --no-cache
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
bun run test:coverage

# –û—Ç—á–µ—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤:
# - coverage/lcov-report/index.html (HTML)
# - coverage/coverage-final.json (JSON)
```

### –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

- ‚úÖ **Unit —Ç–µ—Å—Ç—ã:** ~80% –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚ö†Ô∏è **Integration —Ç–µ—Å—Ç—ã:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- ‚ö†Ô∏è **E2E —Ç–µ—Å—Ç—ã:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## üîç –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```bash
# –ü–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
bunx jest __tests__/unit/utils/aiService.test.ts

# –ü–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
bunx jest --testNamePattern="–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"
```

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å –≤—ã–≤–æ–¥–æ–º –≤—Å–µ—Ö –ª–æ–≥–æ–≤
bunx jest --verbose

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
bunx jest --onlyFailures

# –ó–∞–ø—É—Å–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
DEBUG=* bunx jest
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Jest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://jestjs.io/docs/getting-started)
- [React Native Testing Library](https://callstack.github.io/react-native-testing-library/)
- [Expo Testing Guide](https://docs.expo.dev/guides/testing-with-jest/)

## ü§ù –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∞–º–∏:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [CONTRIBUTING.md](../CONTRIBUTING.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –≤ `__tests__/unit/`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `jest.config.js`
