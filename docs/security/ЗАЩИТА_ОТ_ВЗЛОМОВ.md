# üîí –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–∑–ª–æ–º–æ–≤ –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

### 1. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–°—Ç—Ä–æ–≥–∏–µ Zod —Å—Ö–µ–º—ã** –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Sanitization** –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö** (–º–∞–∫—Å–∏–º—É–º 1000 —á–∞—Ç–æ–≤/–∞–ª–µ—Ä—Ç–æ–≤ –∑–∞ —Ä–∞–∑)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤** (email, phone, deviceId, timestamps)

**–§–∞–π–ª—ã:**
- `backend/utils/validationSchemas.ts` - —Å—Ç—Ä–æ–≥–∏–µ —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `backend/utils/security.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ sanitization

### 2. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection
- **Supabase SDK** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç SQL injection
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —á–µ—Ä–µ–∑ SDK
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è sanitization** —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### 3. ‚úÖ Rate Limiting
- **Middleware –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** –ø–æ IP/deviceId
- **–†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π:
  - AI –æ–ø–µ—Ä–∞—Ü–∏–∏: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
  - –û–±—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã: 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

**–§–∞–π–ª—ã:**
- `backend/trpc/middleware/rateLimit.ts` - rate limiting middleware
- –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫–æ –≤—Å–µ–º sync routes

### 4. ‚úÖ CORS –∑–∞—â–∏—Ç–∞
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ origins** - —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ headers** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ
- **Credentials –∑–∞—â–∏—Ç–∞** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–§–∞–π–ª—ã:**
- `backend/index.ts` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 5. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
- **Sanitization –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫** –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- **–£–¥–∞–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤** –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è HTML/JavaScript** –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

**–§–∞–π–ª—ã:**
- `backend/utils/security.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ sanitization –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ XSS

### 6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –≤ production
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–§–∞–π–ª—ã:**
- `backend/index.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Hono
- `backend/trpc/create-context.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ tRPC

### 7. ‚úÖ Row Level Security (RLS)
- **–ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ Supabase
- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –ø–æ device_id
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**

**–§–∞–π–ª—ã:**
- `backend/security-policies.sql` - SQL –ø–æ–ª–∏—Ç–∏–∫–∏ RLS

### 8. ‚úÖ –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
- **–ú–∞–∫—Å–∏–º—É–º 1000 —á–∞—Ç–æ–≤** –∑–∞ –æ–¥–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- **–ú–∞–∫—Å–∏–º—É–º 1000 –∞–ª–µ—Ä—Ç–æ–≤** –∑–∞ –æ–¥–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- **–ú–∞–∫—Å–∏–º—É–º 10KB** –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–ú–∞–∫—Å–∏–º—É–º 10 email/phone** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å Row Level Security –≤ Supabase

**–í–∞–∂–Ω–æ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `backend/security-policies.sql`
5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL (Run)

### 2. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π backend

```bash
cd backend
bunx vercel --prod
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

```bash
cd backend
bun test-settings.ts
```

---

## üîê –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### 1. Environment Variables
- ‚úÖ –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ù–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Vercel Environment Variables

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ rate limits
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 3. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
  ```bash
  bun update
  bun audit
  ```

### 4. –ë—ç–∫–∞–ø—ã
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Supabase
- –•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ

### 5. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–±—É–¥—É—â–µ–µ)
- –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
  - JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ user_id
  - Refresh tokens –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∞—Ç–∞–∫:

### SQL Injection
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–æ:** Supabase SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** Sanitization –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### XSS (Cross-Site Scripting)
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–æ:** Sanitization –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –§—É–Ω–∫—Ü–∏—è `containsXSS()` –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### CSRF (Cross-Site Request Forgery)
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–æ:** CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã –¥–ª—è production

### DDoS / Rate Limiting
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–æ:** Rate limiting middleware
- ‚úÖ **–õ–∏–º–∏—Ç—ã:** 10-100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

### Data Injection
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–æ:** –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å Zod
- ‚úÖ **–õ–∏–º–∏—Ç—ã:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### Unauthorized Access
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–æ:** Row Level Security –ø–æ–ª–∏—Ç–∏–∫–∏
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è:** –î–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ device_id

---

## üìä –°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –£—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã |
|-----------|--------|----------------|
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | ‚úÖ | –í—ã—Å–æ–∫–∏–π |
| SQL Injection –∑–∞—â–∏—Ç–∞ | ‚úÖ | –í—ã—Å–æ–∫–∏–π |
| Rate Limiting | ‚úÖ | –°—Ä–µ–¥–Ω–∏–π-–í—ã—Å–æ–∫–∏–π |
| CORS –∑–∞—â–∏—Ç–∞ | ‚úÖ | –°—Ä–µ–¥–Ω–∏–π |
| XSS –∑–∞—â–∏—Ç–∞ | ‚úÖ | –°—Ä–µ–¥–Ω–∏–π-–í—ã—Å–æ–∫–∏–π |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | ‚úÖ | –í—ã—Å–æ–∫–∏–π |
| Row Level Security | ‚ö†Ô∏è | –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | ‚ö†Ô∏è | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å |

---

## üöÄ –ü—Ä–æ–µ–∫—Ç –∑–∞—â–∏—â–µ–Ω!

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–∞—â–∏—â–µ–Ω –æ—Ç –≤–∑–ª–æ–º–æ–≤ –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å `security-policies.sql` –≤ Supabase!
