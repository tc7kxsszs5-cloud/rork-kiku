# üìã –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ KIKU

## üéØ –¢–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:

### 1. `chats` - –ß–∞—Ç—ã

```sql
CREATE TABLE IF NOT EXISTS chats (
  id TEXT PRIMARY KEY,
  device_id TEXT NOT NULL,
  contact_name TEXT NOT NULL,
  contact_phone TEXT,
  last_message TEXT,
  last_message_timestamp BIGINT,
  risk_level TEXT DEFAULT 'safe',
  unread_count INTEGER DEFAULT 0,
  created_at BIGINT NOT NULL,
  updated_at BIGINT NOT NULL
);

CREATE INDEX IF NOT EXISTS idx_chats_device_id ON chats(device_id);
CREATE INDEX IF NOT EXISTS idx_chats_updated_at ON chats(updated_at);
```

### 2. `messages` - –°–æ–æ–±—â–µ–Ω–∏—è

```sql
CREATE TABLE IF NOT EXISTS messages (
  id TEXT PRIMARY KEY,
  chat_id TEXT NOT NULL REFERENCES chats(id) ON DELETE CASCADE,
  device_id TEXT NOT NULL,
  sender TEXT NOT NULL,
  content TEXT NOT NULL,
  timestamp BIGINT NOT NULL,
  message_type TEXT DEFAULT 'text',
  risk_level TEXT DEFAULT 'safe',
  ai_analysis JSONB,
  created_at BIGINT NOT NULL
);

CREATE INDEX IF NOT EXISTS idx_messages_chat_id ON messages(chat_id);
CREATE INDEX IF NOT EXISTS idx_messages_device_id ON messages(device_id);
CREATE INDEX IF NOT EXISTS idx_messages_timestamp ON messages(timestamp);
```

### 3. `alerts` - –ê–ª–µ—Ä—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```sql
CREATE TABLE IF NOT EXISTS alerts (
  id TEXT PRIMARY KEY,
  device_id TEXT NOT NULL,
  chat_id TEXT,
  message_id TEXT,
  alert_type TEXT NOT NULL,
  severity TEXT NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  risk_level TEXT NOT NULL,
  status TEXT DEFAULT 'active',
  created_at BIGINT NOT NULL,
  resolved_at BIGINT,
  metadata JSONB
);

CREATE INDEX IF NOT EXISTS idx_alerts_device_id ON alerts(device_id);
CREATE INDEX IF NOT EXISTS idx_alerts_status ON alerts(status);
CREATE INDEX IF NOT EXISTS idx_alerts_created_at ON alerts(created_at);
```

### 4. `devices` - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

```sql
CREATE TABLE IF NOT EXISTS devices (
  id TEXT PRIMARY KEY,
  user_id TEXT,
  device_name TEXT,
  platform TEXT,
  last_sync_timestamp BIGINT,
  created_at BIGINT NOT NULL,
  updated_at BIGINT NOT NULL
);

CREATE INDEX IF NOT EXISTS idx_devices_user_id ON devices(user_id);
```

### 5. `sync_status` - –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```sql
CREATE TABLE IF NOT EXISTS sync_status (
  device_id TEXT PRIMARY KEY,
  last_sync_timestamp BIGINT NOT NULL,
  last_chats_sync BIGINT,
  last_alerts_sync BIGINT,
  last_settings_sync BIGINT,
  updated_at BIGINT NOT NULL
);
```

---

## üìã –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
3. **SQL Editor** ‚Üí **New query**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL –≤—ã—à–µ
5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ Supabase CLI –∏–ª–∏ Dashboard.

---

**–ì–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã!**
