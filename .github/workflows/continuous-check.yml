name: üîÑ Continuous Check & Quality Control

on:
  push:
    branches: [main, develop]
  pull_request:
    types: [opened, synchronize, reopened]
  schedule:
    # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  quality-check:
    name: üîç Quality Check
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
        with:
          lfs: true
          submodules: false

      - name: üèóÔ∏è Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: üì¶ Install dependencies
        run: bun install

      - name: üîç TypeScript Check
        run: bunx tsc --noEmit
        continue-on-error: true

      - name: üßπ ESLint Check
        run: bun run lint
        continue-on-error: true

      - name: üìä Code Quality Report
        run: |
          echo "## üìä Quality Check Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "‚úÖ TypeScript check completed" >> $GITHUB_STEP_SUMMARY
          echo "‚úÖ ESLint check completed" >> $GITHUB_STEP_SUMMARY

  security-check:
    name: üîí Security Check
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
        with:
          lfs: true
          submodules: false

      - name: üèóÔ∏è Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: üì¶ Install dependencies
        run: bun install

      - name: üîí Security Audit
        run: |
          echo "Security audit placeholder"
          # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å: bun audit –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        continue-on-error: true

  project-health:
    name: üìà Project Health
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
        with:
          lfs: true
          submodules: false

      - name: üìä Project Statistics
        run: |
          echo "## üìà Project Health Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤
          TS_FILES=$(find . -name "*.ts" -o -name "*.tsx" | wc -l)
          COMPONENTS=$(find components -name "*.tsx" 2>/dev/null | wc -l)
          CONTEXTS=$(find constants -name "*Context.tsx" 2>/dev/null | wc -l)
          
          echo "üìÅ TypeScript —Ñ–∞–π–ª–æ–≤: $TS_FILES" >> $GITHUB_STEP_SUMMARY
          echo "üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: $COMPONENTS" >> $GITHUB_STEP_SUMMARY
          echo "üîÑ Context –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: $CONTEXTS" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
          if [ -f "app/_layout.tsx" ]; then
            echo "‚úÖ app/_layout.tsx exists" >> $GITHUB_STEP_SUMMARY
          else
            echo "‚ùå app/_layout.tsx missing" >> $GITHUB_STEP_SUMMARY
          fi

  notify-on-failure:
    name: üì¢ Notify on Failure
    runs-on: ubuntu-latest
    needs: [quality-check, security-check]
    if: failure()

    steps:
      - name: üì¢ Notification
        run: |
          echo "‚ö†Ô∏è Quality checks failed!"
          # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Email, Slack, Discord)


