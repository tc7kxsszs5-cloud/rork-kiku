44410fda5733f0f5dd694462ad80285f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useThemeMode = exports.ThemeProvider = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _createContextHook3 = _interopRequireDefault(require("@nkzw/create-context-hook"));
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var _react = require("react");
var _ColorSystem = require("./ColorSystem");
var _logger = require("@/utils/logger");
var THEME_STORAGE_KEY = '@theme_mode_preference';
var createThemePalette = function createThemePalette(semanticColors, isDark) {
  return Object.assign({}, semanticColors, {
    backgroundPrimary: semanticColors.background.primary,
    backgroundSecondary: semanticColors.background.secondary,
    card: semanticColors.surface.primary,
    cardMuted: semanticColors.surface.muted,
    textPrimary: semanticColors.text.primary,
    textSecondary: semanticColors.text.secondary,
    accentPrimary: semanticColors.interactive.primary,
    accentMuted: semanticColors.interactive.secondary,
    borderSoft: semanticColors.border.muted,
    headerBackground: semanticColors.surface.elevated,
    headerText: semanticColors.text.primary,
    tabBarBackground: semanticColors.surface.elevated,
    tabBarActive: semanticColors.interactive.primary,
    tabBarInactive: semanticColors.text.tertiary,
    heroGradient: [semanticColors.background.primary, semanticColors.background.secondary],
    surfaceGradient: [semanticColors.surface.primary, semanticColors.surface.secondary],
    chipBackground: semanticColors.surface.secondary,
    chipText: semanticColors.text.primary,
    isDark: isDark,
    primary: semanticColors.interactive.primary,
    success: semanticColors.status.safe,
    warning: semanticColors.status.warning,
    danger: semanticColors.status.danger
  });
};
var THEMES = {
  sunrise: createThemePalette(_ColorSystem.lightThemeColors, false),
  midnight: createThemePalette(_ColorSystem.darkThemeColors, true)
};
var THEME_OPTIONS = [{
  value: 'sunrise',
  label: 'Теплый день',
  description: 'Теплый защищающий фон с яркими акцентами безопасности'
}, {
  value: 'midnight',
  label: 'Ночной режим',
  description: 'Глубокий темный фон с теплыми неоновыми акцентами'
}];
var _createContextHook = (0, _createContextHook3.default)(function () {
    var _useState = (0, _react.useState)('sunrise'),
      _useState2 = (0, _slicedToArray2.default)(_useState, 2),
      themeMode = _useState2[0],
      setThemeModeState = _useState2[1];
    var _useState3 = (0, _react.useState)(false),
      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
      isReady = _useState4[0],
      setIsReady = _useState4[1];
    (0, _react.useEffect)(function () {
      var isMounted = true;
      var loadTheme = function () {
        var _ref = (0, _asyncToGenerator2.default)(function* () {
          try {
            var storedMode = yield _asyncStorage.default.getItem(THEME_STORAGE_KEY);
            if (storedMode && (storedMode === 'sunrise' || storedMode === 'midnight') && isMounted) {
              setThemeModeState(storedMode);
              _logger.logger.info('Loaded mode from storage', {
                context: 'ThemeContext',
                action: 'loadTheme',
                mode: storedMode
              });
            }
          } catch (error) {
            _logger.logger.error('Failed to load theme mode', error instanceof Error ? error : new Error(String(error)), {
              context: 'ThemeContext',
              action: 'loadTheme'
            });
          } finally {
            if (isMounted) {
              setIsReady(true);
            }
          }
        });
        return function loadTheme() {
          return _ref.apply(this, arguments);
        };
      }();
      loadTheme();
      return function () {
        isMounted = false;
      };
    }, []);
    var persistMode = (0, _react.useCallback)(function () {
      var _ref2 = (0, _asyncToGenerator2.default)(function* (mode) {
        try {
          yield _asyncStorage.default.setItem(THEME_STORAGE_KEY, mode);
          console.log('[ThemeContext] Persisted theme mode', mode);
        } catch (error) {
          console.error('[ThemeContext] Failed to persist theme mode', error);
        }
      });
      return function (_x) {
        return _ref2.apply(this, arguments);
      };
    }(), []);
    var setThemeMode = (0, _react.useCallback)(function (mode) {
      setThemeModeState(function (current) {
        return current === mode ? current : mode;
      });
      persistMode(mode).catch(function (error) {
        return _logger.logger.error('Failed to persist theme mode in setThemeMode', error instanceof Error ? error : new Error(String(error)), {
          context: 'ThemeContext',
          action: 'setThemeMode',
          mode: mode
        });
      });
    }, [persistMode]);
    var toggleThemeMode = (0, _react.useCallback)(function () {
      setThemeMode(themeMode === 'sunrise' ? 'midnight' : 'sunrise');
    }, [setThemeMode, themeMode]);
    var value = (0, _react.useMemo)(function () {
      return {
        themeMode: themeMode,
        theme: THEMES[themeMode],
        setThemeMode: setThemeMode,
        toggleThemeMode: toggleThemeMode,
        themeOptions: THEME_OPTIONS,
        isReady: isReady
      };
    }, [themeMode, setThemeMode, toggleThemeMode, isReady]);
    return value;
  }),
  _createContextHook2 = (0, _slicedToArray2.default)(_createContextHook, 2),
  ThemeProvider = exports.ThemeProvider = _createContextHook2[0],
  useThemeMode = exports.useThemeMode = _createContextHook2[1];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY3JlYXRlQ29udGV4dEhvb2szIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfYXN5bmNTdG9yYWdlIiwiX3JlYWN0IiwiX0NvbG9yU3lzdGVtIiwiX2xvZ2dlciIsIlRIRU1FX1NUT1JBR0VfS0VZIiwiY3JlYXRlVGhlbWVQYWxldHRlIiwic2VtYW50aWNDb2xvcnMiLCJpc0RhcmsiLCJPYmplY3QiLCJhc3NpZ24iLCJiYWNrZ3JvdW5kUHJpbWFyeSIsImJhY2tncm91bmQiLCJwcmltYXJ5IiwiYmFja2dyb3VuZFNlY29uZGFyeSIsInNlY29uZGFyeSIsImNhcmQiLCJzdXJmYWNlIiwiY2FyZE11dGVkIiwibXV0ZWQiLCJ0ZXh0UHJpbWFyeSIsInRleHQiLCJ0ZXh0U2Vjb25kYXJ5IiwiYWNjZW50UHJpbWFyeSIsImludGVyYWN0aXZlIiwiYWNjZW50TXV0ZWQiLCJib3JkZXJTb2Z0IiwiYm9yZGVyIiwiaGVhZGVyQmFja2dyb3VuZCIsImVsZXZhdGVkIiwiaGVhZGVyVGV4dCIsInRhYkJhckJhY2tncm91bmQiLCJ0YWJCYXJBY3RpdmUiLCJ0YWJCYXJJbmFjdGl2ZSIsInRlcnRpYXJ5IiwiaGVyb0dyYWRpZW50Iiwic3VyZmFjZUdyYWRpZW50IiwiY2hpcEJhY2tncm91bmQiLCJjaGlwVGV4dCIsInN1Y2Nlc3MiLCJzdGF0dXMiLCJzYWZlIiwid2FybmluZyIsImRhbmdlciIsIlRIRU1FUyIsInN1bnJpc2UiLCJsaWdodFRoZW1lQ29sb3JzIiwibWlkbmlnaHQiLCJkYXJrVGhlbWVDb2xvcnMiLCJUSEVNRV9PUFRJT05TIiwidmFsdWUiLCJsYWJlbCIsImRlc2NyaXB0aW9uIiwiX2NyZWF0ZUNvbnRleHRIb29rIiwiY3JlYXRlQ29udGV4dEhvb2siLCJfdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJkZWZhdWx0IiwidGhlbWVNb2RlIiwic2V0VGhlbWVNb2RlU3RhdGUiLCJfdXNlU3RhdGUzIiwiX3VzZVN0YXRlNCIsImlzUmVhZHkiLCJzZXRJc1JlYWR5IiwidXNlRWZmZWN0IiwiaXNNb3VudGVkIiwibG9hZFRoZW1lIiwiX3JlZiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsInN0b3JlZE1vZGUiLCJBc3luY1N0b3JhZ2UiLCJnZXRJdGVtIiwibG9nZ2VyIiwiaW5mbyIsImNvbnRleHQiLCJhY3Rpb24iLCJtb2RlIiwiZXJyb3IiLCJFcnJvciIsIlN0cmluZyIsImFwcGx5IiwiYXJndW1lbnRzIiwicGVyc2lzdE1vZGUiLCJ1c2VDYWxsYmFjayIsIl9yZWYyIiwic2V0SXRlbSIsImNvbnNvbGUiLCJsb2ciLCJfeCIsInNldFRoZW1lTW9kZSIsImN1cnJlbnQiLCJjYXRjaCIsInRvZ2dsZVRoZW1lTW9kZSIsInVzZU1lbW8iLCJ0aGVtZSIsInRoZW1lT3B0aW9ucyIsIl9jcmVhdGVDb250ZXh0SG9vazIiLCJUaGVtZVByb3ZpZGVyIiwiZXhwb3J0cyIsInVzZVRoZW1lTW9kZSJdLCJzb3VyY2VzIjpbIlRoZW1lQ29udGV4dC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNyZWF0ZUNvbnRleHRIb29rIGZyb20gJ0Bua3p3L2NyZWF0ZS1jb250ZXh0LWhvb2snO1xuaW1wb3J0IEFzeW5jU3RvcmFnZSBmcm9tICdAcmVhY3QtbmF0aXZlLWFzeW5jLXN0b3JhZ2UvYXN5bmMtc3RvcmFnZSc7XG5pbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGxpZ2h0VGhlbWVDb2xvcnMsIGRhcmtUaGVtZUNvbG9ycywgU2VtYW50aWNDb2xvcnMgfSBmcm9tICcuL0NvbG9yU3lzdGVtJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvdXRpbHMvbG9nZ2VyJztcblxuZXhwb3J0IHR5cGUgVGhlbWVNb2RlID0gJ3N1bnJpc2UnIHwgJ21pZG5pZ2h0JztcblxuLyoqXG4gKiDQoNCw0YHRiNC40YDQtdC90L3QsNGPINC/0LDQu9C40YLRgNCwINGC0LXQvNGLINGBINGD0LvRg9GH0YjQtdC90L3QvtC5INGG0LLQtdGC0L7QstC+0Lkg0YHQuNGB0YLQtdC80L7QuVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRoZW1lUGFsZXR0ZSBleHRlbmRzIFNlbWFudGljQ29sb3JzIHtcbiAgLy8gTGVnYWN5INC/0L7QtNC00LXRgNC20LrQsCAo0LTQu9GPINC+0LHRgNCw0YLQvdC+0Lkg0YHQvtCy0LzQtdGB0YLQuNC80L7RgdGC0LgpXG4gIGJhY2tncm91bmRQcmltYXJ5OiBzdHJpbmc7XG4gIGJhY2tncm91bmRTZWNvbmRhcnk6IHN0cmluZztcbiAgY2FyZDogc3RyaW5nO1xuICBjYXJkTXV0ZWQ6IHN0cmluZztcbiAgdGV4dFByaW1hcnk6IHN0cmluZztcbiAgdGV4dFNlY29uZGFyeTogc3RyaW5nO1xuICBhY2NlbnRQcmltYXJ5OiBzdHJpbmc7XG4gIGFjY2VudE11dGVkOiBzdHJpbmc7XG4gIGJvcmRlclNvZnQ6IHN0cmluZztcbiAgaGVhZGVyQmFja2dyb3VuZDogc3RyaW5nO1xuICBoZWFkZXJUZXh0OiBzdHJpbmc7XG4gIHRhYkJhckJhY2tncm91bmQ6IHN0cmluZztcbiAgdGFiQmFyQWN0aXZlOiBzdHJpbmc7XG4gIHRhYkJhckluYWN0aXZlOiBzdHJpbmc7XG4gIGhlcm9HcmFkaWVudDogW3N0cmluZywgc3RyaW5nXTtcbiAgc3VyZmFjZUdyYWRpZW50OiBbc3RyaW5nLCBzdHJpbmddO1xuICBjaGlwQmFja2dyb3VuZDogc3RyaW5nO1xuICBjaGlwVGV4dDogc3RyaW5nO1xuICBpc0Rhcms6IGJvb2xlYW47XG4gIC8vINCj0LTQvtCx0L3Ri9C1INCw0LvQuNCw0YHRiyDQtNC70Y8g0YfQsNGB0YLQviDQuNGB0L/QvtC70YzQt9GD0LXQvNGL0YUg0YbQstC10YLQvtCyXG4gIHByaW1hcnk6IHN0cmluZztcbiAgc3VjY2Vzczogc3RyaW5nO1xuICB3YXJuaW5nOiBzdHJpbmc7XG4gIGRhbmdlcjogc3RyaW5nO1xufVxuXG5jb25zdCBUSEVNRV9TVE9SQUdFX0tFWSA9ICdAdGhlbWVfbW9kZV9wcmVmZXJlbmNlJztcblxuLyoqXG4gKiDQodC+0LfQtNCw0L3QuNC1INC/0L7Qu9C90L7QuSDQv9Cw0LvQuNGC0YDRiyDRgtC10LzRiyDQuNC3INGB0LXQvNCw0L3RgtC40YfQtdGB0LrQuNGFINGG0LLQtdGC0L7QslxuICovXG5jb25zdCBjcmVhdGVUaGVtZVBhbGV0dGUgPSAoc2VtYW50aWNDb2xvcnM6IFNlbWFudGljQ29sb3JzLCBpc0Rhcms6IGJvb2xlYW4pOiBUaGVtZVBhbGV0dGUgPT4ge1xuICByZXR1cm4ge1xuICAgIC4uLnNlbWFudGljQ29sb3JzLFxuICAgIC8vIExlZ2FjeSDQv9C+0LTQtNC10YDQttC60LBcbiAgICBiYWNrZ3JvdW5kUHJpbWFyeTogc2VtYW50aWNDb2xvcnMuYmFja2dyb3VuZC5wcmltYXJ5LFxuICAgIGJhY2tncm91bmRTZWNvbmRhcnk6IHNlbWFudGljQ29sb3JzLmJhY2tncm91bmQuc2Vjb25kYXJ5LFxuICAgIGNhcmQ6IHNlbWFudGljQ29sb3JzLnN1cmZhY2UucHJpbWFyeSxcbiAgICBjYXJkTXV0ZWQ6IHNlbWFudGljQ29sb3JzLnN1cmZhY2UubXV0ZWQsXG4gICAgdGV4dFByaW1hcnk6IHNlbWFudGljQ29sb3JzLnRleHQucHJpbWFyeSxcbiAgICB0ZXh0U2Vjb25kYXJ5OiBzZW1hbnRpY0NvbG9ycy50ZXh0LnNlY29uZGFyeSxcbiAgICBhY2NlbnRQcmltYXJ5OiBzZW1hbnRpY0NvbG9ycy5pbnRlcmFjdGl2ZS5wcmltYXJ5LFxuICAgIGFjY2VudE11dGVkOiBzZW1hbnRpY0NvbG9ycy5pbnRlcmFjdGl2ZS5zZWNvbmRhcnksXG4gICAgYm9yZGVyU29mdDogc2VtYW50aWNDb2xvcnMuYm9yZGVyLm11dGVkLFxuICAgIGhlYWRlckJhY2tncm91bmQ6IHNlbWFudGljQ29sb3JzLnN1cmZhY2UuZWxldmF0ZWQsXG4gICAgaGVhZGVyVGV4dDogc2VtYW50aWNDb2xvcnMudGV4dC5wcmltYXJ5LFxuICAgIHRhYkJhckJhY2tncm91bmQ6IHNlbWFudGljQ29sb3JzLnN1cmZhY2UuZWxldmF0ZWQsXG4gICAgdGFiQmFyQWN0aXZlOiBzZW1hbnRpY0NvbG9ycy5pbnRlcmFjdGl2ZS5wcmltYXJ5LFxuICAgIHRhYkJhckluYWN0aXZlOiBzZW1hbnRpY0NvbG9ycy50ZXh0LnRlcnRpYXJ5LFxuICAgIGhlcm9HcmFkaWVudDogW3NlbWFudGljQ29sb3JzLmJhY2tncm91bmQucHJpbWFyeSwgc2VtYW50aWNDb2xvcnMuYmFja2dyb3VuZC5zZWNvbmRhcnldLFxuICAgIHN1cmZhY2VHcmFkaWVudDogW3NlbWFudGljQ29sb3JzLnN1cmZhY2UucHJpbWFyeSwgc2VtYW50aWNDb2xvcnMuc3VyZmFjZS5zZWNvbmRhcnldLFxuICAgIGNoaXBCYWNrZ3JvdW5kOiBzZW1hbnRpY0NvbG9ycy5zdXJmYWNlLnNlY29uZGFyeSxcbiAgICBjaGlwVGV4dDogc2VtYW50aWNDb2xvcnMudGV4dC5wcmltYXJ5LFxuICAgIGlzRGFyayxcbiAgICAvLyDQo9C00L7QsdC90YvQtSDQsNC70LjQsNGB0YtcbiAgICBwcmltYXJ5OiBzZW1hbnRpY0NvbG9ycy5pbnRlcmFjdGl2ZS5wcmltYXJ5LFxuICAgIHN1Y2Nlc3M6IHNlbWFudGljQ29sb3JzLnN0YXR1cy5zYWZlLFxuICAgIHdhcm5pbmc6IHNlbWFudGljQ29sb3JzLnN0YXR1cy53YXJuaW5nLFxuICAgIGRhbmdlcjogc2VtYW50aWNDb2xvcnMuc3RhdHVzLmRhbmdlcixcbiAgfTtcbn07XG5cbmNvbnN0IFRIRU1FUzogUmVjb3JkPFRoZW1lTW9kZSwgVGhlbWVQYWxldHRlPiA9IHtcbiAgc3VucmlzZTogY3JlYXRlVGhlbWVQYWxldHRlKGxpZ2h0VGhlbWVDb2xvcnMsIGZhbHNlKSxcbiAgbWlkbmlnaHQ6IGNyZWF0ZVRoZW1lUGFsZXR0ZShkYXJrVGhlbWVDb2xvcnMsIHRydWUpLFxufTtcblxuLy8g0KPQvdC40LrQsNC70YzQvdGL0LUg0L3QsNC30LLQsNC90LjRjyDRgtC10Lwg0YEg0LrQvtC90YLQtdC60YHRgtC+0Lwg0LTQtdGC0YHQutC+0Lkg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4XG5jb25zdCBUSEVNRV9PUFRJT05TOiB7IHZhbHVlOiBUaGVtZU1vZGU7IGxhYmVsOiBzdHJpbmc7IGRlc2NyaXB0aW9uOiBzdHJpbmcgfVtdID0gW1xuICB7XG4gICAgdmFsdWU6ICdzdW5yaXNlJyxcbiAgICBsYWJlbDogJ9Ci0LXQv9C70YvQuSDQtNC10L3RjCcsXG4gICAgZGVzY3JpcHRpb246ICfQotC10L/Qu9GL0Lkg0LfQsNGJ0LjRidCw0Y7RidC40Lkg0YTQvtC9INGBINGP0YDQutC40LzQuCDQsNC60YbQtdC90YLQsNC80Lgg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4JyxcbiAgfSxcbiAge1xuICAgIHZhbHVlOiAnbWlkbmlnaHQnLFxuICAgIGxhYmVsOiAn0J3QvtGH0L3QvtC5INGA0LXQttC40LwnLFxuICAgIGRlc2NyaXB0aW9uOiAn0JPQu9GD0LHQvtC60LjQuSDRgtC10LzQvdGL0Lkg0YTQvtC9INGBINGC0LXQv9C70YvQvNC4INC90LXQvtC90L7QstGL0LzQuCDQsNC60YbQtdC90YLQsNC80LgnLFxuICB9LFxuXTtcblxuaW50ZXJmYWNlIFRoZW1lQ29udGV4dFZhbHVlIHtcbiAgdGhlbWVNb2RlOiBUaGVtZU1vZGU7XG4gIHRoZW1lOiBUaGVtZVBhbGV0dGU7XG4gIHNldFRoZW1lTW9kZTogKG1vZGU6IFRoZW1lTW9kZSkgPT4gdm9pZDtcbiAgdG9nZ2xlVGhlbWVNb2RlOiAoKSA9PiB2b2lkO1xuICB0aGVtZU9wdGlvbnM6IHR5cGVvZiBUSEVNRV9PUFRJT05TO1xuICBpc1JlYWR5OiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgW1RoZW1lUHJvdmlkZXIsIHVzZVRoZW1lTW9kZV0gPSBjcmVhdGVDb250ZXh0SG9vazxUaGVtZUNvbnRleHRWYWx1ZT4oKCkgPT4ge1xuICBjb25zdCBbdGhlbWVNb2RlLCBzZXRUaGVtZU1vZGVTdGF0ZV0gPSB1c2VTdGF0ZTxUaGVtZU1vZGU+KCdzdW5yaXNlJyk7XG4gIGNvbnN0IFtpc1JlYWR5LCBzZXRJc1JlYWR5XSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGxldCBpc01vdW50ZWQgPSB0cnVlO1xuXG4gICAgY29uc3QgbG9hZFRoZW1lID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3RvcmVkTW9kZSA9IGF3YWl0IEFzeW5jU3RvcmFnZS5nZXRJdGVtKFRIRU1FX1NUT1JBR0VfS0VZKTtcbiAgICAgICAgaWYgKHN0b3JlZE1vZGUgJiYgKHN0b3JlZE1vZGUgPT09ICdzdW5yaXNlJyB8fCBzdG9yZWRNb2RlID09PSAnbWlkbmlnaHQnKSAmJiBpc01vdW50ZWQpIHtcbiAgICAgICAgICBzZXRUaGVtZU1vZGVTdGF0ZShzdG9yZWRNb2RlKTtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnTG9hZGVkIG1vZGUgZnJvbSBzdG9yYWdlJywgeyBjb250ZXh0OiAnVGhlbWVDb250ZXh0JywgYWN0aW9uOiAnbG9hZFRoZW1lJywgbW9kZTogc3RvcmVkTW9kZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gbG9hZCB0aGVtZSBtb2RlJywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKFN0cmluZyhlcnJvcikpLCB7IGNvbnRleHQ6ICdUaGVtZUNvbnRleHQnLCBhY3Rpb246ICdsb2FkVGhlbWUnIH0pO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKGlzTW91bnRlZCkge1xuICAgICAgICAgIHNldElzUmVhZHkodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbG9hZFRoZW1lKCk7XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaXNNb3VudGVkID0gZmFsc2U7XG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IHBlcnNpc3RNb2RlID0gdXNlQ2FsbGJhY2soYXN5bmMgKG1vZGU6IFRoZW1lTW9kZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShUSEVNRV9TVE9SQUdFX0tFWSwgbW9kZSk7XG4gICAgICBjb25zb2xlLmxvZygnW1RoZW1lQ29udGV4dF0gUGVyc2lzdGVkIHRoZW1lIG1vZGUnLCBtb2RlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1RoZW1lQ29udGV4dF0gRmFpbGVkIHRvIHBlcnNpc3QgdGhlbWUgbW9kZScsIGVycm9yKTtcbiAgICB9XG4gIH0sIFtdKTtcblxuICBjb25zdCBzZXRUaGVtZU1vZGUgPSB1c2VDYWxsYmFjayhcbiAgICAobW9kZTogVGhlbWVNb2RlKSA9PiB7XG4gICAgICBzZXRUaGVtZU1vZGVTdGF0ZSgoY3VycmVudCkgPT4gKGN1cnJlbnQgPT09IG1vZGUgPyBjdXJyZW50IDogbW9kZSkpO1xuICAgICAgcGVyc2lzdE1vZGUobW9kZSkuY2F0Y2goKGVycm9yKSA9PiBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBwZXJzaXN0IHRoZW1lIG1vZGUgaW4gc2V0VGhlbWVNb2RlJywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKFN0cmluZyhlcnJvcikpLCB7IGNvbnRleHQ6ICdUaGVtZUNvbnRleHQnLCBhY3Rpb246ICdzZXRUaGVtZU1vZGUnLCBtb2RlIH0pKTtcbiAgICB9LFxuICAgIFtwZXJzaXN0TW9kZV0sXG4gICk7XG5cbiAgY29uc3QgdG9nZ2xlVGhlbWVNb2RlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFRoZW1lTW9kZSh0aGVtZU1vZGUgPT09ICdzdW5yaXNlJyA/ICdtaWRuaWdodCcgOiAnc3VucmlzZScpO1xuICB9LCBbc2V0VGhlbWVNb2RlLCB0aGVtZU1vZGVdKTtcblxuICBjb25zdCB2YWx1ZSA9IHVzZU1lbW88VGhlbWVDb250ZXh0VmFsdWU+KCgpID0+ICh7XG4gICAgdGhlbWVNb2RlLFxuICAgIHRoZW1lOiBUSEVNRVNbdGhlbWVNb2RlXSxcbiAgICBzZXRUaGVtZU1vZGUsXG4gICAgdG9nZ2xlVGhlbWVNb2RlLFxuICAgIHRoZW1lT3B0aW9uczogVEhFTUVfT1BUSU9OUyxcbiAgICBpc1JlYWR5LFxuICB9KSwgW3RoZW1lTW9kZSwgc2V0VGhlbWVNb2RlLCB0b2dnbGVUaGVtZU1vZGUsIGlzUmVhZHldKTtcblxuICByZXR1cm4gdmFsdWU7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUFBLG1CQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxhQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxNQUFBLEdBQUFGLE9BQUE7QUFDQSxJQUFBRyxZQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxPQUFBLEdBQUFKLE9BQUE7QUFtQ0EsSUFBTUssaUJBQWlCLEdBQUcsd0JBQXdCO0FBS2xELElBQU1DLGtCQUFrQixHQUFHLFNBQXJCQSxrQkFBa0JBLENBQUlDLGNBQThCLEVBQUVDLE1BQWUsRUFBbUI7RUFDNUYsT0FBQUMsTUFBQSxDQUFBQyxNQUFBLEtBQ0tILGNBQWM7SUFFakJJLGlCQUFpQixFQUFFSixjQUFjLENBQUNLLFVBQVUsQ0FBQ0MsT0FBTztJQUNwREMsbUJBQW1CLEVBQUVQLGNBQWMsQ0FBQ0ssVUFBVSxDQUFDRyxTQUFTO0lBQ3hEQyxJQUFJLEVBQUVULGNBQWMsQ0FBQ1UsT0FBTyxDQUFDSixPQUFPO0lBQ3BDSyxTQUFTLEVBQUVYLGNBQWMsQ0FBQ1UsT0FBTyxDQUFDRSxLQUFLO0lBQ3ZDQyxXQUFXLEVBQUViLGNBQWMsQ0FBQ2MsSUFBSSxDQUFDUixPQUFPO0lBQ3hDUyxhQUFhLEVBQUVmLGNBQWMsQ0FBQ2MsSUFBSSxDQUFDTixTQUFTO0lBQzVDUSxhQUFhLEVBQUVoQixjQUFjLENBQUNpQixXQUFXLENBQUNY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QUFKLEtBQUEsT0FBQUMsU0FBQTtNQUFBO0lBQUEsS0FBRSxFQUFFLENBQUM7SUFFTixJQUFNUSxZQUFZLEdBQUcsSUFBQU4sa0JBQVcsRUFDOUIsVUFBQ1AsSUFBZSxFQUFLO01BQ25CakIsaUJBQWlCLENBQUMsVUFBQytCLE9BQU87UUFBQSxPQUFNQSxPQUFPLEtBQUtkLElBQUksR0FBR2MsT0FBTyxHQUFHZCxJQUFJO01BQUEsQ0FBQyxDQUFDO01BQ25FTSxXQUFXLENBQUNOLElBQUksQ0FBQyxDQUFDZSxLQUFLLENBQUMsVUFBQ2QsS0FBSztRQUFBLE9BQUtMLGNBQU0sQ0FBQ0ssS0FBSyxDQUFDLDhDQUE4QyxFQUFFQSxLQUFLLFlBQVlDLEtBQUssR0FBR0QsS0FBSyxHQUFHLElBQUlDLEtBQUssQ0FBQ0MsTUFBTSxDQUFDRixLQUFLLENBQUMsQ0FBQyxFQUFFO1VBQUVILE9BQU8sRUFBRSxjQUFjO1VBQUVDLE1BQU0sRUFBRSxjQUFjO1VBQUVDLElBQUksRUFBSkE7UUFBSyxDQUFDLENBQUM7TUFBQSxFQUFDO0lBQ3hOLENBQUMsRUFDRCxDQUFDTSxXQUFXLENBQ2QsQ0FBQztJQUVELElBQU1VLGVBQWUsR0FBRyxJQUFBVCxrQkFBVyxFQUFDLFlBQU07TUFDeENNLFlBQVksQ0FBQy9CLFNBQVMsS0FBSyxTQUFTLEdBQUcsVUFBVSxHQUFHLFNBQVMsQ0FBQztJQUNoRSxDQUFDLEVBQUUsQ0FBQytCLFlBQVksRUFBRS9CLFNBQVMsQ0FBQyxDQUFDO0lBRTdCLElBQU1WLEtBQUssR0FBRyxJQUFBNkMsY0FBTyxFQUFvQjtNQUFBLE9BQU87UUFDOUNuQyxTQUFTLEVBQVRBLFNBQVM7UUFDVG9DLEtBQUssRUFBRXBELE1BQU0sQ0FBQ2dCLFNBQVMsQ0FBQztRQUN4QitCLFlBQVksRUFBWkEsWUFBWTtRQUNaRyxlQUFlLEVBQWZBLGVBQWU7UUFDZkcsWUFBWSxFQUFFaEQsYUFBYTtRQUMzQmUsT0FBTyxFQUFQQTtNQUNGLENBQUM7SUFBQSxDQUFDLEVBQUUsQ0FBQ0osU0FBUyxFQUFFK0IsWUFBWSxFQUFFRyxlQUFlLEVBQUU5QixPQUFPLENBQUMsQ0FBQztJQUV4RCxPQUFPZCxLQUFLO0VBQ2QsQ0FBQyxDQUFDO0VBQUFnRCxtQkFBQSxPQUFBeEMsZUFBQSxDQUFBQyxPQUFBLEVBQUFOLGtCQUFBO0VBN0RZOEMsYUFBYSxHQUFBQyxPQUFBLENBQUFELGFBQUEsR0FBQUQsbUJBQUE7RUFBRUcsWUFBWSxHQUFBRCxPQUFBLENBQUFDLFlBQUEsR0FBQUgsbUJBQUEiLCJpZ25vcmVMaXN0IjpbXX0=