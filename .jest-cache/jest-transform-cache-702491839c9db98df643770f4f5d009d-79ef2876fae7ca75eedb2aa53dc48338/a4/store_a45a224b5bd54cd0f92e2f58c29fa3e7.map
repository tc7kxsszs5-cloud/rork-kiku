{"version":3,"names":["MAX_TEST_RESULTS","cov_14lpkijmk","s","devices","Map","upsertDeviceRecord","payload","_ref","_ref2","_ref3","_ref4","f","timestamp","Date","now","existing","get","deviceId","record","pushToken","platform","appVersion","b","userId","permissions","lastSyncedAt","lastTestedAt","testResults","set","listDeviceRecords","Array","from","values","sort","a","getDeviceRecord","appendTestResults","results","_ref5","_results$","undefined","merged","concat","_toConsumableArray","slice","updated","Object","assign"],"sources":["store.ts"],"sourcesContent":["// Types defined locally for backend\nexport interface NotificationDeviceRecord {\n  deviceId: string;\n  pushToken: string;\n  platform: 'ios' | 'android' | 'web';\n  appVersion?: string;\n  userId?: string;\n  permissions?: string;\n  lastSyncedAt: number;\n  lastTestedAt?: number;\n  testResults: NotificationTestResult[];\n}\n\nexport interface NotificationTestResult {\n  id: string;\n  type: 'permissions' | 'token' | 'delivery' | 'sync';\n  status: 'passed' | 'failed';\n  message: string;\n  timestamp: number;\n  deviceLabel?: string;\n}\n\nconst MAX_TEST_RESULTS = 10;\n\nconst devices = new Map<string, NotificationDeviceRecord>();\n\ninterface UpsertPayload {\n  deviceId: string;\n  pushToken: string;\n  platform: 'ios' | 'android' | 'web';\n  appVersion?: string;\n  userId?: string;\n  permissions?: string;\n}\n\nexport const upsertDeviceRecord = (payload: UpsertPayload): NotificationDeviceRecord => {\n  const timestamp = Date.now();\n  const existing = devices.get(payload.deviceId);\n\n  const record: NotificationDeviceRecord = {\n    deviceId: payload.deviceId,\n    pushToken: payload.pushToken,\n    platform: payload.platform,\n    appVersion: payload.appVersion ?? existing?.appVersion,\n    userId: payload.userId ?? existing?.userId,\n    permissions: payload.permissions ?? existing?.permissions,\n    lastSyncedAt: timestamp,\n    lastTestedAt: existing?.lastTestedAt,\n    testResults: existing?.testResults ?? [],\n  };\n\n  devices.set(payload.deviceId, record);\n  return record;\n};\n\nexport const listDeviceRecords = (): NotificationDeviceRecord[] => {\n  return Array.from(devices.values()).sort((a, b) => b.lastSyncedAt - a.lastSyncedAt);\n};\n\nexport const getDeviceRecord = (deviceId: string): NotificationDeviceRecord | undefined => {\n  return devices.get(deviceId);\n};\n\nexport const appendTestResults = (\n  deviceId: string,\n  results: NotificationTestResult[],\n): NotificationDeviceRecord | undefined => {\n  const existing = devices.get(deviceId);\n  if (!existing) {\n    return undefined;\n  }\n\n  const merged = [...results, ...existing.testResults].slice(0, MAX_TEST_RESULTS);\n  const updated: NotificationDeviceRecord = {\n    ...existing,\n    lastTestedAt: results[0]?.timestamp ?? existing.lastTestedAt,\n    testResults: merged,\n  };\n\n  devices.set(deviceId, updated);\n  return updated;\n};\n"],"mappings":"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","ignoreList":[]}