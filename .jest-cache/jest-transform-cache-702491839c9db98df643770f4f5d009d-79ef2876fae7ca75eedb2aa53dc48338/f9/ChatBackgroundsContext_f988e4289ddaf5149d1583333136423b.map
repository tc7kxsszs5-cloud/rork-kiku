{"version":3,"names":["createContextHook","useState","useCallback","AsyncStorage","logger","STORAGE_KEY","cov_1jgn6zsyze","s","DEFAULT_BACKGROUNDS","id","name","type","value","_ref","f","_ref3","_ref4","_slicedToArray","backgrounds","setBackgrounds","_ref5","_ref6","selectedBackgrounds","setSelectedBackgrounds","setChatBackground","_ref7","_asyncToGenerator","chatId","backgroundId","prev","Object","assign","_defineProperty","setItem","JSON","stringify","error","Error","b","String","context","action","_x","_x2","apply","arguments","getChatBackground","defaultBg","color","gradient","gradientDirection","start","x","y","end","bg","find","_ref2","ChatBackgroundsProvider","useChatBackgrounds"],"sources":["ChatBackgroundsContext.tsx"],"sourcesContent":["/**\n * Chat Backgrounds Context\n * Manages chat background customization\n */\n\nimport createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { logger } from '@/utils/logger';\n\nexport interface ChatBackground {\n  id: string;\n  name: string;\n  type: 'color' | 'gradient' | 'image' | 'solid';\n  value?: string | string[];\n  preview?: string;\n  // Для совместимости с chat/[chatId].tsx\n  color?: string;\n  gradient?: string[];\n  gradientDirection?: {\n    start: { x: number; y: number };\n    end: { x: number; y: number };\n  };\n}\n\n// Тип для использования в компонентах (расширенный)\nexport type ChatBackgroundExtended = ChatBackground;\n\nconst STORAGE_KEY = '@chat_backgrounds';\nconst DEFAULT_BACKGROUNDS: ChatBackground[] = [\n  {\n    id: 'default',\n    name: 'По умолчанию',\n    type: 'color',\n    value: '#FFFFFF',\n  },\n  {\n    id: 'gradient1',\n    name: 'Градиент 1',\n    type: 'gradient',\n    value: ['#4A90E2', '#357ABD'],\n  },\n  {\n    id: 'gradient2',\n    name: 'Градиент 2',\n    type: 'gradient',\n    value: ['#FF6B35', '#E55A2B'],\n  },\n];\n\nexport const [ChatBackgroundsProvider, useChatBackgrounds] = createContextHook(() => {\n  const [backgrounds, setBackgrounds] = useState<ChatBackground[]>(DEFAULT_BACKGROUNDS);\n  const [selectedBackgrounds, setSelectedBackgrounds] = useState<Record<string, string>>({});\n\n  const setChatBackground = useCallback(async (chatId: string, backgroundId: string) => {\n    setSelectedBackgrounds((prev) => ({\n      ...prev,\n      [chatId]: backgroundId,\n    }));\n    \n    try {\n      await AsyncStorage.setItem(STORAGE_KEY, JSON.stringify({\n        ...selectedBackgrounds,\n        [chatId]: backgroundId,\n      }));\n    } catch (error) {\n      logger.error('Failed to save background', error instanceof Error ? error : new Error(String(error)), { context: 'ChatBackgroundsContext', action: 'setChatBackground', chatId, backgroundId });\n    }\n  }, [selectedBackgrounds]);\n\n  const getChatBackground = useCallback((chatId: string): ChatBackgroundExtended | null => {\n    const backgroundId = selectedBackgrounds[chatId];\n    if (!backgroundId) {\n      const defaultBg = backgrounds[0];\n      if (!defaultBg) return null;\n      // Преобразуем в формат, ожидаемый chat/[chatId].tsx\n      if (defaultBg.type === 'color') {\n        return {\n          ...defaultBg,\n          type: 'solid' as const,\n          color: defaultBg.value as string,\n        };\n      }\n      if (defaultBg.type === 'gradient') {\n        return {\n          ...defaultBg,\n          gradient: defaultBg.value as string[],\n          gradientDirection: {\n            start: { x: 0, y: 0 },\n            end: { x: 1, y: 1 },\n          },\n        };\n      }\n      return defaultBg;\n    }\n    const bg = backgrounds.find((b) => b.id === backgroundId) || backgrounds[0];\n    if (!bg) return null;\n    // Преобразуем в формат, ожидаемый chat/[chatId].tsx\n    if (bg.type === 'color') {\n      return {\n        ...bg,\n        type: 'solid' as const,\n        color: bg.value as string,\n      };\n    }\n    if (bg.type === 'gradient') {\n      return {\n        ...bg,\n        gradient: bg.value as string[],\n        gradientDirection: {\n          start: { x: 0, y: 0 },\n          end: { x: 1, y: 1 },\n        },\n      };\n    }\n    return bg;\n  }, [selectedBackgrounds, backgrounds]);\n\n  return {\n    backgrounds,\n    selectedBackgrounds,\n    setChatBackground,\n    getChatBackground,\n  };\n});\n"],"mappings":"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","ignoreList":[]}