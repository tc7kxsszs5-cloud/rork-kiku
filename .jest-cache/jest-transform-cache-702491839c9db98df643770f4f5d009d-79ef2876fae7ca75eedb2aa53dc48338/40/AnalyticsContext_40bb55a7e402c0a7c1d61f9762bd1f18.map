{"version":3,"names":["createContextHook","useState","useCallback","useMemo","useEffect","useRef","AsyncStorage","calculateMetrics","saveStoredVersion","needsMigration","APP_DATA_VERSION","getMigrationManager","logger","ANALYTICS_STORAGE_KEY","CURRENT_ANALYTICS_VERSION","DEFAULT_METRICS","totalMessages","totalAlerts","totalSOS","messagesAnalyzed","alertsResolved","averageRiskLevel","mostActiveChat","riskDistribution","safe","low","medium","high","critical","eventsByType","dailyActivity","totalInstalls","totalActivations","activationRate","totalSessions","averageSessionDuration","retention","d1","d7","d30","featureUsage","premiumSubscribers","premiumTrialUsers","premiumConversionRate","dau","mau","threatDetectionRate","falsePositiveRate","falseNegativeRate","averageAlertResponseTime","averageSOSResponseTime","aiAnalysisAccuracy","aiAnalysisSpeed","imageAnalysisAccuracy","sessionsPerUserWeekly","messagesAnalyzedPerDay","featureAdoptionRate","parentChildPairCompletionRate","geographicExpansion","appStoreRating","nps","arr","cac","ltv","ltvCacRatio","userGrowthRate","_createContextHook","_useState","_useState2","_slicedToArray","events","setEvents","isMountedRef","current","loadAnalytics","_ref","_asyncToGenerator","stored","getItem","parsed","JSON","parse","currentVersion","version","console","log","migrationManager","result","migrate","success","data","setItem","stringify","info","context","action","toVersion","error","errorMessage","String","migrationError","Error","Array","isArray","apply","arguments","saveAnalytics","_ref2","versionedData","updatedAt","Date","now","length","trackEvent","event","properties","eventData","timestamp","prev","updated","concat","_toConsumableArray","slice","clearAnalytics","removeItem","exportAnalytics","metrics","_createContextHook2","AnalyticsProvider","useAnalytics"],"sources":["AnalyticsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { calculateMetrics } from '@/utils/analyticsMetrics';\nimport { getStoredVersion, saveStoredVersion, needsMigration, APP_DATA_VERSION } from '@/utils/versioning';\nimport { getMigrationManager } from '@/utils/migrations';\nimport { logger } from '@/utils/logger';\n\nconst ANALYTICS_STORAGE_KEY = '@kiku_analytics';\nconst CURRENT_ANALYTICS_VERSION = APP_DATA_VERSION; // Используем текущую версию данных\n\nexport type AnalyticsEvent = \n  | 'message_sent'\n  | 'message_analyzed'\n  | 'alert_created'\n  | 'alert_resolved'\n  | 'sos_triggered'\n  | 'sos_resolved'\n  | 'chat_viewed'\n  | 'settings_changed'\n  | 'contact_added'\n  | 'contact_removed'\n  | 'time_restriction_added'\n  | 'recommendation_viewed'\n  | 'statistics_viewed'\n  | 'profile_updated'\n  | 'app_installed'\n  | 'app_first_launch'\n  | 'user_activated'\n  | 'session_started'\n  | 'session_ended'\n  | 'feature_used'\n  | 'premium_subscribed'\n  | 'premium_feature_accessed'\n  | 'premium_trial_started'\n  | 'premium_trial_ended'\n  | 'premium_cancelled'\n  | 'alert_notification_sent'\n  | 'sos_notification_sent'\n  | 'ai_analysis_completed'\n  | 'image_analysis_completed'\n  | 'false_positive_reported'\n  | 'threat_confirmed'\n  | 'parent_child_pair_completed'\n  | 'screen_viewed'\n  | 'user_feedback_submitted'\n  | 'sync_failed';\n\nexport interface AnalyticsEventData {\n  event: AnalyticsEvent;\n  timestamp: number;\n  properties?: Record<string, any>;\n}\n\nexport interface AnalyticsMetrics {\n  totalMessages: number;\n  totalAlerts: number;\n  totalSOS: number;\n  messagesAnalyzed: number;\n  alertsResolved: number;\n  averageRiskLevel: number;\n  mostActiveChat: string | null;\n  riskDistribution: {\n    safe: number;\n    low: number;\n    medium: number;\n    high: number;\n    critical: number;\n  };\n  eventsByType: Record<AnalyticsEvent, number>;\n  dailyActivity: { date: string; events: number }[];\n  // KPI Metrics\n  totalInstalls: number;\n  totalActivations: number;\n  activationRate: number; // totalActivations / totalInstalls\n  totalSessions: number;\n  averageSessionDuration: number; // in minutes\n  retention: {\n    d1: number; // Day 1 retention\n    d7: number; // Day 7 retention\n    d30: number; // Day 30 retention\n  };\n  featureUsage: Record<string, number>; // e.g., { 'chat_view': 150, 'settings_changed': 20 }\n  premiumSubscribers: number;\n  premiumTrialUsers: number;\n  premiumConversionRate: number; // premiumSubscribers / totalActivations\n  // DAU/MAU (calculated from sessions)\n  dau: number; // Daily Active Users (unique users with session_started today)\n  mau: number; // Monthly Active Users (unique users with session_started in last 30 days)\n  // Security KPIs\n  threatDetectionRate: number; // Threats detected / Total threats\n  falsePositiveRate: number; // False positives / Total alerts\n  falseNegativeRate: number; // Missed threats / Total threats\n  averageAlertResponseTime: number; // Average time from alert to notification (seconds)\n  averageSOSResponseTime: number; // Average time from SOS trigger to notification (seconds)\n  aiAnalysisAccuracy: number; // Correct analyses / Total analyses\n  aiAnalysisSpeed: number; // Average analysis time (seconds)\n  imageAnalysisAccuracy: number; // Correct image analyses / Total\n  // Engagement KPIs\n  sessionsPerUserWeekly: number; // Average sessions per user per week\n  messagesAnalyzedPerDay: number; // Average messages analyzed per day\n  featureAdoptionRate: number; // Users using features / Total users\n  parentChildPairCompletionRate: number; // Completed pairs / Started pairs\n  // Market KPIs\n  geographicExpansion: number; // Number of countries with users\n  appStoreRating: number; // App Store rating (0-5)\n  nps: number; // Net Promoter Score (-100 to 100)\n  // Revenue KPIs (calculated from premium data)\n  arr: number; // Annual Recurring Revenue\n  cac: number; // Customer Acquisition Cost\n  ltv: number; // Lifetime Value\n  ltvCacRatio: number; // LTV / CAC\n  userGrowthRate: number; // Monthly growth rate (%)\n}\n\nexport interface AnalyticsContextValue {\n  events: AnalyticsEventData[];\n  metrics: AnalyticsMetrics;\n  trackEvent: (event: AnalyticsEvent, properties?: Record<string, any>) => void;\n  clearAnalytics: () => Promise<void>;\n  exportAnalytics: () => string;\n}\n\nconst DEFAULT_METRICS: AnalyticsMetrics = {\n  totalMessages: 0,\n  totalAlerts: 0,\n  totalSOS: 0,\n  messagesAnalyzed: 0,\n  alertsResolved: 0,\n  averageRiskLevel: 0,\n  mostActiveChat: null,\n  riskDistribution: {\n    safe: 0,\n    low: 0,\n    medium: 0,\n    high: 0,\n    critical: 0,\n  },\n  eventsByType: {} as Record<AnalyticsEvent, number>,\n  dailyActivity: [],\n  // KPI Metrics\n  totalInstalls: 0,\n  totalActivations: 0,\n  activationRate: 0,\n  totalSessions: 0,\n  averageSessionDuration: 0,\n  retention: {\n    d1: 0,\n    d7: 0,\n    d30: 0,\n  },\n  featureUsage: {},\n  premiumSubscribers: 0,\n  premiumTrialUsers: 0,\n  premiumConversionRate: 0,\n  dau: 0,\n  mau: 0,\n  // Security KPIs\n  threatDetectionRate: 0,\n  falsePositiveRate: 0,\n  falseNegativeRate: 0,\n  averageAlertResponseTime: 0,\n  averageSOSResponseTime: 0,\n  aiAnalysisAccuracy: 0,\n  aiAnalysisSpeed: 0,\n  imageAnalysisAccuracy: 0,\n  // Engagement KPIs\n  sessionsPerUserWeekly: 0,\n  messagesAnalyzedPerDay: 0,\n  featureAdoptionRate: 0,\n  parentChildPairCompletionRate: 0,\n  // Market KPIs\n  geographicExpansion: 0,\n  appStoreRating: 0,\n  nps: 0,\n  // Revenue KPIs\n  arr: 0,\n  cac: 0,\n  ltv: 0,\n  ltvCacRatio: 0,\n  userGrowthRate: 0,\n};\n\nexport const [AnalyticsProvider, useAnalytics] = createContextHook<AnalyticsContextValue>(() => {\n  const [events, setEvents] = useState<AnalyticsEventData[]>([]);\n  const isMountedRef = useRef(true);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  // Загрузка аналитики при инициализации с поддержкой миграций\n  useEffect(() => {\n    const loadAnalytics = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(ANALYTICS_STORAGE_KEY);\n        if (!stored) {\n          return;\n        }\n\n        if (!isMountedRef.current) {\n          return;\n        }\n\n        let parsed = JSON.parse(stored);\n        \n        // Проверяем версию данных\n        const currentVersion = parsed.version || 1;\n        \n        // Если нужна миграция\n        if (needsMigration(currentVersion, CURRENT_ANALYTICS_VERSION)) {\n          console.log(`[AnalyticsContext] Migrating from version ${currentVersion} to ${CURRENT_ANALYTICS_VERSION}`);\n          \n          try {\n            const migrationManager = getMigrationManager();\n            const result = await migrationManager.migrate(\n              parsed,\n              currentVersion,\n              CURRENT_ANALYTICS_VERSION\n            );\n\n            if (result.success) {\n              parsed = result.data;\n              \n              // Сохраняем мигрированные данные\n              await AsyncStorage.setItem(ANALYTICS_STORAGE_KEY, JSON.stringify(parsed));\n              await saveStoredVersion(ANALYTICS_STORAGE_KEY, CURRENT_ANALYTICS_VERSION);\n              \n              logger.info(`Successfully migrated to version ${CURRENT_ANALYTICS_VERSION}`, { context: 'AnalyticsContext', action: 'migrate', toVersion: CURRENT_ANALYTICS_VERSION });\n            } else {\n              if (result.error) {\n                const errorMessage = typeof result.error === 'string' ? result.error : String(result.error);\n                const migrationError = new Error(errorMessage);\n                logger.error('Migration failed', migrationError, { context: 'AnalyticsContext', action: 'migrate', errorMessage });\n              } else {\n                logger.error('Migration failed', new Error('Unknown migration error'), { context: 'AnalyticsContext', action: 'migrate' });\n              }\n              // Продолжаем с исходными данными\n            }\n          } catch (migrationError) {\n            logger.error('Migration error', migrationError instanceof Error ? migrationError : new Error(String(migrationError)), { context: 'AnalyticsContext', action: 'migrate' });\n            // Продолжаем с исходными данными\n          }\n        }\n\n        // Извлекаем события из структуры данных\n        const events = parsed.events || parsed; // Поддержка старого формата (массив) и нового (объект с events)\n        \n        if (isMountedRef.current) {\n          setEvents(Array.isArray(events) ? events : []);\n        }\n      } catch (error) {\n        logger.error('Failed to load analytics', error instanceof Error ? error : new Error(String(error)), { context: 'AnalyticsContext', action: 'loadAnalytics' });\n      }\n    };\n    loadAnalytics();\n  }, []);\n\n  // Сохранение аналитики при изменении с версионированием\n  useEffect(() => {\n    const saveAnalytics = async () => {\n      try {\n        // Сохраняем в новом формате с версией\n        const versionedData = {\n          version: CURRENT_ANALYTICS_VERSION,\n          events,\n          updatedAt: Date.now(),\n        };\n        \n        await AsyncStorage.setItem(ANALYTICS_STORAGE_KEY, JSON.stringify(versionedData));\n        await saveStoredVersion(ANALYTICS_STORAGE_KEY, CURRENT_ANALYTICS_VERSION);\n      } catch (error) {\n        console.error('[AnalyticsContext] Failed to save analytics:', error);\n      }\n    };\n    if (events.length > 0) {\n      saveAnalytics();\n    }\n  }, [events]);\n\n  const trackEvent = useCallback((event: AnalyticsEvent, properties?: Record<string, any>) => {\n    if (!isMountedRef.current) {\n      return;\n    }\n\n    const eventData: AnalyticsEventData = {\n      event,\n      timestamp: Date.now(),\n      properties,\n    };\n\n    setEvents((prev) => {\n      const updated = [...prev, eventData];\n      // Ограничиваем количество событий (последние 10000)\n      return updated.slice(-10000);\n    });\n\n    logger.info('Event tracked', { context: 'AnalyticsContext', action: 'trackEvent', event, properties });\n  }, []);\n\n  const clearAnalytics = useCallback(async () => {\n    setEvents([]);\n    try {\n      await AsyncStorage.removeItem(ANALYTICS_STORAGE_KEY);\n    } catch (error) {\n      logger.error('Failed to clear analytics', error instanceof Error ? error : new Error(String(error)), { context: 'AnalyticsContext', action: 'clearAnalytics' });\n    }\n  }, []);\n\n  const exportAnalytics = useCallback(() => {\n    return JSON.stringify(events, null, 2);\n  }, [events]);\n\n  // Вычисление метрик (используем чистую функцию для тестируемости)\n  const metrics = useMemo((): AnalyticsMetrics => {\n    return calculateMetrics(events);\n  }, [events]);\n\n  return useMemo(\n    () => ({\n      events,\n      metrics,\n      trackEvent,\n      clearAnalytics,\n      exportAnalytics,\n    }),\n    [events, metrics, trackEvent, clearAnalytics, exportAnalytics]\n  );\n});\n\n"],"mappings":"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","ignoreList":[]}