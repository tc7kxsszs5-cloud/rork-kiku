{"version":3,"names":["_kpiModeling","require","describe","it","projections","calculateGrowthProjection","expect","toHaveLength","month","toBe","activations","installs","dau","premiumUsers","mrr","toBeCloseTo","arr","economics","calculateUnitEconomics","ltv","toBeGreaterThan","toBeLessThan","ltvCacRatio","cac","averageRevenuePerUser","unitEconomics","result","checkKPITargets","targets","toBeDefined","achieved","mau","month6","generateInvestorProjection","kpiStatus","summary","totalUsers","totalRevenue","toBeGreaterThanOrEqual","allTargetsMet","result1","result2"],"sources":["kpiModeling.test.ts"],"sourcesContent":["/**\n * Модульные тесты для моделирования KPIs\n * Только детерминированные тесты\n */\n\nimport {\n  calculateGrowthProjection,\n  calculateUnitEconomics,\n  checkKPITargets,\n  generateInvestorProjection,\n} from '@/utils/kpiModeling';\n\ndescribe('calculateGrowthProjection', () => {\n  it('должен создавать прогноз на 6 месяцев', () => {\n    const projections = calculateGrowthProjection(1000);\n\n    expect(projections).toHaveLength(6);\n    expect(projections[0].month).toBe(1);\n    expect(projections[5].month).toBe(6);\n  });\n\n  it('должен правильно рассчитывать активации', () => {\n    const projections = calculateGrowthProjection(1000, [1.5], 0.6);\n\n    expect(projections[0].activations).toBe(600); // 1000 * 0.6\n    expect(projections[0].installs).toBe(1000);\n  });\n\n  it('должен правильно рассчитывать DAU', () => {\n    const projections = calculateGrowthProjection(1000, [1.5], 0.6, 0.3);\n\n    expect(projections[0].dau).toBe(300); // 1000 * 0.3\n  });\n\n  it('должен правильно рассчитывать premium пользователей и MRR', () => {\n    const projections = calculateGrowthProjection(\n      1000,\n      [1.5],\n      0.6,\n      0.3,\n      [0.35],\n      [0.20],\n      9.99,\n      [0.05] // 5% conversion в первый месяц\n    );\n\n    // MAU = installs = 1000\n    // Premium users = 1000 * 0.05 = 50\n    // MRR = 50 * 9.99 = 499.5\n    expect(projections[0].premiumUsers).toBe(50);\n    expect(projections[0].mrr).toBeCloseTo(499.5, 1);\n    expect(projections[0].arr).toBeCloseTo(5994, 1); // 499.5 * 12\n  });\n\n  it('должен применять рост к установкам', () => {\n    const projections = calculateGrowthProjection(1000, [1.5]); // Множитель 1.5 = +50% рост\n\n    expect(projections[0].installs).toBe(1000);\n    expect(projections[1].installs).toBe(1500); // 1000 * 1.5 = 1500\n  });\n});\n\ndescribe('calculateUnitEconomics', () => {\n  it('должен правильно рассчитывать LTV для premium', () => {\n    const economics = calculateUnitEconomics(4, 9.99, 12, 0.05);\n\n    // LTV premium = 9.99 * 12 = 119.88\n    // LTV free = 15\n    // LTV = 119.88 * 0.05 + 15 * 0.95 = 5.994 + 14.25 = 20.244\n    expect(economics.ltv).toBeGreaterThan(15);\n    expect(economics.ltv).toBeLessThan(25);\n  });\n\n  it('должен правильно рассчитывать LTV/CAC ratio', () => {\n    const economics = calculateUnitEconomics(4, 9.99, 12, 0.05);\n\n    expect(economics.ltvCacRatio).toBeGreaterThan(1);\n    expect(economics.ltvCacRatio).toBe(economics.ltv / economics.cac);\n  });\n\n  it('должен правильно рассчитывать средний доход на пользователя', () => {\n    const economics = calculateUnitEconomics(4, 9.99, 12, 0.05);\n\n    // ARPU = 9.99 * 0.05 = 0.4995\n    expect(economics.averageRevenuePerUser).toBeCloseTo(0.5, 1);\n  });\n});\n\ndescribe('checkKPITargets', () => {\n  it('должен проверять достижение целевых KPIs', () => {\n    const projections = calculateGrowthProjection();\n    const unitEconomics = calculateUnitEconomics();\n    const result = checkKPITargets(projections, unitEconomics);\n\n    expect(result.targets).toBeDefined();\n    expect(result.achieved).toBeDefined();\n    expect(result.targets.dau).toBe(10000);\n    expect(result.targets.mau).toBe(50000);\n  });\n\n  it('должен правильно определять достижение DAU цели', () => {\n    const projections = calculateGrowthProjection();\n    const month6 = projections[5];\n\n    // Если DAU >= 10000, то цель достигнута\n    const unitEconomics = calculateUnitEconomics();\n    const result = checkKPITargets(projections, unitEconomics);\n\n    if (month6.dau >= 10000) {\n      expect(result.achieved.dau).toBe(true);\n    } else {\n      expect(result.achieved.dau).toBe(false);\n    }\n  });\n\n  it('должен правильно определять достижение CAC цели', () => {\n    const projections = calculateGrowthProjection();\n    const unitEconomics = calculateUnitEconomics(4); // CAC = 4\n\n    const result = checkKPITargets(projections, unitEconomics);\n\n    // Цель: CAC <= 10\n    expect(result.achieved.cac).toBe(true); // 4 <= 10\n  });\n});\n\ndescribe('generateInvestorProjection', () => {\n  it('должен генерировать полный прогноз для инвесторов', () => {\n    const result = generateInvestorProjection();\n\n    expect(result.projections).toBeDefined();\n    expect(result.projections).toHaveLength(6);\n    expect(result.unitEconomics).toBeDefined();\n    expect(result.kpiStatus).toBeDefined();\n    expect(result.summary).toBeDefined();\n  });\n\n  it('должен включать итоговую статистику', () => {\n    const result = generateInvestorProjection();\n\n    expect(result.summary.totalUsers).toBeGreaterThan(0);\n    expect(result.summary.totalRevenue).toBeGreaterThanOrEqual(0);\n    expect(result.summary.arr).toBeGreaterThanOrEqual(0);\n    expect(typeof result.summary.allTargetsMet).toBe('boolean');\n  });\n\n  it('должен быть детерминированным (одинаковые результаты)', () => {\n    const result1 = generateInvestorProjection();\n    const result2 = generateInvestorProjection();\n\n    expect(result1.summary.totalUsers).toBe(result2.summary.totalUsers);\n    expect(result1.summary.arr).toBe(result2.summary.arr);\n  });\n});\n"],"mappings":"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","ignoreList":[]}