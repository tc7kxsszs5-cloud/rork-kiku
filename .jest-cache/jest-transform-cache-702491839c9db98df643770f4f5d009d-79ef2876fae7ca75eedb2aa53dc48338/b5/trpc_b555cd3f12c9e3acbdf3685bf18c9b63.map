{"version":3,"names":["createTRPCReact","createTRPCClient","httpBatchLink","Constants","superjson","trpc","PROJECT_BASE_URL","isLocalHost","host","normalized","toLowerCase","includes","startsWith","endsWith","normalizeDevServerUrl","value","trimmed","trim","sanitized","replace","getDevServerFromExtras","_Constants$expoConfig","_extra$rork","_extra$devServer","_extra$expoGo","_extra$expoGo2","extra","expoConfig","candidates","rork","apiBaseUrl","devServer","url","expoGo","metroServerUrl","debuggerHost","candidate","parsed","URL","hostname","console","log","error","warn","getBaseUrl","_env","EXPO_PUBLIC_RORK_API_BASE_URL","isDev","__DEV__","window","_window$location","location","origin","_Constants$expoConfig2","extraHost","hostUri","normalizedHost","trpcClient","links","transformer","headers","fetch","_fetch","_x","_x2","apply","arguments","toString","_ref","_asyncToGenerator","options","controller","AbortController","timeoutId","setTimeout","abort","response","Object","assign","signal","clearTimeout","ok","contentType","get","status","statusText","text","clone","substring","_unused","_x3","_x4","trpcVanillaClient","_fetch2","_x5","_x6","_ref2","_unused2","_x7","_x8"],"sources":["trpc.ts"],"sourcesContent":["import { createTRPCReact } from \"@trpc/react-query\";\nimport { createTRPCClient, httpBatchLink } from \"@trpc/client\";\nimport Constants from \"expo-constants\";\nimport type { AppRouter } from \"@/backend/trpc/app-router\";\nimport superjson from \"superjson\";\n\nexport const trpc = createTRPCReact<AppRouter>();\n\nconst PROJECT_BASE_URL = 'https://d8v7u672uumlfpscvnbps.rork.live';\n\ntype ExpoExtra = {\n  rork?: { apiBaseUrl?: string };\n  devServer?: { url?: string };\n  expoGo?: {\n    debuggerHost?: string;\n    metroServerUrl?: string;\n  };\n};\n\nconst isLocalHost = (host?: string | null) => {\n  if (!host) {\n    return false;\n  }\n\n  const normalized = host.toLowerCase();\n  return (\n    normalized.includes('localhost') ||\n    normalized.startsWith('127.') ||\n    normalized.startsWith('10.') ||\n    normalized.startsWith('192.168.') ||\n    normalized.endsWith('.local')\n  );\n};\n\nconst normalizeDevServerUrl = (value?: string | null) => {\n  if (!value) {\n    return null;\n  }\n\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return null;\n  }\n\n  const sanitized = trimmed\n    .replace(/^exp:\\/\\//i, 'http://')\n    .replace(/^ws:\\/\\//i, 'http://')\n    .replace(/^wss:\\/\\//i, 'https://');\n\n  if (sanitized.startsWith('http://') || sanitized.startsWith('https://')) {\n    return sanitized.replace(/\\/$/, '');\n  }\n\n  return `http://${sanitized}`.replace(/\\/$/, '');\n};\n\nconst getDevServerFromExtras = () => {\n  const extra = Constants.expoConfig?.extra as ExpoExtra | undefined;\n  if (!extra) {\n    return null;\n  }\n\n  const candidates = [\n    extra.rork?.apiBaseUrl,\n    extra.devServer?.url,\n    extra.expoGo?.metroServerUrl,\n    extra.expoGo?.debuggerHost,\n  ];\n\n  for (const candidate of candidates) {\n    const normalized = normalizeDevServerUrl(candidate);\n    if (!normalized) {\n      continue;\n    }\n\n    try {\n      const parsed = new URL(normalized);\n      if (isLocalHost(parsed.hostname)) {\n        console.log('[tRPC] Using Expo extra host:', normalized);\n        return normalized;\n      }\n    } catch (error) {\n      console.warn('[tRPC] Failed to parse extra host candidate:', candidate, error);\n    }\n  }\n\n  return null;\n};\n\nconst getBaseUrl = () => {\n  if (process.env.EXPO_PUBLIC_RORK_API_BASE_URL) {\n    console.log('[tRPC] Using base URL from env:', process.env.EXPO_PUBLIC_RORK_API_BASE_URL);\n    return process.env.EXPO_PUBLIC_RORK_API_BASE_URL;\n  }\n\n  const isDev = typeof __DEV__ !== 'undefined' ? __DEV__ : false;\n\n  if (isDev && typeof window !== 'undefined') {\n    const { origin, hostname } = window.location;\n    if (isLocalHost(hostname)) {\n      console.log('[tRPC] Using window origin (dev):', origin);\n      return origin;\n    }\n  }\n\n  if (isDev) {\n    const extraHost = getDevServerFromExtras();\n    if (extraHost) {\n      return extraHost;\n    }\n\n    const hostUri = Constants.expoConfig?.hostUri;\n    if (hostUri) {\n      const normalizedHost = normalizeDevServerUrl(hostUri);\n      if (normalizedHost) {\n        try {\n          const parsed = new URL(normalizedHost);\n          if (isLocalHost(parsed.hostname)) {\n            console.log('[tRPC] Using Expo hostUri (dev):', normalizedHost);\n            return normalizedHost;\n          }\n        } catch (error) {\n          console.warn('[tRPC] Failed to parse hostUri:', hostUri, error);\n        }\n      }\n    }\n  }\n\n  console.log('[tRPC] Falling back to project domain:', PROJECT_BASE_URL);\n  return PROJECT_BASE_URL;\n};\n\nexport const trpcClient = createTRPCClient<AppRouter>({\n  links: [\n    httpBatchLink({\n      url: `${getBaseUrl()}/api/trpc`,\n      transformer: superjson,\n      headers: () => ({\n        'Content-Type': 'application/json',\n      }),\n      fetch: async (url, options) => {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), 10000);\n\n        try {\n          console.log('[tRPC] Request:', url);\n          const response = await fetch(url, {\n            ...options,\n            signal: controller.signal,\n          });\n          clearTimeout(timeoutId);\n          \n          if (!response.ok) {\n            const contentType = response.headers.get('content-type');\n            console.error('[tRPC] HTTP error:', {\n              status: response.status,\n              statusText: response.statusText,\n              url,\n              contentType,\n            });\n            \n            try {\n              const text = await response.clone().text();\n              console.error('[tRPC] Response body:', text.substring(0, 200));\n            } catch {\n              console.error('[tRPC] Could not read response body');\n            }\n          }\n          return response;\n        } catch (error) {\n          clearTimeout(timeoutId);\n          console.error('[tRPC] Fetch error:', error);\n          throw error;\n        }\n      },\n    }),\n  ],\n});\n\nexport const trpcVanillaClient = createTRPCClient<AppRouter>({\n  links: [\n    httpBatchLink({\n      url: `${getBaseUrl()}/api/trpc`,\n      transformer: superjson,\n      headers: () => ({\n        'Content-Type': 'application/json',\n      }),\n      fetch: async (url, options) => {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), 10000);\n\n        try {\n          console.log('[tRPC Vanilla] Request:', url);\n          const response = await fetch(url, {\n            ...options,\n            signal: controller.signal,\n          });\n          clearTimeout(timeoutId);\n          \n          if (!response.ok) {\n            const contentType = response.headers.get('content-type');\n            console.error('[tRPC Vanilla] HTTP error:', {\n              status: response.status,\n              statusText: response.statusText,\n              url,\n              contentType,\n            });\n            \n            try {\n              const text = await response.clone().text();\n              console.error('[tRPC Vanilla] Response body:', text.substring(0, 200));\n            } catch {\n              console.error('[tRPC Vanilla] Could not read response body');\n            }\n          }\n          return response;\n        } catch (error) {\n          clearTimeout(timeoutId);\n          console.error('[tRPC Vanilla] Fetch error:', error);\n          throw error;\n        }\n      },\n    }),\n  ],\n});\n"],"mappings":";AAAA,SAASA,eAAe,QAAQ,mBAAmB;AACnD,SAASC,gBAAgB,EAAEC,aAAa,QAAQ,cAAc;AAC9D,OAAOC,SAAS,MAAM,gBAAgB;AAEtC,OAAOC,SAAS,MAAM,WAAW;AAEjC,OAAO,IAAMC,IAAI,GAAGL,eAAe,CAAY,CAAC;AAEhD,IAAMM,gBAAgB,GAAG,yCAAyC;AAWlE,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAIC,IAAoB,EAAK;EAC5C,IAAI,CAACA,IAAI,EAAE;IACT,OAAO,KAAK;EACd;EAEA,IAAMC,UAAU,GAAGD,IAAI,CAACE,WAAW,CAAC,CAAC;EACrC,OACED,UAAU,CAACE,QAAQ,CAAC,WAAW,CAAC,IAChCF,UAAU,CAACG,UAAU,CAAC,MAAM,CAAC,IAC7BH,UAAU,CAACG,UAAU,CAAC,KAAK,CAAC,IAC5BH,UAAU,CAACG,UAAU,CAAC,UAAU,CAAC,IACjCH,UAAU,CAACI,QAAQ,CAAC,QAAQ,CAAC;AAEjC,CAAC;AAED,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAqBA,CAAIC,KAAqB,EAAK;EACvD,IAAI,CAACA,KAAK,EAAE;IACV,OAAO,IAAI;EACb;EAEA,IAAMC,OAAO,GAAGD,KAAK,CAACE,IAAI,CAAC,CAAC;EAC5B,IAAI,CAACD,OAAO,EAAE;IACZ,OAAO,IAAI;EACb;EAEA,IAAME,SAAS,GAAGF,OAAO,CACtBG,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAChCA,OAAO,CAAC,WAAW,EAAE,SAAS,CAAC,CAC/BA,OAAO,CAAC,YAAY,EAAE,UAAU,CAAC;EAEpC,IAAID,SAAS,CAACN,UAAU,CAAC,SAAS,CAAC,IAAIM,SAAS,CAACN,UAAU,CAAC,UAAU,CAAC,EAAE;IACvE,OAAOM,SAAS,CAACC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;EACrC;EAEA,OAAO,UAAUD,SAAS,EAAE,CAACC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;AACjD,CAAC;AAED,IAAMC,sBAAsB,GAAG,SAAzBA,sBAAsBA,CAAA,EAAS;EAAA,IAAAC,qBAAA,EAAAC,WAAA,EAAAC,gBAAA,EAAAC,aAAA,EAAAC,cAAA;EACnC,IAAMC,KAAK,IAAAL,qBAAA,GAAGlB,SAAS,CAACwB,UAAU,qBAApBN,qBAAA,CAAsBK,KAA8B;EAClE,IAAI,CAACA,KAAK,EAAE;IACV,OAAO,IAAI;EACb;EAEA,IAAME,UAAU,GAAG,EAAAN,WAAA,GACjBI,KAAK,CAACG,IAAI,qBAAVP,WAAA,CAAYQ,UAAU,GAAAP,gBAAA,GACtBG,KAAK,CAACK,SAAS,qBAAfR,gBAAA,CAAiBS,GAAG,GAAAR,aAAA,GACpBE,KAAK,CAACO,MAAM,qBAAZT,aAAA,CAAcU,cAAc,GAAAT,cAAA,GAC5BC,KAAK,CAACO,MAAM,qBAAZR,cAAA,CAAcU,YAAY,CAC3B;EAED,KAAK,IAAMC,SAAS,IAAIR,UAAU,EAAE;IAClC,IAAMnB,UAAU,GAAGK,qBAAqB,CAACsB,SAAS,CAAC;IACnD,IAAI,CAAC3B,UAAU,EAAE;MACf;IACF;IAEA,IAAI;MACF,IAAM4B,MAAM,GAAG,IAAIC,GAAG,CAAC7B,UAAU,CAAC;MAClC,IAAIF,WAAW,CAAC8B,MAAM,CAACE,QAAQ,CAAC,EAAE;QAChCC,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEhC,UAAU,CAAC;QACxD,OAAOA,UAAU;MACnB;IACF,CAAC,CAAC,OAAOiC,KAAK,EAAE;MACdF,OAAO,CAACG,IAAI,CAAC,8CAA8C,EAAEP,SAAS,EAAEM,KAAK,CAAC;IAChF;EACF;EAEA,OAAO,IAAI;AACb,CAAC;AAED,IAAME,UAAU,GAAG,SAAbA,UAAUA,CAAA,EAAS;EACvB,IAAAC,IAAA,CAAAC,6BAAA,EAA+C;IAC7CN,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAAI,IAAA,CAAAC,6BAA2C,CAAC;IACzF,OAAAD,IAAA,CAAAC,6BAAA;EACF;EAEA,IAAMC,KAAK,GAAG,OAAOC,OAAO,KAAK,WAAW,GAAGA,OAAO,GAAG,KAAK;EAE9D,IAAID,KAAK,IAAI,OAAOE,MAAM,KAAK,WAAW,EAAE;IAC1C,IAAAC,gBAAA,GAA6BD,MAAM,CAACE,QAAQ;MAApCC,MAAM,GAAAF,gBAAA,CAANE,MAAM;MAAEb,QAAQ,GAAAW,gBAAA,CAARX,QAAQ;IACxB,IAAIhC,WAAW,CAACgC,QAAQ,CAAC,EAAE;MACzBC,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEW,MAAM,CAAC;MACxD,OAAOA,MAAM;IACf;EACF;EAEA,IAAIL,KAAK,EAAE;IAAA,IAAAM,sBAAA;IACT,IAAMC,SAAS,GAAGlC,sBAAsB,CAAC,CAAC;IAC1C,IAAIkC,SAAS,EAAE;MACb,OAAOA,SAAS;IAClB;IAEA,IAAMC,OAAO,IAAAF,sBAAA,GAAGlD,SAAS,CAACwB,UAAU,qBAApB0B,sBAAA,CAAsBE,OAAO;IAC7C,IAAIA,OAAO,EAAE;MACX,IAAMC,cAAc,GAAG1C,qBAAqB,CAACyC,OAAO,CAAC;MACrD,IAAIC,cAAc,EAAE;QAClB,IAAI;UACF,IAAMnB,MAAM,GAAG,IAAIC,GAAG,CAACkB,cAAc,CAAC;UACtC,IAAIjD,WAAW,CAAC8B,MAAM,CAACE,QAAQ,CAAC,EAAE;YAChCC,OAAO,CAACC,GAAG,CAAC,kCAAkC,EAAEe,cAAc,CAAC;YAC/D,OAAOA,cAAc;UACvB;QACF,CAAC,CAAC,OAAOd,KAAK,EAAE;UACdF,OAAO,CAACG,IAAI,CAAC,iCAAiC,EAAEY,OAAO,EAAEb,KAAK,CAAC;QACjE;MACF;IACF;EACF;EAEAF,OAAO,CAACC,GAAG,CAAC,wCAAwC,EAAEnC,gBAAgB,CAAC;EACvE,OAAOA,gBAAgB;AACzB,CAAC;AAED,OAAO,IAAMmD,UAAU,GAAGxD,gBAAgB,CAAY;EACpDyD,KAAK,EAAE,CACLxD,aAAa,CAAC;IACZ8B,GAAG,EAAE,GAAGY,UAAU,CAAC,CAAC,WAAW;IAC/Be,WAAW,EAAEvD,SAAS;IACtBwD,OAAO,EAAE,SAATA,OAAOA,CAAA;MAAA,OAAS;QACd,cAAc,EAAE;MAClB,CAAC;IAAA,CAAC;IACFC,KAAK,YAAAC,MAAA;MAAA,SAALD,KAAKA,CAAAE,EAAA,EAAAC,GAAA;QAAA,OAAAF,MAAA,CAAAG,KAAA,OAAAC,SAAA;MAAA;MAALL,KAAK,CAAAM,QAAA;QAAA,OAAAL,MAAA,CAAAK,QAAA;MAAA;MAAA,OAALN,KAAK;IAAA;MAAA,IAAAO,IAAA,GAAAC,iBAAA,CAAE,WAAOrC,GAAG,EAAEsC,OAAO,EAAK;QAC7B,IAAMC,UAAU,GAAG,IAAIC,eAAe,CAAC,CAAC;QACxC,IAAMC,SAAS,GAAGC,UAAU,CAAC;UAAA,OAAMH,UAAU,CAACI,KAAK,CAAC,CAAC;QAAA,GAAE,KAAK,CAAC;QAE7D,IAAI;UACFnC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAET,GAAG,CAAC;UACnC,IAAM4C,QAAQ,SAASf,KAAK,CAAC7B,GAAG,EAAA6C,MAAA,CAAAC,MAAA,KAC3BR,OAAO;YACVS,MAAM,EAAER,UAAU,CAACQ;UAAM,EAC1B,CAAC;UACFC,YAAY,CAACP,SAAS,CAAC;UAEvB,IAAI,CAACG,QAAQ,CAACK,EAAE,EAAE;YAChB,IAAMC,WAAW,GAAGN,QAAQ,CAAChB,OAAO,CAACuB,GAAG,CAAC,cAAc,CAAC;YACxD3C,OAAO,CAACE,KAAK,CAAC,oBAAoB,EAAE;cAClC0C,MAAM,EAAER,QAAQ,CAACQ,MAAM;cACvBC,UAAU,EAAET,QAAQ,CAACS,UAAU;cAC/BrD,GAAG,EAAHA,GAAG;cACHkD,WAAW,EAAXA;YACF,CAAC,CAAC;YAEF,IAAI;cACF,IAAMI,IAAI,SAASV,QAAQ,CAACW,KAAK,CAAC,CAAC,CAACD,IAAI,CAAC,CAAC;cAC1C9C,OAAO,CAACE,KAAK,CAAC,uBAAuB,EAAE4C,IAAI,CAACE,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;YAChE,CAAC,CAAC,OAAAC,OAAA,EAAM;cACNjD,OAAO,CAACE,KAAK,CAAC,qCAAqC,CAAC;YACtD;UACF;UACA,OAAOkC,QAAQ;QACjB,CAAC,CAAC,OAAOlC,KAAK,EAAE;UACdsC,YAAY,CAACP,SAAS,CAAC;UACvBjC,OAAO,CAACE,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;UAC3C,MAAMA,KAAK;QACb;MACF,CAAC;MAAA,iBAAAgD,GAAA,EAAAC,GAAA;QAAA,OAAAvB,IAAA,CAAAH,KAAA,OAAAC,SAAA;MAAA;IAAA;EACH,CAAC,CAAC;AAEN,CAAC,CAAC;AAEF,OAAO,IAAM0B,iBAAiB,GAAG3F,gBAAgB,CAAY;EAC3DyD,KAAK,EAAE,CACLxD,aAAa,CAAC;IACZ8B,GAAG,EAAE,GAAGY,UAAU,CAAC,CAAC,WAAW;IAC/Be,WAAW,EAAEvD,SAAS;IACtBwD,OAAO,EAAE,SAATA,OAAOA,CAAA;MAAA,OAAS;QACd,cAAc,EAAE;MAClB,CAAC;IAAA,CAAC;IACFC,KAAK,YAAAgC,OAAA;MAAA,SAALhC,KAAKA,CAAAiC,GAAA,EAAAC,GAAA;QAAA,OAAAF,OAAA,CAAA5B,KAAA,OAAAC,SAAA;MAAA;MAALL,KAAK,CAAAM,QAAA;QAAA,OAAA0B,OAAA,CAAA1B,QAAA;MAAA;MAAA,OAALN,KAAK;IAAA;MAAA,IAAAmC,KAAA,GAAA3B,iBAAA,CAAE,WAAOrC,GAAG,EAAEsC,OAAO,EAAK;QAC7B,IAAMC,UAAU,GAAG,IAAIC,eAAe,CAAC,CAAC;QACxC,IAAMC,SAAS,GAAGC,UAAU,CAAC;UAAA,OAAMH,UAAU,CAACI,KAAK,CAAC,CAAC;QAAA,GAAE,KAAK,CAAC;QAE7D,IAAI;UACFnC,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAET,GAAG,CAAC;UAC3C,IAAM4C,QAAQ,SAASf,KAAK,CAAC7B,GAAG,EAAA6C,MAAA,CAAAC,MAAA,KAC3BR,OAAO;YACVS,MAAM,EAAER,UAAU,CAACQ;UAAM,EAC1B,CAAC;UACFC,YAAY,CAACP,SAAS,CAAC;UAEvB,IAAI,CAACG,QAAQ,CAACK,EAAE,EAAE;YAChB,IAAMC,WAAW,GAAGN,QAAQ,CAAChB,OAAO,CAACuB,GAAG,CAAC,cAAc,CAAC;YACxD3C,OAAO,CAACE,KAAK,CAAC,4BAA4B,EAAE;cAC1C0C,MAAM,EAAER,QAAQ,CAACQ,MAAM;cACvBC,UAAU,EAAET,QAAQ,CAACS,UAAU;cAC/BrD,GAAG,EAAHA,GAAG;cACHkD,WAAW,EAAXA;YACF,CAAC,CAAC;YAEF,IAAI;cACF,IAAMI,IAAI,SAASV,QAAQ,CAACW,KAAK,CAAC,CAAC,CAACD,IAAI,CAAC,CAAC;cAC1C9C,OAAO,CAACE,KAAK,CAAC,+BAA+B,EAAE4C,IAAI,CAACE,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;YACxE,CAAC,CAAC,OAAAS,QAAA,EAAM;cACNzD,OAAO,CAACE,KAAK,CAAC,6CAA6C,CAAC;YAC9D;UACF;UACA,OAAOkC,QAAQ;QACjB,CAAC,CAAC,OAAOlC,KAAK,EAAE;UACdsC,YAAY,CAACP,SAAS,CAAC;UACvBjC,OAAO,CAACE,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;UACnD,MAAMA,KAAK;QACb;MACF,CAAC;MAAA,iBAAAwD,GAAA,EAAAC,GAAA;QAAA,OAAAH,KAAA,CAAA/B,KAAA,OAAAC,SAAA;MAAA;IAAA;EACH,CAAC,CAAC;AAEN,CAAC,CAAC","ignoreList":[]}