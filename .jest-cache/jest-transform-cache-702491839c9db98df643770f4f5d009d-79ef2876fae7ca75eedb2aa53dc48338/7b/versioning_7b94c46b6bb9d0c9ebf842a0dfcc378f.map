{"version":3,"names":["APP_DATA_VERSION","exports","API_VERSION","SCHEMA_VERSION","getVersionInfo","packageJson","require","appVersion","version","dataVersion","apiVersion","schemaVersion","_unused","createVersionedData","data","arguments","length","undefined","migratedAt","Date","now","needsMigration","currentVersion","targetVersion","getStoredVersion","_x","_getStoredVersion","apply","_asyncToGenerator2","default","storageKey","AsyncStorage","getItem","parseInt","_unused2","saveStoredVersion","_x2","_x3","_saveStoredVersion","setItem","String","error","console"],"sources":["versioning.ts"],"sourcesContent":["/**\n * Система версионирования для проекта KIKU\n * \n * Обеспечивает плавный переход между версиями данных без потери информации\n */\n\nexport const APP_DATA_VERSION = 1; // Текущая версия данных\nexport const API_VERSION = 1; // Текущая версия API\nexport const SCHEMA_VERSION = 1; // Текущая версия схем\n\nexport interface VersionInfo {\n  appVersion: string; // Версия приложения из package.json\n  dataVersion: number; // Версия данных\n  apiVersion: number; // Версия API\n  schemaVersion: number; // Версия схем\n}\n\n/**\n * Получить информацию о версиях\n */\nexport function getVersionInfo(): VersionInfo {\n  try {\n    const packageJson = require('../../package.json');\n    return {\n      appVersion: packageJson.version || '1.0.0',\n      dataVersion: APP_DATA_VERSION,\n      apiVersion: API_VERSION,\n      schemaVersion: SCHEMA_VERSION,\n    };\n  } catch {\n    return {\n      appVersion: '1.0.0',\n      dataVersion: APP_DATA_VERSION,\n      apiVersion: API_VERSION,\n      schemaVersion: SCHEMA_VERSION,\n    };\n  }\n}\n\n/**\n * Версионированные данные\n */\nexport interface VersionedData<T = any> {\n  version: number;\n  data: T;\n  migratedAt?: number;\n  migratedFrom?: number;\n}\n\n/**\n * Создать версионированные данные\n */\nexport function createVersionedData<T>(data: T, version: number = APP_DATA_VERSION): VersionedData<T> {\n  return {\n    version,\n    data,\n    migratedAt: Date.now(),\n  };\n}\n\n/**\n * Проверить нужно ли мигрировать данные\n */\nexport function needsMigration(currentVersion: number, targetVersion: number = APP_DATA_VERSION): boolean {\n  return currentVersion < targetVersion;\n}\n\n/**\n * Получить версию из хранилища\n */\nexport async function getStoredVersion(storageKey: string): Promise<number> {\n  try {\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\n    const version = await AsyncStorage.getItem(`${storageKey}_version`);\n    return version ? parseInt(version, 10) : 1; // По умолчанию версия 1\n  } catch {\n    return 1;\n  }\n}\n\n/**\n * Сохранить версию в хранилище\n */\nexport async function saveStoredVersion(storageKey: string, version: number): Promise<void> {\n  try {\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\n    await AsyncStorage.setItem(`${storageKey}_version`, String(version));\n  } catch (error) {\n    console.error(`[versioning] Failed to save version for ${storageKey}:`, error);\n  }\n}\n"],"mappings":";;;;;;;;;;;AAMO,IAAMA,gBAAgB,GAAAC,OAAA,CAAAD,gBAAA,GAAG,CAAC;AAC1B,IAAME,WAAW,GAAAD,OAAA,CAAAC,WAAA,GAAG,CAAC;AACrB,IAAMC,cAAc,GAAAF,OAAA,CAAAE,cAAA,GAAG,CAAC;AAYxB,SAASC,cAAcA,CAAA,EAAgB;EAC5C,IAAI;IACF,IAAMC,WAAW,GAAGC,OAAO,CAAC,oBAAoB,CAAC;IACjD,OAAO;MACLC,UAAU,EAAEF,WAAW,CAACG,OAAO,IAAI,OAAO;MAC1CC,WAAW,EAAET,gBAAgB;MAC7BU,UAAU,EAAER,WAAW;MACvBS,aAAa,EAAER;IACjB,CAAC;EACH,CAAC,CAAC,OAAAS,OAAA,EAAM;IACN,OAAO;MACLL,UAAU,EAAE,OAAO;MACnBE,WAAW,EAAET,gBAAgB;MAC7BU,UAAU,EAAER,WAAW;MACvBS,aAAa,EAAER;IACjB,CAAC;EACH;AACF;AAeO,SAASU,mBAAmBA,CAAIC,IAAO,EAAwD;EAAA,IAAtDN,OAAe,GAAAO,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGf,gBAAgB;EAChF,OAAO;IACLQ,OAAO,EAAPA,OAAO;IACPM,IAAI,EAAJA,IAAI;IACJI,UAAU,EAAEC,IAAI,CAACC,GAAG,CAAC;EACvB,CAAC;AACH;AAKO,SAASC,cAAcA,CAACC,cAAsB,EAAqD;EAAA,IAAnDC,aAAqB,GAAAR,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGf,gBAAgB;EAC7F,OAAOsB,cAAc,GAAGC,aAAa;AACvC;AAAC,SAKqBC,gBAAgBA,CAAAC,EAAA;EAAA,OAAAC,iBAAA,CAAAC,KAAA,OAAAZ,SAAA;AAAA;AAAA,SAAAW,kBAAA;EAAAA,iBAAA,OAAAE,kBAAA,CAAAC,OAAA,EAA/B,WAAgCC,UAAkB,EAAmB;IAC1E,IAAI;MACF,IAAMC,YAAY,GAAG,OAAO,MAAM,CAAC,2CAA2C,CAAC,EAAEF,OAAO;MACxF,IAAMrB,OAAO,SAASuB,YAAY,CAACC,OAAO,CAAC,GAAGF,UAAU,UAAU,CAAC;MACnE,OAAOtB,OAAO,GAAGyB,QAAQ,CAACzB,OAAO,EAAE,EAAE,CAAC,GAAG,CAAC;IAC5C,CAAC,CAAC,OAAA0B,QAAA,EAAM;MACN,OAAO,CAAC;IACV;EACF,CAAC;EAAA,OAAAR,iBAAA,CAAAC,KAAA,OAAAZ,SAAA;AAAA;AAAA,SAKqBoB,iBAAiBA,CAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,kBAAA,CAAAX,KAAA,OAAAZ,SAAA;AAAA;AAAA,SAAAuB,mBAAA;EAAAA,kBAAA,OAAAV,kBAAA,CAAAC,OAAA,EAAhC,WAAiCC,UAAkB,EAAEtB,OAAe,EAAiB;IAC1F,IAAI;MACF,IAAMuB,YAAY,GAAG,OAAO,MAAM,CAAC,2CAA2C,CAAC,EAAEF,OAAO;MACxF,MAAME,YAAY,CAACQ,OAAO,CAAC,GAAGT,UAAU,UAAU,EAAEU,MAAM,CAAChC,OAAO,CAAC,CAAC;IACtE,CAAC,CAAC,OAAOiC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,2CAA2CX,UAAU,GAAG,EAAEW,KAAK,CAAC;IAChF;EACF,CAAC;EAAA,OAAAH,kBAAA,CAAAX,KAAA,OAAAZ,SAAA;AAAA","ignoreList":[]}