{"version":3,"names":["APP_DATA_VERSION","exports","cov_gxjko5dfc","s","API_VERSION","SCHEMA_VERSION","getVersionInfo","f","packageJson","require","appVersion","b","version","dataVersion","apiVersion","schemaVersion","_unused","createVersionedData","data","arguments","length","undefined","migratedAt","Date","now","needsMigration","currentVersion","targetVersion","getStoredVersion","_x","_getStoredVersion","apply","_asyncToGenerator2","default","storageKey","AsyncStorage","getItem","parseInt","_unused2","saveStoredVersion","_x2","_x3","_saveStoredVersion","setItem","String","error","console"],"sources":["versioning.ts"],"sourcesContent":["/**\n * Система версионирования для проекта KIKU\n * \n * Обеспечивает плавный переход между версиями данных без потери информации\n */\n\nexport const APP_DATA_VERSION = 1; // Текущая версия данных\nexport const API_VERSION = 1; // Текущая версия API\nexport const SCHEMA_VERSION = 1; // Текущая версия схем\n\nexport interface VersionInfo {\n  appVersion: string; // Версия приложения из package.json\n  dataVersion: number; // Версия данных\n  apiVersion: number; // Версия API\n  schemaVersion: number; // Версия схем\n}\n\n/**\n * Получить информацию о версиях\n */\nexport function getVersionInfo(): VersionInfo {\n  try {\n    const packageJson = require('../../package.json');\n    return {\n      appVersion: packageJson.version || '1.0.0',\n      dataVersion: APP_DATA_VERSION,\n      apiVersion: API_VERSION,\n      schemaVersion: SCHEMA_VERSION,\n    };\n  } catch {\n    return {\n      appVersion: '1.0.0',\n      dataVersion: APP_DATA_VERSION,\n      apiVersion: API_VERSION,\n      schemaVersion: SCHEMA_VERSION,\n    };\n  }\n}\n\n/**\n * Версионированные данные\n */\nexport interface VersionedData<T = any> {\n  version: number;\n  data: T;\n  migratedAt?: number;\n  migratedFrom?: number;\n}\n\n/**\n * Создать версионированные данные\n */\nexport function createVersionedData<T>(data: T, version: number = APP_DATA_VERSION): VersionedData<T> {\n  return {\n    version,\n    data,\n    migratedAt: Date.now(),\n  };\n}\n\n/**\n * Проверить нужно ли мигрировать данные\n */\nexport function needsMigration(currentVersion: number, targetVersion: number = APP_DATA_VERSION): boolean {\n  return currentVersion < targetVersion;\n}\n\n/**\n * Получить версию из хранилища\n */\nexport async function getStoredVersion(storageKey: string): Promise<number> {\n  try {\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\n    const version = await AsyncStorage.getItem(`${storageKey}_version`);\n    return version ? parseInt(version, 10) : 1; // По умолчанию версия 1\n  } catch {\n    return 1;\n  }\n}\n\n/**\n * Сохранить версию в хранилище\n */\nexport async function saveStoredVersion(storageKey: string, version: number): Promise<void> {\n  try {\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\n    await AsyncStorage.setItem(`${storageKey}_version`, String(version));\n  } catch (error) {\n    console.error(`[versioning] Failed to save version for ${storageKey}:`, error);\n  }\n}\n"],"mappings":"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","ignoreList":[]}