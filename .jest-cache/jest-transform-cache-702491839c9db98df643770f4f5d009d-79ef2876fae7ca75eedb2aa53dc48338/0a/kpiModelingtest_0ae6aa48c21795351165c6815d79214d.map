{"version":3,"names":["calculateGrowthProjection","calculateUnitEconomics","checkKPITargets","generateInvestorProjection","describe","it","projections","expect","toHaveLength","month","toBe","activations","installs","dau","premiumUsers","mrr","toBeCloseTo","arr","economics","ltv","toBeGreaterThan","toBeLessThan","ltvCacRatio","cac","averageRevenuePerUser","unitEconomics","result","targets","toBeDefined","achieved","mau","month6","kpiStatus","summary","totalUsers","totalRevenue","toBeGreaterThanOrEqual","allTargetsMet","result1","result2"],"sources":["kpiModeling.test.ts"],"sourcesContent":["/**\n * Модульные тесты для моделирования KPIs\n * Только детерминированные тесты\n */\n\nimport {\n  calculateGrowthProjection,\n  calculateUnitEconomics,\n  checkKPITargets,\n  generateInvestorProjection,\n} from '@/utils/kpiModeling';\n\ndescribe('calculateGrowthProjection', () => {\n  it('должен создавать прогноз на 6 месяцев', () => {\n    const projections = calculateGrowthProjection(1000);\n\n    expect(projections).toHaveLength(6);\n    expect(projections[0].month).toBe(1);\n    expect(projections[5].month).toBe(6);\n  });\n\n  it('должен правильно рассчитывать активации', () => {\n    const projections = calculateGrowthProjection(1000, [1.5], 0.6);\n\n    expect(projections[0].activations).toBe(600); // 1000 * 0.6\n    expect(projections[0].installs).toBe(1000);\n  });\n\n  it('должен правильно рассчитывать DAU', () => {\n    const projections = calculateGrowthProjection(1000, [1.5], 0.6, 0.3);\n\n    expect(projections[0].dau).toBe(300); // 1000 * 0.3\n  });\n\n  it('должен правильно рассчитывать premium пользователей и MRR', () => {\n    const projections = calculateGrowthProjection(\n      1000,\n      [1.5],\n      0.6,\n      0.3,\n      [0.35],\n      [0.20],\n      9.99,\n      [0.05] // 5% conversion в первый месяц\n    );\n\n    // MAU = installs = 1000\n    // Premium users = 1000 * 0.05 = 50\n    // MRR = 50 * 9.99 = 499.5\n    expect(projections[0].premiumUsers).toBe(50);\n    expect(projections[0].mrr).toBeCloseTo(499.5, 1);\n    expect(projections[0].arr).toBeCloseTo(5994, 1); // 499.5 * 12\n  });\n\n  it('должен применять рост к установкам', () => {\n    const projections = calculateGrowthProjection(1000, [1.5]); // Множитель 1.5 = +50% рост\n\n    expect(projections[0].installs).toBe(1000);\n    expect(projections[1].installs).toBe(1500); // 1000 * 1.5 = 1500\n  });\n});\n\ndescribe('calculateUnitEconomics', () => {\n  it('должен правильно рассчитывать LTV для premium', () => {\n    const economics = calculateUnitEconomics(4, 9.99, 12, 0.05);\n\n    // LTV premium = 9.99 * 12 = 119.88\n    // LTV free = 15\n    // LTV = 119.88 * 0.05 + 15 * 0.95 = 5.994 + 14.25 = 20.244\n    expect(economics.ltv).toBeGreaterThan(15);\n    expect(economics.ltv).toBeLessThan(25);\n  });\n\n  it('должен правильно рассчитывать LTV/CAC ratio', () => {\n    const economics = calculateUnitEconomics(4, 9.99, 12, 0.05);\n\n    expect(economics.ltvCacRatio).toBeGreaterThan(1);\n    expect(economics.ltvCacRatio).toBe(economics.ltv / economics.cac);\n  });\n\n  it('должен правильно рассчитывать средний доход на пользователя', () => {\n    const economics = calculateUnitEconomics(4, 9.99, 12, 0.05);\n\n    // ARPU = 9.99 * 0.05 = 0.4995\n    expect(economics.averageRevenuePerUser).toBeCloseTo(0.5, 1);\n  });\n});\n\ndescribe('checkKPITargets', () => {\n  it('должен проверять достижение целевых KPIs', () => {\n    const projections = calculateGrowthProjection();\n    const unitEconomics = calculateUnitEconomics();\n    const result = checkKPITargets(projections, unitEconomics);\n\n    expect(result.targets).toBeDefined();\n    expect(result.achieved).toBeDefined();\n    expect(result.targets.dau).toBe(10000);\n    expect(result.targets.mau).toBe(50000);\n  });\n\n  it('должен правильно определять достижение DAU цели', () => {\n    const projections = calculateGrowthProjection();\n    const month6 = projections[5];\n\n    // Если DAU >= 10000, то цель достигнута\n    const unitEconomics = calculateUnitEconomics();\n    const result = checkKPITargets(projections, unitEconomics);\n\n    if (month6.dau >= 10000) {\n      expect(result.achieved.dau).toBe(true);\n    } else {\n      expect(result.achieved.dau).toBe(false);\n    }\n  });\n\n  it('должен правильно определять достижение CAC цели', () => {\n    const projections = calculateGrowthProjection();\n    const unitEconomics = calculateUnitEconomics(4); // CAC = 4\n\n    const result = checkKPITargets(projections, unitEconomics);\n\n    // Цель: CAC <= 10\n    expect(result.achieved.cac).toBe(true); // 4 <= 10\n  });\n});\n\ndescribe('generateInvestorProjection', () => {\n  it('должен генерировать полный прогноз для инвесторов', () => {\n    const result = generateInvestorProjection();\n\n    expect(result.projections).toBeDefined();\n    expect(result.projections).toHaveLength(6);\n    expect(result.unitEconomics).toBeDefined();\n    expect(result.kpiStatus).toBeDefined();\n    expect(result.summary).toBeDefined();\n  });\n\n  it('должен включать итоговую статистику', () => {\n    const result = generateInvestorProjection();\n\n    expect(result.summary.totalUsers).toBeGreaterThan(0);\n    expect(result.summary.totalRevenue).toBeGreaterThanOrEqual(0);\n    expect(result.summary.arr).toBeGreaterThanOrEqual(0);\n    expect(typeof result.summary.allTargetsMet).toBe('boolean');\n  });\n\n  it('должен быть детерминированным (одинаковые результаты)', () => {\n    const result1 = generateInvestorProjection();\n    const result2 = generateInvestorProjection();\n\n    expect(result1.summary.totalUsers).toBe(result2.summary.totalUsers);\n    expect(result1.summary.arr).toBe(result2.summary.arr);\n  });\n});\n"],"mappings":"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","ignoreList":[]}