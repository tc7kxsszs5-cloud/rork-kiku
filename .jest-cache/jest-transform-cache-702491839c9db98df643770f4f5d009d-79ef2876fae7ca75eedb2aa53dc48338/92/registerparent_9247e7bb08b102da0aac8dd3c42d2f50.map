{"version":3,"names":["z","publicProcedure","supabase","sanitizeEmail","rateLimiters","generateParentCode","cov_2ev48tpd5g","f","chars","s","code","i","charAt","Math","floor","random","length","isCodeUnique","_x","_isCodeUnique","apply","arguments","_asyncToGenerator","b","_ref6","from","select","eq","single","data","createUniqueCode","_createUniqueCode","attempts","maxAttempts","Error","registerParentProcedure","use","general","input","object","name","string","min","max","email","phone","optional","country","default","state","coppaConsent","boolean","refine","val","message","privacyPolicyAccepted","mutation","_ref2","_ref","timestamp","Date","now","parentId","toString","substr","sanitizedEmail","_ref3","existing","success","error","_ref4","insert","id","email_verified","pin_hash","created_at","updated_at","coppa_consent","coppa_consent_date","privacy_policy_accepted","privacy_policy_date","parentData","parentError","console","JSON","stringify","details","hint","errorCode","errorDetails","errorHint","fullError","process","env","NODE_ENV","undefined","_ref5","parent_id","expires_at","used_count","max_uses","is_active","codeError","errorMessage","String","_x2"],"sources":["register-parent.ts"],"sourcesContent":["import { z } from \"zod\";\nimport { publicProcedure } from \"../../create-context.js\";\nimport { supabase } from \"../../../utils/supabase.js\";\nimport { sanitizeEmail } from \"../../../utils/security.js\";\nimport { rateLimiters } from \"../../middleware/rateLimit.js\";\n\n/**\n * Генерация уникального кода родителя\n * Формат: KIKU-XXXXXX (6 символов)\n */\nfunction generateParentCode(): string {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Исключаем похожие символы (0, O, I, 1)\n  let code = '';\n  for (let i = 0; i < 6; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return `KIKU-${code}`;\n}\n\n/**\n * Проверка уникальности кода\n */\nasync function isCodeUnique(code: string): Promise<boolean> {\n  if (!supabase) return false;\n  \n  const { data } = await supabase\n    .from('parent_codes')\n    .select('code')\n    .eq('code', code)\n    .single();\n  \n  return !data;\n}\n\n/**\n * Создание уникального кода\n */\nasync function createUniqueCode(): Promise<string> {\n  let code = generateParentCode();\n  let attempts = 0;\n  const maxAttempts = 10;\n  \n  while (!(await isCodeUnique(code)) && attempts < maxAttempts) {\n    code = generateParentCode();\n    attempts++;\n  }\n  \n  if (attempts >= maxAttempts) {\n    throw new Error('Не удалось создать уникальный код. Попробуйте позже.');\n  }\n  \n  return code;\n}\n\nexport const registerParentProcedure = publicProcedure\n  .use(rateLimiters.general)\n  .input(\n    z.object({\n      name: z.string().min(1).max(100),\n      email: z.string().email(),\n      phone: z.string().optional(),\n      country: z.string().default('US'),\n      state: z.string().optional(),\n      coppaConsent: z.boolean().refine(val => val === true, {\n        message: 'Необходимо согласие с COPPA',\n      }),\n      privacyPolicyAccepted: z.boolean().refine(val => val === true, {\n        message: 'Необходимо принять политику конфиденциальности',\n      }),\n    })\n  )\n  .mutation(async ({ input }) => {\n    if (!supabase) {\n      throw new Error(\"Supabase клиент не инициализирован\");\n    }\n\n    const timestamp = Date.now();\n    const parentId = `parent_${timestamp}_${Math.random().toString(36).substr(2, 9)}`;\n\n    try {\n      // Sanitize email\n      const sanitizedEmail = sanitizeEmail(input.email);\n\n      // Проверяем, не существует ли уже родитель с таким email\n      const { data: existing } = await supabase\n        .from('parents')\n        .select('id')\n        .eq('email', sanitizedEmail)\n        .single();\n\n      if (existing) {\n        return {\n          success: false,\n          error: 'Родитель с таким email уже зарегистрирован',\n        };\n      }\n\n      // Создаем родителя\n      const { data: parentData, error: parentError } = await supabase\n        .from('parents')\n        .insert({\n          id: parentId,\n          email: sanitizedEmail,\n          email_verified: false, // Будет верифицирован по email\n          name: input.name,\n          phone: input.phone || null,\n          pin_hash: '', // Будет установлен позже\n          created_at: timestamp,\n          updated_at: timestamp,\n          country: input.country || 'US',\n          state: input.state || null,\n          coppa_consent: input.coppaConsent,\n          coppa_consent_date: input.coppaConsent ? timestamp : null,\n          privacy_policy_accepted: input.privacyPolicyAccepted,\n          privacy_policy_date: input.privacyPolicyAccepted ? timestamp : null,\n        })\n        .select()\n        .single();\n\n      if (parentError) {\n        console.error('[registerParentProcedure] Supabase Error:', JSON.stringify(parentError, null, 2));\n        console.error('[registerParentProcedure] Error Code:', parentError.code);\n        console.error('[registerParentProcedure] Error Message:', parentError.message);\n        console.error('[registerParentProcedure] Error Details:', parentError.details);\n        console.error('[registerParentProcedure] Error Hint:', parentError.hint);\n        \n        // Возвращаем детали ошибки вместо throw\n        return {\n          success: false,\n          error: `Ошибка при создании аккаунта родителя: ${parentError.message || parentError.code || 'Неизвестная ошибка'}`,\n          errorCode: parentError.code,\n          errorDetails: parentError.details,\n          errorHint: parentError.hint,\n          fullError: process.env.NODE_ENV === 'development' ? JSON.stringify(parentError, null, 2) : undefined,\n        };\n      }\n\n      // Генерируем уникальный код\n      const code = await createUniqueCode();\n\n      // Создаем код родителя (бессрочный, максимум 10 детей)\n      const { error: codeError } = await supabase\n        .from('parent_codes')\n        .insert({\n          code,\n          parent_id: parentId,\n          created_at: timestamp,\n          expires_at: null, // Бессрочно\n          used_count: 0,\n          max_uses: 10,\n          is_active: true,\n        });\n\n      if (codeError) {\n        console.error('[registerParentProcedure] Code creation error:', codeError);\n        return {\n          success: false,\n          error: `Ошибка при создании кода: ${codeError.message || codeError.code || 'Неизвестная ошибка'}`,\n          errorCode: codeError.code,\n          errorDetails: codeError.details,\n          errorHint: codeError.hint,\n        };\n      }\n\n      return {\n        success: true,\n        parentId,\n        code,\n        message: 'Регистрация успешна! Сохраните код для регистрации ребенка.',\n      };\n    } catch (error) {\n      console.error('[registerParentProcedure] Error:', error);\n      \n      // Если это ошибка Supabase, передаем детали\n      if (error && typeof error === 'object' && 'message' in error) {\n        const errorMessage = error.message as string;\n        const errorCode = 'code' in error ? (error.code as string) : undefined;\n        const errorDetails = 'details' in error ? (error.details as string) : undefined;\n        const errorHint = 'hint' in error ? (error.hint as string) : undefined;\n        \n        return {\n          success: false,\n          error: errorMessage,\n          errorCode,\n          errorDetails,\n          errorHint,\n          fullError: process.env.NODE_ENV === 'development' ? JSON.stringify(error, null, 2) : undefined,\n        };\n      }\n      \n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Неизвестная ошибка',\n        fullError: process.env.NODE_ENV === 'development' ? String(error) : undefined,\n      };\n    }\n  });\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}