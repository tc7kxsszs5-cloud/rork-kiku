0e8791b90a84036a96c58bb3534fe6d7
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MigrationManager = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var MigrationManager = exports.MigrationManager = function () {
  function MigrationManager() {
    (0, _classCallCheck2.default)(this, MigrationManager);
    this.migrations = [];
    this.backupEnabled = true;
  }
  return (0, _createClass2.default)(MigrationManager, [{
    key: "register",
    value: function register(migration) {
      var conflict = this.migrations.find(function (m) {
        return m.fromVersion === migration.fromVersion && m.toVersion === migration.toVersion;
      });
      if (conflict) {
        console.warn(`[MigrationManager] Migration conflict: ${migration.name} conflicts with ${conflict.name}`);
      }
      this.migrations.push(migration);
      this.migrations.sort(function (a, b) {
        return a.fromVersion - b.fromVersion;
      });
    }
  }, {
    key: "migrate",
    value: (function () {
      var _migrate = (0, _asyncToGenerator2.default)(function* (data, fromVersion, toVersion) {
        var _this = this;
        if (fromVersion >= toVersion) {
          return {
            success: true,
            data: data,
            fromVersion: fromVersion,
            toVersion: toVersion
          };
        }
        var currentData = data;
        var currentVersion = fromVersion;
        try {
          if (this.backupEnabled) {
            yield this.saveBackup(currentData, currentVersion);
          }
          var _loop = function* _loop() {
            var nextVersion = currentVersion + 1;
            var migration = _this.migrations.find(function (m) {
              return m.fromVersion === currentVersion && m.toVersion === nextVersion;
            });
            if (!migration) {
              throw new Error(`No migration found from version ${currentVersion} to ${nextVersion}`);
            }
            console.log(`[MigrationManager] Migrating from ${currentVersion} to ${nextVersion}: ${migration.name}`);
            currentData = yield migration.migrate(currentData);
            currentVersion = migration.toVersion;
            if (currentData && typeof currentData === 'object') {
              currentData.version = currentVersion;
              currentData.migratedAt = Date.now();
              currentData.migratedFrom = migration.fromVersion;
            }
          };
          while (currentVersion < toVersion) {
            yield* _loop();
          }
          return {
            success: true,
            data: currentData,
            fromVersion: fromVersion,
            toVersion: currentVersion
          };
        } catch (error) {
          console.error('[MigrationManager] Migration failed:', error);
          return {
            success: false,
            data: currentData,
            fromVersion: fromVersion,
            toVersion: currentVersion,
            error: error instanceof Error ? error : new Error(String(error))
          };
        }
      });
      function migrate(_x, _x2, _x3) {
        return _migrate.apply(this, arguments);
      }
      return migrate;
    }())
  }, {
    key: "rollback",
    value: (function () {
      var _rollback = (0, _asyncToGenerator2.default)(function* (data, fromVersion, toVersion) {
        var _this2 = this;
        if (fromVersion <= toVersion) {
          return {
            success: true,
            data: data,
            fromVersion: fromVersion,
            toVersion: toVersion
          };
        }
        var currentData = data;
        var currentVersion = fromVersion;
        try {
          var _loop2 = function* _loop2() {
            var prevVersion = currentVersion - 1;
            var migration = _this2.migrations.find(function (m) {
              return m.fromVersion === prevVersion && m.toVersion === currentVersion;
            });
            if (!migration || !migration.rollback) {
              throw new Error(`No rollback found from version ${currentVersion} to ${prevVersion}`);
            }
            console.log(`[MigrationManager] Rolling back from ${currentVersion} to ${prevVersion}: ${migration.name}`);
            currentData = yield migration.rollback(currentData);
            currentVersion = prevVersion;
          };
          while (currentVersion > toVersion) {
            yield* _loop2();
          }
          return {
            success: true,
            data: currentData,
            fromVersion: fromVersion,
            toVersion: currentVersion
          };
        } catch (error) {
          console.error('[MigrationManager] Rollback failed:', error);
          return {
            success: false,
            data: currentData,
            fromVersion: fromVersion,
            toVersion: currentVersion,
            error: error instanceof Error ? error : new Error(String(error))
          };
        }
      });
      function rollback(_x4, _x5, _x6) {
        return _rollback.apply(this, arguments);
      }
      return rollback;
    }())
  }, {
    key: "saveBackup",
    value: (function () {
      var _saveBackup = (0, _asyncToGenerator2.default)(function* (data, version) {
        try {
          var backupKey = `@backup_v${version}_${Date.now()}`;
          yield _asyncStorage.default.setItem(backupKey, JSON.stringify(data));
          var keys = yield _asyncStorage.default.getAllKeys();
          var backupKeys = keys.filter(function (k) {
            return k.startsWith('@backup_');
          }).sort();
          if (backupKeys.length > 5) {
            var keysToRemove = backupKeys.slice(0, backupKeys.length - 5);
            yield _asyncStorage.default.multiRemove(keysToRemove);
          }
        } catch (error) {
          console.error('[MigrationManager] Failed to save backup:', error);
        }
      });
      function saveBackup(_x7, _x8) {
        return _saveBackup.apply(this, arguments);
      }
      return saveBackup;
    }())
  }, {
    key: "getMigrations",
    value: function getMigrations() {
      return (0, _toConsumableArray2.default)(this.migrations);
    }
  }, {
    key: "setBackupEnabled",
    value: function setBackupEnabled(enabled) {
      this.backupEnabled = enabled;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXN5bmNTdG9yYWdlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJNaWdyYXRpb25NYW5hZ2VyIiwiZXhwb3J0cyIsIl9jbGFzc0NhbGxDaGVjazIiLCJkZWZhdWx0IiwibWlncmF0aW9ucyIsImJhY2t1cEVuYWJsZWQiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJyZWdpc3RlciIsIm1pZ3JhdGlvbiIsImNvbmZsaWN0IiwiZmluZCIsIm0iLCJmcm9tVmVyc2lvbiIsInRvVmVyc2lvbiIsImNvbnNvbGUiLCJ3YXJuIiwibmFtZSIsInB1c2giLCJzb3J0IiwiYSIsImIiLCJfbWlncmF0ZSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRhdGEiLCJfdGhpcyIsInN1Y2Nlc3MiLCJjdXJyZW50RGF0YSIsImN1cnJlbnRWZXJzaW9uIiwic2F2ZUJhY2t1cCIsIl9sb29wIiwibmV4dFZlcnNpb24iLCJFcnJvciIsImxvZyIsIm1pZ3JhdGUiLCJ2ZXJzaW9uIiwibWlncmF0ZWRBdCIsIkRhdGUiLCJub3ciLCJtaWdyYXRlZEZyb20iLCJlcnJvciIsIlN0cmluZyIsIl94IiwiX3gyIiwiX3gzIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfcm9sbGJhY2siLCJfdGhpczIiLCJfbG9vcDIiLCJwcmV2VmVyc2lvbiIsInJvbGxiYWNrIiwiX3g0IiwiX3g1IiwiX3g2IiwiX3NhdmVCYWNrdXAiLCJiYWNrdXBLZXkiLCJBc3luY1N0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImtleXMiLCJnZXRBbGxLZXlzIiwiYmFja3VwS2V5cyIsImZpbHRlciIsImsiLCJzdGFydHNXaXRoIiwibGVuZ3RoIiwia2V5c1RvUmVtb3ZlIiwic2xpY2UiLCJtdWx0aVJlbW92ZSIsIl94NyIsIl94OCIsImdldE1pZ3JhdGlvbnMiLCJfdG9Db25zdW1hYmxlQXJyYXkyIiwic2V0QmFja3VwRW5hYmxlZCIsImVuYWJsZWQiXSwic291cmNlcyI6WyJtaWdyYXRpb25NYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog0JzQtdC90LXQtNC20LXRgCDQvNC40LPRgNCw0YbQuNC5INC00LDQvdC90YvRhVxuICogXG4gKiDQo9C/0YDQsNCy0LvRj9C10YIg0LzQuNCz0YDQsNGG0LjRj9C80Lgg0LzQtdC20LTRgyDQstC10YDRgdC40Y/QvNC4INC00LDQvdC90YvRhVxuICovXG5cbmltcG9ydCBBc3luY1N0b3JhZ2UgZnJvbSAnQHJlYWN0LW5hdGl2ZS1hc3luYy1zdG9yYWdlL2FzeW5jLXN0b3JhZ2UnO1xuaW1wb3J0IHsgTWlncmF0aW9uLCBNaWdyYXRpb25SZXN1bHQgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIE1pZ3JhdGlvbk1hbmFnZXIge1xuICBwcml2YXRlIG1pZ3JhdGlvbnM6IE1pZ3JhdGlvbltdID0gW107XG4gIHByaXZhdGUgYmFja3VwRW5hYmxlZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgLyoqXG4gICAqINCX0LDRgNC10LPQuNGB0YLRgNC40YDQvtCy0LDRgtGMINC80LjQs9GA0LDRhtC40Y5cbiAgICovXG4gIHJlZ2lzdGVyKG1pZ3JhdGlvbjogTWlncmF0aW9uKTogdm9pZCB7XG4gICAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8INGH0YLQviDQvdC10YIg0LrQvtC90YTQu9C40LrRgtC+0LJcbiAgICBjb25zdCBjb25mbGljdCA9IHRoaXMubWlncmF0aW9ucy5maW5kKFxuICAgICAgbSA9PiBtLmZyb21WZXJzaW9uID09PSBtaWdyYXRpb24uZnJvbVZlcnNpb24gJiYgbS50b1ZlcnNpb24gPT09IG1pZ3JhdGlvbi50b1ZlcnNpb25cbiAgICApO1xuICAgIFxuICAgIGlmIChjb25mbGljdCkge1xuICAgICAgY29uc29sZS53YXJuKGBbTWlncmF0aW9uTWFuYWdlcl0gTWlncmF0aW9uIGNvbmZsaWN0OiAke21pZ3JhdGlvbi5uYW1lfSBjb25mbGljdHMgd2l0aCAke2NvbmZsaWN0Lm5hbWV9YCk7XG4gICAgfVxuICAgIFxuICAgIHRoaXMubWlncmF0aW9ucy5wdXNoKG1pZ3JhdGlvbik7XG4gICAgLy8g0KHQvtGA0YLQuNGA0YPQtdC8INC/0L4g0LLQtdGA0YHQuNGP0LxcbiAgICB0aGlzLm1pZ3JhdGlvbnMuc29ydCgoYSwgYikgPT4gYS5mcm9tVmVyc2lvbiAtIGIuZnJvbVZlcnNpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqINCS0YvQv9C+0LvQvdC40YLRjCDQvNC40LPRgNCw0YbQuNGOINC00LDQvdC90YvRhVxuICAgKi9cbiAgYXN5bmMgbWlncmF0ZShcbiAgICBkYXRhOiBhbnksXG4gICAgZnJvbVZlcnNpb246IG51bWJlcixcbiAgICB0b1ZlcnNpb246IG51bWJlclxuICApOiBQcm9taXNlPE1pZ3JhdGlvblJlc3VsdD4ge1xuICAgIGlmIChmcm9tVmVyc2lvbiA+PSB0b1ZlcnNpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGZyb21WZXJzaW9uLFxuICAgICAgICB0b1ZlcnNpb24sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGxldCBjdXJyZW50RGF0YSA9IGRhdGE7XG4gICAgbGV0IGN1cnJlbnRWZXJzaW9uID0gZnJvbVZlcnNpb247XG5cbiAgICB0cnkge1xuICAgICAgLy8g0KHQvtGF0YDQsNC90Y/QtdC8INGA0LXQt9C10YDQstC90YPRjiDQutC+0L/QuNGOINC/0LXRgNC10LQg0LzQuNCz0YDQsNGG0LjQtdC5XG4gICAgICBpZiAodGhpcy5iYWNrdXBFbmFibGVkKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUJhY2t1cChjdXJyZW50RGF0YSwgY3VycmVudFZlcnNpb24pO1xuICAgICAgfVxuXG4gICAgICAvLyDQktGL0L/QvtC70L3Rj9C10Lwg0LzQuNCz0YDQsNGG0LjQuCDQv9C+0YjQsNCz0L7QstC+XG4gICAgICB3aGlsZSAoY3VycmVudFZlcnNpb24gPCB0b1ZlcnNpb24pIHtcbiAgICAgICAgY29uc3QgbmV4dFZlcnNpb24gPSBjdXJyZW50VmVyc2lvbiArIDE7XG4gICAgICAgIGNvbnN0IG1pZ3JhdGlvbiA9IHRoaXMubWlncmF0aW9ucy5maW5kKFxuICAgICAgICAgIG0gPT4gbS5mcm9tVmVyc2lvbiA9PT0gY3VycmVudFZlcnNpb24gJiYgbS50b1ZlcnNpb24gPT09IG5leHRWZXJzaW9uXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKCFtaWdyYXRpb24pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgTm8gbWlncmF0aW9uIGZvdW5kIGZyb20gdmVyc2lvbiAke2N1cnJlbnRWZXJzaW9ufSB0byAke25leHRWZXJzaW9ufWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coYFtNaWdyYXRpb25NYW5hZ2VyXSBNaWdyYXRpbmcgZnJvbSAke2N1cnJlbnRWZXJzaW9ufSB0byAke25leHRWZXJzaW9ufTogJHttaWdyYXRpb24ubmFtZX1gKTtcblxuICAgICAgICAvLyDQktGL0L/QvtC70L3Rj9C10Lwg0LzQuNCz0YDQsNGG0LjRjlxuICAgICAgICBjdXJyZW50RGF0YSA9IGF3YWl0IG1pZ3JhdGlvbi5taWdyYXRlKGN1cnJlbnREYXRhKTtcbiAgICAgICAgY3VycmVudFZlcnNpb24gPSBtaWdyYXRpb24udG9WZXJzaW9uO1xuXG4gICAgICAgIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDQstC10YDRgdC40Y4g0LIg0LTQsNC90L3Ri9GFXG4gICAgICAgIGlmIChjdXJyZW50RGF0YSAmJiB0eXBlb2YgY3VycmVudERhdGEgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgY3VycmVudERhdGEudmVyc2lvbiA9IGN1cnJlbnRWZXJzaW9uO1xuICAgICAgICAgIGN1cnJlbnREYXRhLm1pZ3JhdGVkQXQgPSBEYXRlLm5vdygpO1xuICAgICAgICAgIGN1cnJlbnREYXRhLm1pZ3JhdGVkRnJvbSA9IG1pZ3JhdGlvbi5mcm9tVmVyc2lvbjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjdXJyZW50RGF0YSxcbiAgICAgICAgZnJvbVZlcnNpb24sXG4gICAgICAgIHRvVmVyc2lvbjogY3VycmVudFZlcnNpb24sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbTWlncmF0aW9uTWFuYWdlcl0gTWlncmF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZGF0YTogY3VycmVudERhdGEsXG4gICAgICAgIGZyb21WZXJzaW9uLFxuICAgICAgICB0b1ZlcnNpb246IGN1cnJlbnRWZXJzaW9uLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKFN0cmluZyhlcnJvcikpLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7RgtC60LDRgtC40YLRjCDQvNC40LPRgNCw0YbQuNGOXG4gICAqL1xuICBhc3luYyByb2xsYmFjayhcbiAgICBkYXRhOiBhbnksXG4gICAgZnJvbVZlcnNpb246IG51bWJlcixcbiAgICB0b1ZlcnNpb246IG51bWJlclxuICApOiBQcm9taXNlPE1pZ3JhdGlvblJlc3VsdD4ge1xuICAgIGlmIChmcm9tVmVyc2lvbiA8PSB0b1ZlcnNpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGZyb21WZXJzaW9uLFxuICAgICAgICB0b1ZlcnNpb24sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGxldCBjdXJyZW50RGF0YSA9IGRhdGE7XG4gICAgbGV0IGN1cnJlbnRWZXJzaW9uID0gZnJvbVZlcnNpb247XG5cbiAgICB0cnkge1xuICAgICAgLy8g0JLRi9C/0L7Qu9C90Y/QtdC8INC+0YLQutCw0YIg0L/QvtGI0LDQs9C+0LLQvlxuICAgICAgd2hpbGUgKGN1cnJlbnRWZXJzaW9uID4gdG9WZXJzaW9uKSB7XG4gICAgICAgIGNvbnN0IHByZXZWZXJzaW9uID0gY3VycmVudFZlcnNpb24gLSAxO1xuICAgICAgICBjb25zdCBtaWdyYXRpb24gPSB0aGlzLm1pZ3JhdGlvbnMuZmluZChcbiAgICAgICAgICBtID0+IG0uZnJvbVZlcnNpb24gPT09IHByZXZWZXJzaW9uICYmIG0udG9WZXJzaW9uID09PSBjdXJyZW50VmVyc2lvblxuICAgICAgICApO1xuXG4gICAgICAgIGlmICghbWlncmF0aW9uIHx8ICFtaWdyYXRpb24ucm9sbGJhY2spIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgTm8gcm9sbGJhY2sgZm91bmQgZnJvbSB2ZXJzaW9uICR7Y3VycmVudFZlcnNpb259IHRvICR7cHJldlZlcnNpb259YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhgW01pZ3JhdGlvbk1hbmFnZXJdIFJvbGxpbmcgYmFjayBmcm9tICR7Y3VycmVudFZlcnNpb259IHRvICR7cHJldlZlcnNpb259OiAke21pZ3JhdGlvbi5uYW1lfWApO1xuXG4gICAgICAgIC8vINCS0YvQv9C+0LvQvdGP0LXQvCDQvtGC0LrQsNGCXG4gICAgICAgIGN1cnJlbnREYXRhID0gYXdhaXQgbWlncmF0aW9uLnJvbGxiYWNrKGN1cnJlbnREYXRhKTtcbiAgICAgICAgY3VycmVudFZlcnNpb24gPSBwcmV2VmVyc2lvbjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY3VycmVudERhdGEsXG4gICAgICAgIGZyb21WZXJzaW9uLFxuICAgICAgICB0b1ZlcnNpb246IGN1cnJlbnRWZXJzaW9uLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW01pZ3JhdGlvbk1hbmFnZXJdIFJvbGxiYWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZGF0YTogY3VycmVudERhdGEsXG4gICAgICAgIGZyb21WZXJzaW9uLFxuICAgICAgICB0b1ZlcnNpb246IGN1cnJlbnRWZXJzaW9uLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKFN0cmluZyhlcnJvcikpLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0KHQvtGF0YDQsNC90LjRgtGMINGA0LXQt9C10YDQstC90YPRjiDQutC+0L/QuNGOXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNhdmVCYWNrdXAoZGF0YTogYW55LCB2ZXJzaW9uOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYmFja3VwS2V5ID0gYEBiYWNrdXBfdiR7dmVyc2lvbn1fJHtEYXRlLm5vdygpfWA7XG4gICAgICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShiYWNrdXBLZXksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgIFxuICAgICAgLy8g0J7Qs9GA0LDQvdC40YfQuNCy0LDQtdC8INC60L7Qu9C40YfQtdGB0YLQstC+INGA0LXQt9C10YDQstC90YvRhSDQutC+0L/QuNC5ICjQv9C+0YHQu9C10LTQvdC40LUgNSlcbiAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0QWxsS2V5cygpO1xuICAgICAgY29uc3QgYmFja3VwS2V5cyA9IGtleXMuZmlsdGVyKGsgPT4gay5zdGFydHNXaXRoKCdAYmFja3VwXycpKS5zb3J0KCk7XG4gICAgICBpZiAoYmFja3VwS2V5cy5sZW5ndGggPiA1KSB7XG4gICAgICAgIGNvbnN0IGtleXNUb1JlbW92ZSA9IGJhY2t1cEtleXMuc2xpY2UoMCwgYmFja3VwS2V5cy5sZW5ndGggLSA1KTtcbiAgICAgICAgYXdhaXQgQXN5bmNTdG9yYWdlLm11bHRpUmVtb3ZlKGtleXNUb1JlbW92ZSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNaWdyYXRpb25NYW5hZ2VyXSBGYWlsZWQgdG8gc2F2ZSBiYWNrdXA6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMINGB0L/QuNGB0L7QuiDQt9Cw0YDQtdCz0LjRgdGC0YDQuNGA0L7QstCw0L3QvdGL0YUg0LzQuNCz0YDQsNGG0LjQuVxuICAgKi9cbiAgZ2V0TWlncmF0aW9ucygpOiBNaWdyYXRpb25bXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLm1pZ3JhdGlvbnNdO1xuICB9XG5cbiAgLyoqXG4gICAqINCS0LrQu9GO0YfQuNGC0Ywv0LLRi9C60LvRjtGH0LjRgtGMINGA0LXQt9C10YDQstC90YvQtSDQutC+0L/QuNC4XG4gICAqL1xuICBzZXRCYWNrdXBFbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmJhY2t1cEVuYWJsZWQgPSBlbmFibGVkO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQU1BLElBQUFBLGFBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUFxRSxJQUd4REMsZ0JBQWdCLEdBQUFDLE9BQUEsQ0FBQUQsZ0JBQUE7RUFBQSxTQUFBQSxpQkFBQTtJQUFBLElBQUFFLGdCQUFBLENBQUFDLE9BQUEsUUFBQUgsZ0JBQUE7SUFBQSxLQUNuQkksVUFBVSxHQUFnQixFQUFFO0lBQUEsS0FDNUJDLGFBQWEsR0FBWSxJQUFJO0VBQUE7RUFBQSxXQUFBQyxhQUFBLENBQUFILE9BQUEsRUFBQUgsZ0JBQUE7SUFBQU8sR0FBQTtJQUFBQyxLQUFBLEVBS3JDLFNBQUFDLFFBQVFBLENBQUNDLFNBQW9CLEVBQVE7TUFFbkMsSUFBTUMsUUFBUSxHQUFHLElB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TUFBQSxJQUFBZ0QsV0FBQSxPQUFBaEMsa0JBQUEsQ0FBQXJCLE9BQUEsRUEyRGQsV0FBeUJzQixJQUFTLEVBQUVXLE9BQWUsRUFBaUI7UUFDbEUsSUFBSTtVQUNGLElBQU1xQixTQUFTLEdBQUcsWUFBWXJCLE9BQU8sSUFBSUUsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFO1VBQ3JELE1BQU1tQixxQkFBWSxDQUFDQyxPQUFPLENBQUNGLFNBQVMsRUFBRUcsSUFBSSxDQUFDQyxTQUFTLENBQUNwQyxJQUFJLENBQUMsQ0FBQztVQUczRCxJQUFNcUMsSUFBSSxTQUFTSixxQkFBWSxDQUFDSyxVQUFVLENBQUMsQ0FBQztVQUM1QyxJQUFNQyxVQUFVLEdBQUdGLElBQUksQ0FBQ0csTUFBTSxDQUFDLFVBQUFDLENBQUM7WUFBQSxPQUFJQSxDQUFDLENBQUNDLFVBQVUsQ0FBQyxVQUFVLENBQUM7VUFBQSxFQUFDLENBQUMvQyxJQUFJLENBQUMsQ0FBQztVQUNwRSxJQUFJNEMsVUFBVSxDQUFDSSxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3pCLElBQU1DLFlBQVksR0FBR0wsVUFBVSxDQUFDTSxLQUFLLENBQUMsQ0FBQyxFQUFFTixVQUFVLENBQUNJLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDL0QsTUFBTVYscUJBQVksQ0FBQ2EsV0FBVyxDQUFDRixZQUFZLENBQUM7VUFDOUM7UUFDRixDQUFDLENBQUMsT0FBTzVCLEtBQUssRUFBRTtVQUNkekIsT0FBTyxDQUFDeUIsS0FBSyxDQUFDLDJDQUEyQyxFQUFFQSxLQUFLLENBQUM7UUFDbkU7TUFDRixDQUFDO01BQUEsU0FmYVgsVUFBVUEsQ0FBQTBDLEdBQUEsRUFBQUMsR0FBQTtRQUFBLE9BQUFqQixXQUFBLENBQUFWLEtBQUEsT0FBQUMsU0FBQTtNQUFBO01BQUEsT0FBVmpCLFVBQVU7SUFBQTtFQUFBO0lBQUF2QixHQUFBO0lBQUFDLEtBQUEsRUFvQnhCLFNBQUFrRSxhQUFhQSxDQUFBLEVBQWdCO01BQzNCLFdBQUFDLG1CQUFBLENBQUF4RSxPQUFBLEVBQVcsSUFBSSxDQUFDQyxVQUFVO0lBQzVCO0VBQUM7SUFBQUcsR0FBQTtJQUFBQyxLQUFBLEVBS0QsU0FBQW9FLGdCQUFnQkEsQ0FBQ0MsT0FBZ0IsRUFBUTtNQUN2QyxJQUFJLENBQUN4RSxhQUFhLEdBQUd3RSxPQUFPO0lBQzlCO0VBQUM7QUFBQSIsImlnbm9yZUxpc3QiOltdfQ==