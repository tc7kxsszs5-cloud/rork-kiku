{"version":3,"names":["Alert","Platform","logger","i18n","ERROR_TYPE_MAP","getUserFriendlyMessage","error","context","Error","_ref","Object","entries","_ref2","_slicedToArray","errorKey","translationKey","message","includes","name","t","length","showUserFriendlyError","_x","_x2","_x3","_showUserFriendlyError","apply","arguments","_asyncToGenerator","component","errorObj","String","assign","action","OS","alert","console","handleErrorSilently","withErrorHandling","fn","createErrorHandler","show","silent","wrap"],"sources":["errorHandler.ts"],"sourcesContent":["/**\n * User-friendly error handling utility\n * Converts technical errors into user-friendly messages\n */\n\nimport { Alert, Platform } from 'react-native';\nimport { logger } from './logger';\nimport i18n from '@/constants/i18n';\n\nexport interface ErrorContext {\n  component?: string;\n  action?: string;\n  [key: string]: unknown;\n}\n\n/**\n * Error type to translation key mapping\n */\nconst ERROR_TYPE_MAP: Record<string, string> = {\n  'Network error': 'common.errors.networkError',\n  'Sync failed': 'common.errors.syncFailed',\n  'Failed to load': 'common.errors.loadFailed',\n  'Failed to save': 'common.errors.saveFailed',\n  'Permission denied': 'common.errors.permissionDenied',\n  'Storage error': 'common.errors.storageError',\n  'Analysis failed': 'common.errors.analysisFailed',\n  'SOS failed': 'common.errors.sosFailed',\n  'Auth failed': 'common.errors.authFailed',\n};\n\n/**\n * Get user-friendly error message using i18n\n */\nfunction getUserFriendlyMessage(error: Error | unknown, context?: ErrorContext): string {\n  if (error instanceof Error) {\n    // Check for specific error messages and map to translation keys\n    for (const [errorKey, translationKey] of Object.entries(ERROR_TYPE_MAP)) {\n      if (error.message.includes(errorKey) || error.name.includes(errorKey)) {\n        return i18n.t(translationKey);\n      }\n    }\n    // Fallback to error message if it's user-friendly\n    if (error.message.length < 100 && !error.message.includes('Error:') && !error.message.includes('at ')) {\n      return error.message;\n    }\n  }\n  return i18n.t('common.errors.default');\n}\n\n/**\n * Show user-friendly error alert\n */\nexport async function showUserFriendlyError(\n  error: Error | unknown,\n  component?: string,\n  context?: ErrorContext\n): Promise<void> {\n  const message = getUserFriendlyMessage(error, context);\n  const errorObj = error instanceof Error ? error : new Error(String(error));\n\n  // Log error with full details\n  logger.error('User-friendly error shown', errorObj, {\n    component: component || context?.component,\n    action: context?.action,\n    ...context,\n  });\n\n  // Show alert to user\n  if (Platform.OS !== 'web') {\n    Alert.alert(i18n.t('common.error'), message);\n  } else {\n    // On web, use console as fallback\n    console.error('[Error]', message, errorObj);\n  }\n}\n\n/**\n * Handle error silently (log only, no user notification)\n */\nexport function handleErrorSilently(\n  error: Error | unknown,\n  component?: string,\n  context?: ErrorContext\n): void {\n  const errorObj = error instanceof Error ? error : new Error(String(error));\n  logger.error('Error handled silently', errorObj, {\n    component: component || context?.component,\n    action: context?.action,\n    ...context,\n  });\n}\n\n/**\n * Wrap async function with error handling\n */\nexport function withErrorHandling<T extends (...args: unknown[]) => Promise<unknown>>(\n  fn: T,\n  component?: string\n): T {\n  return (async (...args: Parameters<T>) => {\n    try {\n      return await fn(...args);\n    } catch (error) {\n      handleErrorSilently(error, component);\n      throw error;\n    }\n  }) as T;\n}\n\n/**\n * Create error handler for specific component\n */\nexport function createErrorHandler(component: string) {\n  return {\n    show: (error: Error | unknown, context?: ErrorContext) =>\n      showUserFriendlyError(error, component, context),\n    silent: (error: Error | unknown, context?: ErrorContext) =>\n      handleErrorSilently(error, component, context),\n    wrap: <T extends (...args: unknown[]) => Promise<unknown>>(fn: T) =>\n      withErrorHandling(fn, component),\n  };\n}\n"],"mappings":"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","ignoreList":[]}