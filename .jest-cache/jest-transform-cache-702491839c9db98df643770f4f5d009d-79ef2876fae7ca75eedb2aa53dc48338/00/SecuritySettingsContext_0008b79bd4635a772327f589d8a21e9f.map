{"version":3,"names":["_createContextHook3","_interopRequireDefault","require","_react","_asyncStorage","_reactNative","LocalAuthentication","_interopRequireWildcard","SECURITY_SETTINGS_STORAGE_KEY","DEFAULT_SECURITY_SETTINGS","biometricEnabled","biometricType","pinCodeEnabled","screenLockEnabled","lockTimeout","_createContextHook","createContextHook","_useState","useState","_useState2","_slicedToArray2","default","settings","setSettings","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","availableBiometrics","setAvailableBiometrics","useEffect","isMounted","timer","loadSettings","_ref","_asyncToGenerator2","detectedBiometric","Platform","OS","compatible","hasHardwareAsync","enrolled","isEnrolledAsync","types","supportedAuthenticationTypesAsync","includes","AuthenticationType","FACIAL_RECOGNITION","FINGERPRINT","error","console","stored","AsyncStorage","getItem","parsedSettings","JSON","parse","Object","assign","apply","arguments","setTimeout","clearTimeout","updateSettings","useCallback","_ref2","updates","updatedSettings","setItem","stringify","log","_x","authenticate","_ref3","reason","result","authenticateAsync","promptMessage","cancelLabel","disableDeviceFallback","success","_x2","_createContextHook2","SecuritySettingsProvider","exports","useSecuritySettings"],"sources":["SecuritySettingsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Platform } from 'react-native';\nimport * as LocalAuthentication from 'expo-local-authentication';\n\nexport type BiometricType = 'faceId' | 'touchId' | 'fingerprint' | 'none';\n\nexport interface SecuritySettings {\n  biometricEnabled: boolean;\n  biometricType: BiometricType;\n  pinCodeEnabled: boolean;\n  screenLockEnabled: boolean;\n  lockTimeout: number; // в минутах\n}\n\nconst SECURITY_SETTINGS_STORAGE_KEY = '@security_settings';\n\nconst DEFAULT_SECURITY_SETTINGS: SecuritySettings = {\n  biometricEnabled: false,\n  biometricType: 'none',\n  pinCodeEnabled: false,\n  screenLockEnabled: false,\n  lockTimeout: 5, // 5 минут\n};\n\nexport const [SecuritySettingsProvider, useSecuritySettings] = createContextHook(() => {\n  const [settings, setSettings] = useState<SecuritySettings>(DEFAULT_SECURITY_SETTINGS);\n  const [isLoading, setIsLoading] = useState(true);\n  const [availableBiometrics, setAvailableBiometrics] = useState<BiometricType>('none');\n\n  useEffect(() => {\n    let isMounted = true;\n    let timer: ReturnType<typeof setTimeout> | undefined;\n\n    const loadSettings = async () => {\n      try {\n        let detectedBiometric: BiometricType = 'none';\n        \n        // Проверяем доступность биометрии\n        if (Platform.OS !== 'web') {\n          try {\n            const compatible = await LocalAuthentication.hasHardwareAsync();\n            if (compatible && isMounted) {\n              const enrolled = await LocalAuthentication.isEnrolledAsync();\n              if (enrolled) {\n                const types = await LocalAuthentication.supportedAuthenticationTypesAsync();\n                if (types.includes(LocalAuthentication.AuthenticationType.FACIAL_RECOGNITION)) {\n                  detectedBiometric = 'faceId';\n                } else if (types.includes(LocalAuthentication.AuthenticationType.FINGERPRINT)) {\n                  detectedBiometric = Platform.OS === 'ios' ? 'touchId' : 'fingerprint';\n                }\n              }\n            }\n          } catch (error) {\n            console.error('[SecuritySettingsContext] Error checking biometrics:', error);\n          }\n        }\n\n        if (!isMounted) {\n          return;\n        }\n\n        setAvailableBiometrics(detectedBiometric);\n\n        // Загружаем настройки\n        const stored = await AsyncStorage.getItem(SECURITY_SETTINGS_STORAGE_KEY);\n        if (stored) {\n          const parsedSettings = JSON.parse(stored);\n          setSettings({\n            ...DEFAULT_SECURITY_SETTINGS,\n            ...parsedSettings,\n            biometricType: detectedBiometric,\n          });\n        } else {\n          setSettings({\n            ...DEFAULT_SECURITY_SETTINGS,\n            biometricType: detectedBiometric,\n          });\n        }\n      } catch (error) {\n        console.error('[SecuritySettingsContext] Error loading settings:', error);\n      } finally {\n        if (isMounted) {\n          setIsLoading(false);\n        }\n      }\n    };\n\n    if (Platform.OS !== 'web') {\n      loadSettings();\n    } else {\n      timer = setTimeout(loadSettings, 0);\n    }\n\n    return () => {\n      isMounted = false;\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, []);\n\n  const updateSettings = useCallback(async (updates: Partial<SecuritySettings>) => {\n    try {\n      const updatedSettings = { ...settings, ...updates };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SECURITY_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n      console.log('[SecuritySettingsContext] Settings updated:', updates);\n    } catch (error) {\n      console.error('[SecuritySettingsContext] Error updating settings:', error);\n    }\n  }, [settings]);\n\n  const authenticate = useCallback(async (reason?: string): Promise<boolean> => {\n    if (!settings.biometricEnabled || availableBiometrics === 'none') {\n      return false;\n    }\n\n    try {\n      const result = await LocalAuthentication.authenticateAsync({\n        promptMessage: reason || 'Подтвердите вашу личность',\n        cancelLabel: 'Отмена',\n        disableDeviceFallback: false,\n      });\n\n      return result.success;\n    } catch (error) {\n      console.error('[SecuritySettingsContext] Authentication error:', error);\n      return false;\n    }\n  }, [settings.biometricEnabled, availableBiometrics]);\n\n  return {\n    settings,\n    isLoading,\n    availableBiometrics,\n    updateSettings,\n    authenticate,\n  };\n});\n"],"mappings":"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","ignoreList":[]}