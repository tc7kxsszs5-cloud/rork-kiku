{"version":3,"names":["_premiumStatus","require","describe","it","status","tier","features","advancedAnalytics","extendedHistory","multipleChildren","prioritySupport","customAlerts","exportData","aiRecommendations","expect","isTrialExpired","Date","now","toBe","futureTime","trialEndDate","pastTime","isSubscriptionExpired","subscriptionId","subscriptionStartDate","subscriptionEndDate","result","checkSubscriptionStatus","updated","newStatus","toBeUndefined"],"sources":["premiumStatus.test.ts"],"sourcesContent":["/**\n * Модульные тесты для проверки статуса premium подписки\n * Только детерминированные тесты - никаких интеграций/асинхронности\n */\n\nimport {\n  isTrialExpired,\n  isSubscriptionExpired,\n  checkSubscriptionStatus,\n} from '@/utils/premiumStatus';\nimport { PremiumStatus } from '@/constants/PremiumContext';\n\ndescribe('isTrialExpired', () => {\n  it('должен возвращать false для free статуса', () => {\n    const status: PremiumStatus = {\n      tier: 'free',\n      features: {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать false если trial еще не истек', () => {\n    const futureTime = Date.now() + 7 * 24 * 60 * 60 * 1000; // +7 дней\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: futureTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать true если trial истек', () => {\n    const pastTime = Date.now() - 1000; // -1 секунда\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(true);\n  });\n\n  it('должен возвращать false если trialEndDate отсутствует', () => {\n    const status: PremiumStatus = {\n      tier: 'trial',\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(false);\n  });\n});\n\ndescribe('isSubscriptionExpired', () => {\n  it('должен возвращать false для free статуса', () => {\n    const status: PremiumStatus = {\n      tier: 'free',\n      features: {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      },\n    };\n\n    expect(isSubscriptionExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать false если подписка еще не истекла', () => {\n    const futureTime = Date.now() + 30 * 24 * 60 * 60 * 1000; // +30 дней\n    const status: PremiumStatus = {\n      tier: 'premium',\n      subscriptionId: 'sub_123',\n      subscriptionStartDate: Date.now(),\n      subscriptionEndDate: futureTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isSubscriptionExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать true если подписка истекла', () => {\n    const pastTime = Date.now() - 1000; // -1 секунда\n    const status: PremiumStatus = {\n      tier: 'premium',\n      subscriptionId: 'sub_123',\n      subscriptionStartDate: pastTime - 30 * 24 * 60 * 60 * 1000,\n      subscriptionEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isSubscriptionExpired(status, Date.now())).toBe(true);\n  });\n});\n\ndescribe('checkSubscriptionStatus', () => {\n  it('должен возвращать updated: false если статус не изменился', () => {\n    const futureTime = Date.now() + 7 * 24 * 60 * 60 * 1000;\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: futureTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    const result = checkSubscriptionStatus(status, Date.now());\n\n    expect(result.updated).toBe(false);\n    expect(result.newStatus.tier).toBe('trial');\n  });\n\n  it('должен обновлять статус на free если trial истек', () => {\n    const pastTime = Date.now() - 1000;\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    const result = checkSubscriptionStatus(status, Date.now());\n\n    expect(result.updated).toBe(true);\n    expect(result.newStatus.tier).toBe('free');\n    expect(result.newStatus.features.advancedAnalytics).toBe(false);\n    expect(result.newStatus.trialEndDate).toBeUndefined();\n  });\n\n  it('должен обновлять статус на free если подписка истекла', () => {\n    const pastTime = Date.now() - 1000;\n    const status: PremiumStatus = {\n      tier: 'premium',\n      subscriptionId: 'sub_123',\n      subscriptionStartDate: pastTime - 30 * 24 * 60 * 60 * 1000,\n      subscriptionEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    const result = checkSubscriptionStatus(status, Date.now());\n\n    expect(result.updated).toBe(true);\n    expect(result.newStatus.tier).toBe('free');\n    expect(result.newStatus.features.advancedAnalytics).toBe(false);\n    expect(result.newStatus.subscriptionId).toBeUndefined();\n    expect(result.newStatus.subscriptionEndDate).toBeUndefined();\n  });\n});\n"],"mappings":"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","ignoreList":[]}