{"version":3,"names":["AsyncStorage","INSTALL_DATE_KEY","cov_r1to1exdu","s","FIRST_LAUNCH_KEY","ACTIVATION_KEY","LAST_SESSION_KEY","trackInstall","_trackInstall","apply","arguments","_asyncToGenerator","f","existing","getItem","b","parseInt","installDate","Date","now","setItem","toString","error","console","trackFirstLaunch","_trackFirstLaunch","firstLaunchDate","trackActivation","_trackActivation","activationDate","trackSession","_trackSession","sessionDate","getActivationData","_getActivationData","_ref","Promise","all","_ref2","_slicedToArray","installDateStr","firstLaunchStr","activationStr","lastSessionStr","lastSessionDate","isActivated","isFirstLaunch","_isFirstLaunch","_isActivated","activation"],"sources":["activationTracking.ts"],"sourcesContent":["/**\n * Утилиты для отслеживания активации пользователей\n * Используется для KPI: activation rate, retention (D1, D7, D30)\n */\n\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Platform } from 'react-native';\n\nconst INSTALL_DATE_KEY = '@kiku_install_date';\nconst FIRST_LAUNCH_KEY = '@kiku_first_launch';\nconst ACTIVATION_KEY = '@kiku_activation';\nconst LAST_SESSION_KEY = '@kiku_last_session';\n\nexport interface ActivationData {\n  installDate: number;\n  firstLaunchDate: number;\n  activationDate: number | null;\n  lastSessionDate: number;\n  isActivated: boolean;\n}\n\n/**\n * Отслеживание установки приложения (первый запуск)\n */\nexport async function trackInstall(): Promise<number | null> {\n  try {\n    const existing = await AsyncStorage.getItem(INSTALL_DATE_KEY);\n    if (existing) {\n      return parseInt(existing, 10);\n    }\n\n    const installDate = Date.now();\n    await AsyncStorage.setItem(INSTALL_DATE_KEY, installDate.toString());\n    await AsyncStorage.setItem(FIRST_LAUNCH_KEY, installDate.toString());\n    return installDate;\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to track install:', error);\n    return null;\n  }\n}\n\n/**\n * Отслеживание первого запуска\n */\nexport async function trackFirstLaunch(): Promise<number | null> {\n  try {\n    const existing = await AsyncStorage.getItem(FIRST_LAUNCH_KEY);\n    if (existing) {\n      return parseInt(existing, 10);\n    }\n\n    const firstLaunchDate = Date.now();\n    await AsyncStorage.setItem(FIRST_LAUNCH_KEY, firstLaunchDate.toString());\n    return firstLaunchDate;\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to track first launch:', error);\n    return null;\n  }\n}\n\n/**\n * Отслеживание активации пользователя\n * Активация = onboarding завершен + первое значимое действие (добавлен ребенок, просмотрен чат и т.д.)\n */\nexport async function trackActivation(): Promise<number | null> {\n  try {\n    const existing = await AsyncStorage.getItem(ACTIVATION_KEY);\n    if (existing) {\n      return parseInt(existing, 10);\n    }\n\n    const activationDate = Date.now();\n    await AsyncStorage.setItem(ACTIVATION_KEY, activationDate.toString());\n    return activationDate;\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to track activation:', error);\n    return null;\n  }\n}\n\n/**\n * Отслеживание сессии (каждый раз при открытии приложения)\n */\nexport async function trackSession(): Promise<number> {\n  try {\n    const sessionDate = Date.now();\n    await AsyncStorage.setItem(LAST_SESSION_KEY, sessionDate.toString());\n    return sessionDate;\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to track session:', error);\n    return Date.now();\n  }\n}\n\n/**\n * Получить данные активации\n */\nexport async function getActivationData(): Promise<ActivationData> {\n  try {\n    const [installDateStr, firstLaunchStr, activationStr, lastSessionStr] = await Promise.all([\n      AsyncStorage.getItem(INSTALL_DATE_KEY),\n      AsyncStorage.getItem(FIRST_LAUNCH_KEY),\n      AsyncStorage.getItem(ACTIVATION_KEY),\n      AsyncStorage.getItem(LAST_SESSION_KEY),\n    ]);\n\n    return {\n      installDate: installDateStr ? parseInt(installDateStr, 10) : Date.now(),\n      firstLaunchDate: firstLaunchStr ? parseInt(firstLaunchStr, 10) : Date.now(),\n      activationDate: activationStr ? parseInt(activationStr, 10) : null,\n      lastSessionDate: lastSessionStr ? parseInt(lastSessionStr, 10) : Date.now(),\n      isActivated: activationStr !== null,\n    };\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to get activation data:', error);\n    return {\n      installDate: Date.now(),\n      firstLaunchDate: Date.now(),\n      activationDate: null,\n      lastSessionDate: Date.now(),\n      isActivated: false,\n    };\n  }\n}\n\n/**\n * Проверка, является ли это первым запуском\n */\nexport async function isFirstLaunch(): Promise<boolean> {\n  try {\n    const existing = await AsyncStorage.getItem(FIRST_LAUNCH_KEY);\n    return existing === null;\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to check first launch:', error);\n    return true;\n  }\n}\n\n/**\n * Проверка, активирован ли пользователь\n */\nexport async function isActivated(): Promise<boolean> {\n  try {\n    const activation = await AsyncStorage.getItem(ACTIVATION_KEY);\n    return activation !== null;\n  } catch (error) {\n    console.error('[ActivationTracking] Failed to check activation:', error);\n    return false;\n  }\n}\n"],"mappings":"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","ignoreList":[]}