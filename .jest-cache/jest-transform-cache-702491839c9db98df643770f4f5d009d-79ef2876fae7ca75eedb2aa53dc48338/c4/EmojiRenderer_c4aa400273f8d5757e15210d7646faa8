3d6e0c6a5a4c19ed5e6395de2d4effb8
import _slicedToArray from "@babel/runtime/helpers/slicedToArray";
import React, { useMemo } from 'react';
import { Text } from 'react-native';
import { CustomEmoji } from './CustomEmoji';
import { loadCustomEmojis } from '@/utils/customEmojis';
import { jsx as _jsx } from "react/jsx-runtime";
export function EmojiRenderer(_ref) {
  var text = _ref.text,
    _ref$emojiSize = _ref.emojiSize,
    emojiSize = _ref$emojiSize === void 0 ? 20 : _ref$emojiSize,
    style = _ref.style;
  var _React$useState = React.useState([]),
    _React$useState2 = _slicedToArray(_React$useState, 2),
    customEmojis = _React$useState2[0],
    setCustomEmojis = _React$useState2[1];
  React.useEffect(function () {
    loadCustomEmojis().then(setCustomEmojis);
  }, []);
  var parsedContent = useMemo(function () {
    var parts = [];
    var customEmojiMap = new Map(customEmojis.map(function (e) {
      return [e.id, e];
    }));
    var customEmojiRegex = /\[custom:([^\]]+)\]/g;
    var lastIndex = 0;
    var match;
    while ((match = customEmojiRegex.exec(text)) !== null) {
      if (match.index > lastIndex) {
        parts.push({
          type: 'text',
          content: text.substring(lastIndex, match.index)
        });
      }
      var emojiId = match[1];
      var emoji = customEmojiMap.get(emojiId);
      if (emoji) {
        parts.push({
          type: 'custom',
          content: match[0],
          emoji: emoji
        });
      } else {
        parts.push({
          type: 'text',
          content: match[0]
        });
      }
      lastIndex = match.index + match[0].length;
    }
    if (lastIndex < text.length) {
      parts.push({
        type: 'text',
        content: text.substring(lastIndex)
      });
    }
    return parts.length > 0 ? parts : [{
      type: 'text',
      content: text
    }];
  }, [text, customEmojis]);
  return _jsx(Text, {
    style: style,
    children: parsedContent.map(function (part, index) {
      if (part.type === 'custom' && 'emoji' in part) {
        return _jsx(CustomEmoji, {
          emoji: part.emoji,
          size: emojiSize
        }, index);
      }
      return _jsx(Text, {
        children: part.content
      }, index);
    })
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFjdCIsInVzZU1lbW8iLCJUZXh0IiwiQ3VzdG9tRW1vamkiLCJsb2FkQ3VzdG9tRW1vamlzIiwianN4IiwiX2pzeCIsIkVtb2ppUmVuZGVyZXIiLCJfcmVmIiwidGV4dCIsIl9yZWYkZW1vamlTaXplIiwiZW1vamlTaXplIiwic3R5bGUiLCJfUmVhY3QkdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl9SZWFjdCR1c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheSIsImN1c3RvbUVtb2ppcyIsInNldEN1c3RvbUVtb2ppcyIsInVzZUVmZmVjdCIsInRoZW4iLCJwYXJzZWRDb250ZW50IiwicGFydHMiLCJjdXN0b21FbW9qaU1hcCIsIk1hcCIsIm1hcCIsImUiLCJpZCIsImN1c3RvbUVtb2ppUmVnZXgiLCJsYXN0SW5kZXgiLCJtYXRjaCIsImV4ZWMiLCJpbmRleCIsInB1c2giLCJ0eXBlIiwiY29udGVudCIsInN1YnN0cmluZyIsImVtb2ppSWQiLCJlbW9qaSIsImdldCIsImxlbmd0aCIsImNoaWxkcmVuIiwicGFydCIsInNpemUiXSwic291cmNlcyI6WyJFbW9qaVJlbmRlcmVyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqINCa0L7QvNC/0L7QvdC10L3RgiDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDRjdC80L7QtNC30Lgg0LIg0YLQtdC60YHRgtC1INGB0L7QvtCx0YnQtdC90LjQuVxuICogXG4gKiDQn9C+0LTQtNC10YDQttC40LLQsNC10YI6XG4gKiAtINCh0YLQsNC90LTQsNGA0YLQvdGL0LUgVW5pY29kZSDRjdC80L7QtNC30LhcbiAqIC0g0JrQsNGB0YLQvtC80L3Ri9C1INGN0LzQvtC00LfQuCAo0LjQt9C+0LHRgNCw0LbQtdC90LjRjywgU1ZHKVxuICogLSDQodC/0LXRhtC40LDQu9GM0L3Ri9C5INGE0L7RgNC80LDRgiBbY3VzdG9tOmlkXSDQtNC70Y8g0LrQsNGB0YLQvtC80L3Ri9GFINGN0LzQvtC00LfQuFxuICovXG5cbmltcG9ydCBSZWFjdCwgeyB1c2VNZW1vIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5pbXBvcnQgeyBDdXN0b21FbW9qaSB9IGZyb20gJy4vQ3VzdG9tRW1vamknO1xuaW1wb3J0IHsgbG9hZEN1c3RvbUVtb2ppcywgQ3VzdG9tRW1vamlEYXRhIH0gZnJvbSAnQC91dGlscy9jdXN0b21FbW9qaXMnO1xuXG5pbnRlcmZhY2UgRW1vamlSZW5kZXJlclByb3BzIHtcbiAgdGV4dDogc3RyaW5nO1xuICBlbW9qaVNpemU/OiBudW1iZXI7XG4gIHN0eWxlPzogYW55O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gRW1vamlSZW5kZXJlcih7IHRleHQsIGVtb2ppU2l6ZSA9IDIwLCBzdHlsZSB9OiBFbW9qaVJlbmRlcmVyUHJvcHMpIHtcbiAgY29uc3QgW2N1c3RvbUVtb2ppcywgc2V0Q3VzdG9tRW1vamlzXSA9IFJlYWN0LnVzZVN0YXRlPEN1c3RvbUVtb2ppRGF0YVtdPihbXSk7XG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBsb2FkQ3VzdG9tRW1vamlzKCkudGhlbihzZXRDdXN0b21FbW9qaXMpO1xuICB9LCBbXSk7XG5cbiAgLy8g0J/QsNGA0YHQuNC90LMg0YLQtdC60YHRgtCwINGBINC/0L7QtNC00LXRgNC20LrQvtC5INC60LDRgdGC0L7QvNC90YvRhSDRjdC80L7QtNC30LhcbiAgY29uc3QgcGFyc2VkQ29udGVudCA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIHR5cGUgUGFyc2VkUGFydCA9IFxuICAgICAgfCB7IHR5cGU6ICd0ZXh0JzsgY29udGVudDogc3RyaW5nIH1cbiAgICAgIHwgeyB0eXBlOiAnY3VzdG9tJzsgY29udGVudDogc3RyaW5nOyBlbW9qaTogQ3VzdG9tRW1vamlEYXRhIH07XG4gICAgXG4gICAgY29uc3QgcGFydHM6IFBhcnNlZFBhcnRbXSA9IFtdO1xuICAgIGNvbnN0IGN1c3RvbUVtb2ppTWFwID0gbmV3IE1hcChjdXN0b21FbW9qaXMubWFwKGUgPT4gW2UuaWQsIGVdKSk7XG4gICAgXG4gICAgLy8g0KDQtdCz0YPQu9GP0YDQvdC+0LUg0LLRi9GA0LDQttC10L3QuNC1INC00LvRjyDQv9C+0LjRgdC60LAg0LrQsNGB0YLQvtC80L3Ri9GFINGN0LzQvtC00LfQuCBbY3VzdG9tOmlkXVxuICAgIGNvbnN0IGN1c3RvbUVtb2ppUmVnZXggPSAvXFxbY3VzdG9tOihbXlxcXV0rKVxcXS9nO1xuICAgIGxldCBsYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaDtcblxuICAgIHdoaWxlICgobWF0Y2ggPSBjdXN0b21FbW9qaVJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YLQtdC60YHRgiDQtNC+INC60LDRgdGC0L7QvNC90L7Qs9C+INGN0LzQvtC00LfQuFxuICAgICAgaWYgKG1hdGNoLmluZGV4ID4gbGFzdEluZGV4KSB7XG4gICAgICAgIHBhcnRzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICBjb250ZW50OiB0ZXh0LnN1YnN0cmluZyhsYXN0SW5kZXgsIG1hdGNoLmluZGV4KSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDQutCw0YHRgtC+0LzQvdGL0Lkg0Y3QvNC+0LTQt9C4XG4gICAgICBjb25zdCBlbW9qaUlkID0gbWF0Y2hbMV07XG4gICAgICBjb25zdCBlbW9qaSA9IGN1c3RvbUVtb2ppTWFwLmdldChlbW9qaUlkKTtcbiAgICAgIFxuICAgICAgaWYgKGVtb2ppKSB7XG4gICAgICAgIHBhcnRzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICdjdXN0b20nLFxuICAgICAgICAgIGNvbnRlbnQ6IG1hdGNoWzBdLFxuICAgICAgICAgIGVtb2ppLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vINCV0YHQu9C4INGN0LzQvtC00LfQuCDQvdC1INC90LDQudC00LXQvSwg0L7RgdGC0LDQstC70Y/QtdC8INC60LDQuiDRgtC10LrRgdGCXG4gICAgICAgIHBhcnRzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICBjb250ZW50OiBtYXRjaFswXSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDQvtGB0YLQsNCy0YjQuNC50YHRjyDRgtC10LrRgdGCXG4gICAgaWYgKGxhc3RJbmRleCA8IHRleHQubGVuZ3RoKSB7XG4gICAgICBwYXJ0cy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICBjb250ZW50OiB0ZXh0LnN1YnN0cmluZyhsYXN0SW5kZXgpLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnRzLmxlbmd0aCA+IDAgPyBwYXJ0cyA6IFt7IHR5cGU6ICd0ZXh0JywgY29udGVudDogdGV4dCB9XTtcbiAgfSwgW3RleHQsIGN1c3RvbUVtb2ppc10pO1xuXG4gIHJldHVybiAoXG4gICAgPFRleHQgc3R5bGU9e3N0eWxlfT5cbiAgICAgIHtwYXJzZWRDb250ZW50Lm1hcCgocGFydCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKHBhcnQudHlwZSA9PT0gJ2N1c3RvbScgJiYgJ2Vtb2ppJyBpbiBwYXJ0KSB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxDdXN0b21FbW9qaVxuICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgICBlbW9qaT17cGFydC5lbW9qaX1cbiAgICAgICAgICAgICAgc2l6ZT17ZW1vamlTaXplfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8VGV4dCBrZXk9e2luZGV4fT57cGFydC5jb250ZW50fTwvVGV4dD47XG4gICAgICB9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