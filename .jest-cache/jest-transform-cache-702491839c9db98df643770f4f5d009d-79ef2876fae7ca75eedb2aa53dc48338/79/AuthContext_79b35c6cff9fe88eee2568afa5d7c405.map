{"version":3,"names":["createContextHook","useState","useCallback","useEffect","AsyncStorage","SecureStore","logger","AUTH_STORAGE_KEY","cov_1d1toiwgbt","s","PIN_STORAGE_KEY","_ref","f","_ref3","isAuthenticated","_ref4","_slicedToArray","authState","setAuthState","loadAuthState","_ref5","_asyncToGenerator","stored","getItem","b","state","JSON","parse","error","Error","String","context","action","apply","arguments","login","_ref6","userId","role","pin","newState","setItem","stringify","setItemAsync","console","_x","_x2","_x3","logout","removeItem","deleteItemAsync","verifyPin","_ref8","storedPin","getItemAsync","_x4","createChildProfile","_ref9","profile","info","childName","name","id","Date","now","_x5","switchToChildMode","_ref10","childId","_x6","canChangeChatBackgrounds","Object","assign","_ref2","AuthProvider","useAuth"],"sources":["AuthContext.tsx"],"sourcesContent":["/**\n * Auth Context\n * Manages authentication state\n */\n\nimport createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport * as SecureStore from 'expo-secure-store';\nimport { logger } from '@/utils/logger';\n\nexport interface AuthState {\n  isAuthenticated: boolean;\n  userId?: string;\n  role?: 'parent' | 'child';\n}\n\nconst AUTH_STORAGE_KEY = '@auth_state';\nconst PIN_STORAGE_KEY = '@auth_pin';\n\nexport const [AuthProvider, useAuth] = createContextHook(() => {\n  const [authState, setAuthState] = useState<AuthState>({\n    isAuthenticated: false,\n  });\n\n  useEffect(() => {\n    const loadAuthState = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n        if (stored) {\n          const state = JSON.parse(stored);\n          setAuthState(state);\n        }\n      } catch (error) {\n        logger.error('Failed to load auth state', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'loadAuthState' });\n      }\n    };\n\n    loadAuthState();\n  }, []);\n\n  const login = useCallback(async (userId: string, role: 'parent' | 'child', pin?: string) => {\n    const newState: AuthState = {\n      isAuthenticated: true,\n      userId,\n      role,\n    };\n\n    setAuthState(newState);\n\n    try {\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(newState));\n      if (pin) {\n        await SecureStore.setItemAsync(PIN_STORAGE_KEY, pin);\n      }\n    } catch (error) {\n      console.error('[AuthContext] Failed to save auth state:', error);\n    }\n  }, []);\n\n  const logout = useCallback(async () => {\n    setAuthState({\n      isAuthenticated: false,\n    });\n\n    try {\n      await AsyncStorage.removeItem(AUTH_STORAGE_KEY);\n      await SecureStore.deleteItemAsync(PIN_STORAGE_KEY);\n    } catch (error) {\n      logger.error('Failed to clear auth state', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'logout' });\n    }\n  }, []);\n\n  const verifyPin = useCallback(async (pin: string): Promise<boolean> => {\n    try {\n      const storedPin = await SecureStore.getItemAsync(PIN_STORAGE_KEY);\n      return storedPin === pin;\n    } catch (error) {\n      logger.error('Failed to verify PIN', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'verifyPin' });\n      return false;\n    }\n  }, []);\n\n  const createChildProfile = useCallback(async (profile: { name: string; permissions?: any }) => {\n    // Создание профиля ребенка\n    // В реальном приложении здесь будет логика создания профиля\n    logger.info('Creating child profile', { context: 'AuthContext', action: 'createChildProfile', childName: profile.name });\n    return { id: `child_${Date.now()}`, name: profile.name };\n  }, []);\n\n  const switchToChildMode = useCallback(async (childId: string): Promise<boolean> => {\n    if (authState.role === 'parent') {\n      await login(childId, 'child');\n      return true;\n    }\n    return false;\n  }, [authState.role, login]);\n\n  const canChangeChatBackgrounds = useCallback((): boolean => {\n    // Родители могут менять фоны чатов\n    return authState.role === 'parent' && authState.isAuthenticated;\n  }, [authState.role, authState.isAuthenticated]);\n\n  return {\n    ...authState,\n    login,\n    logout,\n    verifyPin,\n    createChildProfile,\n    switchToChildMode,\n    canChangeChatBackgrounds,\n  };\n});\n"],"mappings":"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","ignoreList":[]}