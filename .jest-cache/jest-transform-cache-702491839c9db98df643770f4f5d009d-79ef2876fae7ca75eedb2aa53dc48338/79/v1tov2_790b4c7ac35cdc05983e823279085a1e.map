{"version":3,"names":["userV1ToV2","cov_2kg0tcpv67","s","fromVersion","toVersion","name","description","migrate","_migrate","_asyncToGenerator","data","f","user","b","language","preferences","theme","notifications","analytics","createdAt","addedAt","Date","now","updatedAt","children","Array","isArray","map","child","version","migratedAt","migratedFrom","_x","apply","arguments","rollback","_rollback","isDefault","Object","keys","length","_x2"],"sources":["v1-to-v2.ts"],"sourcesContent":["/**\n * Миграция User данных с версии 1 на версию 2\n * \n * Добавляет:\n * - language к пользователю\n * - preferences к пользователю\n * - createdAt, updatedAt timestamps\n */\n\nimport { Migration } from '../types';\n\nexport const userV1ToV2: Migration = {\n  fromVersion: 1,\n  toVersion: 2,\n  name: 'Add language and preferences to user',\n  description: 'Добавляет language, preferences и timestamps к пользователю',\n\n  async migrate(data: any) {\n    // Мигрируем пользователя\n    if (data.user) {\n      const user = data.user;\n      \n      // Добавляем language если его нет\n      if (!user.language) {\n        user.language = 'ru'; // Дефолтный язык\n      }\n\n      // Добавляем preferences если их нет\n      if (!user.preferences) {\n        user.preferences = {\n          theme: 'sunrise',\n          notifications: true,\n          analytics: true,\n        };\n      }\n\n      // Добавляем timestamps если их нет\n      if (!user.createdAt) {\n        user.createdAt = user.addedAt || Date.now(); // Используем addedAt если есть\n      }\n      if (!user.updatedAt) {\n        user.updatedAt = Date.now();\n      }\n\n      data.user = user;\n    }\n\n    // Мигрируем детей если есть\n    if (data.children && Array.isArray(data.children)) {\n      data.children = data.children.map((child: any) => {\n        if (!child.language) {\n          child.language = 'ru';\n        }\n        if (!child.createdAt) {\n          child.createdAt = child.addedAt || Date.now();\n        }\n        if (!child.updatedAt) {\n          child.updatedAt = Date.now();\n        }\n        return child;\n      });\n    }\n\n    // Обновляем версию\n    data.version = 2;\n    data.migratedAt = Date.now();\n    data.migratedFrom = 1;\n\n    return data;\n  },\n\n  async rollback(data: any) {\n    // Откат миграции\n    if (data.user) {\n      const user = data.user;\n      \n      // Удаляем language если это дефолтное значение\n      if (user.language === 'ru') {\n        delete user.language;\n      }\n\n      // Удаляем preferences если это дефолтные значения\n      if (user.preferences) {\n        const isDefault = \n          user.preferences.theme === 'sunrise' &&\n          user.preferences.notifications === true &&\n          user.preferences.analytics === true &&\n          Object.keys(user.preferences).length === 3;\n        \n        if (isDefault) {\n          delete user.preferences;\n        }\n      }\n\n      // Удаляем timestamps если они были добавлены при миграции\n      if (user.createdAt && user.addedAt && user.createdAt === user.addedAt) {\n        delete user.createdAt;\n      }\n      if (user.updatedAt) {\n        delete user.updatedAt;\n      }\n\n      data.user = user;\n    }\n\n    if (data.children && Array.isArray(data.children)) {\n      data.children = data.children.map((child: any) => {\n        if (child.language === 'ru') {\n          delete child.language;\n        }\n        if (child.createdAt && child.addedAt && child.createdAt === child.addedAt) {\n          delete child.createdAt;\n        }\n        if (child.updatedAt) {\n          delete child.updatedAt;\n        }\n        return child;\n      });\n    }\n\n    data.version = 1;\n    return data;\n  },\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}