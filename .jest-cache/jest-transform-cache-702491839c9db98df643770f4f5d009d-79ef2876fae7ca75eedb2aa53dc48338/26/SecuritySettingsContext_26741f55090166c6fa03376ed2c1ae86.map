{"version":3,"names":["createContextHook","useState","useEffect","useCallback","AsyncStorage","Platform","LocalAuthentication","SECURITY_SETTINGS_STORAGE_KEY","cov_xifs8qj81","s","DEFAULT_SECURITY_SETTINGS","biometricEnabled","biometricType","pinCodeEnabled","screenLockEnabled","lockTimeout","_ref","f","_ref3","_ref4","_slicedToArray","settings","setSettings","_ref5","_ref6","isLoading","setIsLoading","_ref7","_ref8","availableBiometrics","setAvailableBiometrics","isMounted","timer","loadSettings","_ref9","_asyncToGenerator","detectedBiometric","OS","b","compatible","hasHardwareAsync","enrolled","isEnrolledAsync","types","supportedAuthenticationTypesAsync","includes","AuthenticationType","FACIAL_RECOGNITION","FINGERPRINT","error","console","stored","getItem","parsedSettings","JSON","parse","Object","assign","apply","arguments","setTimeout","clearTimeout","updateSettings","_ref10","updates","updatedSettings","setItem","stringify","log","_x","authenticate","_ref11","reason","result","authenticateAsync","promptMessage","cancelLabel","disableDeviceFallback","success","_x2","_ref2","SecuritySettingsProvider","useSecuritySettings"],"sources":["SecuritySettingsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Platform } from 'react-native';\nimport * as LocalAuthentication from 'expo-local-authentication';\n\nexport type BiometricType = 'faceId' | 'touchId' | 'fingerprint' | 'none';\n\nexport interface SecuritySettings {\n  biometricEnabled: boolean;\n  biometricType: BiometricType;\n  pinCodeEnabled: boolean;\n  screenLockEnabled: boolean;\n  lockTimeout: number; // в минутах\n}\n\nconst SECURITY_SETTINGS_STORAGE_KEY = '@security_settings';\n\nconst DEFAULT_SECURITY_SETTINGS: SecuritySettings = {\n  biometricEnabled: false,\n  biometricType: 'none',\n  pinCodeEnabled: false,\n  screenLockEnabled: false,\n  lockTimeout: 5, // 5 минут\n};\n\nexport const [SecuritySettingsProvider, useSecuritySettings] = createContextHook(() => {\n  const [settings, setSettings] = useState<SecuritySettings>(DEFAULT_SECURITY_SETTINGS);\n  const [isLoading, setIsLoading] = useState(true);\n  const [availableBiometrics, setAvailableBiometrics] = useState<BiometricType>('none');\n\n  useEffect(() => {\n    let isMounted = true;\n    let timer: ReturnType<typeof setTimeout> | undefined;\n\n    const loadSettings = async () => {\n      try {\n        let detectedBiometric: BiometricType = 'none';\n        \n        // Проверяем доступность биометрии\n        if (Platform.OS !== 'web') {\n          try {\n            const compatible = await LocalAuthentication.hasHardwareAsync();\n            if (compatible && isMounted) {\n              const enrolled = await LocalAuthentication.isEnrolledAsync();\n              if (enrolled) {\n                const types = await LocalAuthentication.supportedAuthenticationTypesAsync();\n                if (types.includes(LocalAuthentication.AuthenticationType.FACIAL_RECOGNITION)) {\n                  detectedBiometric = 'faceId';\n                } else if (types.includes(LocalAuthentication.AuthenticationType.FINGERPRINT)) {\n                  detectedBiometric = Platform.OS === 'ios' ? 'touchId' : 'fingerprint';\n                }\n              }\n            }\n          } catch (error) {\n            console.error('[SecuritySettingsContext] Error checking biometrics:', error);\n          }\n        }\n\n        if (!isMounted) {\n          return;\n        }\n\n        setAvailableBiometrics(detectedBiometric);\n\n        // Загружаем настройки\n        const stored = await AsyncStorage.getItem(SECURITY_SETTINGS_STORAGE_KEY);\n        if (stored) {\n          const parsedSettings = JSON.parse(stored);\n          setSettings({\n            ...DEFAULT_SECURITY_SETTINGS,\n            ...parsedSettings,\n            biometricType: detectedBiometric,\n          });\n        } else {\n          setSettings({\n            ...DEFAULT_SECURITY_SETTINGS,\n            biometricType: detectedBiometric,\n          });\n        }\n      } catch (error) {\n        console.error('[SecuritySettingsContext] Error loading settings:', error);\n      } finally {\n        if (isMounted) {\n          setIsLoading(false);\n        }\n      }\n    };\n\n    if (Platform.OS !== 'web') {\n      loadSettings();\n    } else {\n      timer = setTimeout(loadSettings, 0);\n    }\n\n    return () => {\n      isMounted = false;\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, []);\n\n  const updateSettings = useCallback(async (updates: Partial<SecuritySettings>) => {\n    try {\n      const updatedSettings = { ...settings, ...updates };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SECURITY_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n      console.log('[SecuritySettingsContext] Settings updated:', updates);\n    } catch (error) {\n      console.error('[SecuritySettingsContext] Error updating settings:', error);\n    }\n  }, [settings]);\n\n  const authenticate = useCallback(async (reason?: string): Promise<boolean> => {\n    if (!settings.biometricEnabled || availableBiometrics === 'none') {\n      return false;\n    }\n\n    try {\n      const result = await LocalAuthentication.authenticateAsync({\n        promptMessage: reason || 'Подтвердите вашу личность',\n        cancelLabel: 'Отмена',\n        disableDeviceFallback: false,\n      });\n\n      return result.success;\n    } catch (error) {\n      console.error('[SecuritySettingsContext] Authentication error:', error);\n      return false;\n    }\n  }, [settings.biometricEnabled, availableBiometrics]);\n\n  return {\n    settings,\n    isLoading,\n    availableBiometrics,\n    updateSettings,\n    authenticate,\n  };\n});\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}