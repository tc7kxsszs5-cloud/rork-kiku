{"version":3,"names":["createContextHook","useState","useCallback","useMemo","useEffect","useRef","AsyncStorage","calculateMetrics","saveStoredVersion","needsMigration","APP_DATA_VERSION","getMigrationManager","logger","ANALYTICS_STORAGE_KEY","cov_7p38g405t","s","CURRENT_ANALYTICS_VERSION","DEFAULT_METRICS","totalMessages","totalAlerts","totalSOS","messagesAnalyzed","alertsResolved","averageRiskLevel","mostActiveChat","riskDistribution","safe","low","medium","high","critical","eventsByType","dailyActivity","totalInstalls","totalActivations","activationRate","totalSessions","averageSessionDuration","retention","d1","d7","d30","featureUsage","premiumSubscribers","premiumTrialUsers","premiumConversionRate","dau","mau","threatDetectionRate","falsePositiveRate","falseNegativeRate","averageAlertResponseTime","averageSOSResponseTime","aiAnalysisAccuracy","aiAnalysisSpeed","imageAnalysisAccuracy","sessionsPerUserWeekly","messagesAnalyzedPerDay","featureAdoptionRate","parentChildPairCompletionRate","geographicExpansion","appStoreRating","nps","arr","cac","ltv","ltvCacRatio","userGrowthRate","_ref","f","_ref3","_ref4","_slicedToArray","events","setEvents","isMountedRef","current","loadAnalytics","_ref5","_asyncToGenerator","stored","getItem","b","parsed","JSON","parse","currentVersion","version","console","log","migrationManager","result","migrate","success","data","setItem","stringify","info","context","action","toVersion","error","errorMessage","String","migrationError","Error","Array","isArray","apply","arguments","saveAnalytics","_ref6","versionedData","updatedAt","Date","now","length","trackEvent","event","properties","eventData","timestamp","prev","updated","concat","_toConsumableArray","slice","clearAnalytics","removeItem","exportAnalytics","metrics","_ref2","AnalyticsProvider","useAnalytics"],"sources":["AnalyticsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { calculateMetrics } from '@/utils/analyticsMetrics';\nimport { getStoredVersion, saveStoredVersion, needsMigration, APP_DATA_VERSION } from '@/utils/versioning';\nimport { getMigrationManager } from '@/utils/migrations';\nimport { logger } from '@/utils/logger';\n\nconst ANALYTICS_STORAGE_KEY = '@kiku_analytics';\nconst CURRENT_ANALYTICS_VERSION = APP_DATA_VERSION; // Используем текущую версию данных\n\nexport type AnalyticsEvent = \n  | 'message_sent'\n  | 'message_analyzed'\n  | 'alert_created'\n  | 'alert_resolved'\n  | 'sos_triggered'\n  | 'sos_resolved'\n  | 'chat_viewed'\n  | 'settings_changed'\n  | 'contact_added'\n  | 'contact_removed'\n  | 'time_restriction_added'\n  | 'recommendation_viewed'\n  | 'statistics_viewed'\n  | 'profile_updated'\n  | 'app_installed'\n  | 'app_first_launch'\n  | 'user_activated'\n  | 'session_started'\n  | 'session_ended'\n  | 'feature_used'\n  | 'premium_subscribed'\n  | 'premium_feature_accessed'\n  | 'premium_trial_started'\n  | 'premium_trial_ended'\n  | 'premium_cancelled'\n  | 'alert_notification_sent'\n  | 'sos_notification_sent'\n  | 'ai_analysis_completed'\n  | 'image_analysis_completed'\n  | 'false_positive_reported'\n  | 'threat_confirmed'\n  | 'parent_child_pair_completed'\n  | 'screen_viewed'\n  | 'user_feedback_submitted'\n  | 'sync_failed';\n\nexport interface AnalyticsEventData {\n  event: AnalyticsEvent;\n  timestamp: number;\n  properties?: Record<string, any>;\n}\n\nexport interface AnalyticsMetrics {\n  totalMessages: number;\n  totalAlerts: number;\n  totalSOS: number;\n  messagesAnalyzed: number;\n  alertsResolved: number;\n  averageRiskLevel: number;\n  mostActiveChat: string | null;\n  riskDistribution: {\n    safe: number;\n    low: number;\n    medium: number;\n    high: number;\n    critical: number;\n  };\n  eventsByType: Record<AnalyticsEvent, number>;\n  dailyActivity: { date: string; events: number }[];\n  // KPI Metrics\n  totalInstalls: number;\n  totalActivations: number;\n  activationRate: number; // totalActivations / totalInstalls\n  totalSessions: number;\n  averageSessionDuration: number; // in minutes\n  retention: {\n    d1: number; // Day 1 retention\n    d7: number; // Day 7 retention\n    d30: number; // Day 30 retention\n  };\n  featureUsage: Record<string, number>; // e.g., { 'chat_view': 150, 'settings_changed': 20 }\n  premiumSubscribers: number;\n  premiumTrialUsers: number;\n  premiumConversionRate: number; // premiumSubscribers / totalActivations\n  // DAU/MAU (calculated from sessions)\n  dau: number; // Daily Active Users (unique users with session_started today)\n  mau: number; // Monthly Active Users (unique users with session_started in last 30 days)\n  // Security KPIs\n  threatDetectionRate: number; // Threats detected / Total threats\n  falsePositiveRate: number; // False positives / Total alerts\n  falseNegativeRate: number; // Missed threats / Total threats\n  averageAlertResponseTime: number; // Average time from alert to notification (seconds)\n  averageSOSResponseTime: number; // Average time from SOS trigger to notification (seconds)\n  aiAnalysisAccuracy: number; // Correct analyses / Total analyses\n  aiAnalysisSpeed: number; // Average analysis time (seconds)\n  imageAnalysisAccuracy: number; // Correct image analyses / Total\n  // Engagement KPIs\n  sessionsPerUserWeekly: number; // Average sessions per user per week\n  messagesAnalyzedPerDay: number; // Average messages analyzed per day\n  featureAdoptionRate: number; // Users using features / Total users\n  parentChildPairCompletionRate: number; // Completed pairs / Started pairs\n  // Market KPIs\n  geographicExpansion: number; // Number of countries with users\n  appStoreRating: number; // App Store rating (0-5)\n  nps: number; // Net Promoter Score (-100 to 100)\n  // Revenue KPIs (calculated from premium data)\n  arr: number; // Annual Recurring Revenue\n  cac: number; // Customer Acquisition Cost\n  ltv: number; // Lifetime Value\n  ltvCacRatio: number; // LTV / CAC\n  userGrowthRate: number; // Monthly growth rate (%)\n}\n\nexport interface AnalyticsContextValue {\n  events: AnalyticsEventData[];\n  metrics: AnalyticsMetrics;\n  trackEvent: (event: AnalyticsEvent, properties?: Record<string, any>) => void;\n  clearAnalytics: () => Promise<void>;\n  exportAnalytics: () => string;\n}\n\nconst DEFAULT_METRICS: AnalyticsMetrics = {\n  totalMessages: 0,\n  totalAlerts: 0,\n  totalSOS: 0,\n  messagesAnalyzed: 0,\n  alertsResolved: 0,\n  averageRiskLevel: 0,\n  mostActiveChat: null,\n  riskDistribution: {\n    safe: 0,\n    low: 0,\n    medium: 0,\n    high: 0,\n    critical: 0,\n  },\n  eventsByType: {} as Record<AnalyticsEvent, number>,\n  dailyActivity: [],\n  // KPI Metrics\n  totalInstalls: 0,\n  totalActivations: 0,\n  activationRate: 0,\n  totalSessions: 0,\n  averageSessionDuration: 0,\n  retention: {\n    d1: 0,\n    d7: 0,\n    d30: 0,\n  },\n  featureUsage: {},\n  premiumSubscribers: 0,\n  premiumTrialUsers: 0,\n  premiumConversionRate: 0,\n  dau: 0,\n  mau: 0,\n  // Security KPIs\n  threatDetectionRate: 0,\n  falsePositiveRate: 0,\n  falseNegativeRate: 0,\n  averageAlertResponseTime: 0,\n  averageSOSResponseTime: 0,\n  aiAnalysisAccuracy: 0,\n  aiAnalysisSpeed: 0,\n  imageAnalysisAccuracy: 0,\n  // Engagement KPIs\n  sessionsPerUserWeekly: 0,\n  messagesAnalyzedPerDay: 0,\n  featureAdoptionRate: 0,\n  parentChildPairCompletionRate: 0,\n  // Market KPIs\n  geographicExpansion: 0,\n  appStoreRating: 0,\n  nps: 0,\n  // Revenue KPIs\n  arr: 0,\n  cac: 0,\n  ltv: 0,\n  ltvCacRatio: 0,\n  userGrowthRate: 0,\n};\n\nexport const [AnalyticsProvider, useAnalytics] = createContextHook<AnalyticsContextValue>(() => {\n  const [events, setEvents] = useState<AnalyticsEventData[]>([]);\n  const isMountedRef = useRef(true);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  // Загрузка аналитики при инициализации с поддержкой миграций\n  useEffect(() => {\n    const loadAnalytics = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(ANALYTICS_STORAGE_KEY);\n        if (!stored) {\n          return;\n        }\n\n        if (!isMountedRef.current) {\n          return;\n        }\n\n        let parsed = JSON.parse(stored);\n        \n        // Проверяем версию данных\n        const currentVersion = parsed.version || 1;\n        \n        // Если нужна миграция\n        if (needsMigration(currentVersion, CURRENT_ANALYTICS_VERSION)) {\n          console.log(`[AnalyticsContext] Migrating from version ${currentVersion} to ${CURRENT_ANALYTICS_VERSION}`);\n          \n          try {\n            const migrationManager = getMigrationManager();\n            const result = await migrationManager.migrate(\n              parsed,\n              currentVersion,\n              CURRENT_ANALYTICS_VERSION\n            );\n\n            if (result.success) {\n              parsed = result.data;\n              \n              // Сохраняем мигрированные данные\n              await AsyncStorage.setItem(ANALYTICS_STORAGE_KEY, JSON.stringify(parsed));\n              await saveStoredVersion(ANALYTICS_STORAGE_KEY, CURRENT_ANALYTICS_VERSION);\n              \n              logger.info(`Successfully migrated to version ${CURRENT_ANALYTICS_VERSION}`, { context: 'AnalyticsContext', action: 'migrate', toVersion: CURRENT_ANALYTICS_VERSION });\n            } else {\n              if (result.error) {\n                const errorMessage = typeof result.error === 'string' ? result.error : String(result.error);\n                const migrationError = new Error(errorMessage);\n                logger.error('Migration failed', migrationError, { context: 'AnalyticsContext', action: 'migrate', errorMessage });\n              } else {\n                logger.error('Migration failed', new Error('Unknown migration error'), { context: 'AnalyticsContext', action: 'migrate' });\n              }\n              // Продолжаем с исходными данными\n            }\n          } catch (migrationError) {\n            logger.error('Migration error', migrationError instanceof Error ? migrationError : new Error(String(migrationError)), { context: 'AnalyticsContext', action: 'migrate' });\n            // Продолжаем с исходными данными\n          }\n        }\n\n        // Извлекаем события из структуры данных\n        const events = parsed.events || parsed; // Поддержка старого формата (массив) и нового (объект с events)\n        \n        if (isMountedRef.current) {\n          setEvents(Array.isArray(events) ? events : []);\n        }\n      } catch (error) {\n        logger.error('Failed to load analytics', error instanceof Error ? error : new Error(String(error)), { context: 'AnalyticsContext', action: 'loadAnalytics' });\n      }\n    };\n    loadAnalytics();\n  }, []);\n\n  // Сохранение аналитики при изменении с версионированием\n  useEffect(() => {\n    const saveAnalytics = async () => {\n      try {\n        // Сохраняем в новом формате с версией\n        const versionedData = {\n          version: CURRENT_ANALYTICS_VERSION,\n          events,\n          updatedAt: Date.now(),\n        };\n        \n        await AsyncStorage.setItem(ANALYTICS_STORAGE_KEY, JSON.stringify(versionedData));\n        await saveStoredVersion(ANALYTICS_STORAGE_KEY, CURRENT_ANALYTICS_VERSION);\n      } catch (error) {\n        console.error('[AnalyticsContext] Failed to save analytics:', error);\n      }\n    };\n    if (events.length > 0) {\n      saveAnalytics();\n    }\n  }, [events]);\n\n  const trackEvent = useCallback((event: AnalyticsEvent, properties?: Record<string, any>) => {\n    if (!isMountedRef.current) {\n      return;\n    }\n\n    const eventData: AnalyticsEventData = {\n      event,\n      timestamp: Date.now(),\n      properties,\n    };\n\n    setEvents((prev) => {\n      const updated = [...prev, eventData];\n      // Ограничиваем количество событий (последние 10000)\n      return updated.slice(-10000);\n    });\n\n    logger.info('Event tracked', { context: 'AnalyticsContext', action: 'trackEvent', event, properties });\n  }, []);\n\n  const clearAnalytics = useCallback(async () => {\n    setEvents([]);\n    try {\n      await AsyncStorage.removeItem(ANALYTICS_STORAGE_KEY);\n    } catch (error) {\n      logger.error('Failed to clear analytics', error instanceof Error ? error : new Error(String(error)), { context: 'AnalyticsContext', action: 'clearAnalytics' });\n    }\n  }, []);\n\n  const exportAnalytics = useCallback(() => {\n    return JSON.stringify(events, null, 2);\n  }, [events]);\n\n  // Вычисление метрик (используем чистую функцию для тестируемости)\n  const metrics = useMemo((): AnalyticsMetrics => {\n    return calculateMetrics(events);\n  }, [events]);\n\n  return useMemo(\n    () => ({\n      events,\n      metrics,\n      trackEvent,\n      clearAnalytics,\n      exportAnalytics,\n    }),\n    [events, metrics, trackEvent, clearAnalytics, exportAnalytics]\n  );\n});\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}