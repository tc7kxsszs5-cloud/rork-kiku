{"version":3,"names":["_createContextHook3","_interopRequireDefault","require","_react","_asyncStorage","_reactNative","SYNC_SETTINGS_STORAGE_KEY","DEFAULT_SYNC_SETTINGS","autoSyncEnabled","frequency","source","_createContextHook","createContextHook","_useState","useState","_useState2","_slicedToArray2","default","settings","setSettings","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","isSyncing","setIsSyncing","useEffect","isMounted","timer","loadSettings","_ref","_asyncToGenerator2","stored","AsyncStorage","getItem","parsedSettings","JSON","parse","Object","assign","error","console","apply","arguments","Platform","OS","setTimeout","clearTimeout","updateSettings","useCallback","_ref2","updates","updatedSettings","setItem","stringify","log","_x","triggerSync","prev","lastSyncStatus","Promise","resolve","lastSyncTimestamp","Date","now","_createContextHook2","SyncSettingsProvider","exports","useSyncSettings"],"sources":["SyncSettingsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Platform } from 'react-native';\n\nexport type SyncFrequency = 'realtime' | '5min' | '15min' | '1hour';\nexport type SyncSource = 'local' | 'cloud';\n\nexport interface SyncSettings {\n  autoSyncEnabled: boolean;\n  frequency: SyncFrequency;\n  source: SyncSource;\n  lastSyncTimestamp?: number;\n  lastSyncStatus?: 'success' | 'error' | 'pending';\n}\n\nconst SYNC_SETTINGS_STORAGE_KEY = '@sync_settings';\n\nconst DEFAULT_SYNC_SETTINGS: SyncSettings = {\n  autoSyncEnabled: true,\n  frequency: 'realtime',\n  source: 'cloud',\n};\n\nexport const [SyncSettingsProvider, useSyncSettings] = createContextHook(() => {\n  const [settings, setSettings] = useState<SyncSettings>(DEFAULT_SYNC_SETTINGS);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSyncing, setIsSyncing] = useState(false);\n\n  useEffect(() => {\n    let isMounted = true;\n    let timer: ReturnType<typeof setTimeout> | undefined;\n\n    const loadSettings = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(SYNC_SETTINGS_STORAGE_KEY);\n        if (!isMounted) {\n          return;\n        }\n        if (stored) {\n          const parsedSettings = JSON.parse(stored);\n          setSettings({ ...DEFAULT_SYNC_SETTINGS, ...parsedSettings });\n        }\n      } catch (error) {\n        console.error('[SyncSettingsContext] Error loading settings:', error);\n      } finally {\n        if (isMounted) {\n          setIsLoading(false);\n        }\n      }\n    };\n\n    if (Platform.OS !== 'web') {\n      loadSettings();\n    } else {\n      timer = setTimeout(loadSettings, 0);\n    }\n\n    return () => {\n      isMounted = false;\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, []);\n\n  const updateSettings = useCallback(async (updates: Partial<SyncSettings>) => {\n    try {\n      const updatedSettings = { ...settings, ...updates };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SYNC_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n      console.log('[SyncSettingsContext] Settings updated:', updates);\n    } catch (error) {\n      console.error('[SyncSettingsContext] Error updating settings:', error);\n    }\n  }, [settings]);\n\n  const triggerSync = useCallback(async () => {\n    if (isSyncing) {\n      return;\n    }\n\n    setIsSyncing(true);\n    setSettings(prev => ({ ...prev, lastSyncStatus: 'pending' }));\n\n    try {\n      // Здесь будет логика синхронизации с backend\n      // Пока что просто имитируем задержку\n      await new Promise(resolve => setTimeout(resolve, 1500));\n\n      const updatedSettings: SyncSettings = {\n        ...settings,\n        lastSyncTimestamp: Date.now(),\n        lastSyncStatus: 'success',\n      };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SYNC_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n\n      console.log('[SyncSettingsContext] Sync completed successfully');\n    } catch (error) {\n      console.error('[SyncSettingsContext] Error during sync:', error);\n      setSettings(prev => ({\n        ...prev,\n        lastSyncTimestamp: Date.now(),\n        lastSyncStatus: 'error',\n      }));\n    } finally {\n      setIsSyncing(false);\n    }\n  }, [settings, isSyncing]);\n\n  return {\n    settings,\n    isLoading,\n    isSyncing,\n    updateSettings,\n    triggerSync,\n  };\n});\n"],"mappings":"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","ignoreList":[]}