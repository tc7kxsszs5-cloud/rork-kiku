{"version":3,"names":["TRPCError","z","publicProcedure","appendTestResults","testResultSchema","cov_52536hyrr","s","object","id","string","min","type","enum","status","message","timestamp","number","int","deviceLabel","optional","logDeviceTestProcedure","input","deviceId","results","array","mutation","_ref","f","device","b","code","lastTestedAt"],"sources":["log-device-test.ts"],"sourcesContent":["import { TRPCError } from '@trpc/server';\nimport { z } from 'zod';\nimport { publicProcedure } from '../../create-context.js';\nimport { appendTestResults } from './store.js';\n\nconst testResultSchema = z.object({\n  id: z.string().min(3),\n  type: z.enum(['permissions', 'token', 'delivery', 'sync']),\n  status: z.enum(['passed', 'failed']),\n  message: z.string().min(1),\n  timestamp: z.number().int(),\n  deviceLabel: z.string().optional(),\n});\n\nexport const logDeviceTestProcedure = publicProcedure\n  .input(\n    z.object({\n      deviceId: z.string().min(3),\n      results: z.array(testResultSchema).min(1),\n    }),\n  )\n  .mutation(({ input }) => {\n    const device = appendTestResults(input.deviceId, input.results);\n    if (!device) {\n      throw new TRPCError({ code: 'NOT_FOUND', message: 'Device not registered' });\n    }\n\n    return {\n      device,\n      lastTestedAt: device.lastTestedAt,\n    };\n  });\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,SAAS,QAAQ,cAAc;AACxC,SAASC,CAAC,QAAQ,KAAK;AACvB,SAASC,eAAe,QAAQ,yBAAyB;AACzD,SAASC,iBAAiB,QAAQ,YAAY;AAE9C,IAAMC,gBAAgB,IAAAC,aAAA,GAAAC,CAAA,OAAGL,CAAC,CAACM,MAAM,CAAC;EAChCC,EAAE,EAAEP,CAAC,CAACQ,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAAC;EACrBC,IAAI,EAAEV,CAAC,CAACW,IAAI,CAAC,CAAC,aAAa,EAAE,OAAO,EAAE,UAAU,EAAE,MAAM,CAAC,CAAC;EAC1DC,MAAM,EAAEZ,CAAC,CAACW,IAAI,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;EACpCE,OAAO,EAAEb,CAAC,CAACQ,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAAC;EAC1BK,SAAS,EAAEd,CAAC,CAACe,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC;EAC3BC,WAAW,EAAEjB,CAAC,CAACQ,MAAM,CAAC,CAAC,CAACU,QAAQ,CAAC;AACnC,CAAC,CAAC;AAEF,OAAO,IAAMC,sBAAsB,IAAAf,aAAA,GAAAC,CAAA,OAAGJ,eAAe,CAClDmB,KAAK,CACJpB,CAAC,CAACM,MAAM,CAAC;EACPe,QAAQ,EAAErB,CAAC,CAACQ,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAAC;EAC3Ba,OAAO,EAAEtB,CAAC,CAACuB,KAAK,CAACpB,gBAAgB,CAAC,CAACM,GAAG,CAAC,CAAC;AAC1C,CAAC,CACH,CAAC,CACAe,QAAQ,CAAC,UAAAC,IAAA,EAAe;EAAA,IAAZL,KAAK,GAAAK,IAAA,CAALL,KAAK;EAAAhB,aAAA,GAAAsB,CAAA;EAChB,IAAMC,MAAM,IAAAvB,aAAA,GAAAC,CAAA,OAAGH,iBAAiB,CAACkB,KAAK,CAACC,QAAQ,EAAED,KAAK,CAACE,OAAO,CAAC;EAAClB,aAAA,GAAAC,CAAA;EAChE,IAAI,CAACsB,MAAM,EAAE;IAAAvB,aAAA,GAAAwB,CAAA;IAAAxB,aAAA,GAAAC,CAAA;IACX,MAAM,IAAIN,SAAS,CAAC;MAAE8B,IAAI,EAAE,WAAW;MAAEhB,OAAO,EAAE;IAAwB,CAAC,CAAC;EAC9E,CAAC;IAAAT,aAAA,GAAAwB,CAAA;EAAA;EAAAxB,aAAA,GAAAC,CAAA;EAED,OAAO;IACLsB,MAAM,EAANA,MAAM;IACNG,YAAY,EAAEH,MAAM,CAACG;EACvB,CAAC;AACH,CAAC,CAAC","ignoreList":[]}