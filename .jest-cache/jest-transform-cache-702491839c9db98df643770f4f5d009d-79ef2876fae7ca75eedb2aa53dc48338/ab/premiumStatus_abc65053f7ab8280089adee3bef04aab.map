{"version":3,"names":["isTrialExpired","status","currentTime","tier","trialEndDate","isSubscriptionExpired","subscriptionEndDate","checkSubscriptionStatus","newStatus","Object","assign","features","advancedAnalytics","extendedHistory","multipleChildren","prioritySupport","customAlerts","exportData","aiRecommendations","undefined","updated","subscriptionId","subscriptionStartDate"],"sources":["premiumStatus.ts"],"sourcesContent":["/**\n * Чистые детерминированные функции для проверки статуса premium подписки\n * Вынесено из PremiumContext для модульного тестирования\n */\n\nimport { PremiumStatus, PremiumTier } from '@/constants/PremiumContext';\n\n/**\n * Проверяет, истекла ли trial подписка\n * Чистая детерминированная функция\n */\nexport function isTrialExpired(status: PremiumStatus, currentTime: number): boolean {\n  if (status.tier !== 'trial') return false;\n  if (!status.trialEndDate) return false;\n  return currentTime > status.trialEndDate;\n}\n\n/**\n * Проверяет, истекла ли premium подписка\n * Чистая детерминированная функция\n */\nexport function isSubscriptionExpired(status: PremiumStatus, currentTime: number): boolean {\n  if (status.tier !== 'premium') return false;\n  if (!status.subscriptionEndDate) return false;\n  return currentTime > status.subscriptionEndDate;\n}\n\n/**\n * Проверяет статус подписки и возвращает обновленный статус если нужно\n * Чистая детерминированная функция\n */\nexport function checkSubscriptionStatus(\n  status: PremiumStatus,\n  currentTime: number\n): { updated: boolean; newStatus: PremiumStatus } {\n  const newStatus = { ...status };\n\n  // Проверка trial\n  if (status.tier === 'trial' && status.trialEndDate) {\n    if (currentTime > status.trialEndDate) {\n      // Trial истек\n      newStatus.tier = 'free';\n      newStatus.features = {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      };\n      newStatus.trialEndDate = undefined;\n      return { updated: true, newStatus };\n    }\n  }\n\n  // Проверка subscription\n  if (status.tier === 'premium' && status.subscriptionEndDate) {\n    if (currentTime > status.subscriptionEndDate) {\n      // Подписка истекла\n      newStatus.tier = 'free';\n      newStatus.features = {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      };\n      newStatus.subscriptionId = undefined;\n      newStatus.subscriptionStartDate = undefined;\n      newStatus.subscriptionEndDate = undefined;\n      return { updated: true, newStatus };\n    }\n  }\n\n  return { updated: false, newStatus: status };\n}\n"],"mappings":"AAWA,OAAO,SAASA,cAAcA,CAACC,MAAqB,EAAEC,WAAmB,EAAW;EAClF,IAAID,MAAM,CAACE,IAAI,KAAK,OAAO,EAAE,OAAO,KAAK;EACzC,IAAI,CAACF,MAAM,CAACG,YAAY,EAAE,OAAO,KAAK;EACtC,OAAOF,WAAW,GAAGD,MAAM,CAACG,YAAY;AAC1C;AAMA,OAAO,SAASC,qBAAqBA,CAACJ,MAAqB,EAAEC,WAAmB,EAAW;EACzF,IAAID,MAAM,CAACE,IAAI,KAAK,SAAS,EAAE,OAAO,KAAK;EAC3C,IAAI,CAACF,MAAM,CAACK,mBAAmB,EAAE,OAAO,KAAK;EAC7C,OAAOJ,WAAW,GAAGD,MAAM,CAACK,mBAAmB;AACjD;AAMA,OAAO,SAASC,uBAAuBA,CACrCN,MAAqB,EACrBC,WAAmB,EAC6B;EAChD,IAAMM,SAAS,GAAAC,MAAA,CAAAC,MAAA,KAAQT,MAAM,CAAE;EAG/B,IAAIA,MAAM,CAACE,IAAI,KAAK,OAAO,IAAIF,MAAM,CAACG,YAAY,EAAE;IAClD,IAAIF,WAAW,GAAGD,MAAM,CAACG,YAAY,EAAE;MAErCI,SAAS,CAACL,IAAI,GAAG,MAAM;MACvBK,SAAS,CAACG,QAAQ,GAAG;QACnBC,iBAAiB,EAAE,KAAK;QACxBC,eAAe,EAAE,KAAK;QACtBC,gBAAgB,EAAE,KAAK;QACvBC,eAAe,EAAE,KAAK;QACtBC,YAAY,EAAE,KAAK;QACnBC,UAAU,EAAE,KAAK;QACjBC,iBAAiB,EAAE;MACrB,CAAC;MACDV,SAAS,CAACJ,YAAY,GAAGe,SAAS;MAClC,OAAO;QAAEC,OAAO,EAAE,IAAI;QAAEZ,SAAS,EAATA;MAAU,CAAC;IACrC;EACF;EAGA,IAAIP,MAAM,CAACE,IAAI,KAAK,SAAS,IAAIF,MAAM,CAACK,mBAAmB,EAAE;IAC3D,IAAIJ,WAAW,GAAGD,MAAM,CAACK,mBAAmB,EAAE;MAE5CE,SAAS,CAACL,IAAI,GAAG,MAAM;MACvBK,SAAS,CAACG,QAAQ,GAAG;QACnBC,iBAAiB,EAAE,KAAK;QACxBC,eAAe,EAAE,KAAK;QACtBC,gBAAgB,EAAE,KAAK;QACvBC,eAAe,EAAE,KAAK;QACtBC,YAAY,EAAE,KAAK;QACnBC,UAAU,EAAE,KAAK;QACjBC,iBAAiB,EAAE;MACrB,CAAC;MACDV,SAAS,CAACa,cAAc,GAAGF,SAAS;MACpCX,SAAS,CAACc,qBAAqB,GAAGH,SAAS;MAC3CX,SAAS,CAACF,mBAAmB,GAAGa,SAAS;MACzC,OAAO;QAAEC,OAAO,EAAE,IAAI;QAAEZ,SAAS,EAATA;MAAU,CAAC;IACrC;EACF;EAEA,OAAO;IAAEY,OAAO,EAAE,KAAK;IAAEZ,SAAS,EAAEP;EAAO,CAAC;AAC9C","ignoreList":[]}