{"version":3,"names":["z","sanitizeDeviceId","sanitizeEmail","sanitizePhone","validateTimestamp","deviceIdSchema","cov_1qprmvsp4d","s","string","min","max","refine","val","f","test","transform","timestampSchema","number","int","positive","emailSchema","email","phoneSchema","regex","chatSchema","object","id","contactName","contactPhone","optional","lastMessage","lastMessageTimestamp","riskLevel","enum","unreadCount","createdAt","updatedAt","strict","messageSchema","sender","content","timestamp","messageType","default","aiAnalysis","any","alertSchema","chatId","messageId","alertType","severity","title","description","status","resolvedAt","metadata","settingsSchema","timeRestrictionsEnabled","boolean","dailyUsageLimit","requireApprovalForNewContacts","blockUnknownContacts","imageFilteringEnabled","locationSharingEnabled","sosNotificationsEnabled","guardianEmails","array","guardianPhones","syncChatsInputSchema","deviceId","chats","lastSyncTimestamp","getChatsInputSchema","syncAlertsInputSchema","alerts","getAlertsInputSchema","syncSettingsInputSchema","settings","getSettingsInputSchema"],"sources":["validationSchemas.ts"],"sourcesContent":["/**\n * Strict validation schemas using Zod\n * Provides comprehensive input validation for security\n */\n\nimport { z } from \"zod\";\nimport { sanitizeDeviceId, sanitizeEmail, sanitizePhone, validateTimestamp, validateArrayLength } from \"./security.js\";\n\n/**\n * Device ID schema - strict validation\n */\nexport const deviceIdSchema = z.string()\n  .min(1, \"Device ID cannot be empty\")\n  .max(100, \"Device ID too long\")\n  .refine(\n    (val) => /^[a-zA-Z0-9._-]+$/.test(val),\n    \"Device ID contains invalid characters\"\n  )\n  .transform((val) => sanitizeDeviceId(val));\n\n/**\n * Timestamp schema\n */\nexport const timestampSchema = z.number()\n  .int(\"Timestamp must be an integer\")\n  .positive(\"Timestamp must be positive\")\n  .transform((val) => validateTimestamp(val));\n\n/**\n * Email schema\n */\nexport const emailSchema = z.string()\n  .email(\"Invalid email format\")\n  .max(254, \"Email too long\")\n  .transform((val) => sanitizeEmail(val));\n\n/**\n * Phone schema\n */\nexport const phoneSchema = z.string()\n  .regex(/^\\+[1-9]\\d{10,15}$/, \"Invalid phone format\")\n  .transform((val) => sanitizePhone(val));\n\n/**\n * Chat schema - strict validation\n */\nexport const chatSchema = z.object({\n  id: z.string().min(1).max(100),\n  contactName: z.string().min(1).max(200),\n  contactPhone: phoneSchema.optional(),\n  lastMessage: z.string().max(1000).optional(),\n  lastMessageTimestamp: timestampSchema.optional(),\n  riskLevel: z.enum(['safe', 'low', 'medium', 'high', 'critical']),\n  unreadCount: z.number().int().min(0).max(10000),\n  createdAt: timestampSchema,\n  updatedAt: timestampSchema,\n}).strict();\n\n/**\n * Message schema - strict validation\n */\nexport const messageSchema = z.object({\n  id: z.string().min(1).max(100),\n  sender: z.string().min(1).max(200),\n  content: z.string().min(1).max(10000), // Max 10KB per message\n  timestamp: timestampSchema,\n  messageType: z.enum(['text', 'image', 'voice', 'video']).default('text'),\n  riskLevel: z.enum(['safe', 'low', 'medium', 'high', 'critical']).optional(),\n  aiAnalysis: z.any().optional(),\n}).strict();\n\n/**\n * Alert schema - strict validation\n */\nexport const alertSchema = z.object({\n  id: z.string().min(1).max(100),\n  chatId: z.string().min(1).max(100).optional(),\n  messageId: z.string().min(1).max(100).optional(),\n  alertType: z.string().min(1).max(100),\n  severity: z.enum(['low', 'medium', 'high', 'critical']),\n  title: z.string().min(1).max(200),\n  description: z.string().max(2000).optional(),\n  riskLevel: z.enum(['safe', 'low', 'medium', 'high', 'critical']),\n  status: z.enum(['active', 'resolved', 'dismissed']).default('active'),\n  createdAt: timestampSchema,\n  resolvedAt: timestampSchema.optional(),\n  metadata: z.any().optional(),\n}).strict();\n\n/**\n * Settings schema - strict validation\n */\nexport const settingsSchema = z.object({\n  timeRestrictionsEnabled: z.boolean(),\n  dailyUsageLimit: z.number().int().min(0).max(1440), // Max 24 hours in minutes\n  requireApprovalForNewContacts: z.boolean(),\n  blockUnknownContacts: z.boolean(),\n  imageFilteringEnabled: z.boolean(),\n  locationSharingEnabled: z.boolean(),\n  sosNotificationsEnabled: z.boolean(),\n  guardianEmails: z.array(emailSchema).max(10), // Max 10 emails\n  guardianPhones: z.array(phoneSchema).max(10), // Max 10 phones\n  updatedAt: timestampSchema.optional(),\n}).strict();\n\n/**\n * Sync input schema for chats\n */\nexport const syncChatsInputSchema = z.object({\n  deviceId: deviceIdSchema,\n  chats: z.array(chatSchema).max(1000), // Max 1000 chats per sync\n  lastSyncTimestamp: timestampSchema.optional(),\n}).strict();\n\n/**\n * Get chats input schema\n */\nexport const getChatsInputSchema = z.object({\n  deviceId: deviceIdSchema,\n  lastSyncTimestamp: timestampSchema.optional(),\n}).strict();\n\n/**\n * Sync alerts input schema\n */\nexport const syncAlertsInputSchema = z.object({\n  deviceId: deviceIdSchema,\n  alerts: z.array(alertSchema).max(1000), // Max 1000 alerts per sync\n  lastSyncTimestamp: timestampSchema.optional(),\n}).strict();\n\n/**\n * Get alerts input schema\n */\nexport const getAlertsInputSchema = z.object({\n  deviceId: deviceIdSchema,\n  lastSyncTimestamp: timestampSchema.optional(),\n}).strict();\n\n/**\n * Sync settings input schema\n */\nexport const syncSettingsInputSchema = z.object({\n  deviceId: deviceIdSchema,\n  settings: settingsSchema.optional(),\n  lastSyncTimestamp: timestampSchema.optional(),\n}).strict();\n\n/**\n * Get settings input schema\n */\nexport const getSettingsInputSchema = z.object({\n  deviceId: deviceIdSchema,\n}).strict();\n"],"mappings":"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","ignoreList":[]}