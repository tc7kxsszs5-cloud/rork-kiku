{"version":3,"names":["publicProcedure","createTRPCRouter","getDeltaAlerts","supabase","syncAlertsInputSchema","getAlertsInputSchema","rateLimiters","cov_2mt9o8rlwr","s","mergeAlerts","serverAlerts","clientAlerts","f","alertMap","Map","forEach","alert","set","id","existing","get","b","timestamp","Array","from","values","sort","a","getAlertsFromDB","_ref","_asyncToGenerator","deviceId","Error","_ref2","select","eq","order","ascending","data","error","console","_x","apply","arguments","saveAlertsToDB","_ref3","alerts","alertsToSave","map","device_id","chat_id","chatId","message_id","messageId","alert_type","alertType","severity","title","description","risk_level","riskLevel","status","created_at","createdAt","Date","now","resolved_at","resolvedAt","metadata","_ref4","upsert","onConflict","_x2","_x3","updateAlertsSyncStatus","_ref5","last_alerts_sync","updated_at","_x4","_x5","syncAlertsProcedure","use","sync","input","mutation","_ref7","_ref6","_ref8","_ref8$lastSyncTimesta","lastSyncTimestamp","length","mergedAlerts","allAlerts","deltaAlerts","success","serverTimestamp","isDelta","count","message","_x6","getAlertsProcedure","query","_ref10","_ref9","_ref11","_ref11$lastSyncTimest","lastSync","_ref12","single","_x7","syncAlertsRouter"],"sources":["alerts.ts"],"sourcesContent":["import { z } from \"zod\";\nimport { publicProcedure, createTRPCRouter } from \"../../create-context.js\";\nimport { getDeltaAlerts } from \"../../../utils/syncHelpers.js\";\nimport { supabase } from \"../../../utils/supabase.js\";\nimport { syncAlertsInputSchema, getAlertsInputSchema } from \"../../../utils/validationSchemas.js\";\nimport { rateLimiters } from \"../../middleware/rateLimit.js\";\n\nconst mergeAlerts = (serverAlerts: any[], clientAlerts: any[]): any[] => {\n  const alertMap = new Map<string, any>();\n\n  // Добавляем серверные алерты\n  serverAlerts.forEach((alert) => {\n    alertMap.set(alert.id, alert);\n  });\n\n  // Объединяем с клиентскими\n  clientAlerts.forEach((alert) => {\n    const existing = alertMap.get(alert.id);\n    if (!existing || (alert.timestamp && existing.timestamp && alert.timestamp > existing.timestamp)) {\n      alertMap.set(alert.id, alert);\n    }\n  });\n\n  return Array.from(alertMap.values()).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));\n};\n\n// Получить алерты из базы данных\nconst getAlertsFromDB = async (deviceId: string): Promise<any[]> => {\n  if (!supabase) {\n    throw new Error(\"Supabase клиент не инициализирован\");\n  }\n\n  const { data, error } = await supabase\n    .from('alerts')\n    .select('*')\n    .eq('device_id', deviceId)\n    .order('created_at', { ascending: false });\n\n  if (error) {\n    console.error('[getAlertsFromDB] Error:', error);\n    return [];\n  }\n\n  return data || [];\n};\n\n// Сохранить алерты в базу данных\nconst saveAlertsToDB = async (deviceId: string, alerts: any[]): Promise<void> => {\n  if (!supabase) {\n    throw new Error(\"Supabase клиент не инициализирован\");\n  }\n\n  const alertsToSave = alerts.map((alert) => ({\n    id: alert.id,\n    device_id: deviceId,\n    chat_id: alert.chatId || alert.chat_id,\n    message_id: alert.messageId || alert.message_id,\n    alert_type: alert.alertType || alert.alert_type || '',\n    severity: alert.severity || 'medium',\n    title: alert.title || '',\n    description: alert.description,\n    risk_level: alert.riskLevel || alert.risk_level || 'medium',\n    status: alert.status || 'active',\n    created_at: alert.createdAt || alert.created_at || Date.now(),\n    resolved_at: alert.resolvedAt || alert.resolved_at,\n    metadata: alert.metadata || null,\n  }));\n\n  // Используем upsert для обновления существующих и создания новых\n  const { error } = await supabase\n    .from('alerts')\n    .upsert(alertsToSave, { onConflict: 'id' });\n\n  if (error) {\n    console.error('[saveAlertsToDB] Error:', error);\n    throw error;\n  }\n};\n\n// Обновить статус синхронизации алертов\nconst updateAlertsSyncStatus = async (deviceId: string, timestamp: number): Promise<void> => {\n  if (!supabase) {\n    return;\n  }\n\n  await supabase\n    .from('sync_status')\n    .upsert({\n      device_id: deviceId,\n      last_alerts_sync: timestamp,\n      updated_at: timestamp,\n    }, { onConflict: 'device_id' });\n};\n\nexport const syncAlertsProcedure = publicProcedure\n  .use(rateLimiters.sync)\n  .input(syncAlertsInputSchema)\n  .mutation(async ({ input }) => {\n    const { deviceId, alerts, lastSyncTimestamp = 0 } = input;\n    const timestamp = Date.now();\n\n    try {\n      // Получаем существующие алерты из базы данных\n      const serverAlerts = await getAlertsFromDB(deviceId);\n\n      if (alerts && alerts.length > 0) {\n        // Merge логика - объединяем серверные и клиентские алерты\n        const mergedAlerts = mergeAlerts(serverAlerts, alerts);\n        \n        // Сохраняем объединенные алерты в базу данных\n        await saveAlertsToDB(deviceId, mergedAlerts);\n      }\n\n      // Обновляем статус синхронизации\n      await updateAlertsSyncStatus(deviceId, timestamp);\n\n      // Если запрошен incremental sync - возвращаем только изменения\n      if (lastSyncTimestamp > 0) {\n        const allAlerts = await getAlertsFromDB(deviceId);\n        const deltaAlerts = getDeltaAlerts(allAlerts, lastSyncTimestamp);\n        \n        return {\n          success: true,\n          alerts: deltaAlerts,\n          lastSyncTimestamp: timestamp,\n          serverTimestamp: timestamp,\n          isDelta: true,\n          count: deltaAlerts.length,\n        };\n      }\n\n      // Полная синхронизация - возвращаем все алерты\n      const allAlerts = await getAlertsFromDB(deviceId);\n      \n      return {\n        success: true,\n        alerts: allAlerts,\n        lastSyncTimestamp: timestamp,\n        serverTimestamp: timestamp,\n        isDelta: false,\n        count: allAlerts.length,\n      };\n    } catch (error) {\n      console.error('[syncAlertsProcedure] Error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error',\n        alerts: [],\n        lastSyncTimestamp: timestamp,\n        serverTimestamp: timestamp,\n      };\n    }\n  });\n\nexport const getAlertsProcedure = publicProcedure\n  .use(rateLimiters.sync)\n  .input(getAlertsInputSchema)\n  .query(async ({ input }) => {\n    const { deviceId, lastSyncTimestamp = 0 } = input;\n\n    try {\n      const allAlerts = await getAlertsFromDB(deviceId);\n      \n      // Получаем последний timestamp синхронизации\n      let lastSync = 0;\n      if (supabase) {\n        const { data } = await supabase\n          .from('sync_status')\n          .select('last_alerts_sync')\n          .eq('device_id', deviceId)\n          .single();\n        lastSync = data?.last_alerts_sync || 0;\n      }\n\n      // Incremental sync если запрошен\n      if (lastSyncTimestamp > 0) {\n        const deltaAlerts = getDeltaAlerts(allAlerts, lastSyncTimestamp);\n        return {\n          alerts: deltaAlerts,\n          lastSyncTimestamp: lastSync,\n          serverTimestamp: Date.now(),\n          isDelta: true,\n          count: deltaAlerts.length,\n        };\n      }\n\n      // Полная синхронизация\n      return {\n        alerts: allAlerts,\n        lastSyncTimestamp: lastSync,\n        serverTimestamp: Date.now(),\n        isDelta: false,\n        count: allAlerts.length,\n      };\n    } catch (error) {\n      console.error('[getAlertsProcedure] Error:', error);\n      return {\n        alerts: [],\n        lastSyncTimestamp: 0,\n        serverTimestamp: Date.now(),\n        isDelta: false,\n        count: 0,\n      };\n    }\n  });\n\nexport const syncAlertsRouter = createTRPCRouter({\n  sync: syncAlertsProcedure,\n  get: getAlertsProcedure,\n});\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}