{"version":3,"names":["publicProcedure","createTRPCRouter","getDeltaChats","supabase","syncChatsInputSchema","getChatsInputSchema","rateLimiters","cov_1livqyqxdh","s","mergeChats","serverChats","clientChats","f","mergedMap","Map","forEach","chat","set","id","Object","assign","source","clientChat","existing","get","b","updatedAt","messages","mergeMessages","Array","from","values","serverMessages","clientMessages","messageMap","msg","timestamp","sort","a","getChatsFromDB","_ref","_asyncToGenerator","deviceId","Error","_ref2","select","eq","order","ascending","data","error","console","_x","apply","arguments","saveChatsToDB","_ref3","chats","Date","now","chatsToSave","map","device_id","contact_name","contactName","contact_phone","contactPhone","last_message","lastMessage","last_message_timestamp","lastMessageTimestamp","risk_level","riskLevel","unread_count","unreadCount","created_at","createdAt","updated_at","_ref4","upsert","onConflict","isArray","length","saveMessagesToDB","_x2","_x3","_ref5","chatId","messagesToSave","chat_id","sender","content","text","message_type","messageType","ai_analysis","aiAnalysis","_ref6","_x4","_x5","_x6","getMessagesFromDB","_ref7","_ref8","_x7","updateSyncStatus","_ref9","last_sync_timestamp","last_chats_sync","_x8","_x9","syncChatsProcedure","use","sync","input","mutation","_ref11","_ref10","_ref12","_ref12$lastSyncTimest","lastSyncTimestamp","chatsWithMessages","Promise","all","_ref13","_x11","mergedChats","chatsWithTimestamp","allChats","chatsWithMessagesForDelta","_ref14","_x12","deltaChats","success","serverTimestamp","isDelta","count","chatsWithMessagesForFull","_ref15","_x13","message","_x10","getChatsProcedure","query","_ref17","_ref16","_ref18","_ref18$lastSyncTimest","_ref19","_x15","lastSync","_ref20","single","_x14","syncChatsRouter"],"sources":["chats.ts"],"sourcesContent":["import { z } from \"zod\";\nimport { publicProcedure, createTRPCRouter } from \"../../create-context.js\";\nimport { getDeltaChats } from \"../../../utils/syncHelpers.js\";\nimport { supabase } from \"../../../utils/supabase.js\";\nimport { syncChatsInputSchema, getChatsInputSchema } from \"../../../utils/validationSchemas.js\";\nimport { rateLimiters } from \"../../middleware/rateLimit.js\";\n\n// Улучшенная merge логика\nconst mergeChats = (serverChats: any[], clientChats: any[]): any[] => {\n  const mergedMap = new Map<string, any>();\n\n  // Добавляем серверные чаты\n  serverChats.forEach((chat) => {\n    mergedMap.set(chat.id, { ...chat, source: 'server' });\n  });\n\n  // Объединяем с клиентскими чатами\n  clientChats.forEach((clientChat) => {\n    const existing = mergedMap.get(clientChat.id);\n    \n    if (!existing) {\n      // Новый чат с клиента\n      mergedMap.set(clientChat.id, { ...clientChat, source: 'client' });\n    } else {\n      // Чат существует - merge логика\n      // Используем последний timestamp (last-write-wins для конфликтов)\n      if (clientChat.updatedAt && existing.updatedAt) {\n        if (clientChat.updatedAt > existing.updatedAt) {\n          // Клиент более свежий\n          mergedMap.set(clientChat.id, {\n            ...clientChat,\n            // Объединяем сообщения (уникальные по ID)\n            messages: mergeMessages(existing.messages || [], clientChat.messages || []),\n          });\n        } else {\n          // Сервер более свежий, но добавляем новые сообщения с клиента\n          mergedMap.set(clientChat.id, {\n            ...existing,\n            messages: mergeMessages(existing.messages || [], clientChat.messages || []),\n          });\n        }\n      } else {\n        // Нет timestamp - просто объединяем сообщения\n        mergedMap.set(clientChat.id, {\n          ...existing,\n          messages: mergeMessages(existing.messages || [], clientChat.messages || []),\n        });\n      }\n    }\n  });\n\n  return Array.from(mergedMap.values());\n};\n\n// Объединение сообщений (уникальные по ID)\nconst mergeMessages = (serverMessages: any[], clientMessages: any[]): any[] => {\n  const messageMap = new Map<string, any>();\n\n  // Добавляем серверные сообщения\n  serverMessages.forEach((msg) => {\n    messageMap.set(msg.id, msg);\n  });\n\n  // Добавляем/обновляем клиентские сообщения\n  clientMessages.forEach((msg) => {\n    const existing = messageMap.get(msg.id);\n    if (!existing || (msg.timestamp && existing.timestamp && msg.timestamp > existing.timestamp)) {\n      messageMap.set(msg.id, msg);\n    }\n  });\n\n  // Сортируем по timestamp\n  return Array.from(messageMap.values()).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));\n};\n\n// Получить чаты из базы данных\nconst getChatsFromDB = async (deviceId: string): Promise<any[]> => {\n  if (!supabase) {\n    throw new Error(\"Supabase клиент не инициализирован\");\n  }\n\n  const { data, error } = await supabase\n    .from('chats')\n    .select('*')\n    .eq('device_id', deviceId)\n    .order('updated_at', { ascending: false });\n\n  if (error) {\n    console.error('[getChatsFromDB] Error:', error);\n    return [];\n  }\n\n  return data || [];\n};\n\n// Сохранить чаты в базу данных\nconst saveChatsToDB = async (deviceId: string, chats: any[]): Promise<void> => {\n  if (!supabase) {\n    throw new Error(\"Supabase клиент не инициализирован\");\n  }\n\n  const timestamp = Date.now();\n  const chatsToSave = chats.map((chat) => ({\n    id: chat.id,\n    device_id: deviceId,\n    contact_name: chat.contactName || chat.contact_name || '',\n    contact_phone: chat.contactPhone || chat.contact_phone,\n    last_message: chat.lastMessage || chat.last_message,\n    last_message_timestamp: chat.lastMessageTimestamp || chat.last_message_timestamp,\n    risk_level: chat.riskLevel || chat.risk_level || 'safe',\n    unread_count: chat.unreadCount || chat.unread_count || 0,\n    created_at: chat.createdAt || chat.created_at || timestamp,\n    updated_at: chat.updatedAt || chat.updated_at || timestamp,\n  }));\n\n  // Используем upsert для обновления существующих и создания новых\n  const { error } = await supabase\n    .from('chats')\n    .upsert(chatsToSave, { onConflict: 'id' });\n\n  if (error) {\n    console.error('[saveChatsToDB] Error:', error);\n    throw error;\n  }\n\n  // Сохраняем сообщения отдельно\n  for (const chat of chats) {\n    if (chat.messages && Array.isArray(chat.messages) && chat.messages.length > 0) {\n      await saveMessagesToDB(chat.id, deviceId, chat.messages);\n    }\n  }\n};\n\n// Сохранить сообщения в базу данных\nconst saveMessagesToDB = async (chatId: string, deviceId: string, messages: any[]): Promise<void> => {\n  if (!supabase) {\n    throw new Error(\"Supabase клиент не инициализирован\");\n  }\n\n  const messagesToSave = messages.map((msg) => ({\n    id: msg.id,\n    chat_id: chatId,\n    device_id: deviceId,\n    sender: msg.sender || '',\n    content: msg.content || msg.text || '',\n    timestamp: msg.timestamp || Date.now(),\n    message_type: msg.messageType || msg.message_type || 'text',\n    risk_level: msg.riskLevel || msg.risk_level || 'safe',\n    ai_analysis: msg.aiAnalysis || msg.ai_analysis || null,\n    created_at: msg.createdAt || msg.created_at || Date.now(),\n  }));\n\n  const { error } = await supabase\n    .from('messages')\n    .upsert(messagesToSave, { onConflict: 'id' });\n\n  if (error) {\n    console.error('[saveMessagesToDB] Error:', error);\n    // Не бросаем ошибку, чтобы не прервать сохранение чатов\n  }\n};\n\n// Получить сообщения из базы данных\nconst getMessagesFromDB = async (chatId: string): Promise<any[]> => {\n  if (!supabase) {\n    return [];\n  }\n\n  const { data, error } = await supabase\n    .from('messages')\n    .select('*')\n    .eq('chat_id', chatId)\n    .order('timestamp', { ascending: true });\n\n  if (error) {\n    console.error('[getMessagesFromDB] Error:', error);\n    return [];\n  }\n\n  return data || [];\n};\n\n// Обновить статус синхронизации\nconst updateSyncStatus = async (deviceId: string, timestamp: number): Promise<void> => {\n  if (!supabase) {\n    return;\n  }\n\n  await supabase\n    .from('sync_status')\n    .upsert({\n      device_id: deviceId,\n      last_sync_timestamp: timestamp,\n      last_chats_sync: timestamp,\n      updated_at: timestamp,\n    }, { onConflict: 'device_id' });\n};\n\nexport const syncChatsProcedure = publicProcedure\n  .use(rateLimiters.sync)\n  .input(syncChatsInputSchema)\n  .mutation(async ({ input }) => {\n    const { deviceId, chats, lastSyncTimestamp = 0 } = input;\n    const timestamp = Date.now();\n\n    try {\n      // Получаем существующие чаты из базы данных\n      const serverChats = await getChatsFromDB(deviceId);\n\n      // Загружаем сообщения для каждого чата\n      const chatsWithMessages = await Promise.all(\n        serverChats.map(async (chat) => {\n          const messages = await getMessagesFromDB(chat.id);\n          return {\n            ...chat,\n            messages,\n            contactName: chat.contact_name,\n            contactPhone: chat.contact_phone,\n            lastMessage: chat.last_message,\n            lastMessageTimestamp: chat.last_message_timestamp,\n            riskLevel: chat.risk_level,\n            unreadCount: chat.unread_count,\n            createdAt: chat.created_at,\n            updatedAt: chat.updated_at,\n          };\n        })\n      );\n\n      if (chats && chats.length > 0) {\n        // Merge логика - объединяем серверные и клиентские чаты\n        const mergedChats = mergeChats(chatsWithMessages, chats);\n        \n        // Добавляем updatedAt если нет\n        const chatsWithTimestamp = mergedChats.map((chat) => ({\n          ...chat,\n          updatedAt: chat.updatedAt || timestamp,\n        }));\n\n        // Сохраняем объединенные чаты в базу данных\n        await saveChatsToDB(deviceId, chatsWithTimestamp);\n      }\n\n      // Обновляем статус синхронизации\n      await updateSyncStatus(deviceId, timestamp);\n\n      // Если запрошен incremental sync - возвращаем только изменения\n      if (lastSyncTimestamp > 0) {\n        const allChats = await getChatsFromDB(deviceId);\n        const chatsWithMessagesForDelta = await Promise.all(\n          allChats.map(async (chat) => {\n            const messages = await getMessagesFromDB(chat.id);\n            return {\n              ...chat,\n              messages,\n              contactName: chat.contact_name,\n              contactPhone: chat.contact_phone,\n              lastMessage: chat.last_message,\n              lastMessageTimestamp: chat.last_message_timestamp,\n              riskLevel: chat.risk_level,\n              unreadCount: chat.unread_count,\n              createdAt: chat.created_at,\n              updatedAt: chat.updated_at,\n            };\n          })\n        );\n        const deltaChats = getDeltaChats(chatsWithMessagesForDelta, lastSyncTimestamp);\n        \n        return {\n          success: true,\n          chats: deltaChats,\n          lastSyncTimestamp: timestamp,\n          serverTimestamp: timestamp,\n          isDelta: true,\n          count: deltaChats.length,\n        };\n      }\n\n      // Полная синхронизация - возвращаем все чаты\n      const allChats = await getChatsFromDB(deviceId);\n      const chatsWithMessagesForFull = await Promise.all(\n        allChats.map(async (chat) => {\n          const messages = await getMessagesFromDB(chat.id);\n          return {\n            ...chat,\n            messages,\n            contactName: chat.contact_name,\n            contactPhone: chat.contact_phone,\n            lastMessage: chat.last_message,\n            lastMessageTimestamp: chat.last_message_timestamp,\n            riskLevel: chat.risk_level,\n            unreadCount: chat.unread_count,\n            createdAt: chat.created_at,\n            updatedAt: chat.updated_at,\n          };\n        })\n      );\n\n      return {\n        success: true,\n        chats: chatsWithMessagesForFull,\n        lastSyncTimestamp: timestamp,\n        serverTimestamp: timestamp,\n        isDelta: false,\n        count: chatsWithMessagesForFull.length,\n      };\n    } catch (error) {\n      console.error('[syncChatsProcedure] Error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error',\n        chats: [],\n        lastSyncTimestamp: timestamp,\n        serverTimestamp: timestamp,\n      };\n    }\n  });\n\nexport const getChatsProcedure = publicProcedure\n  .use(rateLimiters.sync)\n  .input(getChatsInputSchema)\n  .query(async ({ input }) => {\n    const { deviceId, lastSyncTimestamp = 0 } = input;\n\n    try {\n      const allChats = await getChatsFromDB(deviceId);\n      \n      // Загружаем сообщения для каждого чата\n      const chatsWithMessages = await Promise.all(\n        allChats.map(async (chat) => {\n          const messages = await getMessagesFromDB(chat.id);\n          return {\n            ...chat,\n            messages,\n            contactName: chat.contact_name,\n            contactPhone: chat.contact_phone,\n            lastMessage: chat.last_message,\n            lastMessageTimestamp: chat.last_message_timestamp,\n            riskLevel: chat.risk_level,\n            unreadCount: chat.unread_count,\n            createdAt: chat.created_at,\n            updatedAt: chat.updated_at,\n          };\n        })\n      );\n\n      // Получаем последний timestamp синхронизации\n      let lastSync = 0;\n      if (supabase) {\n        const { data } = await supabase\n          .from('sync_status')\n          .select('last_chats_sync')\n          .eq('device_id', deviceId)\n          .single();\n        lastSync = data?.last_chats_sync || 0;\n      }\n\n      // Incremental sync если запрошен\n      if (lastSyncTimestamp > 0) {\n        const deltaChats = getDeltaChats(chatsWithMessages, lastSyncTimestamp);\n        return {\n          chats: deltaChats,\n          lastSyncTimestamp: lastSync,\n          serverTimestamp: Date.now(),\n          isDelta: true,\n          count: deltaChats.length,\n        };\n      }\n\n      // Полная синхронизация\n      return {\n        chats: chatsWithMessages,\n        lastSyncTimestamp: lastSync,\n        serverTimestamp: Date.now(),\n        isDelta: false,\n        count: chatsWithMessages.length,\n      };\n    } catch (error) {\n      console.error('[getChatsProcedure] Error:', error);\n      return {\n        chats: [],\n        lastSyncTimestamp: 0,\n        serverTimestamp: Date.now(),\n        isDelta: false,\n        count: 0,\n      };\n    }\n  });\n\nexport const syncChatsRouter = createTRPCRouter({\n  sync: syncChatsProcedure,\n  get: getChatsProcedure,\n});\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}