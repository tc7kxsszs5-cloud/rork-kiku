cd1e4f64c47ef934d497728d933a6fe8
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var PixelRatio = require('../Utilities/PixelRatio').default;
var Platform = require('../Utilities/Platform').default;
var _require = require('./AssetUtils'),
  pickScale = _require.pickScale;
var _require2 = require('@react-native/assets-registry/path-support'),
  getAndroidResourceFolderName = _require2.getAndroidResourceFolderName,
  getAndroidResourceIdentifier = _require2.getAndroidResourceIdentifier,
  getBasePath = _require2.getBasePath;
var invariant = require('invariant');
function getScaledAssetPath(asset) {
  var scale = pickScale(asset.scales, PixelRatio.get());
  var scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';
  var assetDir = getBasePath(asset);
  return assetDir + '/' + asset.name + scaleSuffix + '.' + asset.type;
}
function getAssetPathInDrawableFolder(asset) {
  var scale = pickScale(asset.scales, PixelRatio.get());
  var drawableFolder = getAndroidResourceFolderName(asset, scale);
  var fileName = getAndroidResourceIdentifier(asset);
  return drawableFolder + '/' + fileName + '.' + asset.type;
}
function assetSupportsNetworkLoads(asset) {
  return !(asset.type === 'xml' && Platform.OS === 'android');
}
var AssetSourceResolver = function () {
  function AssetSourceResolver(serverUrl, jsbundleUrl, asset) {
    (0, _classCallCheck2.default)(this, AssetSourceResolver);
    this.serverUrl = serverUrl;
    this.jsbundleUrl = jsbundleUrl;
    this.asset = asset;
  }
  return (0, _createClass2.default)(AssetSourceResolver, [{
    key: "isLoadedFromServer",
    value: function isLoadedFromServer() {
      return this.serverUrl != null && this.serverUrl !== '' && assetSupportsNetworkLoads(this.asset);
    }
  }, {
    key: "isLoadedFromFileSystem",
    value: function isLoadedFromFileSystem() {
      var _this$jsbundleUrl;
      return this.jsbundleUrl != null && ((_this$jsbundleUrl = this.jsbundleUrl) == null ? void 0 : _this$jsbundleUrl.startsWith('file://'));
    }
  }, {
    key: "defaultAsset",
    value: function defaultAsset() {
      if (this.isLoadedFromServer()) {
        return this.assetServerURL();
      }
      if (this.asset.resolver != null) {
        return this.getAssetUsingResolver(this.asset.resolver);
      }
      if (Platform.OS === 'android') {
        return this.isLoadedFromFileSystem() ? this.drawableFolderInBundle() : this.resourceIdentifierWithoutScale();
      } else {
        return this.scaledAssetURLNearBundle();
      }
    }
  }, {
    key: "getAssetUsingResolver",
    value: function getAssetUsingResolver(resolver) {
      switch (resolver) {
        case 'android':
          return this.isLoadedFromFileSystem() ? this.drawableFolderInBundle() : this.resourceIdentifierWithoutScale();
        case 'generic':
          return this.scaledAssetURLNearBundle();
        default:
          throw new Error("Don't know how to get asset via provided resolver: " + resolver + '\nAsset: ' + JSON.stringify(this.asset, null, '\t') + '\nPossible resolvers are:' + JSON.stringify(['android', 'generic'], null, '\t'));
      }
    }
  }, {
    key: "assetServerURL",
    value: function assetServerURL() {
      invariant(this.serverUrl != null, 'need server to load from');
      return this.fromSource(this.serverUrl + getScaledAssetPath(this.asset) + '?platform=' + Platform.OS + '&hash=' + this.asset.hash);
    }
  }, {
    key: "scaledAssetPath",
    value: function scaledAssetPath() {
      return this.fromSource(getScaledAssetPath(this.asset));
    }
  }, {
    key: "scaledAssetURLNearBundle",
    value: function scaledAssetURLNearBundle() {
      var _this$jsbundleUrl2;
      var path = (_this$jsbundleUrl2 = this.jsbundleUrl) != null ? _this$jsbundleUrl2 : 'file://';
      return this.fromSource(path + getScaledAssetPath(this.asset).replace(/\.\.\//g, '_'));
    }
  }, {
    key: "resourceIdentifierWithoutScale",
    value: function resourceIdentifierWithoutScale() {
      invariant(Platform.OS === 'android', 'resource identifiers work on Android');
      return this.fromSource(getAndroidResourceIdentifier(this.asset));
    }
  }, {
    key: "drawableFolderInBundle",
    value: function drawableFolderInBundle() {
      var _this$jsbundleUrl3;
      var path = (_this$jsbundleUrl3 = this.jsbundleUrl) != null ? _this$jsbundleUrl3 : 'file://';
      return this.fromSource(path + getAssetPathInDrawableFolder(this.asset));
    }
  }, {
    key: "fromSource",
    value: function fromSource(source) {
      return {
        __packager_asset: true,
        width: this.asset.width,
        height: this.asset.height,
        uri: source,
        scale: pickScale(this.asset.scales, PixelRatio.get())
      };
    }
  }]);
}();
AssetSourceResolver.pickScale = pickScale;
var _default = exports.default = AssetSourceResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHQiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiUGl4ZWxSYXRpbyIsIlBsYXRmb3JtIiwiX3JlcXVpcmUiLCJwaWNrU2NhbGUiLCJfcmVxdWlyZTIiLCJnZXRBbmRyb2lkUmVzb3VyY2VGb2xkZXJOYW1lIiwiZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllciIsImdldEJhc2VQYXRoIiwiaW52YXJpYW50IiwiZ2V0U2NhbGVkQXNzZXRQYXRoIiwiYXNzZXQiLCJzY2FsZSIsInNjYWxlcyIsImdldCIsInNjYWxlU3VmZml4IiwiYXNzZXREaXIiLCJuYW1lIiwidHlwZSIsImdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIiLCJkcmF3YWJsZUZvbGRlciIsImZpbGVOYW1lIiwiYXNzZXRTdXBwb3J0c05ldHdvcmtMb2FkcyIsIk9TIiwiQXNzZXRTb3VyY2VSZXNvbHZlciIsInNlcnZlclVybCIsImpzYnVuZGxlVXJsIiwia2V5IiwiaXNMb2FkZWRGcm9tU2VydmVyIiwiaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSIsIl90aGlzJGpzYnVuZGxlVXJsIiwic3RhcnRzV2l0aCIsImRlZmF1bHRBc3NldCIsImFzc2V0U2VydmVyVVJMIiwicmVzb2x2ZXIiLCJnZXRBc3NldFVzaW5nUmVzb2x2ZXIiLCJkcmF3YWJsZUZvbGRlckluQnVuZGxlIiwicmVzb3VyY2VJZGVudGlmaWVyV2l0aG91dFNjYWxlIiwic2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiZnJvbVNvdXJjZSIsImhhc2giLCJzY2FsZWRBc3NldFBhdGgiLCJfdGhpcyRqc2J1bmRsZVVybDIiLCJwYXRoIiwicmVwbGFjZSIsIl90aGlzJGpzYnVuZGxlVXJsMyIsInNvdXJjZSIsIl9fcGFja2FnZXJfYXNzZXQiLCJ3aWR0aCIsImhlaWdodCIsInVyaSIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiQXNzZXRTb3VyY2VSZXNvbHZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3cgc3RyaWN0LWxvY2FsXG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgdHlwZSBSZXNvbHZlZEFzc2V0U291cmNlID0ge1xuICArX19wYWNrYWdlcl9hc3NldDogYm9vbGVhbixcbiAgK3dpZHRoOiA/bnVtYmVyLFxuICAraGVpZ2h0OiA/bnVtYmVyLFxuICArdXJpOiBzdHJpbmcsXG4gICtzY2FsZTogbnVtYmVyLFxufTtcblxuLy8gRnJvbSBAcmVhY3QtbmF0aXZlL2Fzc2V0cy1yZWdpc3RyeVxudHlwZSBBc3NldERlc3RQYXRoUmVzb2x2ZXIgPSAnYW5kcm9pZCcgfCAnZ2VuZXJpYyc7XG5cbi8vIEZyb20gQHJlYWN0LW5hdGl2ZS9hc3NldHMtcmVnaXN0cnlcbnR5cGUgUGFja2FnZXJBc3NldCA9ICRSZWFkT25seTx7XG4gIF9fcGFja2FnZXJfYXNzZXQ6IGJvb2xlYW4sXG4gIGZpbGVTeXN0ZW1Mb2NhdGlvbjogc3RyaW5nLFxuICBodHRwU2VydmVyTG9jYXRpb246IHN0cmluZyxcbiAgd2lkdGg6ID9udW1iZXIsXG4gIGhlaWdodDogP251bWJlcixcbiAgc2NhbGVzOiBBcnJheTxudW1iZXI+LFxuICBoYXNoOiBzdHJpbmcsXG4gIG5hbWU6IHN0cmluZyxcbiAgdHlwZTogc3RyaW5nLFxuICByZXNvbHZlcj86IEFzc2V0RGVzdFBhdGhSZXNvbHZlcixcbiAgLi4uXG59PjtcblxuY29uc3QgUGl4ZWxSYXRpbyA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9QaXhlbFJhdGlvJykuZGVmYXVsdDtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BsYXRmb3JtJykuZGVmYXVsdDtcbmNvbnN0IHtwaWNrU2NhbGV9ID0gcmVxdWlyZSgnLi9Bc3NldFV0aWxzJyk7XG5jb25zdCB7XG4gIGdldEFuZHJvaWRSZXNvdXJjZUZvbGRlck5hbWUsXG4gIGdldEFuZHJvaWRSZXNvdXJjZUlkZW50aWZpZXIsXG4gIGdldEJhc2VQYXRoLFxufSA9IHJlcXVpcmUoJ0ByZWFjdC1uYXRpdmUvYXNzZXRzLXJlZ2lzdHJ5L3BhdGgtc3VwcG9ydCcpO1xuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5cbi8qKlxuICogUmV0dXJucyBhIHBhdGggbGlrZSAnYXNzZXRzL0F3ZXNvbWVNb2R1bGUvaWNvbkAyeC5wbmcnXG4gKi9cbmZ1bmN0aW9uIGdldFNjYWxlZEFzc2V0UGF0aChhc3NldDogUGFja2FnZXJBc3NldCk6IHN0cmluZyB7XG4gIGNvbnN0IHNjYWxlID0gcGlja1NjYWxlKGFzc2V0LnNjYWxlcywgUGl4ZWxSYXRpby5nZXQoKSk7XG4gIGNvbnN0IHNjYWxlU3VmZml4ID0gc2NhbGUgPT09IDEgPyAnJyA6ICdAJyArIHNjYWxlICsgJ3gnO1xuICBjb25zdCBhc3NldERpciA9IGdldEJhc2VQYXRoKGFzc2V0KTtcbiAgcmV0dXJuIGFzc2V0RGlyICsgJy8nICsgYXNzZXQubmFtZSArIHNjYWxlU3VmZml4ICsgJy4nICsgYXNzZXQudHlwZTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcGF0aCBsaWtlICdkcmF3YWJsZS1tZHBpL2ljb24ucG5nJ1xuICovXG5mdW5jdGlvbiBnZXRBc3NldFBhdGhJbkRyYXdhYmxlRm9sZGVyKGFzc2V0OiBQYWNrYWdlckFzc2V0KTogc3RyaW5nIHtcbiAgY29uc3Qgc2NhbGUgPSBwaWNrU2NhbGUoYXNzZXQuc2NhbGVzLCBQaXhlbFJhdGlvLmdldCgpKTtcbiAgY29uc3QgZHJhd2FibGVGb2xkZXIgPSBnZXRBbmRyb2lkUmVzb3VyY2VGb2xkZXJOYW1lKGFzc2V0LCBzY2FsZSk7XG4gIGNvbnN0IGZpbGVOYW1lID0gZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllcihhc3NldCk7XG4gIHJldHVybiBkcmF3YWJsZUZvbGRlciArICcvJyArIGZpbGVOYW1lICsgJy4nICsgYXNzZXQudHlwZTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIGFzc2V0IGNhbiBiZSBsb2FkZWQgb3ZlciB0aGUgbmV0d29yay5cbiAqXG4gKiBUaGlzIHByZXZlbnRzIGFuIGlzc3VlIGxvYWRpbmcgWE1MIGFzc2V0cyBvbiBBbmRyb2lkLiBYTUwgYXNzZXQgdHlwZXMgbGlrZVxuICogdmVjdG9yIGRyYXdhYmxlcyBjYW4gb25seSBiZSBsb2FkZWQgZnJvbSBwcmVjb21waWxlZCBzb3VyY2UuIEFuZHJvaWQgZG9lc1xuICogbm90IHN1cHBvcnQgbG9hZGluZyB0aGVzZSBvdmVyIHRoZSBuZXR3b3JrLCBhbmQgQUFQVCBwcmVjb21waWxlcyBkYXRhIGJ5XG4gKiBicmVha2luZyBwYXRoIGRhdGEgYW5kIHJlc291cmNlIGluZm9ybWF0aW9uIGFwYXJ0IGludG8gbXVsdGlwbGUgZmlsZXMsXG4gKiBzdHVmZmluZyBpdCBhbGwgaW50byB0aGUgcmVzb3VyY2UgdGFibGUuIEFzIGEgcmVzdWx0LCB3ZSBzaG91bGQgb25seSBhdHRlbXB0XG4gKiB0byBsb2FkIHJlc291cmNlcyBhcyB3ZSB3b3VsZCBpbiByZWxlYXNlIGJ1aWxkczogYnkgdGhlIHJlc291cmNlIG5hbWUuXG4gKlxuICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZTpcbiAqIGh0dHBzOi8vaXNzdWV0cmFja2VyLmdvb2dsZS5jb20vaXNzdWVzLzYyNDM1MDY5XG4gKiBodHRwczovL2lzc3VldHJhY2tlci5nb29nbGUuY29tL2lzc3Vlcy82ODI5MzE4OVxuICovXG5mdW5jdGlvbiBhc3NldFN1cHBvcnRzTmV0d29ya0xvYWRzKGFzc2V0OiBQYWNrYWdlckFzc2V0KTogYm9vbGVhbiB7XG4gIHJldHVybiAhKGFzc2V0LnR5cGUgPT09ICd4bWwnICYmIFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpO1xufVxuXG5jbGFzcyBBc3NldFNvdXJjZVJlc29sdmVyIHtcbiAgc2VydmVyVXJsOiA/c3RyaW5nO1xuICAvLyB3aGVyZSB0aGUganNidW5kbGUgaXMgYmVpbmcgcnVuIGZyb21cbiAganNidW5kbGVVcmw6ID9zdHJpbmc7XG4gIC8vIHRoZSBhc3NldCB0byByZXNvbHZlXG4gIGFzc2V0OiBQYWNrYWdlckFzc2V0O1xuXG4gIGNvbnN0cnVjdG9yKHNlcnZlclVybDogP3N0cmluZywganNidW5kbGVVcmw6ID9zdHJpbmcsIGFzc2V0OiBQYWNrYWdlckFzc2V0KSB7XG4gICAgdGhpcy5zZXJ2ZXJVcmwgPSBzZXJ2ZXJVcmw7XG4gICAgdGhpcy5qc2J1bmRsZVVybCA9IGpzYnVuZGxlVXJsO1xuICAgIHRoaXMuYXNzZXQgPSBhc3NldDtcbiAgfVxuXG4gIGlzTG9hZGVkRnJvbVNlcnZlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5zZXJ2ZXJVcmwgIT0gbnVsbCAmJlxuICAgICAgdGhpcy5zZXJ2ZXJVcmwgIT09ICcnICYmXG4gICAgICBhc3NldFN1cHBvcnRzTmV0d29ya0xvYWRzKHRoaXMuYXNzZXQpXG4gICAgKTtcbiAgfVxuXG4gIGlzTG9hZGVkRnJvbUZpbGVTeXN0ZW0oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuanNidW5kbGVVcmwgIT0gbnVsbCAmJiB0aGlzLmpzYnVuZGxlVXJsPy5zdGFydHNXaXRoKCdmaWxlOi8vJyk7XG4gIH1cblxuICBkZWZhdWx0QXNzZXQoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgaWYgKHRoaXMuaXNMb2FkZWRGcm9tU2VydmVyKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmFzc2V0U2VydmVyVVJMKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYXNzZXQucmVzb2x2ZXIgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QXNzZXRVc2luZ1Jlc29sdmVyKHRoaXMuYXNzZXQucmVzb2x2ZXIpO1xuICAgIH1cblxuICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICByZXR1cm4gdGhpcy5pc0xvYWRlZEZyb21GaWxlU3lzdGVtKClcbiAgICAgICAgPyB0aGlzLmRyYXdhYmxlRm9sZGVySW5CdW5kbGUoKVxuICAgICAgICA6IHRoaXMucmVzb3VyY2VJZGVudGlmaWVyV2l0aG91dFNjYWxlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnNjYWxlZEFzc2V0VVJMTmVhckJ1bmRsZSgpO1xuICAgIH1cbiAgfVxuXG4gIGdldEFzc2V0VXNpbmdSZXNvbHZlcihyZXNvbHZlcjogQXNzZXREZXN0UGF0aFJlc29sdmVyKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgc3dpdGNoIChyZXNvbHZlcikge1xuICAgICAgY2FzZSAnYW5kcm9pZCc6XG4gICAgICAgIHJldHVybiB0aGlzLmlzTG9hZGVkRnJvbUZpbGVTeXN0ZW0oKVxuICAgICAgICAgID8gdGhpcy5kcmF3YWJsZUZvbGRlckluQnVuZGxlKClcbiAgICAgICAgICA6IHRoaXMucmVzb3VyY2VJZGVudGlmaWVyV2l0aG91dFNjYWxlKCk7XG4gICAgICBjYXNlICdnZW5lcmljJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlKCk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJEb24ndCBrbm93IGhvdyB0byBnZXQgYXNzZXQgdmlhIHByb3ZpZGVkIHJlc29sdmVyOiBcIiArXG4gICAgICAgICAgICByZXNvbHZlciArXG4gICAgICAgICAgICAnXFxuQXNzZXQ6ICcgK1xuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5hc3NldCwgbnVsbCwgJ1xcdCcpICtcbiAgICAgICAgICAgICdcXG5Qb3NzaWJsZSByZXNvbHZlcnMgYXJlOicgK1xuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoWydhbmRyb2lkJywgJ2dlbmVyaWMnXSwgbnVsbCwgJ1xcdCcpLFxuICAgICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIGFic29sdXRlIFVSTCB3aGljaCBjYW4gYmUgdXNlZCB0byBmZXRjaCB0aGUgYXNzZXRcbiAgICogZnJvbSB0aGUgZGV2c2VydmVyXG4gICAqL1xuICBhc3NldFNlcnZlclVSTCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpbnZhcmlhbnQodGhpcy5zZXJ2ZXJVcmwgIT0gbnVsbCwgJ25lZWQgc2VydmVyIHRvIGxvYWQgZnJvbScpO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoXG4gICAgICB0aGlzLnNlcnZlclVybCArXG4gICAgICAgIGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KSArXG4gICAgICAgICc/cGxhdGZvcm09JyArXG4gICAgICAgIFBsYXRmb3JtLk9TICtcbiAgICAgICAgJyZoYXNoPScgK1xuICAgICAgICB0aGlzLmFzc2V0Lmhhc2gsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNvbHZlcyB0byBqdXN0IHRoZSBzY2FsZWQgYXNzZXQgZmlsZW5hbWVcbiAgICogRS5nLiAnYXNzZXRzL0F3ZXNvbWVNb2R1bGUvaWNvbkAyeC5wbmcnXG4gICAqL1xuICBzY2FsZWRBc3NldFBhdGgoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShnZXRTY2FsZWRBc3NldFBhdGgodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIHRvIHdoZXJlIHRoZSBidW5kbGUgaXMgcnVubmluZyBmcm9tLCB3aXRoIGEgc2NhbGVkIGFzc2V0IGZpbGVuYW1lXG4gICAqIEUuZy4gJ2ZpbGU6Ly8vc2RjYXJkL2J1bmRsZS9hc3NldHMvQXdlc29tZU1vZHVsZS9pY29uQDJ4LnBuZydcbiAgICovXG4gIHNjYWxlZEFzc2V0VVJMTmVhckJ1bmRsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBjb25zdCBwYXRoID0gdGhpcy5qc2J1bmRsZVVybCA/PyAnZmlsZTovLyc7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShcbiAgICAgIC8vIEFzc2V0cyBjYW4gaGF2ZSByZWxhdGl2ZSBwYXRocyBvdXRzaWRlIG9mIHRoZSBwcm9qZWN0IHJvb3QuXG4gICAgICAvLyBXaGVuIGJ1bmRsaW5nIHRoZW0gd2UgcmVwbGFjZSBgLi4vYCB3aXRoIGBfYCB0byBtYWtlIHN1cmUgdGhleVxuICAgICAgLy8gZG9uJ3QgZW5kIHVwIG91dHNpZGUgb2YgdGhlIGV4cGVjdGVkIGFzc2V0cyBkaXJlY3RvcnkuXG4gICAgICBwYXRoICsgZ2V0U2NhbGVkQXNzZXRQYXRoKHRoaXMuYXNzZXQpLnJlcGxhY2UoL1xcLlxcLlxcLy9nLCAnXycpLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgYXNzZXRzIGJ1bmRsZWQgd2l0aCB0aGUgYXBwLCBsb2NhdGVkIGJ5XG4gICAqIHJlc291cmNlIGlkZW50aWZpZXJcbiAgICogVGhlIEFuZHJvaWQgcmVzb3VyY2Ugc3lzdGVtIHBpY2tzIHRoZSBjb3JyZWN0IHNjYWxlLlxuICAgKiBFLmcuICdhc3NldHNfYXdlc29tZW1vZHVsZV9pY29uJ1xuICAgKi9cbiAgcmVzb3VyY2VJZGVudGlmaWVyV2l0aG91dFNjYWxlKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGludmFyaWFudChcbiAgICAgIFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcsXG4gICAgICAncmVzb3VyY2UgaWRlbnRpZmllcnMgd29yayBvbiBBbmRyb2lkJyxcbiAgICApO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllcih0aGlzLmFzc2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogSWYgdGhlIGpzYnVuZGxlIGlzIHJ1bm5pbmcgZnJvbSBhIHNpZGVsb2FkIGxvY2F0aW9uLCB0aGlzIHJlc29sdmVzIGFzc2V0c1xuICAgKiByZWxhdGl2ZSB0byBpdHMgbG9jYXRpb25cbiAgICogRS5nLiAnZmlsZTovLy9zZGNhcmQvQXdlc29tZU1vZHVsZS9kcmF3YWJsZS1tZHBpL2ljb24ucG5nJ1xuICAgKi9cbiAgZHJhd2FibGVGb2xkZXJJbkJ1bmRsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBjb25zdCBwYXRoID0gdGhpcy5qc2J1bmRsZVVybCA/PyAnZmlsZTovLyc7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShwYXRoICsgZ2V0QXNzZXRQYXRoSW5EcmF3YWJsZUZvbGRlcih0aGlzLmFzc2V0KSk7XG4gIH1cblxuICBmcm9tU291cmNlKHNvdXJjZTogc3RyaW5nKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fcGFja2FnZXJfYXNzZXQ6IHRydWUsXG4gICAgICB3aWR0aDogdGhpcy5hc3NldC53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5hc3NldC5oZWlnaHQsXG4gICAgICB1cmk6IHNvdXJjZSxcbiAgICAgIHNjYWxlOiBwaWNrU2NhbGUodGhpcy5hc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgcGlja1NjYWxlOiAoc2NhbGVzOiBBcnJheTxudW1iZXI+LCBkZXZpY2VTY2FsZT86IG51bWJlcikgPT4gbnVtYmVyID1cbiAgICBwaWNrU2NhbGU7XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFzc2V0U291cmNlUmVzb2x2ZXI7XG4iXSwibWFwcGluZ3MiOiJBQVVBLFlBQVk7O0FBQUMsSUFBQUEs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