{"version":3,"names":["createContextHook","useState","useCallback","AsyncStorage","logger","STORAGE_KEY","DEFAULT_BACKGROUNDS","id","name","type","value","_createContextHook","_useState","_useState2","_slicedToArray","backgrounds","setBackgrounds","_useState3","_useState4","selectedBackgrounds","setSelectedBackgrounds","setChatBackground","_ref","_asyncToGenerator","chatId","backgroundId","prev","Object","assign","_defineProperty","setItem","JSON","stringify","error","Error","String","context","action","_x","_x2","apply","arguments","getChatBackground","defaultBg","color","gradient","gradientDirection","start","x","y","end","bg","find","b","_createContextHook2","ChatBackgroundsProvider","useChatBackgrounds"],"sources":["ChatBackgroundsContext.tsx"],"sourcesContent":["/**\n * Chat Backgrounds Context\n * Manages chat background customization\n */\n\nimport createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { logger } from '@/utils/logger';\n\nexport interface ChatBackground {\n  id: string;\n  name: string;\n  type: 'color' | 'gradient' | 'image' | 'solid';\n  value?: string | string[];\n  preview?: string;\n  // Для совместимости с chat/[chatId].tsx\n  color?: string;\n  gradient?: string[];\n  gradientDirection?: {\n    start: { x: number; y: number };\n    end: { x: number; y: number };\n  };\n}\n\n// Тип для использования в компонентах (расширенный)\nexport type ChatBackgroundExtended = ChatBackground;\n\nconst STORAGE_KEY = '@chat_backgrounds';\nconst DEFAULT_BACKGROUNDS: ChatBackground[] = [\n  {\n    id: 'default',\n    name: 'По умолчанию',\n    type: 'color',\n    value: '#FFFFFF',\n  },\n  {\n    id: 'gradient1',\n    name: 'Градиент 1',\n    type: 'gradient',\n    value: ['#4A90E2', '#357ABD'],\n  },\n  {\n    id: 'gradient2',\n    name: 'Градиент 2',\n    type: 'gradient',\n    value: ['#FF6B35', '#E55A2B'],\n  },\n];\n\nexport const [ChatBackgroundsProvider, useChatBackgrounds] = createContextHook(() => {\n  const [backgrounds, setBackgrounds] = useState<ChatBackground[]>(DEFAULT_BACKGROUNDS);\n  const [selectedBackgrounds, setSelectedBackgrounds] = useState<Record<string, string>>({});\n\n  const setChatBackground = useCallback(async (chatId: string, backgroundId: string) => {\n    setSelectedBackgrounds((prev) => ({\n      ...prev,\n      [chatId]: backgroundId,\n    }));\n    \n    try {\n      await AsyncStorage.setItem(STORAGE_KEY, JSON.stringify({\n        ...selectedBackgrounds,\n        [chatId]: backgroundId,\n      }));\n    } catch (error) {\n      logger.error('Failed to save background', error instanceof Error ? error : new Error(String(error)), { context: 'ChatBackgroundsContext', action: 'setChatBackground', chatId, backgroundId });\n    }\n  }, [selectedBackgrounds]);\n\n  const getChatBackground = useCallback((chatId: string): ChatBackgroundExtended | null => {\n    const backgroundId = selectedBackgrounds[chatId];\n    if (!backgroundId) {\n      const defaultBg = backgrounds[0];\n      if (!defaultBg) return null;\n      // Преобразуем в формат, ожидаемый chat/[chatId].tsx\n      if (defaultBg.type === 'color') {\n        return {\n          ...defaultBg,\n          type: 'solid' as const,\n          color: defaultBg.value as string,\n        };\n      }\n      if (defaultBg.type === 'gradient') {\n        return {\n          ...defaultBg,\n          gradient: defaultBg.value as string[],\n          gradientDirection: {\n            start: { x: 0, y: 0 },\n            end: { x: 1, y: 1 },\n          },\n        };\n      }\n      return defaultBg;\n    }\n    const bg = backgrounds.find((b) => b.id === backgroundId) || backgrounds[0];\n    if (!bg) return null;\n    // Преобразуем в формат, ожидаемый chat/[chatId].tsx\n    if (bg.type === 'color') {\n      return {\n        ...bg,\n        type: 'solid' as const,\n        color: bg.value as string,\n      };\n    }\n    if (bg.type === 'gradient') {\n      return {\n        ...bg,\n        gradient: bg.value as string[],\n        gradientDirection: {\n          start: { x: 0, y: 0 },\n          end: { x: 1, y: 1 },\n        },\n      };\n    }\n    return bg;\n  }, [selectedBackgrounds, backgrounds]);\n\n  return {\n    backgrounds,\n    selectedBackgrounds,\n    setChatBackground,\n    getChatBackground,\n  };\n});\n"],"mappings":"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","ignoreList":[]}