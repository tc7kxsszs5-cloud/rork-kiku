4fe68b1a5a3dbe6804ddda56951028e6
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SCHEMA_VERSION = exports.APP_DATA_VERSION = exports.API_VERSION = void 0;
exports.createVersionedData = createVersionedData;
exports.getStoredVersion = getStoredVersion;
exports.getVersionInfo = getVersionInfo;
exports.needsMigration = needsMigration;
exports.saveStoredVersion = saveStoredVersion;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var APP_DATA_VERSION = exports.APP_DATA_VERSION = 1;
var API_VERSION = exports.API_VERSION = 1;
var SCHEMA_VERSION = exports.SCHEMA_VERSION = 1;
function getVersionInfo() {
  try {
    var packageJson = require('../../package.json');
    return {
      appVersion: packageJson.version || '1.0.0',
      dataVersion: APP_DATA_VERSION,
      apiVersion: API_VERSION,
      schemaVersion: SCHEMA_VERSION
    };
  } catch (_unused) {
    return {
      appVersion: '1.0.0',
      dataVersion: APP_DATA_VERSION,
      apiVersion: API_VERSION,
      schemaVersion: SCHEMA_VERSION
    };
  }
}
function createVersionedData(data) {
  var version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : APP_DATA_VERSION;
  return {
    version: version,
    data: data,
    migratedAt: Date.now()
  };
}
function needsMigration(currentVersion) {
  var targetVersion = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : APP_DATA_VERSION;
  return currentVersion < targetVersion;
}
function getStoredVersion(_x) {
  return _getStoredVersion.apply(this, arguments);
}
function _getStoredVersion() {
  _getStoredVersion = (0, _asyncToGenerator2.default)(function* (storageKey) {
    try {
      var AsyncStorage = (yield import('@react-native-async-storage/async-storage')).default;
      var version = yield AsyncStorage.getItem(`${storageKey}_version`);
      return version ? parseInt(version, 10) : 1;
    } catch (_unused2) {
      return 1;
    }
  });
  return _getStoredVersion.apply(this, arguments);
}
function saveStoredVersion(_x2, _x3) {
  return _saveStoredVersion.apply(this, arguments);
}
function _saveStoredVersion() {
  _saveStoredVersion = (0, _asyncToGenerator2.default)(function* (storageKey, version) {
    try {
      var AsyncStorage = (yield import('@react-native-async-storage/async-storage')).default;
      yield AsyncStorage.setItem(`${storageKey}_version`, String(version));
    } catch (error) {
      console.error(`[versioning] Failed to save version for ${storageKey}:`, error);
    }
  });
  return _saveStoredVersion.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBUFBfREFUQV9WRVJTSU9OIiwiZXhwb3J0cyIsIkFQSV9WRVJTSU9OIiwiU0NIRU1BX1ZFUlNJT04iLCJnZXRWZXJzaW9uSW5mbyIsInBhY2thZ2VKc29uIiwicmVxdWlyZSIsImFwcFZlcnNpb24iLCJ2ZXJzaW9uIiwiZGF0YVZlcnNpb24iLCJhcGlWZXJzaW9uIiwic2NoZW1hVmVyc2lvbiIsIl91bnVzZWQiLCJjcmVhdGVWZXJzaW9uZWREYXRhIiwiZGF0YSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsIm1pZ3JhdGVkQXQiLCJEYXRlIiwibm93IiwibmVlZHNNaWdyYXRpb24iLCJjdXJyZW50VmVyc2lvbiIsInRhcmdldFZlcnNpb24iLCJnZXRTdG9yZWRWZXJzaW9uIiwiX3giLCJfZ2V0U3RvcmVkVmVyc2lvbiIsImFwcGx5IiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiZGVmYXVsdCIsInN0b3JhZ2VLZXkiLCJBc3luY1N0b3JhZ2UiLCJnZXRJdGVtIiwicGFyc2VJbnQiLCJfdW51c2VkMiIsInNhdmVTdG9yZWRWZXJzaW9uIiwiX3gyIiwiX3gzIiwiX3NhdmVTdG9yZWRWZXJzaW9uIiwic2V0SXRlbSIsIlN0cmluZyIsImVycm9yIiwiY29uc29sZSJdLCJzb3VyY2VzIjpbInZlcnNpb25pbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDQodC40YHRgtC10LzQsCDQstC10YDRgdC40L7QvdC40YDQvtCy0LDQvdC40Y8g0LTQu9GPINC/0YDQvtC10LrRgtCwIEtJS1VcbiAqIFxuICog0J7QsdC10YHQv9C10YfQuNCy0LDQtdGCINC/0LvQsNCy0L3Ri9C5INC/0LXRgNC10YXQvtC0INC80LXQttC00YMg0LLQtdGA0YHQuNGP0LzQuCDQtNCw0L3QvdGL0YUg0LHQtdC3INC/0L7RgtC10YDQuCDQuNC90YTQvtGA0LzQsNGG0LjQuFxuICovXG5cbmV4cG9ydCBjb25zdCBBUFBfREFUQV9WRVJTSU9OID0gMTsgLy8g0KLQtdC60YPRidCw0Y8g0LLQtdGA0YHQuNGPINC00LDQvdC90YvRhVxuZXhwb3J0IGNvbnN0IEFQSV9WRVJTSU9OID0gMTsgLy8g0KLQtdC60YPRidCw0Y8g0LLQtdGA0YHQuNGPIEFQSVxuZXhwb3J0IGNvbnN0IFNDSEVNQV9WRVJTSU9OID0gMTsgLy8g0KLQtdC60YPRidCw0Y8g0LLQtdGA0YHQuNGPINGB0YXQtdC8XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmVyc2lvbkluZm8ge1xuICBhcHBWZXJzaW9uOiBzdHJpbmc7IC8vINCS0LXRgNGB0LjRjyDQv9GA0LjQu9C+0LbQtdC90LjRjyDQuNC3IHBhY2thZ2UuanNvblxuICBkYXRhVmVyc2lvbjogbnVtYmVyOyAvLyDQktC10YDRgdC40Y8g0LTQsNC90L3Ri9GFXG4gIGFwaVZlcnNpb246IG51bWJlcjsgLy8g0JLQtdGA0YHQuNGPIEFQSVxuICBzY2hlbWFWZXJzaW9uOiBudW1iZXI7IC8vINCS0LXRgNGB0LjRjyDRgdGF0LXQvFxufVxuXG4vKipcbiAqINCf0L7Qu9GD0YfQuNGC0Ywg0LjQvdGE0L7RgNC80LDRhtC40Y4g0L4g0LLQtdGA0YHQuNGP0YVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFZlcnNpb25JbmZvKCk6IFZlcnNpb25JbmZvIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWNrYWdlSnNvbiA9IHJlcXVpcmUoJy4uLy4uL3BhY2thZ2UuanNvbicpO1xuICAgIHJldHVybiB7XG4gICAgICBhcHBWZXJzaW9uOiBwYWNrYWdlSnNvbi52ZXJzaW9uIHx8ICcxLjAuMCcsXG4gICAgICBkYXRhVmVyc2lvbjogQVBQX0RBVEFfVkVSU0lPTixcbiAgICAgIGFwaVZlcnNpb246IEFQSV9WRVJTSU9OLFxuICAgICAgc2NoZW1hVmVyc2lvbjogU0NIRU1BX1ZFUlNJT04sXG4gICAgfTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFwcFZlcnNpb246ICcxLjAuMCcsXG4gICAgICBkYXRhVmVyc2lvbjogQVBQX0RBVEFfVkVSU0lPTixcbiAgICAgIGFwaVZlcnNpb246IEFQSV9WRVJTSU9OLFxuICAgICAgc2NoZW1hVmVyc2lvbjogU0NIRU1BX1ZFUlNJT04sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqINCS0LXRgNGB0LjQvtC90LjRgNC+0LLQsNC90L3Ri9C1INC00LDQvdC90YvQtVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZlcnNpb25lZERhdGE8VCA9IGFueT4ge1xuICB2ZXJzaW9uOiBudW1iZXI7XG4gIGRhdGE6IFQ7XG4gIG1pZ3JhdGVkQXQ/OiBudW1iZXI7XG4gIG1pZ3JhdGVkRnJvbT86IG51bWJlcjtcbn1cblxuLyoqXG4gKiDQodC+0LfQtNCw0YLRjCDQstC10YDRgdC40L7QvdC40YDQvtCy0LDQvdC90YvQtSDQtNCw0L3QvdGL0LVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVZlcnNpb25lZERhdGE8VD4oZGF0YTogVCwgdmVyc2lvbjogbnVtYmVyID0gQVBQX0RBVEFfVkVSU0lPTik6IFZlcnNpb25lZERhdGE8VD4ge1xuICByZXR1cm4ge1xuICAgIHZlcnNpb24sXG4gICAgZGF0YSxcbiAgICBtaWdyYXRlZEF0OiBEYXRlLm5vdygpLFxuICB9O1xufVxuXG4vKipcbiAqINCf0YDQvtCy0LXRgNC40YLRjCDQvdGD0LbQvdC+INC70Lgg0LzQuNCz0YDQuNGA0L7QstCw0YLRjCDQtNCw0L3QvdGL0LVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5lZWRzTWlncmF0aW9uKGN1cnJlbnRWZXJzaW9uOiBudW1iZXIsIHRhcmdldFZlcnNpb246IG51bWJlciA9IEFQUF9EQVRBX1ZFUlNJT04pOiBib29sZWFuIHtcbiAgcmV0dXJuIGN1cnJlbnRWZXJzaW9uIDwgdGFyZ2V0VmVyc2lvbjtcbn1cblxuLyoqXG4gKiDQn9C+0LvRg9GH0LjRgtGMINCy0LXRgNGB0LjRjiDQuNC3INGF0YDQsNC90LjQu9C40YnQsFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3RvcmVkVmVyc2lvbihzdG9yYWdlS2V5OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICB0cnkge1xuICAgIGNvbnN0IEFzeW5jU3RvcmFnZSA9IChhd2FpdCBpbXBvcnQoJ0ByZWFjdC1uYXRpdmUtYXN5bmMtc3RvcmFnZS9hc3luYy1zdG9yYWdlJykpLmRlZmF1bHQ7XG4gICAgY29uc3QgdmVyc2lvbiA9IGF3YWl0IEFzeW5jU3RvcmFnZS5nZXRJdGVtKGAke3N0b3JhZ2VLZXl9X3ZlcnNpb25gKTtcbiAgICByZXR1cm4gdmVyc2lvbiA/IHBhcnNlSW50KHZlcnNpb24sIDEwKSA6IDE7IC8vINCf0L4g0YPQvNC+0LvRh9Cw0L3QuNGOINCy0LXRgNGB0LjRjyAxXG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiAxO1xuICB9XG59XG5cbi8qKlxuICog0KHQvtGF0YDQsNC90LjRgtGMINCy0LXRgNGB0LjRjiDQsiDRhdGA0LDQvdC40LvQuNGJ0LVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVTdG9yZWRWZXJzaW9uKHN0b3JhZ2VLZXk6IHN0cmluZywgdmVyc2lvbjogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgQXN5bmNTdG9yYWdlID0gKGF3YWl0IGltcG9ydCgnQHJlYWN0LW5hdGl2ZS1hc3luYy1zdG9yYWdlL2FzeW5jLXN0b3JhZ2UnKSkuZGVmYXVsdDtcbiAgICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShgJHtzdG9yYWdlS2V5fV92ZXJzaW9uYCwgU3RyaW5nKHZlcnNpb24pKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBbdmVyc2lvbmluZ10gRmFpbGVkIHRvIHNhdmUgdmVyc2lvbiBmb3IgJHtzdG9yYWdlS2V5fTpgLCBlcnJvcik7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFNTyxJQUFNQSxnQkFBZ0IsR0FBQUMsT0FBQSxDQUFBRCxnQkFBQSxHQUFHLENBQUM7QUFDMUIsSUFBTUUsV0FBVyxHQUFBRCxPQUFBLENBQUFDLFdBQUEsR0FB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