{"version":3,"names":["createContextHook","useState","useCallback","useMemo","useEffect","useRef","MOCK_CHATS","INITIAL_MESSAGES","HapticFeedback","Notifications","Platform","useAnalytics","getSoundForRiskLevel","getAndroidPriorityForRiskLevel","getChannelIdForRiskLevel","setupNotificationChannels","analyzeMessageWithAI","analyzeImageWithAI","usePersonalizedAI","evaluateMessageRisk","evaluateImageRisk","chatSyncService","alertSyncService","trpcVanillaClient","useUser","logger","handleErrorSilently","LEVEL_ORDER","SIMULATED_DELAY_MS","simulateLatency","Promise","resolve","setTimeout","mergeChatsWithServer","localChats","serverChats","chatMap","Map","forEach","chat","set","id","localChat","serverChat","get","localLastActivity","lastActivity","serverLastActivity","mergedMessages","mergeMessages","messages","Object","assign","Array","from","values","serverMessages","localMessages","messageMap","msg","existing","timestamp","sort","a","b","mergeAlertsWithServer","localAlerts","serverAlerts","alertMap","alert","_createContextHook","_useState","_useState2","_slicedToArray","chats","setChats","_useState3","_useState4","alerts","setAlerts","_useState5","_useState6","isAnalyzing","setIsAnalyzing","_useState7","_useState8","isSyncing","setIsSyncing","_useState9","_useState10","lastSyncTimestamp","setLastSyncTimestamp","_useState11","_useState12","syncError","setSyncError","isMountedRef","syncTimeoutRef","_useAnalytics","trackEvent","_usePersonalizedAI","personalizeAnalysis","_useUser","user","syncData","_asyncToGenerator","silent","arguments","length","undefined","current","initialize","chatsResult","syncChats","success","data","mergedChats","serverChatsResult","getChats","alertsResult","syncAlerts","mergedAlerts","serverAlertsResult","getAlerts","Date","now","info","context","error","Error","String","action","syncErr","message","OS","catch","initialSync","_ref2","apply","interval","setInterval","clearInterval","clearTimeout","analyzeMessage","_ref3","aiAnalysis","text","useAdvancedAI","confidenceThreshold","_x","analyzeImage","_ref4","imageUri","enableImageAnalysis","blocked","reasons","console","_x2","addMessage","_ref5","chatId","senderId","senderName","newMessage","Math","random","analyzed","imageAnalyzed","imageBlocked","prev","map","concat","_toConsumableArray","updatedAt","hasImage","analysis","personalizedAnalysis","imageAnalysis","riskLevel","warning","updatedMessages","riskReasons","imageRiskReasons","levels","highestRisk","reduce","max","msgLevel","indexOf","shouldAlert","imageRisk","newAlert","messageId","resolved","prevAlerts","alertId","riskLevelLabels","safe","low","medium","high","critical","title","chatName","isGroup","groupName","participantNames","join","body","sound","channelId","priority","scheduleNotificationAsync","content","type","trigger","notifications","sendRiskAlertPush","mutate","userId","backendError","warn","overallRisk","_x3","_x4","_x5","_x6","_x7","initializeChatMessages","resolveAlert","updated","resolvedAlert","find","unresolvedAlerts","filter","criticalAlerts","_createContextHook2","MonitoringProvider","useMonitoring"],"sources":["MonitoringContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { Chat, Message, Alert, RiskLevel, RiskAnalysis } from '@/constants/types';\nimport { MOCK_CHATS, INITIAL_MESSAGES } from '@/constants/mockData';\nimport { HapticFeedback } from '@/constants/haptics';\nimport * as Notifications from 'expo-notifications';\nimport { Platform } from 'react-native';\nimport { useAnalytics } from './AnalyticsContext';\nimport {\n  getSoundForRiskLevel,\n  getAndroidPriorityForRiskLevel,\n  getChannelIdForRiskLevel,\n  setupNotificationChannels,\n} from '@/utils/soundNotifications';\nimport { analyzeMessageWithAI, analyzeImageWithAI } from './AIModerationService';\nimport { usePersonalizedAI } from './PersonalizedAIContext';\nimport { evaluateMessageRisk, evaluateImageRisk } from '@/utils/riskEvaluation';\nimport { chatSyncService, alertSyncService } from '@/utils/syncService';\nimport { trpcVanillaClient } from '@/lib/trpc';\nimport { useUser } from './UserContext';\nimport { logger } from '@/utils/logger';\nimport { handleErrorSilently, showUserFriendlyError } from '@/utils/errorHandler';\n\nconst LEVEL_ORDER: RiskLevel[] = ['safe', 'low', 'medium', 'high', 'critical'];\n\nconst SIMULATED_DELAY_MS = 120;\n\nconst simulateLatency = () => new Promise<void>((resolve) => setTimeout(resolve, SIMULATED_DELAY_MS));\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è merge —á–∞—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)\nconst mergeChatsWithServer = (localChats: Chat[], serverChats: Chat[]): Chat[] => {\n  const chatMap = new Map<string, Chat>();\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —á–∞—Ç—ã\n  serverChats.forEach((chat) => {\n    chatMap.set(chat.id, chat);\n  });\n\n  // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ (last-write-wins –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)\n  localChats.forEach((localChat) => {\n    const serverChat = chatMap.get(localChat.id);\n    if (!serverChat) {\n      // –ù–æ–≤—ã–π —á–∞—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞\n      chatMap.set(localChat.id, localChat);\n    } else {\n      // –ß–∞—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–æ–≤–µ—Ä—è–µ–º lastActivity\n      const localLastActivity = localChat.lastActivity || 0;\n      const serverLastActivity = serverChat.lastActivity || 0;\n\n      if (localLastActivity > serverLastActivity) {\n        // –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–π - –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è\n        const mergedMessages = mergeMessages(serverChat.messages, localChat.messages);\n        chatMap.set(localChat.id, {\n          ...localChat,\n          messages: mergedMessages,\n        });\n      } else {\n        // –°–µ—Ä–≤–µ—Ä–Ω—ã–π –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–π, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞\n        const mergedMessages = mergeMessages(serverChat.messages, localChat.messages);\n        chatMap.set(localChat.id, {\n          ...serverChat,\n          messages: mergedMessages,\n        });\n      }\n    }\n  });\n\n  return Array.from(chatMap.values());\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è merge —Å–æ–æ–±—â–µ–Ω–∏–π (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ ID)\nconst mergeMessages = (serverMessages: Message[], localMessages: Message[]): Message[] => {\n  const messageMap = new Map<string, Message>();\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n  serverMessages.forEach((msg) => {\n    messageMap.set(msg.id, msg);\n  });\n\n  // –î–æ–±–∞–≤–ª—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n  localMessages.forEach((msg) => {\n    const existing = messageMap.get(msg.id);\n    if (!existing || (msg.timestamp > existing.timestamp)) {\n      messageMap.set(msg.id, msg);\n    }\n  });\n\n  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ timestamp\n  return Array.from(messageMap.values()).sort((a, b) => a.timestamp - b.timestamp);\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è merge –∞–ª–µ—Ä—Ç–æ–≤\nconst mergeAlertsWithServer = (localAlerts: Alert[], serverAlerts: Alert[]): Alert[] => {\n  const alertMap = new Map<string, Alert>();\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã\n  serverAlerts.forEach((alert) => {\n    alertMap.set(alert.id, alert);\n  });\n\n  // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ (last-write-wins)\n  localAlerts.forEach((alert) => {\n    const existing = alertMap.get(alert.id);\n    if (!existing || (alert.timestamp > existing.timestamp)) {\n      alertMap.set(alert.id, alert);\n    }\n  });\n\n  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ timestamp (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)\n  return Array.from(alertMap.values()).sort((a, b) => b.timestamp - a.timestamp);\n};\n\nexport const [MonitoringProvider, useMonitoring] = createContextHook(() => {\n  const [chats, setChats] = useState<Chat[]>(MOCK_CHATS);\n  const [alerts, setAlerts] = useState<Alert[]>([]);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const [lastSyncTimestamp, setLastSyncTimestamp] = useState<number | null>(null);\n  const [syncError, setSyncError] = useState<Error | null>(null);\n  const isMountedRef = useRef(true);\n  const syncTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const { trackEvent } = useAnalytics();\n  const { personalizeAnalysis } = usePersonalizedAI();\n  const { user } = useUser();\n\n  // –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö\n  const syncData = useCallback(async (silent = false) => {\n    if (!isMountedRef.current || isSyncing) {\n      return;\n    }\n\n    if (!silent) {\n      setIsSyncing(true);\n    }\n    setSyncError(null);\n\n    try {\n      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏\n      await chatSyncService.initialize();\n      await alertSyncService.initialize();\n\n      // 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–∞—Ç–æ–≤ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n      const chatsResult = await chatSyncService.syncChats(chats);\n      if (chatsResult.success && chatsResult.data && chatsResult.data.length > 0) {\n        // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏\n        const mergedChats = mergeChatsWithServer(chats, chatsResult.data);\n        setChats(mergedChats);\n      }\n\n      // 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–∞—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞\n      const serverChatsResult = await chatSyncService.getChats();\n      if (serverChatsResult.success && serverChatsResult.data && serverChatsResult.data.length > 0) {\n        // Merge —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏\n        const mergedChats = mergeChatsWithServer(chats, serverChatsResult.data);\n        setChats(mergedChats);\n      }\n\n      // 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n      const alertsResult = await alertSyncService.syncAlerts(alerts);\n      if (alertsResult.success && alertsResult.data && alertsResult.data.length > 0) {\n        // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∞–ª–µ—Ä—Ç–∞–º–∏\n        const mergedAlerts = mergeAlertsWithServer(alerts, alertsResult.data);\n        setAlerts(mergedAlerts);\n      }\n\n      // 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∞–ª–µ—Ä—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞\n      const serverAlertsResult = await alertSyncService.getAlerts();\n      if (serverAlertsResult.success && serverAlertsResult.data && serverAlertsResult.data.length > 0) {\n        // Merge —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∞–ª–µ—Ä—Ç–∞–º–∏\n        const mergedAlerts = mergeAlertsWithServer(alerts, serverAlertsResult.data);\n        setAlerts(mergedAlerts);\n      }\n\n      setLastSyncTimestamp(Date.now());\n      logger.info('Sync completed successfully', { context: 'MonitoringContext' });\n    } catch (error) {\n      logger.error('Sync error occurred', error instanceof Error ? error : new Error(String(error)), { context: 'MonitoringContext', action: 'syncData' });\n      const syncErr = error instanceof Error ? error : new Error('Sync failed');\n      setSyncError(syncErr);\n      if (!silent) {\n        trackEvent('sync_failed', { error: syncErr.message });\n      }\n    } finally {\n      if (!silent) {\n        setIsSyncing(false);\n      }\n    }\n  }, [chats, alerts, isSyncing, trackEvent]);\n\n  useEffect(() => {\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è Android –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏\n    if (Platform.OS === 'android') {\n      setupNotificationChannels().catch((error) => {\n        logger.error('Failed to setup notification channels', error instanceof Error ? error : new Error(String(error)), { context: 'MonitoringContext', action: 'setupNotificationChannels' });\n      });\n    }\n\n    // –ü–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ\n    const initialSync = async () => {\n      await syncData(true); // Silent sync –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ\n    };\n\n    if (isMountedRef.current) {\n      initialSync();\n\n      // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥\n      const interval = setInterval(() => {\n        if (isMountedRef.current && !isSyncing) {\n          syncData(true); // Silent –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è\n        }\n      }, 30000);\n\n      return () => {\n        isMountedRef.current = false;\n        clearInterval(interval);\n        if (syncTimeoutRef.current) {\n          clearTimeout(syncTimeoutRef.current);\n        }\n      };\n    }\n  }, [syncData, isSyncing]);\n\n  const analyzeMessage = useCallback(async (message: Message): Promise<RiskAnalysis> => {\n    try {\n      await simulateLatency();\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π AI –∞–Ω–∞–ª–∏–∑\n      const aiAnalysis = await analyzeMessageWithAI(message.text, {\n        useAdvancedAI: true,\n        confidenceThreshold: 0.7,\n      });\n      return aiAnalysis;\n    } catch (error) {\n      handleErrorSilently(error, 'MonitoringContext', { action: 'analyzeMessage' });\n      // Fallback –Ω–∞ –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑\n      return evaluateMessageRisk(message);\n    }\n  }, []);\n\n  const analyzeImage = useCallback(async (imageUri: string): Promise<{ blocked: boolean; reasons: string[] }> => {\n    try {\n      await simulateLatency();\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π AI –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n      const aiAnalysis = await analyzeImageWithAI(imageUri, {\n        enableImageAnalysis: true,\n      });\n      return {\n        blocked: aiAnalysis.blocked,\n        reasons: aiAnalysis.reasons,\n      };\n    } catch (error) {\n      console.error('Error analyzing image:', error);\n      // Fallback –Ω–∞ –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑\n      return evaluateImageRisk(imageUri);\n    }\n  }, []);\n\n  const addMessage = useCallback(async (chatId: string, text: string, senderId: string, senderName: string, imageUri?: string) => {\n    if (!isMountedRef.current) {\n      return;\n    }\n\n    const newMessage: Message = {\n      id: `msg_${Date.now()}_${Math.random()}`,\n      text,\n      senderId,\n      senderName,\n      timestamp: Date.now(),\n      analyzed: false,\n      imageUri,\n      imageAnalyzed: false,\n      imageBlocked: false,\n    };\n\n    setChats((prev) =>\n      prev.map((chat) => {\n        if (chat.id === chatId) {\n          return {\n            ...chat,\n            messages: [...chat.messages, newMessage],\n            lastActivity: Date.now(),\n            updatedAt: Date.now(), // –î–æ–±–∞–≤–ª—è–µ–º updatedAt –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏\n          };\n        }\n        return chat;\n      })\n    );\n\n    // –¢—Ä–µ–∫–∏–Ω–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è\n    trackEvent('message_sent', { chatId, senderId, hasImage: !!imageUri });\n\n    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è (debounce 2 —Å–µ–∫—É–Ω–¥—ã)\n    if (syncTimeoutRef.current) {\n      clearTimeout(syncTimeoutRef.current);\n    }\n    syncTimeoutRef.current = setTimeout(() => {\n      syncData(true); // Silent sync\n    }, 2000);\n\n    setIsAnalyzing(true);\n\n    try {\n      let analysis = await analyzeMessage(newMessage);\n\n      // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º senderId –∫–∞–∫ childId (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)\n      // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π\n      const personalizedAnalysis = personalizeAnalysis(senderId, analysis, newMessage.text);\n      analysis = personalizedAnalysis;\n\n      if (!isMountedRef.current) {\n        return;\n      }\n\n      let imageAnalysis = { blocked: false, reasons: [] as string[] };\n      if (imageUri) {\n        imageAnalysis = await analyzeImage(imageUri);\n        if (!isMountedRef.current) {\n          return;\n        }\n      }\n\n      if (!isMountedRef.current) {\n        return;\n      }\n\n      if (analysis.riskLevel === 'critical') {\n        HapticFeedback.error();\n      } else if (analysis.riskLevel === 'high' || analysis.riskLevel === 'medium') {\n        HapticFeedback.warning();\n      } else if (analysis.riskLevel === 'safe') {\n        HapticFeedback.success();\n      }\n\n      if (!isMountedRef.current) {\n        return;\n      }\n\n      setChats((prev) =>\n        prev.map((chat) => {\n          if (chat.id === chatId) {\n            const updatedMessages = chat.messages.map((msg) =>\n              msg.id === newMessage.id\n                ? {\n                    ...msg,\n                    riskLevel: analysis.riskLevel,\n                    riskReasons: analysis.reasons,\n                    analyzed: true,\n                    imageAnalyzed: true,\n                    imageBlocked: imageAnalysis.blocked,\n                    imageRiskReasons: imageAnalysis.reasons,\n                  }\n                : msg\n            );\n\n            const levels: RiskLevel[] = ['safe', 'low', 'medium', 'high', 'critical'];\n            const highestRisk = updatedMessages.reduce((max, msg) => {\n              const msgLevel = msg.riskLevel || 'safe';\n              return levels.indexOf(msgLevel) > levels.indexOf(max) ? msgLevel : max;\n            }, 'safe' as RiskLevel);\n\n            const shouldAlert = analysis.riskLevel !== 'safe' && analysis.riskLevel !== 'low';\n            const imageRisk = imageAnalysis.blocked;\n\n            if ((shouldAlert || imageRisk) && isMountedRef.current) {\n              const newAlert: Alert = {\n                id: `alert_${Date.now()}`,\n                chatId,\n                messageId: newMessage.id,\n                riskLevel: analysis.riskLevel,\n                timestamp: Date.now(),\n                reasons: analysis.reasons,\n                resolved: false,\n              };\n              setAlerts((prevAlerts) => [newAlert, ...prevAlerts]);\n\n              // –¢—Ä–µ–∫–∏–Ω–≥ —Å–æ–∑–¥–∞–Ω–∏—è –∞–ª–µ—Ä—Ç–∞\n              trackEvent('alert_created', {\n                alertId: newAlert.id,\n                chatId,\n                riskLevel: analysis.riskLevel,\n                reasons: analysis.reasons,\n              });\n\n              // –û—Ç–ø—Ä–∞–≤–∫–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è–º\n              (async () => {\n                try {\n                  const riskLevelLabels: Record<RiskLevel, string> = {\n                    safe: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ',\n                    low: '–ù–∏–∑–∫–∏–π',\n                    medium: '–°—Ä–µ–¥–Ω–∏–π',\n                    high: '–í—ã—Å–æ–∫–∏–π',\n                    critical: '–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô',\n                  };\n\n                  const title = analysis.riskLevel === 'critical' \n                    ? 'üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω!'\n                    : `‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω ${riskLevelLabels[analysis.riskLevel]} —Ä–∏—Å–∫`;\n\n                  const chatName = chat.isGroup ? chat.groupName : chat.participantNames.join(' –∏ ');\n                  const body = `–í —á–∞—Ç–µ \"${chatName}\": ${analysis.reasons[0] || '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É–≥—Ä–æ–∑–∞'}`;\n\n                  // –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\n                  if (Platform.OS !== 'web') {\n                    const sound = getSoundForRiskLevel(analysis.riskLevel);\n                    const channelId = getChannelIdForRiskLevel(analysis.riskLevel);\n                    const priority = getAndroidPriorityForRiskLevel(analysis.riskLevel);\n\n                    await Notifications.scheduleNotificationAsync({\n                      content: {\n                        title,\n                        body,\n                        data: {\n                          type: 'risk_alert',\n                          alertId: newAlert.id,\n                          chatId,\n                          riskLevel: analysis.riskLevel,\n                        },\n                        sound,\n                        ...(Platform.OS === 'android' && channelId ? { channelId } : {}),\n                        priority,\n                      },\n                      trigger: null,\n                    });\n                  }\n\n                  // Backend –æ—Ç–ø—Ä–∞–≤–∫–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π\n                  if (user?.id && analysis.riskLevel !== 'safe') {\n                    try {\n                      await trpcVanillaClient.notifications.sendRiskAlertPush.mutate({\n                        userId: user.id,\n                        chatId,\n                        messageId: newMessage.id,\n                        riskLevel: analysis.riskLevel as 'low' | 'medium' | 'high' | 'critical',\n                        reasons: analysis.reasons,\n                        chatName,\n                      });\n                      logger.info('Push notification sent to parents via backend', { context: 'MonitoringContext', action: 'sendRiskAlertPush' });\n                    } catch (backendError) {\n                      logger.error('Failed to send push via backend (non-critical)', backendError instanceof Error ? backendError : new Error(String(backendError)), { context: 'MonitoringContext', action: 'sendRiskAlertPush', critical: false });\n                      // –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ - –ª–æ–∫–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\n                    }\n                  } else {\n                    logger.warn('Cannot send push via backend: user.id is missing', { context: 'MonitoringContext', action: 'sendRiskAlertPush' });\n                  }\n                } catch (error) {\n                  logger.error('Failed to send push notification', error instanceof Error ? error : new Error(String(error)), { context: 'MonitoringContext', action: 'sendRiskAlertPush' });\n                }\n              })();\n            }\n\n            // –¢—Ä–µ–∫–∏–Ω–≥ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è\n            trackEvent('message_analyzed', {\n              messageId: newMessage.id,\n              chatId,\n              riskLevel: analysis.riskLevel,\n              hasImage: !!imageUri,\n              imageBlocked: imageAnalysis.blocked,\n            });\n\n            return {\n              ...chat,\n              messages: updatedMessages,\n              overallRisk: highestRisk,\n            };\n          }\n          return chat;\n        })\n      );\n    } finally {\n      if (isMountedRef.current) {\n        setIsAnalyzing(false);\n      }\n    }\n  }, [analyzeMessage, analyzeImage, trackEvent, personalizeAnalysis]);\n\n  const initializeChatMessages = useCallback(() => {\n    if (!isMountedRef.current) {\n      return;\n    }\n    setChats((prev) =>\n      prev.map((chat) => ({\n        ...chat,\n        messages: INITIAL_MESSAGES[chat.id] || [],\n      }))\n    );\n  }, []);\n\n  useEffect(() => {\n    if (isMountedRef.current) {\n      initializeChatMessages();\n    }\n  }, [initializeChatMessages]);\n\n  const resolveAlert = useCallback((alertId: string) => {\n    setAlerts((prev) => {\n      const updated = prev.map((alert) =>\n        alert.id === alertId ? { ...alert, resolved: true } : alert\n      );\n      const resolvedAlert = prev.find((a) => a.id === alertId);\n      if (resolvedAlert) {\n        trackEvent('alert_resolved', {\n          alertId,\n          chatId: resolvedAlert.chatId,\n          riskLevel: resolvedAlert.riskLevel,\n        });\n      }\n      return updated;\n    });\n\n    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞–ª–µ—Ä—Ç–∞ (debounce 2 —Å–µ–∫—É–Ω–¥—ã)\n    if (syncTimeoutRef.current) {\n      clearTimeout(syncTimeoutRef.current);\n    }\n    syncTimeoutRef.current = setTimeout(() => {\n      syncData(true); // Silent sync\n    }, 2000);\n  }, [trackEvent, syncData]);\n\n  const unresolvedAlerts = useMemo(\n    () => alerts.filter((alert) => !alert.resolved),\n    [alerts]\n  );\n\n  const criticalAlerts = useMemo(\n    () => unresolvedAlerts.filter((alert) => alert.riskLevel === 'critical'),\n    [unresolvedAlerts]\n  );\n\n  return useMemo(\n    () => ({\n      chats,\n      alerts,\n      unresolvedAlerts,\n      criticalAlerts,\n      isAnalyzing,\n      isSyncing,\n      lastSyncTimestamp,\n      syncError,\n      addMessage,\n      initializeChatMessages,\n      resolveAlert,\n      syncData, // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏\n    }),\n    [\n      chats,\n      alerts,\n      unresolvedAlerts,\n      criticalAlerts,\n      isAnalyzing,\n      isSyncing,\n      lastSyncTimestamp,\n      syncError,\n      addMessage,\n      initializeChatMessages,\n      resolveAlert,\n      syncData,\n    ]\n  );\n});\n"],"mappings":"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","ignoreList":[]}