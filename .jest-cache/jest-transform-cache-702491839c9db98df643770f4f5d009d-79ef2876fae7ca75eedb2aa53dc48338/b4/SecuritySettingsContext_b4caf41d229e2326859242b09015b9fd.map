{"version":3,"names":["createContextHook","useState","useEffect","useCallback","AsyncStorage","Platform","LocalAuthentication","SECURITY_SETTINGS_STORAGE_KEY","DEFAULT_SECURITY_SETTINGS","biometricEnabled","biometricType","pinCodeEnabled","screenLockEnabled","lockTimeout","_createContextHook","_useState","_useState2","_slicedToArray","settings","setSettings","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","availableBiometrics","setAvailableBiometrics","isMounted","timer","loadSettings","_ref","_asyncToGenerator","detectedBiometric","OS","compatible","hasHardwareAsync","enrolled","isEnrolledAsync","types","supportedAuthenticationTypesAsync","includes","AuthenticationType","FACIAL_RECOGNITION","FINGERPRINT","error","console","stored","getItem","parsedSettings","JSON","parse","Object","assign","apply","arguments","setTimeout","clearTimeout","updateSettings","_ref2","updates","updatedSettings","setItem","stringify","log","_x","authenticate","_ref3","reason","result","authenticateAsync","promptMessage","cancelLabel","disableDeviceFallback","success","_x2","_createContextHook2","SecuritySettingsProvider","useSecuritySettings"],"sources":["SecuritySettingsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Platform } from 'react-native';\nimport * as LocalAuthentication from 'expo-local-authentication';\n\nexport type BiometricType = 'faceId' | 'touchId' | 'fingerprint' | 'none';\n\nexport interface SecuritySettings {\n  biometricEnabled: boolean;\n  biometricType: BiometricType;\n  pinCodeEnabled: boolean;\n  screenLockEnabled: boolean;\n  lockTimeout: number; // в минутах\n}\n\nconst SECURITY_SETTINGS_STORAGE_KEY = '@security_settings';\n\nconst DEFAULT_SECURITY_SETTINGS: SecuritySettings = {\n  biometricEnabled: false,\n  biometricType: 'none',\n  pinCodeEnabled: false,\n  screenLockEnabled: false,\n  lockTimeout: 5, // 5 минут\n};\n\nexport const [SecuritySettingsProvider, useSecuritySettings] = createContextHook(() => {\n  const [settings, setSettings] = useState<SecuritySettings>(DEFAULT_SECURITY_SETTINGS);\n  const [isLoading, setIsLoading] = useState(true);\n  const [availableBiometrics, setAvailableBiometrics] = useState<BiometricType>('none');\n\n  useEffect(() => {\n    let isMounted = true;\n    let timer: ReturnType<typeof setTimeout> | undefined;\n\n    const loadSettings = async () => {\n      try {\n        let detectedBiometric: BiometricType = 'none';\n        \n        // Проверяем доступность биометрии\n        if (Platform.OS !== 'web') {\n          try {\n            const compatible = await LocalAuthentication.hasHardwareAsync();\n            if (compatible && isMounted) {\n              const enrolled = await LocalAuthentication.isEnrolledAsync();\n              if (enrolled) {\n                const types = await LocalAuthentication.supportedAuthenticationTypesAsync();\n                if (types.includes(LocalAuthentication.AuthenticationType.FACIAL_RECOGNITION)) {\n                  detectedBiometric = 'faceId';\n                } else if (types.includes(LocalAuthentication.AuthenticationType.FINGERPRINT)) {\n                  detectedBiometric = Platform.OS === 'ios' ? 'touchId' : 'fingerprint';\n                }\n              }\n            }\n          } catch (error) {\n            console.error('[SecuritySettingsContext] Error checking biometrics:', error);\n          }\n        }\n\n        if (!isMounted) {\n          return;\n        }\n\n        setAvailableBiometrics(detectedBiometric);\n\n        // Загружаем настройки\n        const stored = await AsyncStorage.getItem(SECURITY_SETTINGS_STORAGE_KEY);\n        if (stored) {\n          const parsedSettings = JSON.parse(stored);\n          setSettings({\n            ...DEFAULT_SECURITY_SETTINGS,\n            ...parsedSettings,\n            biometricType: detectedBiometric,\n          });\n        } else {\n          setSettings({\n            ...DEFAULT_SECURITY_SETTINGS,\n            biometricType: detectedBiometric,\n          });\n        }\n      } catch (error) {\n        console.error('[SecuritySettingsContext] Error loading settings:', error);\n      } finally {\n        if (isMounted) {\n          setIsLoading(false);\n        }\n      }\n    };\n\n    if (Platform.OS !== 'web') {\n      loadSettings();\n    } else {\n      timer = setTimeout(loadSettings, 0);\n    }\n\n    return () => {\n      isMounted = false;\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, []);\n\n  const updateSettings = useCallback(async (updates: Partial<SecuritySettings>) => {\n    try {\n      const updatedSettings = { ...settings, ...updates };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SECURITY_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n      console.log('[SecuritySettingsContext] Settings updated:', updates);\n    } catch (error) {\n      console.error('[SecuritySettingsContext] Error updating settings:', error);\n    }\n  }, [settings]);\n\n  const authenticate = useCallback(async (reason?: string): Promise<boolean> => {\n    if (!settings.biometricEnabled || availableBiometrics === 'none') {\n      return false;\n    }\n\n    try {\n      const result = await LocalAuthentication.authenticateAsync({\n        promptMessage: reason || 'Подтвердите вашу личность',\n        cancelLabel: 'Отмена',\n        disableDeviceFallback: false,\n      });\n\n      return result.success;\n    } catch (error) {\n      console.error('[SecuritySettingsContext] Authentication error:', error);\n      return false;\n    }\n  }, [settings.biometricEnabled, availableBiometrics]);\n\n  return {\n    settings,\n    isLoading,\n    availableBiometrics,\n    updateSettings,\n    authenticate,\n  };\n});\n"],"mappings":"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","ignoreList":[]}