{"version":3,"names":["isTrialExpired","status","currentTime","cov_vmww96yq","f","s","tier","b","trialEndDate","isSubscriptionExpired","subscriptionEndDate","checkSubscriptionStatus","newStatus","Object","assign","features","advancedAnalytics","extendedHistory","multipleChildren","prioritySupport","customAlerts","exportData","aiRecommendations","undefined","updated","subscriptionId","subscriptionStartDate"],"sources":["premiumStatus.ts"],"sourcesContent":["/**\n * Чистые детерминированные функции для проверки статуса premium подписки\n * Вынесено из PremiumContext для модульного тестирования\n */\n\nimport { PremiumStatus, PremiumTier } from '@/constants/PremiumContext';\n\n/**\n * Проверяет, истекла ли trial подписка\n * Чистая детерминированная функция\n */\nexport function isTrialExpired(status: PremiumStatus, currentTime: number): boolean {\n  if (status.tier !== 'trial') return false;\n  if (!status.trialEndDate) return false;\n  return currentTime > status.trialEndDate;\n}\n\n/**\n * Проверяет, истекла ли premium подписка\n * Чистая детерминированная функция\n */\nexport function isSubscriptionExpired(status: PremiumStatus, currentTime: number): boolean {\n  if (status.tier !== 'premium') return false;\n  if (!status.subscriptionEndDate) return false;\n  return currentTime > status.subscriptionEndDate;\n}\n\n/**\n * Проверяет статус подписки и возвращает обновленный статус если нужно\n * Чистая детерминированная функция\n */\nexport function checkSubscriptionStatus(\n  status: PremiumStatus,\n  currentTime: number\n): { updated: boolean; newStatus: PremiumStatus } {\n  const newStatus = { ...status };\n\n  // Проверка trial\n  if (status.tier === 'trial' && status.trialEndDate) {\n    if (currentTime > status.trialEndDate) {\n      // Trial истек\n      newStatus.tier = 'free';\n      newStatus.features = {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      };\n      newStatus.trialEndDate = undefined;\n      return { updated: true, newStatus };\n    }\n  }\n\n  // Проверка subscription\n  if (status.tier === 'premium' && status.subscriptionEndDate) {\n    if (currentTime > status.subscriptionEndDate) {\n      // Подписка истекла\n      newStatus.tier = 'free';\n      newStatus.features = {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      };\n      newStatus.subscriptionId = undefined;\n      newStatus.subscriptionStartDate = undefined;\n      newStatus.subscriptionEndDate = undefined;\n      return { updated: true, newStatus };\n    }\n  }\n\n  return { updated: false, newStatus: status };\n}\n"],"mappings":"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","ignoreList":[]}