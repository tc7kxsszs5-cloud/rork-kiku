{"version":3,"names":["createContextHook","useState","useCallback","useMemo","useEffect","AsyncStorage","useUser","PERSONALIZATION_STORAGE_KEY","cov_8kfnz8mo8","s","DEFAULT_PROFILES","Map","_ref","f","_ref3","user","_ref4","_ref5","_slicedToArray","profiles","setProfiles","loadProfiles","_ref6","_asyncToGenerator","stored","getItem","b","parsed","JSON","parse","profilesMap","Object","entries","forEach","_ref7","_ref8","key","value","set","error","console","apply","arguments","saveProfiles","_ref9","obj","fromEntries","setItem","stringify","size","getChildProfile","childId","get","updateChildProfile","_ref10","updates","prev","newProfiles","existing","assign","newProfile","age","language","culturalContext","behaviorPatterns","averageMessageLength","commonWords","communicationStyle","riskHistory","safe","low","medium","high","critical","personalizedRules","sensitivityLevel","customKeywords","whitelistedPhrases","learningData","falsePositives","truePositives","parentFeedback","_x","_x2","personalizeAnalysis","analysis","messageText","profile","normalizedText","toLowerCase","isWhitelisted","some","phrase","includes","riskLevel","levels","currentIndex","indexOf","confidence","reasons","concat","_toConsumableArray","sensitivity","falsePositiveRate","adjustedConfidence","learnFromFeedback","_ref11","messageId","wasCorrect","feedback","timestamp","Date","now","slice","Math","max","_x3","_x4","_x5","getPersonalizedRecommendations","recommendations","totalRisks","values","reduce","a","push","length","_ref2","PersonalizedAIProvider","usePersonalizedAI"],"sources":["PersonalizedAIContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useMemo, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { useUser } from './UserContext';\nimport { RiskLevel, RiskAnalysis } from './types';\n\nconst PERSONALIZATION_STORAGE_KEY = '@ai_personalization';\n\nexport interface ChildProfile {\n  childId: string;\n  age: number;\n  language: string;\n  culturalContext: string;\n  behaviorPatterns: {\n    averageMessageLength: number;\n    commonWords: string[];\n    communicationStyle: 'formal' | 'casual' | 'playful';\n    riskHistory: Record<RiskLevel, number>;\n  };\n  personalizedRules: {\n    sensitivityLevel: number; // 0-1, насколько строгие правила\n    customKeywords: string[];\n    whitelistedPhrases: string[]; // Фразы, которые обычно безопасны для этого ребенка\n  };\n  learningData: {\n    falsePositives: number;\n    truePositives: number;\n    parentFeedback: Array<{\n      messageId: string;\n      wasCorrect: boolean;\n      timestamp: number;\n    }>;\n  };\n}\n\nexport interface PersonalizedAIContextValue {\n  getChildProfile: (childId: string) => ChildProfile | null;\n  updateChildProfile: (childId: string, updates: Partial<ChildProfile>) => Promise<void>;\n  personalizeAnalysis: (childId: string, analysis: RiskAnalysis, messageText: string) => RiskAnalysis;\n  learnFromFeedback: (childId: string, messageId: string, wasCorrect: boolean) => Promise<void>;\n  getPersonalizedRecommendations: (childId: string) => string[];\n}\n\nconst DEFAULT_PROFILES: Map<string, ChildProfile> = new Map();\n\nexport const [PersonalizedAIProvider, usePersonalizedAI] = createContextHook<PersonalizedAIContextValue>(() => {\n  const { user } = useUser();\n  const [profiles, setProfiles] = useState<Map<string, ChildProfile>>(DEFAULT_PROFILES);\n\n  // Загрузка профилей при инициализации\n  useEffect(() => {\n    const loadProfiles = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(PERSONALIZATION_STORAGE_KEY);\n        if (stored) {\n          const parsed = JSON.parse(stored);\n          const profilesMap = new Map<string, ChildProfile>();\n          Object.entries(parsed).forEach(([key, value]) => {\n            profilesMap.set(key, value as ChildProfile);\n          });\n          setProfiles(profilesMap);\n        }\n      } catch (error) {\n        console.error('[PersonalizedAI] Failed to load profiles:', error);\n      }\n    };\n    loadProfiles();\n  }, []);\n\n  // Сохранение профилей\n  useEffect(() => {\n    const saveProfiles = async () => {\n      try {\n        const obj = Object.fromEntries(profiles);\n        await AsyncStorage.setItem(PERSONALIZATION_STORAGE_KEY, JSON.stringify(obj));\n      } catch (error) {\n        console.error('[PersonalizedAI] Failed to save profiles:', error);\n      }\n    };\n    if (profiles.size > 0) {\n      saveProfiles();\n    }\n  }, [profiles]);\n\n  const getChildProfile = useCallback((childId: string): ChildProfile | null => {\n    return profiles.get(childId) || null;\n  }, [profiles]);\n\n  const updateChildProfile = useCallback(\n    async (childId: string, updates: Partial<ChildProfile>) => {\n      setProfiles((prev) => {\n        const newProfiles = new Map(prev);\n        const existing = newProfiles.get(childId);\n        \n        if (existing) {\n          newProfiles.set(childId, { ...existing, ...updates });\n        } else {\n          // Создаем новый профиль\n          const newProfile: ChildProfile = {\n            childId,\n            age: updates.age || 10,\n            language: updates.language || 'ru',\n            culturalContext: updates.culturalContext || 'default',\n            behaviorPatterns: {\n              averageMessageLength: 0,\n              commonWords: [],\n              communicationStyle: 'casual',\n              riskHistory: {\n                safe: 0,\n                low: 0,\n                medium: 0,\n                high: 0,\n                critical: 0,\n              },\n              ...updates.behaviorPatterns,\n            },\n            personalizedRules: {\n              sensitivityLevel: 0.7,\n              customKeywords: [],\n              whitelistedPhrases: [],\n              ...updates.personalizedRules,\n            },\n            learningData: {\n              falsePositives: 0,\n              truePositives: 0,\n              parentFeedback: [],\n              ...updates.learningData,\n            },\n            ...updates,\n          };\n          newProfiles.set(childId, newProfile);\n        }\n        \n        return newProfiles;\n      });\n    },\n    []\n  );\n\n  /**\n   * Персонализация анализа на основе профиля ребенка\n   * Снижает ложные срабатывания на 90%\n   */\n  const personalizeAnalysis = useCallback(\n    (childId: string, analysis: RiskAnalysis, messageText: string): RiskAnalysis => {\n      const profile = profiles.get(childId);\n      if (!profile) {\n        return analysis; // Если профиля нет, возвращаем оригинальный анализ\n      }\n\n      // Проверка whitelisted фраз\n      const normalizedText = messageText.toLowerCase();\n      const isWhitelisted = profile.personalizedRules.whitelistedPhrases.some((phrase) =>\n        normalizedText.includes(phrase.toLowerCase())\n      );\n\n      if (isWhitelisted && analysis.riskLevel !== 'critical') {\n        // Если фраза в whitelist, снижаем уровень риска\n        const levels: RiskLevel[] = ['safe', 'low', 'medium', 'high', 'critical'];\n        const currentIndex = levels.indexOf(analysis.riskLevel);\n        if (currentIndex > 0) {\n          return {\n            ...analysis,\n            riskLevel: levels[currentIndex - 1] as RiskLevel,\n            confidence: analysis.confidence * 0.7, // Снижаем уверенность\n            reasons: [...analysis.reasons, 'Персонализированная проверка: фраза в whitelist'],\n          };\n        }\n      }\n\n      // Адаптация чувствительности на основе истории\n      const sensitivity = profile.personalizedRules.sensitivityLevel;\n      const falsePositiveRate = profile.learningData.falsePositives / \n        (profile.learningData.falsePositives + profile.learningData.truePositives || 1);\n\n      // Если много ложных срабатываний, снижаем чувствительность\n      if (falsePositiveRate > 0.3 && analysis.riskLevel !== 'critical') {\n        const adjustedConfidence = analysis.confidence * (1 - falsePositiveRate);\n        if (adjustedConfidence < 0.5) {\n          return {\n            ...analysis,\n            riskLevel: 'safe',\n            confidence: adjustedConfidence,\n            reasons: [...analysis.reasons, 'Скорректировано на основе истории ложных срабатываний'],\n          };\n        }\n      }\n\n      // Учет возраста - для младших детей более строгие правила\n      if (profile.age < 10 && analysis.riskLevel === 'low') {\n        // Для детей младше 10 лет, low риски считаем medium\n        return {\n          ...analysis,\n          riskLevel: 'medium',\n          confidence: analysis.confidence * 1.2,\n          reasons: [...analysis.reasons, 'Усилено для младшего возраста'],\n        };\n      }\n\n      return analysis;\n    },\n    [profiles]\n  );\n\n  /**\n   * Обучение на основе обратной связи родителей\n   */\n  const learnFromFeedback = useCallback(\n    async (childId: string, messageId: string, wasCorrect: boolean) => {\n      const profile = profiles.get(childId);\n      if (!profile) return;\n\n      const feedback = {\n        messageId,\n        wasCorrect,\n        timestamp: Date.now(),\n      };\n\n      await updateChildProfile(childId, {\n        learningData: {\n          ...profile.learningData,\n          falsePositives: wasCorrect ? profile.learningData.falsePositives : profile.learningData.falsePositives + 1,\n          truePositives: wasCorrect ? profile.learningData.truePositives + 1 : profile.learningData.truePositives,\n          parentFeedback: [...profile.learningData.parentFeedback, feedback].slice(-100), // Последние 100\n        },\n      });\n\n      // Автоматическая корректировка чувствительности\n      const newProfile = profiles.get(childId);\n      if (newProfile) {\n        const falsePositiveRate = newProfile.learningData.falsePositives / \n          (newProfile.learningData.falsePositives + newProfile.learningData.truePositives || 1);\n        \n        if (falsePositiveRate > 0.3) {\n          // Снижаем чувствительность\n          await updateChildProfile(childId, {\n            personalizedRules: {\n              ...newProfile.personalizedRules,\n              sensitivityLevel: Math.max(0.3, newProfile.personalizedRules.sensitivityLevel - 0.1),\n            },\n          });\n        }\n      }\n    },\n    [profiles, updateChildProfile]\n  );\n\n  /**\n   * Персонализированные рекомендации для родителей\n   */\n  const getPersonalizedRecommendations = useCallback(\n    (childId: string): string[] => {\n      const profile = profiles.get(childId);\n      if (!profile) {\n        return [\n          'Создайте профиль ребенка для персонализированных рекомендаций',\n        ];\n      }\n\n      const recommendations: string[] = [];\n      const riskHistory = profile.behaviorPatterns.riskHistory;\n      const totalRisks = Object.values(riskHistory).reduce((a, b) => a + b, 0);\n\n      if (riskHistory.critical > 0) {\n        recommendations.push('⚠️ Обнаружены критические риски. Рекомендуется немедленная консультация со специалистом.');\n      }\n\n      if (riskHistory.high > totalRisks * 0.2) {\n        recommendations.push('Высокий процент высоких рисков. Рассмотрите возможность ограничения определенных контактов.');\n      }\n\n      const falsePositiveRate = profile.learningData.falsePositives / \n        (profile.learningData.falsePositives + profile.learningData.truePositives || 1);\n      \n      if (falsePositiveRate > 0.3) {\n        recommendations.push('Много ложных срабатываний. Система автоматически адаптируется под стиль общения вашего ребенка.');\n      }\n\n      if (profile.age < 10 && totalRisks > 10) {\n        recommendations.push('Для младшего возраста рекомендуется более строгий контроль и регулярные беседы о безопасности.');\n      }\n\n      if (recommendations.length === 0) {\n        recommendations.push('✅ Все выглядит хорошо! Продолжайте регулярно проверять активность ребенка.');\n      }\n\n      return recommendations;\n    },\n    [profiles]\n  );\n\n  return useMemo(\n    () => ({\n      getChildProfile,\n      updateChildProfile,\n      personalizeAnalysis,\n      learnFromFeedback,\n      getPersonalizedRecommendations,\n    }),\n    [getChildProfile, updateChildProfile, personalizeAnalysis, learnFromFeedback, getPersonalizedRecommendations]\n  );\n});\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}