75415617912edc75ade249e7f73f67af
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolveUri = resolveUri;
exports.selectAssetSource = selectAssetSource;
var _expoModulesCore = require("expo-modules-core");
var _reactNative = require("react-native");
var _AssetSourceResolver = _interopRequireDefault(require("./AssetSourceResolver"));
var _PlatformUtils = require("./PlatformUtils");
function selectAssetSource(meta) {
  var _meta$fileHashes$inde, _meta$fileUris$index, _manifest2$extra;
  var scale = _AssetSourceResolver.default.pickScale(meta.scales, _reactNative.PixelRatio.get());
  var index = meta.scales.findIndex(function (s) {
    return s === scale;
  });
  var hash = meta.fileHashes ? (_meta$fileHashes$inde = meta.fileHashes[index]) != null ? _meta$fileHashes$inde : meta.fileHashes[0] : meta.hash;
  var uri = meta.fileUris ? (_meta$fileUris$index = meta.fileUris[index]) != null ? _meta$fileUris$index : meta.fileUris[0] : meta.uri;
  if (uri) {
    return {
      uri: resolveUri(uri),
      hash: hash
    };
  }
  var fileScale = scale === 1 ? '' : `@${scale}x`;
  var fileExtension = meta.type ? `.${encodeURIComponent(meta.type)}` : '';
  var suffix = `/${encodeURIComponent(meta.name)}${fileScale}${fileExtension}`;
  var params = new URLSearchParams({
    platform: _expoModulesCore.Platform.OS,
    hash: meta.hash
  });
  if (/^https?:\/\//.test(meta.httpServerLocation)) {
    var _uri = meta.httpServerLocation + suffix + '?' + params;
    return {
      uri: _uri,
      hash: hash
    };
  }
  var manifest2 = (0, _PlatformUtils.getManifest2)();
  var devServerUrl = manifest2 != null && (_manifest2$extra = manifest2.extra) != null && (_manifest2$extra = _manifest2$extra.expoGo) != null && _manifest2$extra.developer ? 'http://' + manifest2.extra.expoGo.debuggerHost : null;
  if (devServerUrl) {
    var baseUrl = new URL(meta.httpServerLocation + suffix, devServerUrl);
    baseUrl.searchParams.set('platform', _expoModulesCore.Platform.OS);
    baseUrl.searchParams.set('hash', meta.hash);
    return {
      uri: baseUrl.href,
      hash: hash
    };
  }
  if (_reactNative.NativeModules['ExponentKernel']) {
    return {
      uri: `https://classic-assets.eascdn.net/~assets/${encodeURIComponent(hash)}`,
      hash: hash
    };
  }
  return {
    uri: '',
    hash: hash
  };
}
function resolveUri(uri) {
  return _PlatformUtils.manifestBaseUrl ? new URL(uri, _PlatformUtils.manifestBaseUrl).href : uri;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwb01vZHVsZXNDb3JlIiwicmVxdWlyZSIsIl9yZWFjdE5hdGl2ZSIsIl9Bc3NldFNvdXJjZVJlc29sdmVyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9QbGF0Zm9ybVV0aWxzIiwic2VsZWN0QXNzZXRTb3VyY2UiLCJtZXRhIiwiX21ldGEkZmlsZUhhc2hlcyRpbmRlIiwiX21ldGEkZmlsZVVyaXMkaW5kZXgiLCJfbWFuaWZlc3QyJGV4dHJhIiwic2NhbGUiLCJBc3NldFNvdXJjZVJlc29sdmVyIiwicGlja1NjYWxlIiwic2NhbGVzIiwiUGl4ZWxSYXRpbyIsImdldCIsImluZGV4IiwiZmluZEluZGV4IiwicyIsImhhc2giLCJmaWxlSGFzaGVzIiwidXJpIiwiZmlsZVVyaXMiLCJyZXNvbHZlVXJpIiwiZmlsZVNjYWxlIiwiZmlsZUV4dGVuc2lvbiIsInR5cGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJzdWZmaXgiLCJuYW1lIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwicGxhdGZvcm0iLCJQbGF0Zm9ybSIsIk9TIiwidGVzdCIsImh0dHBTZXJ2ZXJMb2NhdGlvbiIsIm1hbmlmZXN0MiIsImdldE1hbmlmZXN0MiIsImRldlNlcnZlclVybCIsImV4dHJhIiwiZXhwb0dvIiwiZGV2ZWxvcGVyIiwiZGVidWdnZXJIb3N0IiwiYmFzZVVybCIsIlVSTCIsInNlYXJjaFBhcmFtcyIsInNldCIsImhyZWYiLCJOYXRpdmVNb2R1bGVzIiwibWFuaWZlc3RCYXNlVXJsIl0sInNvdXJjZXMiOlsiLi4vc3JjL0Fzc2V0U291cmNlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFBhY2thZ2VyQXNzZXQgfSBmcm9tICdAcmVhY3QtbmF0aXZlL2Fzc2V0cy1yZWdpc3RyeS9yZWdpc3RyeSc7XG5pbXBvcnQgeyBQbGF0Zm9ybSB9IGZyb20gJ2V4cG8tbW9kdWxlcy1jb3JlJztcbmltcG9ydCB7IFBpeGVsUmF0aW8sIE5hdGl2ZU1vZHVsZXMgfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG5pbXBvcnQgQXNzZXRTb3VyY2VSZXNvbHZlciBmcm9tICcuL0Fzc2V0U291cmNlUmVzb2x2ZXInO1xuaW1wb3J0IHsgZ2V0TWFuaWZlc3QyLCBtYW5pZmVzdEJhc2VVcmwgfSBmcm9tICcuL1BsYXRmb3JtVXRpbHMnO1xuXG4vLyBAZG9jc01pc3NpbmdcbmV4cG9ydCB0eXBlIEFzc2V0TWV0YWRhdGEgPSBQaWNrPFxuICBQYWNrYWdlckFzc2V0LFxuICAnaHR0cFNlcnZlckxvY2F0aW9uJyB8ICduYW1lJyB8ICdoYXNoJyB8ICd0eXBlJyB8ICdzY2FsZXMnIHwgJ3dpZHRoJyB8ICdoZWlnaHQnXG4+ICYge1xuICB1cmk/OiBzdHJpbmc7XG4gIGZpbGVIYXNoZXM/OiBzdHJpbmdbXTtcbiAgZmlsZVVyaXM/OiBzdHJpbmdbXTtcbn07XG5cbmV4cG9ydCB0eXBlIEFzc2V0U291cmNlID0ge1xuICB1cmk6IHN0cmluZztcbiAgaGFzaDogc3RyaW5nO1xufTtcblxuLyoqXG4gKiBTZWxlY3RzIHRoZSBiZXN0IGZpbGUgZm9yIHRoZSBnaXZlbiBhc3NldCAoZXg6IGNob29zaW5nIHRoZSBiZXN0IHNjYWxlIGZvciBpbWFnZXMpIGFuZCByZXR1cm5zXG4gKiBhIHsgdXJpLCBoYXNoIH0gcGFpciBmb3IgdGhlIHNwZWNpZmljIGFzc2V0IGZpbGUuXG4gKlxuICogSWYgdGhlIGFzc2V0IGlzbid0IGFuIGltYWdlIHdpdGggbXVsdGlwbGUgc2NhbGVzLCB0aGUgZmlyc3QgZmlsZSBpcyBzZWxlY3RlZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNlbGVjdEFzc2V0U291cmNlKG1ldGE6IEFzc2V0TWV0YWRhdGEpOiBBc3NldFNvdXJjZSB7XG4gIC8vIFRoaXMgbG9naWMgaXMgYmFzZWQgb24gdGhhdCBvZiBBc3NldFNvdXJjZVJlc29sdmVyLCB3aXRoIGFkZGl0aW9uYWwgc3VwcG9ydCBmb3IgZmlsZSBoYXNoZXMgYW5kXG4gIC8vIGV4cGxpY2l0bHkgcHJvdmlkZWQgVVJJc1xuICBjb25zdCBzY2FsZSA9IEFzc2V0U291cmNlUmVzb2x2ZXIucGlja1NjYWxlKG1ldGEuc2NhbGVzLCBQaXhlbFJhdGlvLmdldCgpKTtcbiAgY29uc3QgaW5kZXggPSBtZXRhLnNjYWxlcy5maW5kSW5kZXgoKHMpID0+IHMgPT09IHNjYWxlKTtcbiAgY29uc3QgaGFzaCA9IG1ldGEuZmlsZUhhc2hlcyA/IChtZXRhLmZpbGVIYXNoZXNbaW5kZXhdID8/IG1ldGEuZmlsZUhhc2hlc1swXSkgOiBtZXRhLmhhc2g7XG5cbiAgLy8gQWxsb3cgYXNzZXQgcHJvY2Vzc29ycyB0byBkaXJlY3RseSBwcm92aWRlIHRoZSBVUkwgdG8gbG9hZFxuICBjb25zdCB1cmkgPSBtZXRhLmZpbGVVcmlzID8gKG1ldGEuZmlsZVVyaXNbaW5kZXhdID8/IG1ldGEuZmlsZVVyaXNbMF0pIDogbWV0YS51cmk7XG4gIGlmICh1cmkpIHtcbiAgICByZXR1cm4geyB1cmk6IHJlc29sdmVVcmkodXJpKSwgaGFzaCB9O1xuICB9XG5cbiAgY29uc3QgZmlsZVNjYWxlID0gc2NhbGUgPT09IDEgPyAnJyA6IGBAJHtzY2FsZX14YDtcbiAgY29uc3QgZmlsZUV4dGVuc2lvbiA9IG1ldGEudHlwZSA/IGAuJHtlbmNvZGVVUklDb21wb25lbnQobWV0YS50eXBlKX1gIDogJyc7XG4gIGNvbnN0IHN1ZmZpeCA9IGAvJHtlbmNvZGVVUklDb21wb25lbnQobWV0YS5uYW1lKX0ke2ZpbGVTY2FsZX0ke2ZpbGVFeHRlbnNpb259YDtcbiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgcGxhdGZvcm06IFBsYXRmb3JtLk9TLFxuICAgIGhhc2g6IG1ldGEuaGFzaCxcbiAgfSk7XG5cbiAgLy8gRm9yIGFzc2V0cyB3aXRoIGEgc3BlY2lmaWVkIGFic29sdXRlIFVSTCwgd2UgdXNlIHRoZSBleGlzdGluZyBvcmlnaW4gaW5zdGVhZCBvZiBwcmVwZW5kaW5nIHRoZVxuICAvLyBkZXZlbG9wbWVudCBzZXJ2ZXIgb3IgcHJvZHVjdGlvbiBDRE4gVVJMIG9yaWdpblxuICBpZiAoL15odHRwcz86XFwvXFwvLy50ZXN0KG1ldGEuaHR0cFNlcnZlckxvY2F0aW9uKSkge1xuICAgIGNvbnN0IHVyaSA9IG1ldGEuaHR0cFNlcnZlckxvY2F0aW9uICsgc3VmZml4ICsgJz8nICsgcGFyYW1zO1xuICAgIHJldHVybiB7IHVyaSwgaGFzaCB9O1xuICB9XG5cbiAgLy8gRm9yIGFzc2V0cyBkdXJpbmcgZGV2ZWxvcG1lbnQgdXNpbmcgbWFuaWZlc3QyLCB3ZSB1c2UgdGhlIGRldmVsb3BtZW50IHNlcnZlcidzIFVSTCBvcmlnaW5cbiAgY29uc3QgbWFuaWZlc3QyID0gZ2V0TWFuaWZlc3QyKCk7XG5cbiAgY29uc3QgZGV2U2VydmVyVXJsID0gbWFuaWZlc3QyPy5leHRyYT8uZXhwb0dvPy5kZXZlbG9wZXJcbiAgICA/ICdodHRwOi8vJyArIG1hbmlmZXN0Mi5leHRyYS5leHBvR28uZGVidWdnZXJIb3N0XG4gICAgOiBudWxsO1xuICBpZiAoZGV2U2VydmVyVXJsKSB7XG4gICAgY29uc3QgYmFzZVVybCA9IG5ldyBVUkwobWV0YS5odHRwU2VydmVyTG9jYXRpb24gKyBzdWZmaXgsIGRldlNlcnZlclVybCk7XG5cbiAgICBiYXNlVXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3BsYXRmb3JtJywgUGxhdGZvcm0uT1MpO1xuICAgIGJhc2VVcmwuc2VhcmNoUGFyYW1zLnNldCgnaGFzaCcsIG1ldGEuaGFzaCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVyaTogYmFzZVVybC5ocmVmLFxuICAgICAgaGFzaCxcbiAgICB9O1xuICB9XG5cbiAgLy8gVGVtcG9yYXJ5IGZhbGxiYWNrIGZvciBsb2FkaW5nIGFzc2V0cyBpbiBFeHBvIEdvIGhvbWVcbiAgaWYgKE5hdGl2ZU1vZHVsZXNbJ0V4cG9uZW50S2VybmVsJ10pIHtcbiAgICByZXR1cm4geyB1cmk6IGBodHRwczovL2NsYXNzaWMtYXNzZXRzLmVhc2Nkbi5uZXQvfmFzc2V0cy8ke2VuY29kZVVSSUNvbXBvbmVudChoYXNoKX1gLCBoYXNoIH07XG4gIH1cblxuICAvLyBJbiBjb3JyZWN0bHkgY29uZmlndXJlZCBhcHBzLCB3ZSBhcnJpdmUgaGVyZSBpZiB0aGUgYXNzZXQgaXMgbG9jYWxseSBhdmFpbGFibGUgb24gZGlzayBkdWUgdG9cbiAgLy8gYmVpbmcgbWFuYWdlZCBieSBleHBvLXVwZGF0ZXMsIGFuZCBgZ2V0TG9jYWxBc3NldFVyaShoYXNoKWAgbXVzdCByZXR1cm4gYSBsb2NhbCBVUkkgZm9yIHRoaXNcbiAgLy8gaGFzaC4gU2luY2UgdGhlIGFzc2V0IGlzIGxvY2FsLCB3ZSBkb24ndCBoYXZlIGEgcmVtb3RlIFVSTCBhbmQgc3BlY2lmeSBhbiBpbnZhbGlkIFVSTCAoYW4gZW1wdHlcbiAgLy8gc3RyaW5nKSBhcyBhIHBsYWNlaG9sZGVyLlxuICByZXR1cm4geyB1cmk6ICcnLCBoYXNoIH07XG59XG5cbi8qKlxuICogUmVzb2x2ZXMgdGhlIGdpdmVuIFVSSSB0byBhbiBhYnNvbHV0ZSBVUkkuIElmIHRoZSBnaXZlbiBVUkkgaXMgYWxyZWFkeSBhbiBhYnNvbHV0ZSBVUkksIGl0IGlzXG4gKiBzaW1wbHkgcmV0dXJuZWQuIE90aGVyd2lzZSwgaWYgaXQgaXMgYSByZWxhdGl2ZSBVUkksIGl0IGlzIHJlc29sdmVkIHJlbGF0aXZlIHRvIHRoZSBtYW5pZmVzdCdzXG4gKiBiYXNlIFVSSS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVVcmkodXJpOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBgbWFuaWZlc3RCYXNlVXJsYCBpcyBhbHdheXMgYW4gYWJzb2x1dGUgVVJMIG9yIGBudWxsYC5cbiAgcmV0dXJuIG1hbmlmZXN0QmFzZVVybCA/IG5ldyBVUkwodXJpLCBtYW5pZmVzdEJhc2VVcmwpLmhyZWYgOiB1cmk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQUFBLGdCQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxZQUFBLEdBQUFELE9BQUE7QUFFQSxJQUFBRSxvQkFB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