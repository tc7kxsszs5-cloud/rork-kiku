{"version":3,"names":["_createContextHook3","_interopRequireDefault","require","_react","_asyncStorage","SecureStore","_interopRequireWildcard","_logger","AUTH_STORAGE_KEY","PIN_STORAGE_KEY","_createContextHook","createContextHook","_useState","useState","isAuthenticated","_useState2","_slicedToArray2","default","authState","setAuthState","useEffect","loadAuthState","_ref","_asyncToGenerator2","stored","AsyncStorage","getItem","state","JSON","parse","error","logger","Error","String","context","action","apply","arguments","login","useCallback","_ref2","userId","role","pin","newState","setItem","stringify","setItemAsync","console","_x","_x2","_x3","logout","removeItem","deleteItemAsync","verifyPin","_ref4","storedPin","getItemAsync","_x4","createChildProfile","_ref5","profile","info","childName","name","id","Date","now","_x5","switchToChildMode","_ref6","childId","_x6","canChangeChatBackgrounds","Object","assign","_createContextHook2","AuthProvider","exports","useAuth"],"sources":["AuthContext.tsx"],"sourcesContent":["/**\n * Auth Context\n * Manages authentication state\n */\n\nimport createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport * as SecureStore from 'expo-secure-store';\nimport { logger } from '@/utils/logger';\n\nexport interface AuthState {\n  isAuthenticated: boolean;\n  userId?: string;\n  role?: 'parent' | 'child';\n}\n\nconst AUTH_STORAGE_KEY = '@auth_state';\nconst PIN_STORAGE_KEY = '@auth_pin';\n\nexport const [AuthProvider, useAuth] = createContextHook(() => {\n  const [authState, setAuthState] = useState<AuthState>({\n    isAuthenticated: false,\n  });\n\n  useEffect(() => {\n    const loadAuthState = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n        if (stored) {\n          const state = JSON.parse(stored);\n          setAuthState(state);\n        }\n      } catch (error) {\n        logger.error('Failed to load auth state', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'loadAuthState' });\n      }\n    };\n\n    loadAuthState();\n  }, []);\n\n  const login = useCallback(async (userId: string, role: 'parent' | 'child', pin?: string) => {\n    const newState: AuthState = {\n      isAuthenticated: true,\n      userId,\n      role,\n    };\n\n    setAuthState(newState);\n\n    try {\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(newState));\n      if (pin) {\n        await SecureStore.setItemAsync(PIN_STORAGE_KEY, pin);\n      }\n    } catch (error) {\n      console.error('[AuthContext] Failed to save auth state:', error);\n    }\n  }, []);\n\n  const logout = useCallback(async () => {\n    setAuthState({\n      isAuthenticated: false,\n    });\n\n    try {\n      await AsyncStorage.removeItem(AUTH_STORAGE_KEY);\n      await SecureStore.deleteItemAsync(PIN_STORAGE_KEY);\n    } catch (error) {\n      logger.error('Failed to clear auth state', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'logout' });\n    }\n  }, []);\n\n  const verifyPin = useCallback(async (pin: string): Promise<boolean> => {\n    try {\n      const storedPin = await SecureStore.getItemAsync(PIN_STORAGE_KEY);\n      return storedPin === pin;\n    } catch (error) {\n      logger.error('Failed to verify PIN', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'verifyPin' });\n      return false;\n    }\n  }, []);\n\n  const createChildProfile = useCallback(async (profile: { name: string; permissions?: any }) => {\n    // Создание профиля ребенка\n    // В реальном приложении здесь будет логика создания профиля\n    logger.info('Creating child profile', { context: 'AuthContext', action: 'createChildProfile', childName: profile.name });\n    return { id: `child_${Date.now()}`, name: profile.name };\n  }, []);\n\n  const switchToChildMode = useCallback(async (childId: string): Promise<boolean> => {\n    if (authState.role === 'parent') {\n      await login(childId, 'child');\n      return true;\n    }\n    return false;\n  }, [authState.role, login]);\n\n  const canChangeChatBackgrounds = useCallback((): boolean => {\n    // Родители могут менять фоны чатов\n    return authState.role === 'parent' && authState.isAuthenticated;\n  }, [authState.role, authState.isAuthenticated]);\n\n  return {\n    ...authState,\n    login,\n    logout,\n    verifyPin,\n    createChildProfile,\n    switchToChildMode,\n    canChangeChatBackgrounds,\n  };\n});\n"],"mappings":"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","ignoreList":[]}