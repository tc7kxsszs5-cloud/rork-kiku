{"version":3,"names":["createContextHook","useState","useCallback","useEffect","AsyncStorage","SecureStore","logger","AUTH_STORAGE_KEY","PIN_STORAGE_KEY","_createContextHook","_useState","isAuthenticated","_useState2","_slicedToArray","authState","setAuthState","loadAuthState","_ref","_asyncToGenerator","stored","getItem","state","JSON","parse","error","Error","String","context","action","apply","arguments","login","_ref2","userId","role","pin","newState","setItem","stringify","setItemAsync","console","_x","_x2","_x3","logout","removeItem","deleteItemAsync","verifyPin","_ref4","storedPin","getItemAsync","_x4","createChildProfile","_ref5","profile","info","childName","name","id","Date","now","_x5","switchToChildMode","_ref6","childId","_x6","canChangeChatBackgrounds","Object","assign","_createContextHook2","AuthProvider","useAuth"],"sources":["AuthContext.tsx"],"sourcesContent":["/**\n * Auth Context\n * Manages authentication state\n */\n\nimport createContextHook from '@nkzw/create-context-hook';\nimport { useState, useCallback, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport * as SecureStore from 'expo-secure-store';\nimport { logger } from '@/utils/logger';\n\nexport interface AuthState {\n  isAuthenticated: boolean;\n  userId?: string;\n  role?: 'parent' | 'child';\n}\n\nconst AUTH_STORAGE_KEY = '@auth_state';\nconst PIN_STORAGE_KEY = '@auth_pin';\n\nexport const [AuthProvider, useAuth] = createContextHook(() => {\n  const [authState, setAuthState] = useState<AuthState>({\n    isAuthenticated: false,\n  });\n\n  useEffect(() => {\n    const loadAuthState = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n        if (stored) {\n          const state = JSON.parse(stored);\n          setAuthState(state);\n        }\n      } catch (error) {\n        logger.error('Failed to load auth state', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'loadAuthState' });\n      }\n    };\n\n    loadAuthState();\n  }, []);\n\n  const login = useCallback(async (userId: string, role: 'parent' | 'child', pin?: string) => {\n    const newState: AuthState = {\n      isAuthenticated: true,\n      userId,\n      role,\n    };\n\n    setAuthState(newState);\n\n    try {\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(newState));\n      if (pin) {\n        await SecureStore.setItemAsync(PIN_STORAGE_KEY, pin);\n      }\n    } catch (error) {\n      console.error('[AuthContext] Failed to save auth state:', error);\n    }\n  }, []);\n\n  const logout = useCallback(async () => {\n    setAuthState({\n      isAuthenticated: false,\n    });\n\n    try {\n      await AsyncStorage.removeItem(AUTH_STORAGE_KEY);\n      await SecureStore.deleteItemAsync(PIN_STORAGE_KEY);\n    } catch (error) {\n      logger.error('Failed to clear auth state', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'logout' });\n    }\n  }, []);\n\n  const verifyPin = useCallback(async (pin: string): Promise<boolean> => {\n    try {\n      const storedPin = await SecureStore.getItemAsync(PIN_STORAGE_KEY);\n      return storedPin === pin;\n    } catch (error) {\n      logger.error('Failed to verify PIN', error instanceof Error ? error : new Error(String(error)), { context: 'AuthContext', action: 'verifyPin' });\n      return false;\n    }\n  }, []);\n\n  const createChildProfile = useCallback(async (profile: { name: string; permissions?: any }) => {\n    // Создание профиля ребенка\n    // В реальном приложении здесь будет логика создания профиля\n    logger.info('Creating child profile', { context: 'AuthContext', action: 'createChildProfile', childName: profile.name });\n    return { id: `child_${Date.now()}`, name: profile.name };\n  }, []);\n\n  const switchToChildMode = useCallback(async (childId: string): Promise<boolean> => {\n    if (authState.role === 'parent') {\n      await login(childId, 'child');\n      return true;\n    }\n    return false;\n  }, [authState.role, login]);\n\n  const canChangeChatBackgrounds = useCallback((): boolean => {\n    // Родители могут менять фоны чатов\n    return authState.role === 'parent' && authState.isAuthenticated;\n  }, [authState.role, authState.isAuthenticated]);\n\n  return {\n    ...authState,\n    login,\n    logout,\n    verifyPin,\n    createChildProfile,\n    switchToChildMode,\n    canChangeChatBackgrounds,\n  };\n});\n"],"mappings":"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","ignoreList":[]}