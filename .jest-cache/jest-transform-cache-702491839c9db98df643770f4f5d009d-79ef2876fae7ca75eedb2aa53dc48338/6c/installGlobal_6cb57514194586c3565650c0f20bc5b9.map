{"version":3,"names":["BUILTIN_SYMBOL","Symbol","for","defineLazyObjectProperty","object","name","descriptor","get","enumerable","writable","value","valueSet","getValue","setValue","newValue","Object","defineProperty","configurable","set","installGlobal","global","globalThis","getOwnPropertyDescriptor","__DEV__","backupName","toUpperCase","slice","_ref","_ref$configurable","console","error"],"sources":["installGlobal.ts"],"sourcesContent":["/**\n * Copyright © 2025 650 Industries.\n * Copyright © Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * Fork of unexposed react-native module\n * https://github.com/facebook/react-native/blob/c5fb371061c1083684a23aa0852f6dbfb74a8b52/packages/react-native/Libraries/Utilities/PolyfillFunctions.js#L1\n */\n\n// Add a well-known shared symbol that doesn't show up in iteration or inspection\n// this can be used to detect if the global object abides by the Expo team's documented\n// built-in requirements.\nconst BUILTIN_SYMBOL = Symbol.for('expo.builtin');\n\n/** Defines a lazily evaluated property on the supplied `object` */\nfunction defineLazyObjectProperty<T>(\n  object: object,\n  name: string,\n  descriptor: {\n    get: () => T;\n    enumerable?: boolean;\n    writable?: boolean;\n  }\n): void {\n  const { get } = descriptor;\n  const enumerable = descriptor.enumerable !== false;\n  const writable = descriptor.writable !== false;\n\n  let value: any;\n  let valueSet = false;\n  function getValue(): T {\n    // WORKAROUND: A weird infinite loop occurs where calling `getValue` calls\n    // `setValue` which calls `Object.defineProperty` which somehow triggers\n    // `getValue` again. Adding `valueSet` breaks this loop.\n    if (!valueSet) {\n      // Calling `get()` here can trigger an infinite loop if it fails to\n      // remove the getter on the property, which can happen when executing\n      // JS in a V8 context.  `valueSet = true` will break this loop, and\n      // sets the value of the property to undefined, until the code in `get()`\n      // finishes, at which point the property is set to the correct value.\n      valueSet = true;\n      setValue(get());\n    }\n    return value;\n  }\n  function setValue(newValue: T): void {\n    value = newValue;\n    valueSet = true;\n    Object.defineProperty(object, name, {\n      value: newValue,\n      configurable: true,\n      enumerable,\n      writable,\n    });\n  }\n\n  Object.defineProperty(object, name, {\n    get: getValue,\n    set: setValue,\n    configurable: true,\n    enumerable,\n  });\n}\n\n/**\n * Sets an object's property. If a property with the same name exists, this will\n * replace it but maintain its descriptor configuration. The property will be\n * replaced with a lazy getter.\n *\n * In DEV mode the original property value will be preserved as `original[PropertyName]`\n * so that, if necessary, it can be restored. For example, if you want to route\n * network requests through DevTools (to trace them):\n *\n *   global.XMLHttpRequest = global.originalXMLHttpRequest;\n *\n * @see https://github.com/facebook/react-native/issues/934\n */\nexport function installGlobal<T extends object>(name: string, getValue: () => T): void {\n  // @ts-ignore: globalThis is not defined in all environments\n  const object = typeof global !== 'undefined' ? global : globalThis;\n  const descriptor = Object.getOwnPropertyDescriptor(object, name);\n  if (__DEV__ && descriptor) {\n    const backupName = `original${name[0].toUpperCase()}${name.slice(1)}`;\n    Object.defineProperty(object, backupName, descriptor);\n  }\n\n  const { enumerable, writable, configurable = false } = descriptor || {};\n  if (descriptor && !configurable) {\n    console.error('Failed to set polyfill. ' + name + ' is not configurable.');\n    return;\n  }\n\n  defineLazyObjectProperty(object, name, {\n    get() {\n      const value = getValue();\n      Object.defineProperty(value, BUILTIN_SYMBOL, {\n        value: true,\n        enumerable: false,\n        configurable: false,\n      });\n\n      return value;\n    },\n    enumerable: enumerable !== false,\n    writable: writable !== false,\n  });\n}\n"],"mappings":";;;;AAcA,IAAMA,cAAc,GAAGC,MAAM,CAACC,GAAG,CAAC,cAAc,CAAC;AAGjD,SAASC,wBAAwBA,CAC/BC,MAAc,EACdC,IAAY,EACZC,UAIC,EACK;EACN,IAAQC,GAAG,GAAKD,UAAU,CAAlBC,GAAG;EACX,IAAMC,UAAU,GAAGF,UAAU,CAACE,UAAU,KAAK,KAAK;EAClD,IAAMC,QAAQ,GAAGH,UAAU,CAACG,QAAQ,KAAK,KAAK;EAE9C,IAAIC,KAAU;EACd,IAAIC,QAAQ,GAAG,KAAK;EACpB,SAASC,QAAQA,CAAA,EAAM;IAIrB,IAAI,CAACD,QAAQ,EAAE;MAMbA,QAAQ,GAAG,IAAI;MACfE,QAAQ,CAACN,GAAG,CAAC,CAAC,CAAC;IACjB;IACA,OAAOG,KAAK;EACd;EACA,SAASG,QAAQA,CAACC,QAAW,EAAQ;IACnCJ,KAAK,GAAGI,QAAQ;IAChBH,QAAQ,GAAG,IAAI;IACfI,MAAM,CAACC,cAAc,CAACZ,MAAM,EAAEC,IAAI,EAAE;MAClCK,KAAK,EAAEI,QAAQ;MACfG,YAAY,EAAE,IAAI;MAClBT,UAAU,EAAVA,UAAU;MACVC,QAAQ,EAARA;IACF,CAAC,CAAC;EACJ;EAEAM,MAAM,CAACC,cAAc,CAACZ,MAAM,EAAEC,IAAI,EAAE;IAClCE,GAAG,EAAEK,QAAQ;IACbM,GAAG,EAAEL,QAAQ;IACbI,YAAY,EAAE,IAAI;IAClBT,UAAU,EAAVA;EACF,CAAC,CAAC;AACJ;AAeO,SAASW,aAAaA,CAAmBd,IAAY,EAAEO,QAAiB,EAAQ;EAErF,IAAMR,MAAM,GAAG,OAAOgB,MAAM,KAAK,WAAW,GAAGA,MAAM,GAAGC,UAAU;EAClE,IAAMf,UAAU,GAAGS,MAAM,CAACO,wBAAwB,CAAClB,MAAM,EAAEC,IAAI,CAAC;EAChE,IAAIkB,OAAO,IAAIjB,UAAU,EAAE;IACzB,IAAMkB,UAAU,GAAG,WAAWnB,IAAI,CAAC,CAAC,CAAC,CAACoB,WAAW,CAAC,CAAC,GAAGpB,IAAI,CAACqB,KAAK,CAAC,CAAC,CAAC,EAAE;IACrEX,MAAM,CAACC,cAAc,CAACZ,MAAM,EAAEoB,UAAU,EAAElB,UAAU,CAAC;EACvD;EAEA,IAAAqB,IAAA,GAAuDrB,UAAU,IAAI,CAAC,CAAC;IAA/DE,UAAU,GAAAmB,IAAA,CAAVnB,UAAU;IAAEC,QAAQ,GAAAkB,IAAA,CAARlB,QAAQ;IAAAmB,iBAAA,GAAAD,IAAA,CAAEV,YAAY;IAAZA,YAAY,GAAAW,iBAAA,cAAG,KAAK,GAAAA,iBAAA;EAClD,IAAItB,UAAU,IAAI,CAACW,YAAY,EAAE;IAC/BY,OAAO,CAACC,KAAK,CAAC,0BAA0B,GAAGzB,IAAI,GAAG,uBAAuB,CAAC;IAC1E;EACF;EAEAF,wBAAwB,CAACC,MAAM,EAAEC,IAAI,EAAE;IACrCE,GAAG,WAAHA,GAAGA,CAAA,EAAG;MACJ,IAAMG,KAAK,GAAGE,QAAQ,CAAC,CAAC;MACxBG,MAAM,CAACC,cAAc,CAACN,KAAK,EAAEV,cAAc,EAAE;QAC3CU,KAAK,EAAE,IAAI;QACXF,UAAU,EAAE,KAAK;QACjBS,YAAY,EAAE;MAChB,CAAC,CAAC;MAEF,OAAOP,KAAK;IACd,CAAC;IACDF,UAAU,EAAEA,UAAU,KAAK,KAAK;IAChCC,QAAQ,EAAEA,QAAQ,KAAK;EACzB,CAAC,CAAC;AACJ","ignoreList":[]}