{"version":3,"names":["React","useMemo","Text","CustomEmoji","loadCustomEmojis","jsx","_jsx","EmojiRenderer","_ref","text","_ref$emojiSize","emojiSize","style","_React$useState","useState","_React$useState2","_slicedToArray","customEmojis","setCustomEmojis","useEffect","then","parsedContent","parts","customEmojiMap","Map","map","e","id","customEmojiRegex","lastIndex","match","exec","index","push","type","content","substring","emojiId","emoji","get","length","children","part","size"],"sources":["EmojiRenderer.tsx"],"sourcesContent":["/**\n * Компонент для отображения эмодзи в тексте сообщений\n * \n * Поддерживает:\n * - Стандартные Unicode эмодзи\n * - Кастомные эмодзи (изображения, SVG)\n * - Специальный формат [custom:id] для кастомных эмодзи\n */\n\nimport React, { useMemo } from 'react';\nimport { Text } from 'react-native';\nimport { CustomEmoji } from './CustomEmoji';\nimport { loadCustomEmojis, CustomEmojiData } from '@/utils/customEmojis';\n\ninterface EmojiRendererProps {\n  text: string;\n  emojiSize?: number;\n  style?: any;\n}\n\nexport function EmojiRenderer({ text, emojiSize = 20, style }: EmojiRendererProps) {\n  const [customEmojis, setCustomEmojis] = React.useState<CustomEmojiData[]>([]);\n\n  React.useEffect(() => {\n    loadCustomEmojis().then(setCustomEmojis);\n  }, []);\n\n  // Парсинг текста с поддержкой кастомных эмодзи\n  const parsedContent = useMemo(() => {\n    type ParsedPart = \n      | { type: 'text'; content: string }\n      | { type: 'custom'; content: string; emoji: CustomEmojiData };\n    \n    const parts: ParsedPart[] = [];\n    const customEmojiMap = new Map(customEmojis.map(e => [e.id, e]));\n    \n    // Регулярное выражение для поиска кастомных эмодзи [custom:id]\n    const customEmojiRegex = /\\[custom:([^\\]]+)\\]/g;\n    let lastIndex = 0;\n    let match;\n\n    while ((match = customEmojiRegex.exec(text)) !== null) {\n      // Добавляем текст до кастомного эмодзи\n      if (match.index > lastIndex) {\n        parts.push({\n          type: 'text',\n          content: text.substring(lastIndex, match.index),\n        });\n      }\n\n      // Добавляем кастомный эмодзи\n      const emojiId = match[1];\n      const emoji = customEmojiMap.get(emojiId);\n      \n      if (emoji) {\n        parts.push({\n          type: 'custom',\n          content: match[0],\n          emoji,\n        });\n      } else {\n        // Если эмодзи не найден, оставляем как текст\n        parts.push({\n          type: 'text',\n          content: match[0],\n        });\n      }\n\n      lastIndex = match.index + match[0].length;\n    }\n\n    // Добавляем оставшийся текст\n    if (lastIndex < text.length) {\n      parts.push({\n        type: 'text',\n        content: text.substring(lastIndex),\n      });\n    }\n\n    return parts.length > 0 ? parts : [{ type: 'text', content: text }];\n  }, [text, customEmojis]);\n\n  return (\n    <Text style={style}>\n      {parsedContent.map((part, index) => {\n        if (part.type === 'custom' && 'emoji' in part) {\n          return (\n            <CustomEmoji\n              key={index}\n              emoji={part.emoji}\n              size={emojiSize}\n            />\n          );\n        }\n        return <Text key={index}>{part.content}</Text>;\n      })}\n    </Text>\n  );\n}\n"],"mappings":"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","ignoreList":[]}