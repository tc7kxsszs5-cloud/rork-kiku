{"version":3,"names":["APP_DATA_VERSION","API_VERSION","SCHEMA_VERSION","getVersionInfo","packageJson","require","appVersion","version","dataVersion","apiVersion","schemaVersion","_unused","createVersionedData","data","arguments","length","undefined","migratedAt","Date","now","needsMigration","currentVersion","targetVersion","getStoredVersion","_x","_getStoredVersion","apply","_asyncToGenerator","storageKey","AsyncStorage","default","getItem","parseInt","_unused2","saveStoredVersion","_x2","_x3","_saveStoredVersion","setItem","String","error","console"],"sources":["versioning.ts"],"sourcesContent":["/**\n * Система версионирования для проекта KIKU\n * \n * Обеспечивает плавный переход между версиями данных без потери информации\n */\n\nexport const APP_DATA_VERSION = 1; // Текущая версия данных\nexport const API_VERSION = 1; // Текущая версия API\nexport const SCHEMA_VERSION = 1; // Текущая версия схем\n\nexport interface VersionInfo {\n  appVersion: string; // Версия приложения из package.json\n  dataVersion: number; // Версия данных\n  apiVersion: number; // Версия API\n  schemaVersion: number; // Версия схем\n}\n\n/**\n * Получить информацию о версиях\n */\nexport function getVersionInfo(): VersionInfo {\n  try {\n    const packageJson = require('../../package.json');\n    return {\n      appVersion: packageJson.version || '1.0.0',\n      dataVersion: APP_DATA_VERSION,\n      apiVersion: API_VERSION,\n      schemaVersion: SCHEMA_VERSION,\n    };\n  } catch {\n    return {\n      appVersion: '1.0.0',\n      dataVersion: APP_DATA_VERSION,\n      apiVersion: API_VERSION,\n      schemaVersion: SCHEMA_VERSION,\n    };\n  }\n}\n\n/**\n * Версионированные данные\n */\nexport interface VersionedData<T = any> {\n  version: number;\n  data: T;\n  migratedAt?: number;\n  migratedFrom?: number;\n}\n\n/**\n * Создать версионированные данные\n */\nexport function createVersionedData<T>(data: T, version: number = APP_DATA_VERSION): VersionedData<T> {\n  return {\n    version,\n    data,\n    migratedAt: Date.now(),\n  };\n}\n\n/**\n * Проверить нужно ли мигрировать данные\n */\nexport function needsMigration(currentVersion: number, targetVersion: number = APP_DATA_VERSION): boolean {\n  return currentVersion < targetVersion;\n}\n\n/**\n * Получить версию из хранилища\n */\nexport async function getStoredVersion(storageKey: string): Promise<number> {\n  try {\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\n    const version = await AsyncStorage.getItem(`${storageKey}_version`);\n    return version ? parseInt(version, 10) : 1; // По умолчанию версия 1\n  } catch {\n    return 1;\n  }\n}\n\n/**\n * Сохранить версию в хранилище\n */\nexport async function saveStoredVersion(storageKey: string, version: number): Promise<void> {\n  try {\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\n    await AsyncStorage.setItem(`${storageKey}_version`, String(version));\n  } catch (error) {\n    console.error(`[versioning] Failed to save version for ${storageKey}:`, error);\n  }\n}\n"],"mappings":";AAMA,OAAO,IAAMA,gBAAgB,GAAG,CAAC;AACjC,OAAO,IAAMC,WAAW,GAAG,CAAC;AAC5B,OAAO,IAAMC,cAAc,GAAG,CAAC;AAY/B,OAAO,SAASC,cAAcA,CAAA,EAAgB;EAC5C,IAAI;IACF,IAAMC,WAAW,GAAGC,OAAO,CAAC,oBAAoB,CAAC;IACjD,OAAO;MACLC,UAAU,EAAEF,WAAW,CAACG,OAAO,IAAI,OAAO;MAC1CC,WAAW,EAAER,gBAAgB;MAC7BS,UAAU,EAAER,WAAW;MACvBS,aAAa,EAAER;IACjB,CAAC;EACH,CAAC,CAAC,OAAAS,OAAA,EAAM;IACN,OAAO;MACLL,UAAU,EAAE,OAAO;MACnBE,WAAW,EAAER,gBAAgB;MAC7BS,UAAU,EAAER,WAAW;MACvBS,aAAa,EAAER;IACjB,CAAC;EACH;AACF;AAeA,OAAO,SAASU,mBAAmBA,CAAIC,IAAO,EAAwD;EAAA,IAAtDN,OAAe,GAAAO,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGd,gBAAgB;EAChF,OAAO;IACLO,OAAO,EAAPA,OAAO;IACPM,IAAI,EAAJA,IAAI;IACJI,UAAU,EAAEC,IAAI,CAACC,GAAG,CAAC;EACvB,CAAC;AACH;AAKA,OAAO,SAASC,cAAcA,CAACC,cAAsB,EAAqD;EAAA,IAAnDC,aAAqB,GAAAR,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGd,gBAAgB;EAC7F,OAAOqB,cAAc,GAAGC,aAAa;AACvC;AAKA,gBAAsBC,gBAAgBA,CAAAC,EAAA;EAAA,OAAAC,iBAAA,CAAAC,KAAA,OAAAZ,SAAA;AAAA;AAQrC,SAAAW,kBAAA;EAAAA,iBAAA,GAAAE,iBAAA,CARM,WAAgCC,UAAkB,EAAmB;IAC1E,IAAI;MACF,IAAMC,YAAY,GAAG,OAAO,MAAM,CAAC,2CAA2C,CAAC,EAAEC,OAAO;MACxF,IAAMvB,OAAO,SAASsB,YAAY,CAACE,OAAO,CAAC,GAAGH,UAAU,UAAU,CAAC;MACnE,OAAOrB,OAAO,GAAGyB,QAAQ,CAACzB,OAAO,EAAE,EAAE,CAAC,GAAG,CAAC;IAC5C,CAAC,CAAC,OAAA0B,QAAA,EAAM;MACN,OAAO,CAAC;IACV;EACF,CAAC;EAAA,OAAAR,iBAAA,CAAAC,KAAA,OAAAZ,SAAA;AAAA;AAKD,gBAAsBoB,iBAAiBA,CAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,kBAAA,CAAAX,KAAA,OAAAZ,SAAA;AAAA;AAOtC,SAAAuB,mBAAA;EAAAA,kBAAA,GAAAV,iBAAA,CAPM,WAAiCC,UAAkB,EAAErB,OAAe,EAAiB;IAC1F,IAAI;MACF,IAAMsB,YAAY,GAAG,OAAO,MAAM,CAAC,2CAA2C,CAAC,EAAEC,OAAO;MACxF,MAAMD,YAAY,CAACS,OAAO,CAAC,GAAGV,UAAU,UAAU,EAAEW,MAAM,CAAChC,OAAO,CAAC,CAAC;IACtE,CAAC,CAAC,OAAOiC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,2CAA2CZ,UAAU,GAAG,EAAEY,KAAK,CAAC;IAChF;EACF,CAAC;EAAA,OAAAH,kBAAA,CAAAX,KAAA,OAAAZ,SAAA;AAAA","ignoreList":[]}