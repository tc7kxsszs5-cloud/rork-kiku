{"version":3,"names":["createContextHook","useState","useEffect","useCallback","AsyncStorage","Platform","SYNC_SETTINGS_STORAGE_KEY","DEFAULT_SYNC_SETTINGS","autoSyncEnabled","frequency","source","_createContextHook","_useState","_useState2","_slicedToArray","settings","setSettings","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","isSyncing","setIsSyncing","isMounted","timer","loadSettings","_ref","_asyncToGenerator","stored","getItem","parsedSettings","JSON","parse","Object","assign","error","console","apply","arguments","OS","setTimeout","clearTimeout","updateSettings","_ref2","updates","updatedSettings","setItem","stringify","log","_x","triggerSync","prev","lastSyncStatus","Promise","resolve","lastSyncTimestamp","Date","now","_createContextHook2","SyncSettingsProvider","useSyncSettings"],"sources":["SyncSettingsContext.tsx"],"sourcesContent":["import createContextHook from '@nkzw/create-context-hook';\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Platform } from 'react-native';\n\nexport type SyncFrequency = 'realtime' | '5min' | '15min' | '1hour';\nexport type SyncSource = 'local' | 'cloud';\n\nexport interface SyncSettings {\n  autoSyncEnabled: boolean;\n  frequency: SyncFrequency;\n  source: SyncSource;\n  lastSyncTimestamp?: number;\n  lastSyncStatus?: 'success' | 'error' | 'pending';\n}\n\nconst SYNC_SETTINGS_STORAGE_KEY = '@sync_settings';\n\nconst DEFAULT_SYNC_SETTINGS: SyncSettings = {\n  autoSyncEnabled: true,\n  frequency: 'realtime',\n  source: 'cloud',\n};\n\nexport const [SyncSettingsProvider, useSyncSettings] = createContextHook(() => {\n  const [settings, setSettings] = useState<SyncSettings>(DEFAULT_SYNC_SETTINGS);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSyncing, setIsSyncing] = useState(false);\n\n  useEffect(() => {\n    let isMounted = true;\n    let timer: ReturnType<typeof setTimeout> | undefined;\n\n    const loadSettings = async () => {\n      try {\n        const stored = await AsyncStorage.getItem(SYNC_SETTINGS_STORAGE_KEY);\n        if (!isMounted) {\n          return;\n        }\n        if (stored) {\n          const parsedSettings = JSON.parse(stored);\n          setSettings({ ...DEFAULT_SYNC_SETTINGS, ...parsedSettings });\n        }\n      } catch (error) {\n        console.error('[SyncSettingsContext] Error loading settings:', error);\n      } finally {\n        if (isMounted) {\n          setIsLoading(false);\n        }\n      }\n    };\n\n    if (Platform.OS !== 'web') {\n      loadSettings();\n    } else {\n      timer = setTimeout(loadSettings, 0);\n    }\n\n    return () => {\n      isMounted = false;\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, []);\n\n  const updateSettings = useCallback(async (updates: Partial<SyncSettings>) => {\n    try {\n      const updatedSettings = { ...settings, ...updates };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SYNC_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n      console.log('[SyncSettingsContext] Settings updated:', updates);\n    } catch (error) {\n      console.error('[SyncSettingsContext] Error updating settings:', error);\n    }\n  }, [settings]);\n\n  const triggerSync = useCallback(async () => {\n    if (isSyncing) {\n      return;\n    }\n\n    setIsSyncing(true);\n    setSettings(prev => ({ ...prev, lastSyncStatus: 'pending' }));\n\n    try {\n      // Здесь будет логика синхронизации с backend\n      // Пока что просто имитируем задержку\n      await new Promise(resolve => setTimeout(resolve, 1500));\n\n      const updatedSettings: SyncSettings = {\n        ...settings,\n        lastSyncTimestamp: Date.now(),\n        lastSyncStatus: 'success',\n      };\n      setSettings(updatedSettings);\n      await AsyncStorage.setItem(SYNC_SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\n\n      console.log('[SyncSettingsContext] Sync completed successfully');\n    } catch (error) {\n      console.error('[SyncSettingsContext] Error during sync:', error);\n      setSettings(prev => ({\n        ...prev,\n        lastSyncTimestamp: Date.now(),\n        lastSyncStatus: 'error',\n      }));\n    } finally {\n      setIsSyncing(false);\n    }\n  }, [settings, isSyncing]);\n\n  return {\n    settings,\n    isLoading,\n    isSyncing,\n    updateSettings,\n    triggerSync,\n  };\n});\n"],"mappings":"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","ignoreList":[]}