{"version":3,"names":["isTrialExpired","isSubscriptionExpired","checkSubscriptionStatus","describe","it","status","tier","features","advancedAnalytics","extendedHistory","multipleChildren","prioritySupport","customAlerts","exportData","aiRecommendations","expect","Date","now","toBe","futureTime","trialEndDate","pastTime","subscriptionId","subscriptionStartDate","subscriptionEndDate","result","updated","newStatus","toBeUndefined"],"sources":["premiumStatus.test.ts"],"sourcesContent":["/**\n * Модульные тесты для проверки статуса premium подписки\n * Только детерминированные тесты - никаких интеграций/асинхронности\n */\n\nimport {\n  isTrialExpired,\n  isSubscriptionExpired,\n  checkSubscriptionStatus,\n} from '@/utils/premiumStatus';\nimport { PremiumStatus } from '@/constants/PremiumContext';\n\ndescribe('isTrialExpired', () => {\n  it('должен возвращать false для free статуса', () => {\n    const status: PremiumStatus = {\n      tier: 'free',\n      features: {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать false если trial еще не истек', () => {\n    const futureTime = Date.now() + 7 * 24 * 60 * 60 * 1000; // +7 дней\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: futureTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать true если trial истек', () => {\n    const pastTime = Date.now() - 1000; // -1 секунда\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(true);\n  });\n\n  it('должен возвращать false если trialEndDate отсутствует', () => {\n    const status: PremiumStatus = {\n      tier: 'trial',\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isTrialExpired(status, Date.now())).toBe(false);\n  });\n});\n\ndescribe('isSubscriptionExpired', () => {\n  it('должен возвращать false для free статуса', () => {\n    const status: PremiumStatus = {\n      tier: 'free',\n      features: {\n        advancedAnalytics: false,\n        extendedHistory: false,\n        multipleChildren: false,\n        prioritySupport: false,\n        customAlerts: false,\n        exportData: false,\n        aiRecommendations: false,\n      },\n    };\n\n    expect(isSubscriptionExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать false если подписка еще не истекла', () => {\n    const futureTime = Date.now() + 30 * 24 * 60 * 60 * 1000; // +30 дней\n    const status: PremiumStatus = {\n      tier: 'premium',\n      subscriptionId: 'sub_123',\n      subscriptionStartDate: Date.now(),\n      subscriptionEndDate: futureTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isSubscriptionExpired(status, Date.now())).toBe(false);\n  });\n\n  it('должен возвращать true если подписка истекла', () => {\n    const pastTime = Date.now() - 1000; // -1 секунда\n    const status: PremiumStatus = {\n      tier: 'premium',\n      subscriptionId: 'sub_123',\n      subscriptionStartDate: pastTime - 30 * 24 * 60 * 60 * 1000,\n      subscriptionEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    expect(isSubscriptionExpired(status, Date.now())).toBe(true);\n  });\n});\n\ndescribe('checkSubscriptionStatus', () => {\n  it('должен возвращать updated: false если статус не изменился', () => {\n    const futureTime = Date.now() + 7 * 24 * 60 * 60 * 1000;\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: futureTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    const result = checkSubscriptionStatus(status, Date.now());\n\n    expect(result.updated).toBe(false);\n    expect(result.newStatus.tier).toBe('trial');\n  });\n\n  it('должен обновлять статус на free если trial истек', () => {\n    const pastTime = Date.now() - 1000;\n    const status: PremiumStatus = {\n      tier: 'trial',\n      trialEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    const result = checkSubscriptionStatus(status, Date.now());\n\n    expect(result.updated).toBe(true);\n    expect(result.newStatus.tier).toBe('free');\n    expect(result.newStatus.features.advancedAnalytics).toBe(false);\n    expect(result.newStatus.trialEndDate).toBeUndefined();\n  });\n\n  it('должен обновлять статус на free если подписка истекла', () => {\n    const pastTime = Date.now() - 1000;\n    const status: PremiumStatus = {\n      tier: 'premium',\n      subscriptionId: 'sub_123',\n      subscriptionStartDate: pastTime - 30 * 24 * 60 * 60 * 1000,\n      subscriptionEndDate: pastTime,\n      features: {\n        advancedAnalytics: true,\n        extendedHistory: true,\n        multipleChildren: true,\n        prioritySupport: true,\n        customAlerts: true,\n        exportData: true,\n        aiRecommendations: true,\n      },\n    };\n\n    const result = checkSubscriptionStatus(status, Date.now());\n\n    expect(result.updated).toBe(true);\n    expect(result.newStatus.tier).toBe('free');\n    expect(result.newStatus.features.advancedAnalytics).toBe(false);\n    expect(result.newStatus.subscriptionId).toBeUndefined();\n    expect(result.newStatus.subscriptionEndDate).toBeUndefined();\n  });\n});\n"],"mappings":"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","ignoreList":[]}