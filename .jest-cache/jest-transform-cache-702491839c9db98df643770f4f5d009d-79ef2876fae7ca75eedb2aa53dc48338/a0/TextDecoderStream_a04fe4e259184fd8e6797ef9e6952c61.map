{"version":3,"names":["TextDecoderStream","exports","_TransformStream","label","options","_this","_classCallCheck2","default","decoder","TextDecoder","_callSuper2","transform","chunk","controller","text","decode","stream","enqueue","e","error","flush","_inherits2","_createClass2","key","get","encoding","fatal","ignoreBOM","TransformStream","TextEncoderStream","_TransformStream2","_this2","encoder","TextEncoder","carry","String","undefined","lastCharIndex","length","lastCodeUnit","charCodeAt","fromCharCode","substring","encoded","encode"],"sources":["TextDecoderStream.ts"],"sourcesContent":["// https://encoding.spec.whatwg.org/#interface-textdecoderstream\nexport class TextDecoderStream extends TransformStream<Uint8Array | ArrayBuffer, string> {\n  private decoder: TextDecoder;\n\n  constructor(label?: string, options?: TextDecoderOptions) {\n    const decoder = new TextDecoder(label, options);\n    super({\n      transform(\n        chunk: ArrayBuffer | Uint8Array,\n        controller: TransformStreamDefaultController<string>\n      ) {\n        try {\n          const text = decoder.decode(chunk, { stream: true });\n          if (text) controller.enqueue(text);\n        } catch (e: unknown) {\n          controller.error(e);\n        }\n      },\n      flush(controller: TransformStreamDefaultController<string>) {\n        try {\n          const text = decoder.decode();\n          if (text) controller.enqueue(text);\n        } catch (e: unknown) {\n          controller.error(e);\n        }\n      },\n    });\n    this.decoder = decoder;\n  }\n\n  get encoding() {\n    return this.decoder.encoding;\n  }\n\n  get fatal() {\n    return this.decoder.fatal;\n  }\n\n  get ignoreBOM() {\n    return this.decoder.ignoreBOM;\n  }\n}\n\n// https://encoding.spec.whatwg.org/#interface-textencoderstream\nexport class TextEncoderStream extends TransformStream {\n  private encoder: TextEncoder;\n\n  constructor() {\n    const encoder = new TextEncoder();\n    let carry: string | undefined;\n    super({\n      transform(chunk: string, controller: TransformStreamDefaultController<Uint8Array>) {\n        chunk = String(chunk);\n        if (carry !== undefined) {\n          chunk = carry + chunk;\n          carry = undefined;\n        }\n\n        const lastCharIndex = chunk.length - 1;\n        const lastCodeUnit = chunk.charCodeAt(lastCharIndex);\n        if (lastCodeUnit >= 0xd800 && lastCodeUnit < 0xdc00) {\n          carry = String.fromCharCode(lastCodeUnit);\n          chunk = chunk.substring(0, lastCharIndex);\n        }\n\n        const encoded = encoder.encode(chunk);\n        if (encoded.length) {\n          try {\n            controller.enqueue(encoded);\n          } catch (e: unknown) {\n            controller.error(e);\n          }\n        }\n      },\n\n      flush(controller: TransformStreamDefaultController<Uint8Array>) {\n        if (carry !== undefined) {\n          try {\n            controller.enqueue(encoder.encode(carry));\n          } catch (e: unknown) {\n            controller.error(e);\n          } finally {\n            carry = undefined;\n          }\n        }\n      },\n    });\n    this.encoder = encoder;\n  }\n\n  get encoding() {\n    return this.encoder.encoding;\n  }\n}\n"],"mappings":"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","ignoreList":[]}