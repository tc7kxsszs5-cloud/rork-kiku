{"version":3,"names":["_reactNative","require","LoadBundleFromServerError","_Error","message","url","isTimeout","options","_this","_classCallCheck2","default","_callSuper2","name","_inherits2","_createClass2","_wrapNativeSuper2","Error","LoadBundleFromServerRequestError","_LoadBundleFromServer","_this2","_len","arguments","length","args","Array","_key","concat","fetchAsync","id","statusCode","responseText","headers","dataListener","completeListener","responseListener","incrementalDataListener","Promise","resolve","reject","addListener","Networking","bind","_ref","_ref2","_slicedToArray2","requestId","response","_ref3","_ref4","data","_ref5","_ref6","status","responseHeaders","_ref7","_ref8","error","cause","body","sendRequest","finally","_dataListener","_completeListener","_responseListener","_incrementalDataListe","remove"],"sources":["fetchAsync.native.ts"],"sourcesContent":["/**\n * Copyright (c) 650 Industries.\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// @ts-expect-error\nimport { Networking } from 'react-native';\n\ntype Subscriber = { remove: () => void };\n\nclass LoadBundleFromServerError extends Error {\n  name = 'LoadBundleFromServerError';\n\n  constructor(\n    message: string,\n    public url: string,\n    public isTimeout: boolean,\n    options?: ErrorOptions\n  ) {\n    super(message, options);\n  }\n}\n\nclass LoadBundleFromServerRequestError extends LoadBundleFromServerError {\n  name = 'LoadBundleFromServerRequestError';\n}\n\nexport function fetchAsync(\n  url: string\n): Promise<{ body: string; status: number; headers: Record<string, string> }> {\n  let id: string | null = null;\n  let statusCode: number | null = null;\n  let responseText: string | null = null;\n  let headers: Record<string, string> = {};\n  let dataListener: Subscriber | null = null;\n  let completeListener: Subscriber | null = null;\n  let responseListener: Subscriber | null = null;\n  let incrementalDataListener: Subscriber | null = null;\n  return new Promise<{ body: string; status: number; headers: Record<string, string> }>(\n    (resolve, reject) => {\n      const addListener = Networking.addListener.bind() as (\n        event: string,\n        callback: (props: [string, any, any]) => any\n      ) => Subscriber;\n      dataListener = addListener('didReceiveNetworkData', ([requestId, response]) => {\n        if (requestId === id) {\n          responseText = response;\n        }\n      });\n      incrementalDataListener = addListener(\n        'didReceiveNetworkIncrementalData',\n        ([requestId, data]) => {\n          if (requestId === id) {\n            if (responseText != null) {\n              responseText += data;\n            } else {\n              responseText = data;\n            }\n          }\n        }\n      );\n      responseListener = addListener(\n        'didReceiveNetworkResponse',\n        ([requestId, status, responseHeaders]) => {\n          if (requestId === id) {\n            statusCode = status;\n            headers = responseHeaders;\n          }\n        }\n      );\n      completeListener = addListener(\n        'didCompleteNetworkResponse',\n        ([requestId, error, isTimeout]) => {\n          if (requestId === id) {\n            if (error) {\n              reject(\n                new LoadBundleFromServerRequestError('Could not load bundle', url, isTimeout, {\n                  cause: error,\n                })\n              );\n            } else {\n              resolve({ body: responseText!, status: statusCode!, headers });\n            }\n          }\n        }\n      );\n      (Networking.sendRequest as any)(\n        'GET',\n        'asyncRequest',\n        url,\n        {\n          'expo-platform': process.env.EXPO_OS,\n        },\n        '',\n        'text',\n        true,\n        0,\n        (requestId: string) => {\n          id = requestId;\n        },\n        true\n      );\n    }\n  ).finally(() => {\n    dataListener?.remove();\n    completeListener?.remove();\n    responseListener?.remove();\n    incrementalDataListener?.remove();\n  });\n}\n"],"mappings":"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","ignoreList":[]}