{"version":3,"names":["z","publicProcedure","listDeviceRecords","getDeviceRecord","cov_1f83bnwuw8","s","sendExpoPushNotification","_ref","_asyncToGenerator","message","f","_result$data","response","fetch","method","headers","body","JSON","stringify","result","json","data","status","b","id","_result$data2","error","console","Error","_x","apply","arguments","sendPushToDeviceProcedure","input","object","deviceId","string","min","title","record","any","optional","sound","priority","enum","channelId","mutation","_ref3","_ref2","_ref4","device","success","pushToken","Object","assign","to","notificationId","_x2","sendPushToUserProcedure","userId","_ref6","_ref5","_ref7","allDevices","userDevices","filter","length","sent","total","results","Promise","allSettled","map","r","value","failed","i","reason","undefined","_x3","sendRiskAlertPushProcedure","chatId","messageId","riskLevel","reasons","array","chatName","_ref9","_ref8","_ref10","riskLevelLabels","low","medium","high","critical","type","_x4"],"sources":["send-push.ts"],"sourcesContent":["import { z } from 'zod';\nimport { publicProcedure } from '../../create-context.js';\nimport { listDeviceRecords, getDeviceRecord } from './store.js';\n\n// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Expo Push Notification\ninterface ExpoPushMessage {\n  to: string;\n  sound?: string;\n  title?: string;\n  body?: string;\n  data?: Record<string, any>;\n  badge?: number;\n  priority?: 'default' | 'normal' | 'high';\n  channelId?: string;\n}\n\n// –û—Ç–ø—Ä–∞–≤–∫–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Expo Push API\nconst sendExpoPushNotification = async (message: ExpoPushMessage): Promise<{ status: 'ok' | 'error'; id?: string; error?: string }> => {\n  try {\n    const response = await fetch('https://exp.host/--/api/v2/push/send', {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Accept-Encoding': 'gzip, deflate',\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(message),\n    });\n\n    const result = await response.json();\n    \n    if (result.data?.status === 'ok') {\n      return { status: 'ok', id: result.data.id };\n    } else {\n      return { status: 'error', error: result.data?.message || 'Unknown error' };\n    }\n  } catch (error) {\n    console.error('[send-push] Expo Push API error:', error);\n    return { status: 'error', error: error instanceof Error ? error.message : 'Network error' };\n  }\n};\n\n// –û—Ç–ø—Ä–∞–≤–∫–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–¥–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É\nexport const sendPushToDeviceProcedure = publicProcedure\n  .input(\n    z.object({\n      deviceId: z.string().min(3),\n      title: z.string().min(1),\n      body: z.string().min(1),\n      data: z.record(z.string(), z.any()).optional(),\n      sound: z.string().optional(),\n      priority: z.enum(['default', 'normal', 'high']).optional(),\n      channelId: z.string().optional(),\n    })\n  )\n  .mutation(async ({ input }) => {\n    const { deviceId, title, body, data, sound, priority, channelId } = input;\n\n    // –ü–æ–ª—É—á–∞–µ–º –∑–∞–ø–∏—Å—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\n    const device = getDeviceRecord(deviceId);\n    if (!device) {\n      return {\n        success: false,\n        error: 'Device not found',\n      };\n    }\n\n    if (!device.pushToken) {\n      return {\n        success: false,\n        error: 'Device has no push token',\n      };\n    }\n\n    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Expo Push API\n    const message: ExpoPushMessage = {\n      to: device.pushToken,\n      title,\n      body,\n      sound: sound || 'default',\n      priority: priority || 'high',\n      data: data || {},\n      ...(channelId && { channelId }),\n    };\n\n    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Expo Push API\n    const result = await sendExpoPushNotification(message);\n\n    if (result.status === 'ok') {\n      return {\n        success: true,\n        notificationId: result.id,\n        deviceId: device.deviceId,\n      };\n    } else {\n      return {\n        success: false,\n        error: result.error || 'Failed to send notification',\n      };\n    }\n  });\n\n// –û—Ç–ø—Ä–∞–≤–∫–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ä–æ–¥–∏—Ç–µ–ª—è–º)\nexport const sendPushToUserProcedure = publicProcedure\n  .input(\n    z.object({\n      userId: z.string().min(1),\n      title: z.string().min(1),\n      body: z.string().min(1),\n      data: z.record(z.string(), z.any()).optional(),\n      sound: z.string().optional(),\n      priority: z.enum(['default', 'normal', 'high']).optional(),\n      channelId: z.string().optional(),\n    })\n  )\n  .mutation(async ({ input }) => {\n    const { userId, title, body, data, sound, priority, channelId } = input;\n\n    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    const allDevices = listDeviceRecords();\n    const userDevices = allDevices.filter((device) => device.userId === userId && device.pushToken);\n\n    if (userDevices.length === 0) {\n      return {\n        success: false,\n        error: 'No devices found for user',\n        sent: 0,\n        total: 0,\n      };\n    }\n\n    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    const results = await Promise.allSettled(\n      userDevices.map((device) => {\n        const message: ExpoPushMessage = {\n          to: device.pushToken!,\n          title,\n          body,\n          sound: sound || 'default',\n          priority: priority || 'high',\n          data: data || {},\n          ...(channelId && { channelId }),\n        };\n        return sendExpoPushNotification(message);\n      })\n    );\n\n    const sent = results.filter((r) => r.status === 'fulfilled' && r.value.status === 'ok').length;\n    const failed = results.length - sent;\n\n    return {\n      success: sent > 0,\n      sent,\n      total: userDevices.length,\n      failed,\n      results: results.map((r, i) => ({\n        deviceId: userDevices[i].deviceId,\n        status: r.status === 'fulfilled' ? r.value.status : 'error',\n        error: r.status === 'rejected' ? r.reason : (r.status === 'fulfilled' && r.value.status === 'error' ? r.value.error : undefined),\n      })),\n    };\n  });\n\n// –û—Ç–ø—Ä–∞–≤–∫–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ä–∏—Å–∫–∞ (–¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π)\nexport const sendRiskAlertPushProcedure = publicProcedure\n  .input(\n    z.object({\n      userId: z.string().min(1),\n      chatId: z.string().min(1),\n      messageId: z.string().min(1),\n      riskLevel: z.enum(['low', 'medium', 'high', 'critical']),\n      reasons: z.array(z.string()).optional(),\n      chatName: z.string().optional(),\n    })\n  )\n  .mutation(async ({ input }) => {\n    const { userId, chatId, messageId, riskLevel, reasons, chatName } = input;\n\n    const riskLevelLabels: Record<string, string> = {\n      low: '–ù–∏–∑–∫–∏–π',\n      medium: '–°—Ä–µ–¥–Ω–∏–π',\n      high: '–í—ã—Å–æ–∫–∏–π',\n      critical: '–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô',\n    };\n\n    const title = riskLevel === 'critical' \n      ? 'üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω!'\n      : `‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω ${riskLevelLabels[riskLevel]} —Ä–∏—Å–∫`;\n\n    const body = chatName \n      ? `–í —á–∞—Ç–µ \"${chatName}\": ${reasons?.[0] || '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É–≥—Ä–æ–∑–∞'}`\n      : `–í —á–∞—Ç–µ: ${reasons?.[0] || '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É–≥—Ä–æ–∑–∞'}`;\n\n    const sound = riskLevel === 'critical' ? 'default' : 'default';\n    const priority = riskLevel === 'critical' ? 'high' : 'normal';\n\n    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è–º\n    const allDevices = listDeviceRecords();\n    const userDevices = allDevices.filter((device) => device.userId === userId && device.pushToken);\n\n    if (userDevices.length === 0) {\n      return {\n        success: false,\n        error: 'No devices found for user',\n        sent: 0,\n      };\n    }\n\n    const results = await Promise.allSettled(\n      userDevices.map((device) => {\n        const message: ExpoPushMessage = {\n          to: device.pushToken!,\n          title,\n          body,\n          sound,\n          priority,\n          data: {\n            type: 'risk_alert',\n            chatId,\n            messageId,\n            riskLevel,\n            reasons: reasons || [],\n          },\n        };\n        return sendExpoPushNotification(message);\n      })\n    );\n\n    const sent = results.filter((r) => r.status === 'fulfilled' && r.value.status === 'ok').length;\n\n    return {\n      success: sent > 0,\n      sent,\n      total: userDevices.length,\n    };\n  });\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}