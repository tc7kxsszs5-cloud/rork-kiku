# –¢–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ KIKU

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
__tests__/
‚îú‚îÄ‚îÄ unit/                    # Unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
‚îÇ
‚îú‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ app/                 # –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ startup.test.tsx
‚îÇ   ‚îî‚îÄ‚îÄ contexts/            # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ MonitoringContext.test.tsx
‚îÇ       ‚îú‚îÄ‚îÄ ParentalControlsContext.test.tsx
‚îÇ       ‚îî‚îÄ‚îÄ UserContext.test.tsx
‚îÇ
‚îî‚îÄ‚îÄ e2e/                     # E2E —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã)
    ‚îú‚îÄ‚îÄ screens/             # –¢–µ—Å—Ç—ã —ç–∫—Ä–∞–Ω–æ–≤
    ‚îÇ   ‚îî‚îÄ‚îÄ monitoring.test.tsx
    ‚îî‚îÄ‚îÄ processes/           # –¢–µ—Å—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        ‚îú‚îÄ‚îÄ ai-analysis.test.tsx
        ‚îú‚îÄ‚îÄ sos-process.test.tsx
        ‚îî‚îÄ‚îÄ lifecycle.test.tsx
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
bun test
```

### –ó–∞–ø—É—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
```bash
# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–æ)
bun run test:unit

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
bun run test:integration

# –¢–æ–ª—å–∫–æ E2E —Ç–µ—Å—Ç—ã (–º–µ–¥–ª–µ–Ω–Ω–æ)
bun run test:e2e
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã + –æ—Ç—á—ë—Ç –ø–æ–∫—Ä—ã—Ç–∏—è
bun run test:coverage

# –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã + –ø–æ–∫—Ä—ã—Ç–∏–µ (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
bun run test:unit:coverage
```
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç—á—ë—Ç –≤ `coverage/lcov-report/index.html` (–æ—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ).

### Watch mode (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```bash
bun test --watch
```

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### ‚úÖ Unit —Ç–µ—Å—Ç—ã (`unit/`)
- –£—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (< 10ms –∫–∞–∂–¥—ã–π)

### ‚úÖ Integration —Ç–µ—Å—Ç—ã (`integration/`)

#### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`app/startup.test.tsx`)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ AsyncStorage
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã (`contexts/`)
- **MonitoringContext** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–∞—Ç–æ–≤, –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π, –∞–ª–µ—Ä—Ç—ã
- **ParentalControlsContext** - —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, SOS, –∫–æ–Ω—Ç–∞–∫—Ç—ã
- **UserContext** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Ñ–∏–ª–∏, –¥–µ—Ç–∏

### ‚úÖ E2E —Ç–µ—Å—Ç—ã (`e2e/`)

#### –≠–∫—Ä–∞–Ω—ã (`screens/`)
- –ü–æ–ª–Ω—ã–π flow —Ä–∞–±–æ—Ç—ã —Å —ç–∫—Ä–∞–Ω–∞–º–∏
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å UI

#### –ü—Ä–æ—Ü–µ—Å—Å—ã (`processes/`)
- **ai-analysis.test.tsx** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª AI –∞–Ω–∞–ª–∏–∑–∞
- **sos-process.test.tsx** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª SOS
- **lifecycle.test.tsx** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```typescript
// __tests__/integration/contexts/YourContext.test.tsx
import { renderHook, waitFor, act } from '@testing-library/react-native';
import { YourProvider, useYourContext } from '@/constants/YourContext';

const createWrapper = () => {
  return ({ children }: { children: React.ReactNode }) => (
    <YourProvider>{children}</YourProvider>
  );
};

describe('YourContext Integration', () => {
  it('–¥–æ–ª–∂–µ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', async () => {
    const { result } = renderHook(() => useYourContext(), {
      wrapper: createWrapper(),
    });

    await waitFor(() => {
      expect(result.current.isLoading).toBe(false);
    });
  });
});
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

```typescript
// __tests__/e2e/processes/your-process.test.tsx
describe('Your Process E2E', () => {
  it('–¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ—Ü–µ—Å—Å–∞', async () => {
    // 1. –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    // 2. –î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  });
});
```

## –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã (–º–∏—Ä–æ–≤—ã–µ –Ω–æ—Ä–º—ã)

–¢–µ—Å—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç—ã–º –Ω–æ—Ä–º–∞–º: **Jest**, **Testing Library**, **CI**.

- –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: [docs/testing/TESTING_STANDARDS.md](../docs/testing/TESTING_STANDARDS.md)
- –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫: [docs/testing/SKIPPED_TESTS.md](../docs/testing/SKIPPED_TESTS.md)
- –ü–ª–∞–Ω —Ä–∞–∑–±–æ—Ä–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ —Å–Ω—è—Ç–∏—è skip: [docs/testing/PLAN_UNSTABLE_AND_SKIP.md](../docs/testing/PLAN_UNSTABLE_AND_SKIP.md)

## Best Practices

1. **–ò–∑–æ–ª—è—Ü–∏—è** ‚Äî –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
2. **–ú–æ–∫–∏** ‚Äî –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã; —Å–±—Ä–æ—Å –≤ `beforeEach` (`jest.clearAllMocks()`)
3. **Arrange-Act-Assert** ‚Äî —á—ë—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞
4. **–û–∂–∏–¥–∞–Ω–∏–µ** ‚Äî `waitFor()` –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π; –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Äî `act()`
5. **–ó–∞–ø—Ä–æ—Å—ã** ‚Äî –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (—Ç–µ–∫—Å—Ç, —Ä–æ–ª–∏, `testId`), –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

## CI/CD

–í—Å–µ —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ CI/CD:
```bash
bun run ci:all  # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Üí –õ–∏–Ω—Ç ‚Üí TypeScript ‚Üí –¢–µ—Å—Ç—ã
```

## –ü–æ–∫—Ä—ã—Ç–∏–µ

–¶–µ–ª—å –ø–æ–∫—Ä—ã—Ç–∏—è: **> 80%** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ:
```bash
bun run test:coverage
```

–û—Ç—á–µ—Ç –±—É–¥–µ—Ç –≤ `coverage/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

## –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –∏–∑ `bun run test`

–°–µ–π—á–∞—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–Ω–µ** –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:

- **`__tests__/e2e/`** ‚Äî E2E —Ç—è–Ω–µ—Ç `app/_layout`, `expo-splash-screen`, NativeModules; –¥–ª—è Jest –≤ node env –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç.
- **`__tests__/integration/contexts.test.tsx`** ‚Äî `require()` –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç ESM `@nkzw/create-context-hook`, —á—Ç–æ –ª–æ–º–∞–µ—Ç Jest.

–ò—Ö –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ (`bun run test:e2e`, `bunx jest __tests__/integration/contexts.test`) –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä. –Ω–∞—Ç–∏–≤–Ω–æ–µ E2E).

## Troubleshooting

### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- –£–≤–µ–ª–∏—á—å—Ç–µ `testTimeout` –≤ `jest.config.js`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–∫–∏ async –æ–ø–µ—Ä–∞—Ü–∏–π

### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç –∏–∑-–∑–∞ –º–æ–∫–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ `jest.setup.js`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–æ–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –¢–µ—Å—Ç—ã –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç –º–æ–¥—É–ª–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `moduleNameMapper` –≤ `jest.config.js`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—É—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (`@/` –∞–ª–∏–∞—Å)

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- üìñ [TESTING_STANDARDS.md](../docs/testing/TESTING_STANDARDS.md) ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Jest, Testing Library, CI)
- üìñ [SKIPPED_TESTS.md](../docs/testing/SKIPPED_TESTS.md) ‚Äî –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
- üìñ [UNIT_TESTS_SUMMARY.md](../docs/testing/UNIT_TESTS_SUMMARY.md) ‚Äî —Å–≤–æ–¥–∫–∞ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤
- üìñ [KNOWN_ISSUES.md](../docs/testing/KNOWN_ISSUES.md) ‚Äî –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
